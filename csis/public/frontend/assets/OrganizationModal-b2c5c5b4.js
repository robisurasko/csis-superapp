import{F as D}from"./QuickEntryModal-157d8856.js";import{E as j}from"./DragVerticalIcon-e7d3e46c.js";import{u as F}from"./index-31644aa3.js";import{i as S}from"./Link-4317fd36.js";import{m as C,B as T,i as y,l as c,z as U,k as $,e as h,f as m,g as f,w as M,d as r,t as J,u as i,b as p,p as z,a3 as L,E as q,I as G,J as V}from"./index-85632e04.js";const H={class:"px-4 pt-5 pb-6 bg-surface-modal sm:px-6"},K={class:"flex items-center justify-between mb-5"},P={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},W={class:"flex items-center gap-1"},X={class:"px-4 pt-4 pb-7 sm:px-6"},Y={class:"space-y-2"},se={__name:"OrganizationModal",props:C({options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{},organization:{},organizationModifiers:{},showQuickEntryModal:{},showQuickEntryModalModifiers:{}}),emits:C(["openAddressModal"],["update:modelValue","update:organization","update:showQuickEntryModal"]),setup(d,{emit:O}){const g=d,k=O,{isManager:Q}=F(),B=T(),t=y(d,"modelValue"),_=y(d,"organization"),w=c(!1);c(null);let u=c({organization_name:"",website:"",annual_revenue:"",no_of_employees:"1-10",industry:""}),E=c({});const v=c(null);async function I(){const a=await q("frappe.client.insert",{doc:{doctype:"CRM Organization",...u.value}},{onError:e=>{var o,l;e.error.exc_type=="ValidationError"&&(v.value=(l=(o=e.error)==null?void 0:o.messages)==null?void 0:l[0])}});w.value=!1,a.name&&(G("organization_created"),R(a))}function R(a){var e,o;a.name&&g.options.redirect?B.push({name:"Organization",params:{organizationId:a.name}}):(o=(e=_.value)==null?void 0:e.reload)==null||o.call(e),t.value=!1,g.options.afterInsert&&g.options.afterInsert(a)}const b=U({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Organization"],params:{doctype:"CRM Organization",type:"Quick Entry"},auto:!0,transform:a=>a.forEach(e=>{e.sections.forEach(o=>{o.columns.forEach(l=>{l.fields.forEach(n=>{n.fieldname=="address"?(n.create=(s,x)=>{u.value.address=s,k("openAddressModal"),t.value=!1,x()},n.edit=s=>{k("openAddressModal",s),t.value=!1}):n.fieldtype==="Table"&&(u.value[n.fieldname]=[])})})})})});$(()=>t.value,a=>{a&&V(()=>{var e;E.value=((e=_.value)==null?void 0:e.doc)||_.value||{},u.value={...E.value}})});const N=y(d,"showQuickEntryModal");function A(){N.value=!0,V(()=>t.value=!1)}return(a,e)=>{const o=h("Button"),l=h("ErrorMessage"),n=h("Dialog");return m(),f(n,{modelValue:t.value,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value=s),options:{size:"xl"}},{body:M(()=>{var s;return[r("div",H,[r("div",K,[r("div",null,[r("h3",P,J(a.__("New Organization")),1)]),r("div",W,[i(Q)()&&!i(S)?(m(),f(o,{key:0,variant:"ghost",class:"w-7",onClick:A},{default:M(()=>[p(j,{class:"w-4 h-4"})]),_:1})):z("",!0),p(o,{variant:"ghost",class:"w-7",onClick:e[0]||(e[0]=x=>t.value=!1)},{default:M(()=>[p(i(L),{name:"x",class:"w-4 h-4"})]),_:1})])]),(s=i(b).data)!=null&&s.length?(m(),f(D,{key:0,tabs:i(b).data,data:i(u),doctype:"CRM Organization"},null,8,["tabs","data"])):z("",!0),v.value?(m(),f(l,{key:1,class:"mt-8",message:a.__(v.value)},null,8,["message"])):z("",!0)]),r("div",X,[r("div",Y,[p(o,{class:"w-full",variant:"solid",label:a.__("Create"),loading:w.value,onClick:I},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}};export{se as _};
//# sourceMappingURL=OrganizationModal-b2c5c5b4.js.map
