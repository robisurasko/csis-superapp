{"version":3,"file":"Deal-b1287224.js","sources":["../../../../frontend/src/pages/Deal.vue"],"sourcesContent":["<template>\n  <LayoutHeader v-if=\"deal.data\">\n    <template #left-header>\n      <Breadcrumbs :items=\"breadcrumbs\">\n        <template #prefix=\"{ item }\">\n          <Icon v-if=\"item.icon\" :icon=\"item.icon\" class=\"mr-2 h-4\" />\n        </template>\n      </Breadcrumbs>\n    </template>\n    <template #right-header>\n      <CustomActions\n        v-if=\"deal.data._customActions?.length\"\n        :actions=\"deal.data._customActions\"\n      />\n      <AssignTo\n        v-model=\"deal.data._assignedTo\"\n        :data=\"deal.data\"\n        doctype=\"CRM Deal\"\n      />\n      <Dropdown\n        :options=\"statusOptions('deal', updateField, deal.data._customStatuses)\"\n      >\n        <template #default=\"{ open }\">\n          <Button :label=\"deal.data.status\">\n            <template #prefix>\n              <IndicatorIcon :class=\"getDealStatus(deal.data.status).color\" />\n            </template>\n            <template #suffix>\n              <FeatherIcon\n                :name=\"open ? 'chevron-up' : 'chevron-down'\"\n                class=\"h-4\"\n              />\n            </template>\n          </Button>\n        </template>\n      </Dropdown>\n    </template>\n  </LayoutHeader>\n  <div v-if=\"deal.data\" class=\"flex h-full overflow-hidden\">\n    <Tabs as=\"div\" v-model=\"tabIndex\" :tabs=\"tabs\">\n      <template #tab-panel>\n        <Activities\n          ref=\"activities\"\n          doctype=\"CRM Deal\"\n          :tabs=\"tabs\"\n          v-model:reload=\"reload\"\n          v-model:tabIndex=\"tabIndex\"\n          v-model=\"deal\"\n        />\n      </template>\n    </Tabs>\n    <Resizer side=\"right\" class=\"flex flex-col justify-between border-l\">\n      <div\n        class=\"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium text-ink-gray-9\"\n        @click=\"copyToClipboard(deal.data.name)\"\n      >\n        {{ __(deal.data.name) }}\n      </div>\n      <div class=\"flex items-center justify-start gap-5 border-b p-5\">\n        <Tooltip :text=\"__('Organization logo')\">\n          <div class=\"group relative size-12\">\n            <Avatar\n              size=\"3xl\"\n              class=\"size-12\"\n              :label=\"title\"\n              :image=\"organization.data?.organization_logo\"\n            />\n          </div>\n        </Tooltip>\n        <div class=\"flex flex-col gap-2.5 truncate text-ink-gray-9\">\n          <Tooltip :text=\"organization.data?.name || __('Set an organization')\">\n            <div class=\"truncate text-2xl font-medium\">\n              {{ title }}\n            </div>\n          </Tooltip>\n          <div class=\"flex gap-1.5\">\n            <Tooltip v-if=\"callEnabled\" :text=\"__('Make a call')\">\n              <div>\n                <Button class=\"h-7 w-7\" @click=\"triggerCall\">\n                  <PhoneIcon class=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </Tooltip>\n            <Tooltip :text=\"__('Send an email')\">\n              <div>\n                <Button class=\"h-7 w-7\">\n                  <Email2Icon\n                    class=\"h-4 w-4\"\n                    @click=\"\n                      deal.data.email\n                        ? openEmailBox()\n                        : toast.error(__('No email set'))\n                    \"\n                  />\n                </Button>\n              </div>\n            </Tooltip>\n            <Tooltip :text=\"__('Go to website')\">\n              <div>\n                <Button class=\"h-7 w-7\">\n                  <LinkIcon\n                    class=\"h-4 w-4\"\n                    @click=\"\n                      deal.data.website\n                        ? openWebsite(deal.data.website)\n                        : toast.error(__('No website set'))\n                    \"\n                  />\n                </Button>\n              </div>\n            </Tooltip>\n            <Tooltip :text=\"__('Attach a file')\">\n              <div>\n                <Button class=\"size-7\" @click=\"showFilesUploader = true\">\n                  <AttachmentIcon class=\"size-4\" />\n                </Button>\n              </div>\n            </Tooltip>\n          </div>\n        </div>\n      </div>\n      <SLASection\n        v-if=\"deal.data.sla_status\"\n        v-model=\"deal.data\"\n        @updateField=\"updateField\"\n      />\n      <div\n        v-if=\"sections.data\"\n        class=\"flex flex-1 flex-col justify-between overflow-hidden\"\n      >\n        <SidePanelLayout\n          :sections=\"sections.data\"\n          :addContact=\"addContact\"\n          doctype=\"CRM Deal\"\n          :docname=\"deal.data.name\"\n          @reload=\"sections.reload\"\n        >\n          <template #actions=\"{ section }\">\n            <div v-if=\"section.name == 'contacts_section'\" class=\"pr-2\">\n              <Link\n                value=\"\"\n                doctype=\"Contact\"\n                @change=\"(e) => addContact(e)\"\n                :onCreate=\"\n                  (value, close) => {\n                    _contact = {\n                      first_name: value,\n                      company_name: deal.data.organization,\n                    }\n                    showContactModal = true\n                    close()\n                  }\n                \"\n              >\n                <template #target=\"{ togglePopover }\">\n                  <Button\n                    class=\"h-7 px-3\"\n                    variant=\"ghost\"\n                    icon=\"plus\"\n                    @click=\"togglePopover()\"\n                  />\n                </template>\n              </Link>\n            </div>\n          </template>\n          <template #default=\"{ section }\">\n            <div\n              v-if=\"section.name == 'contacts_section'\"\n              class=\"contacts-area\"\n            >\n              <div\n                v-if=\"dealContacts?.loading && dealContacts?.data?.length == 0\"\n                class=\"flex min-h-20 flex-1 items-center justify-center gap-3 text-base text-ink-gray-4\"\n              >\n                <LoadingIndicator class=\"h-4 w-4\" />\n                <span>{{ __('Loading...') }}</span>\n              </div>\n              <div\n                v-else-if=\"dealContacts?.data?.length\"\n                v-for=\"(contact, i) in dealContacts.data\"\n                :key=\"contact.name\"\n              >\n                <div class=\"px-2 pb-2.5\" :class=\"[i == 0 ? 'pt-5' : 'pt-2.5']\">\n                  <Section :opened=\"contact.opened\">\n                    <template #header=\"{ opened, toggle }\">\n                      <div\n                        class=\"flex cursor-pointer items-center justify-between gap-2 pr-1 text-base leading-5 text-ink-gray-7\"\n                      >\n                        <div\n                          class=\"flex h-7 items-center gap-2 truncate\"\n                          @click=\"toggle()\"\n                        >\n                          <Avatar\n                            :label=\"contact.full_name\"\n                            :image=\"contact.image\"\n                            size=\"md\"\n                          />\n                          <div class=\"truncate\">\n                            {{ contact.full_name }}\n                          </div>\n                          <Badge\n                            v-if=\"contact.is_primary\"\n                            class=\"ml-2\"\n                            variant=\"outline\"\n                            :label=\"__('Primary')\"\n                            theme=\"green\"\n                          />\n                        </div>\n                        <div class=\"flex items-center\">\n                          <Dropdown :options=\"contactOptions(contact)\">\n                            <Button\n                              icon=\"more-horizontal\"\n                              class=\"text-ink-gray-5\"\n                              variant=\"ghost\"\n                            />\n                          </Dropdown>\n                          <Button\n                            variant=\"ghost\"\n                            @click=\"\n                              router.push({\n                                name: 'Contact',\n                                params: { contactId: contact.name },\n                              })\n                            \"\n                          >\n                            <ArrowUpRightIcon class=\"h-4 w-4\" />\n                          </Button>\n                          <Button variant=\"ghost\" @click=\"toggle()\">\n                            <FeatherIcon\n                              name=\"chevron-right\"\n                              class=\"h-4 w-4 text-ink-gray-9 transition-all duration-300 ease-in-out\"\n                              :class=\"{ 'rotate-90': opened }\"\n                            />\n                          </Button>\n                        </div>\n                      </div>\n                    </template>\n                    <div\n                      class=\"flex flex-col gap-1.5 text-base text-ink-gray-8\"\n                    >\n                      <div class=\"flex items-center gap-3 pb-1.5 pl-1 pt-4\">\n                        <Email2Icon class=\"h-4 w-4\" />\n                        {{ contact.email }}\n                      </div>\n                      <div class=\"flex items-center gap-3 p-1 py-1.5\">\n                        <PhoneIcon class=\"h-4 w-4\" />\n                        {{ contact.mobile_no }}\n                      </div>\n                    </div>\n                  </Section>\n                </div>\n                <div\n                  v-if=\"i != dealContacts.data.length - 1\"\n                  class=\"mx-2 h-px border-t border-outline-gray-modals\"\n                />\n              </div>\n              <div\n                v-else\n                class=\"flex h-20 items-center justify-center text-base text-ink-gray-5\"\n              >\n                {{ __('No contacts added') }}\n              </div>\n            </div>\n          </template>\n        </SidePanelLayout>\n      </div>\n    </Resizer>\n  </div>\n  <ErrorPage\n    v-else-if=\"errorTitle\"\n    :errorTitle=\"errorTitle\"\n    :errorMessage=\"errorMessage\"\n  />\n  <OrganizationModal\n    v-model=\"showOrganizationModal\"\n    v-model:organization=\"_organization\"\n    :options=\"{\n      redirect: false,\n      afterInsert: (doc) => updateField('organization', doc.name),\n    }\"\n  />\n  <ContactModal\n    v-model=\"showContactModal\"\n    :contact=\"_contact\"\n    :options=\"{\n      redirect: false,\n      afterInsert: (doc) => addContact(doc.name),\n    }\"\n  />\n  <FilesUploader\n    v-if=\"deal.data?.name\"\n    v-model=\"showFilesUploader\"\n    doctype=\"CRM Deal\"\n    :docname=\"deal.data.name\"\n    @after=\"\n      () => {\n        activities?.all_activities?.reload()\n        changeTabTo('attachments')\n      }\n    \"\n  />\n</template>\n<script setup>\nimport ErrorPage from '@/components/ErrorPage.vue'\nimport Icon from '@/components/Icon.vue'\nimport Resizer from '@/components/Resizer.vue'\nimport LoadingIndicator from '@/components/Icons/LoadingIndicator.vue'\nimport ActivityIcon from '@/components/Icons/ActivityIcon.vue'\nimport EmailIcon from '@/components/Icons/EmailIcon.vue'\nimport Email2Icon from '@/components/Icons/Email2Icon.vue'\nimport CommentIcon from '@/components/Icons/CommentIcon.vue'\nimport DetailsIcon from '@/components/Icons/DetailsIcon.vue'\nimport PhoneIcon from '@/components/Icons/PhoneIcon.vue'\nimport TaskIcon from '@/components/Icons/TaskIcon.vue'\nimport NoteIcon from '@/components/Icons/NoteIcon.vue'\nimport WhatsAppIcon from '@/components/Icons/WhatsAppIcon.vue'\nimport IndicatorIcon from '@/components/Icons/IndicatorIcon.vue'\nimport LinkIcon from '@/components/Icons/LinkIcon.vue'\nimport ArrowUpRightIcon from '@/components/Icons/ArrowUpRightIcon.vue'\nimport SuccessIcon from '@/components/Icons/SuccessIcon.vue'\nimport AttachmentIcon from '@/components/Icons/AttachmentIcon.vue'\nimport LayoutHeader from '@/components/LayoutHeader.vue'\nimport Activities from '@/components/Activities/Activities.vue'\nimport OrganizationModal from '@/components/Modals/OrganizationModal.vue'\nimport AssignTo from '@/components/AssignTo.vue'\nimport FilesUploader from '@/components/FilesUploader/FilesUploader.vue'\nimport ContactModal from '@/components/Modals/ContactModal.vue'\nimport Link from '@/components/Controls/Link.vue'\nimport Section from '@/components/Section.vue'\nimport SidePanelLayout from '@/components/SidePanelLayout.vue'\nimport SLASection from '@/components/SLASection.vue'\nimport CustomActions from '@/components/CustomActions.vue'\nimport {\n  openWebsite,\n  setupAssignees,\n  setupCustomizations,\n  copyToClipboard,\n} from '@/utils'\nimport { getView } from '@/utils/view'\nimport { getSettings } from '@/stores/settings'\nimport { globalStore } from '@/stores/global'\nimport { statusesStore } from '@/stores/statuses'\nimport { getMeta } from '@/stores/meta'\nimport { whatsappEnabled, callEnabled } from '@/composables/settings'\nimport {\n  createResource,\n  Dropdown,\n  Tooltip,\n  Avatar,\n  Tabs,\n  Breadcrumbs,\n  call,\n  usePageMeta,\n  toast,\n} from 'frappe-ui'\nimport { useOnboarding } from 'frappe-ui/frappe'\nimport { ref, computed, h, onMounted, onBeforeUnmount } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { useActiveTabManager } from '@/composables/useActiveTabManager'\n\nconst { brand } = getSettings()\nconst { $dialog, $socket, makeCall } = globalStore()\nconst { statusOptions, getDealStatus } = statusesStore()\nconst { doctypeMeta } = getMeta('CRM Deal')\n\nconst { updateOnboardingStep, isOnboardingStepsCompleted } =\n  useOnboarding('frappecrm')\n\nconst route = useRoute()\nconst router = useRouter()\n\nconst props = defineProps({\n  dealId: {\n    type: String,\n    required: true,\n  },\n})\n\nconst errorTitle = ref('')\nconst errorMessage = ref('')\n\nconst deal = createResource({\n  url: 'crm.fcrm.doctype.crm_deal.api.get_deal',\n  params: { name: props.dealId },\n  cache: ['deal', props.dealId],\n  onSuccess: (data) => {\n    errorTitle.value = ''\n    errorMessage.value = ''\n\n    if (data.organization) {\n      organization.update({\n        params: { doctype: 'CRM Organization', name: data.organization },\n      })\n      organization.fetch()\n    }\n\n    setupAssignees(deal)\n    setupCustomizations(deal, {\n      doc: data,\n      $dialog,\n      $socket,\n      router,\n      toast,\n      updateField,\n      createToast: toast.create,\n      deleteDoc: deleteDeal,\n      resource: {\n        deal,\n        dealContacts,\n        sections,\n      },\n      call,\n    })\n  },\n  onError: (err) => {\n    if (err.messages?.[0]) {\n      errorTitle.value = __('Not permitted')\n      errorMessage.value = __(err.messages?.[0])\n    } else {\n      router.push({ name: 'Deals' })\n    }\n  },\n})\n\nconst organization = createResource({\n  url: 'frappe.client.get',\n  onSuccess: (data) => (deal.data._organizationObj = data),\n})\n\nonMounted(() => {\n  $socket.on('crm_customer_created', () => {\n    toast.success(__('Customer created successfully'))\n  })\n\n  if (deal.data) {\n    organization.data = deal.data._organizationObj\n    return\n  }\n  deal.fetch()\n})\n\nonBeforeUnmount(() => {\n  $socket.off('crm_customer_created')\n})\n\nconst reload = ref(false)\nconst showOrganizationModal = ref(false)\nconst showFilesUploader = ref(false)\nconst _organization = ref({})\n\nfunction updateDeal(fieldname, value, callback) {\n  value = Array.isArray(fieldname) ? '' : value\n\n  if (validateRequired(fieldname, value)) return\n\n  createResource({\n    url: 'frappe.client.set_value',\n    params: {\n      doctype: 'CRM Deal',\n      name: props.dealId,\n      fieldname,\n      value,\n    },\n    auto: true,\n    onSuccess: () => {\n      deal.reload()\n      reload.value = true\n      toast.success(__('Deal updated'))\n      callback?.()\n    },\n    onError: (err) => {\n      toast.error(__('Error updating deal: {0}', [err.messages?.[0]]))\n    },\n  })\n}\n\nfunction validateRequired(fieldname, value) {\n  let meta = deal.data.fields_meta || {}\n  if (meta[fieldname]?.reqd && !value) {\n    toast.error(__('{0} is a required field', [meta[fieldname].label]))\n    return true\n  }\n  return false\n}\n\nconst breadcrumbs = computed(() => {\n  let items = [{ label: __('Deals'), route: { name: 'Deals' } }]\n\n  if (route.query.view || route.query.viewType) {\n    let view = getView(route.query.view, route.query.viewType, 'CRM Deal')\n    if (view) {\n      items.push({\n        label: __(view.label),\n        icon: view.icon,\n        route: {\n          name: 'Deals',\n          params: { viewType: route.query.viewType },\n          query: { view: route.query.view },\n        },\n      })\n    }\n  }\n\n  items.push({\n    label: title.value,\n    route: { name: 'Deal', params: { dealId: deal.data.name } },\n  })\n  return items\n})\n\nconst title = computed(() => {\n  let t = doctypeMeta['CRM Deal']?.title_field || 'name'\n  return deal.data?.[t] || props.dealId\n})\n\nusePageMeta(() => {\n  return {\n    title: title.value,\n    icon: brand.favicon,\n  }\n})\n\nconst tabs = computed(() => {\n  let tabOptions = [\n    {\n      name: 'Activity',\n      label: __('Activity'),\n      icon: ActivityIcon,\n    },\n    {\n      name: 'Emails',\n      label: __('Emails'),\n      icon: EmailIcon,\n    },\n    {\n      name: 'Comments',\n      label: __('Comments'),\n      icon: CommentIcon,\n    },\n    {\n      name: 'Data',\n      label: __('Data'),\n      icon: DetailsIcon,\n    },\n    {\n      name: 'Calls',\n      label: __('Calls'),\n      icon: PhoneIcon,\n    },\n    {\n      name: 'Tasks',\n      label: __('Tasks'),\n      icon: TaskIcon,\n    },\n    {\n      name: 'Notes',\n      label: __('Notes'),\n      icon: NoteIcon,\n    },\n    {\n      name: 'Attachments',\n      label: __('Attachments'),\n      icon: AttachmentIcon,\n    },\n    {\n      name: 'WhatsApp',\n      label: __('WhatsApp'),\n      icon: WhatsAppIcon,\n      condition: () => whatsappEnabled.value,\n    },\n  ]\n  return tabOptions.filter((tab) => (tab.condition ? tab.condition() : true))\n})\nconst { tabIndex } = useActiveTabManager(tabs, 'lastDealTab')\n\nconst sections = createResource({\n  url: 'crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections',\n  cache: ['sidePanelSections', 'CRM Deal'],\n  params: { doctype: 'CRM Deal' },\n  transform: (data) => getParsedSections(data),\n})\n\nif (!sections.data) sections.fetch()\n\nfunction getParsedSections(_sections) {\n  _sections.forEach((section) => {\n    if (section.name == 'contacts_section') return\n    section.columns[0].fields.forEach((field) => {\n      if (field.fieldname == 'organization') {\n        field.create = (value, close) => {\n          _organization.value.organization_name = value\n          showOrganizationModal.value = true\n          close()\n        }\n        field.link = (org) =>\n          router.push({\n            name: 'Organization',\n            params: { organizationId: org },\n          })\n      }\n    })\n  })\n  return _sections\n}\n\nconst showContactModal = ref(false)\nconst _contact = ref({})\n\nfunction contactOptions(contact) {\n  let options = [\n    {\n      label: __('Remove'),\n      icon: 'trash-2',\n      onClick: () => removeContact(contact.name),\n    },\n  ]\n\n  if (!contact.is_primary) {\n    options.push({\n      label: __('Set as Primary Contact'),\n      icon: h(SuccessIcon, { class: 'h-4 w-4' }),\n      onClick: () => setPrimaryContact(contact.name),\n    })\n  }\n\n  return options\n}\n\nasync function addContact(contact) {\n  if (dealContacts.data?.find((c) => c.name === contact)) {\n    toast.error(__('Contact already added'))\n    return\n  }\n\n  let d = await call('crm.fcrm.doctype.crm_deal.crm_deal.add_contact', {\n    deal: props.dealId,\n    contact,\n  })\n  if (d) {\n    dealContacts.reload()\n    toast.success(__('Contact added'))\n  }\n}\n\nasync function removeContact(contact) {\n  let d = await call('crm.fcrm.doctype.crm_deal.crm_deal.remove_contact', {\n    deal: props.dealId,\n    contact,\n  })\n  if (d) {\n    dealContacts.reload()\n    toast.success(__('Contact removed'))\n  }\n}\n\nasync function setPrimaryContact(contact) {\n  let d = await call('crm.fcrm.doctype.crm_deal.crm_deal.set_primary_contact', {\n    deal: props.dealId,\n    contact,\n  })\n  if (d) {\n    dealContacts.reload()\n    toast.success(__('Primary contact set'))\n  }\n}\n\nconst dealContacts = createResource({\n  url: 'crm.fcrm.doctype.crm_deal.api.get_deal_contacts',\n  params: { name: props.dealId },\n  cache: ['deal_contacts', props.dealId],\n  transform: (data) => {\n    data.forEach((contact) => {\n      contact.opened = false\n    })\n    return data\n  },\n})\n\nif (!dealContacts.data) dealContacts.fetch()\n\nfunction triggerCall() {\n  let primaryContact = dealContacts.data?.find((c) => c.is_primary)\n  let mobile_no = primaryContact.mobile_no || null\n\n  if (!primaryContact) {\n    toast.error(__('No primary contact set'))\n    return\n  }\n\n  if (!mobile_no) {\n    toast.error(__('No mobile number set'))\n    return\n  }\n\n  makeCall(mobile_no)\n}\n\nfunction updateField(name, value, callback) {\n  if (name == 'status' && !isOnboardingStepsCompleted.value) {\n    updateOnboardingStep('change_deal_status')\n  }\n\n  updateDeal(name, value, () => {\n    deal.data[name] = value\n    callback?.()\n  })\n}\n\nasync function deleteDeal(name) {\n  await call('frappe.client.delete', {\n    doctype: 'CRM Deal',\n    name,\n  })\n  router.push({ name: 'Deals' })\n}\n\nconst activities = ref(null)\n\nfunction openEmailBox() {\n  activities.value.emailBox.show = true\n}\n</script>\n"],"names":["brand","getSettings","$dialog","$socket","makeCall","globalStore","statusOptions","getDealStatus","statusesStore","doctypeMeta","getMeta","updateOnboardingStep","isOnboardingStepsCompleted","useOnboarding","route","useRoute","router","useRouter","props","__props","errorTitle","ref","errorMessage","deal","createResource","data","organization","setupAssignees","setupCustomizations","toast","updateField","deleteDeal","dealContacts","sections","call","err","_a","_b","onMounted","onBeforeUnmount","reload","showOrganizationModal","showFilesUploader","_organization","updateDeal","fieldname","value","callback","validateRequired","meta","breadcrumbs","computed","items","view","getView","title","t","usePageMeta","tabs","ActivityIcon","EmailIcon","CommentIcon","DetailsIcon","PhoneIcon","TaskIcon","NoteIcon","AttachmentIcon","WhatsAppIcon","whatsappEnabled","tab","tabIndex","useActiveTabManager","getParsedSections","_sections","section","field","close","org","showContactModal","_contact","contactOptions","contact","options","removeContact","h","SuccessIcon","setPrimaryContact","addContact","c","triggerCall","primaryContact","mobile_no","name","activities","openEmailBox"],"mappings":"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"}