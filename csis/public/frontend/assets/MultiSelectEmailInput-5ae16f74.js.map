{"version":3,"file":"MultiSelectEmailInput-5ae16f74.js","sources":["../../../../frontend/src/components/Icons/EmailIcon.vue","../../../../frontend/src/components/Controls/MultiSelectEmailInput.vue"],"sourcesContent":["<template>\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M13.75 7.06416V12.1549C13.75 12.9834 13.0784 13.6549 12.25 13.6549H3.75C2.92157 13.6549 2.25 12.9834 2.25 12.1549V7.06416L6.81475 9.5221C7.55469 9.92053 8.44531 9.92053 9.18525 9.5221L13.75 7.06416ZM13.7469 5.93008C13.7137 5.41511 13.4172 4.95039 12.9583 4.70457L8.70833 2.42778C8.26586 2.19074 7.73414 2.19074 7.29167 2.42778L3.04167 4.70457C2.5828 4.95039 2.28629 5.41511 2.25311 5.93008L7.28885 8.64163C7.73282 8.88069 8.26719 8.88069 8.71115 8.64163L13.7469 5.93008ZM1.25 6.02679C1.25 5.10517 1.75706 4.25829 2.56945 3.82309L6.81945 1.5463C7.55691 1.15123 8.4431 1.15123 9.18055 1.5463L13.4306 3.82309C14.2429 4.25829 14.75 5.10517 14.75 6.02679V12.1549C14.75 13.5356 13.6307 14.6549 12.25 14.6549H3.75C2.36929 14.6549 1.25 13.5356 1.25 12.1549V6.02679Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n</template>\n","<template>\n  <div>\n    <div class=\"flex flex-wrap gap-1\">\n      <Button\n        ref=\"emails\"\n        v-for=\"value in values\"\n        :key=\"value\"\n        :label=\"value\"\n        theme=\"gray\"\n        variant=\"subtle\"\n        :class=\"{\n          'rounded bg-surface-white hover:!bg-surface-gray-1 focus-visible:ring-outline-gray-4':\n            variant === 'subtle',\n        }\"\n        @keydown.delete.capture.stop=\"removeLastValue\"\n      >\n        <template #suffix>\n          <FeatherIcon\n            class=\"h-3.5\"\n            name=\"x\"\n            @click.stop=\"removeValue(value)\"\n          />\n        </template>\n      </Button>\n      <div class=\"flex-1\">\n        <Combobox v-model=\"selectedValue\" nullable>\n          <Popover class=\"w-full\" v-model:show=\"showOptions\">\n            <template #target=\"{ togglePopover }\">\n              <ComboboxInput\n                ref=\"search\"\n                class=\"search-input form-input w-full border-none focus:border-none focus:!shadow-none focus-visible:!ring-0\"\n                :class=\"[\n                  variant == 'ghost'\n                    ? 'bg-surface-white hover:bg-surface-white'\n                    : 'bg-surface-gray-2 hover:bg-surface-gray-3',\n                  inputClass,\n                ]\"\n                :placeholder=\"placeholder\"\n                type=\"text\"\n                :value=\"query\"\n                @change=\"\n                  (e) => {\n                    query = e.target.value\n                    showOptions = true\n                  }\n                \"\n                autocomplete=\"off\"\n                @focus=\"() => togglePopover()\"\n                @keydown.delete.capture.stop=\"removeLastValue\"\n              />\n            </template>\n            <template #body=\"{ isOpen }\">\n              <div v-show=\"isOpen\">\n                <div\n                  class=\"mt-1 rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none\"\n                >\n                  <ComboboxOptions\n                    class=\"p-1.5 max-h-[12rem] overflow-y-auto\"\n                    static\n                  >\n                    <div\n                      v-if=\"!options.length\"\n                      class=\"flex gap-2 rounded px-2 py-1 text-base text-ink-gray-5\"\n                    >\n                      <FeatherIcon\n                        v-if=\"fetchContacts\"\n                        name=\"search\"\n                        class=\"h-4\"\n                      />\n                      {{\n                        fetchContacts\n                          ? __('No results found')\n                          : __('Type an email address to add')\n                      }}\n                    </div>\n                    <ComboboxOption\n                      v-for=\"option in options\"\n                      :key=\"option.value\"\n                      :value=\"option\"\n                      v-slot=\"{ active }\"\n                    >\n                      <li\n                        :class=\"[\n                          'flex cursor-pointer items-center rounded px-2 py-1 text-base',\n                          { 'bg-surface-gray-3': active },\n                        ]\"\n                      >\n                        <UserAvatar\n                          class=\"mr-2\"\n                          :user=\"option.value\"\n                          size=\"lg\"\n                        />\n                        <div class=\"flex flex-col gap-1 p-1 text-ink-gray-8\">\n                          <div class=\"text-base font-medium\">\n                            {{ option.label }}\n                          </div>\n                          <div class=\"text-sm text-ink-gray-5\">\n                            {{ option.value }}\n                          </div>\n                        </div>\n                      </li>\n                    </ComboboxOption>\n                  </ComboboxOptions>\n                </div>\n              </div>\n            </template>\n          </Popover>\n        </Combobox>\n      </div>\n    </div>\n    <ErrorMessage class=\"mt-2 pl-2\" v-if=\"error\" :message=\"error\" />\n    <div\n      v-if=\"info\"\n      class=\"whitespace-pre-line text-sm text-ink-blue-3 mt-2 pl-2\"\n    >\n      {{ info }}\n    </div>\n  </div>\n</template>\n\n<script setup>\nimport {\n  Combobox,\n  ComboboxInput,\n  ComboboxOptions,\n  ComboboxOption,\n} from '@headlessui/vue'\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport Popover from '@/components/frappe-ui/Popover.vue'\nimport { createResource } from 'frappe-ui'\nimport { ref, computed, nextTick } from 'vue'\nimport { watchDebounced } from '@vueuse/core'\n\nconst props = defineProps({\n  validate: {\n    type: Function,\n    default: null,\n  },\n  variant: {\n    type: String,\n    default: 'subtle',\n  },\n  placeholder: {\n    type: String,\n    default: '',\n  },\n  inputClass: {\n    type: String,\n    default: '',\n  },\n  errorMessage: {\n    type: Function,\n    default: (value) => `${value} is an Invalid value`,\n  },\n  fetchContacts: {\n    type: Boolean,\n    default: true,\n  },\n})\n\nconst values = defineModel()\n\nconst emails = ref([])\nconst search = ref(null)\nconst error = ref(null)\nconst info = ref(null)\nconst query = ref('')\nconst text = ref('')\nconst showOptions = ref(false)\n\nconst selectedValue = computed({\n  get: () => query.value || '',\n  set: (val) => {\n    query.value = ''\n    if (val) {\n      showOptions.value = false\n    }\n    val?.value && addValue(val.value)\n  },\n})\n\nwatchDebounced(\n  query,\n  (val) => {\n    val = val || ''\n    if (text.value === val && options.value?.length) return\n    text.value = val\n    reload(val)\n  },\n  { debounce: 300, immediate: true },\n)\n\nconst filterOptions = createResource({\n  url: 'crm.api.contact.search_emails',\n  method: 'POST',\n  cache: [text.value, 'Contact'],\n  params: { txt: text.value },\n  transform: (data) => {\n    let allData = data.map((option) => {\n      let fullName = option[0]\n      let email = option[1]\n      let name = option[2]\n      return {\n        label: fullName || name || email,\n        value: email,\n      }\n    })\n    return allData\n  },\n})\n\nconst options = computed(() => {\n  let searchedContacts = props.fetchContacts ? filterOptions.data : []\n  if (!searchedContacts?.length && query.value) {\n    searchedContacts.push({\n      label: query.value,\n      value: query.value,\n    })\n  }\n  return searchedContacts || []\n})\n\nfunction reload(val) {\n  if (!props.fetchContacts) return\n\n  filterOptions.update({\n    params: { txt: val },\n  })\n  filterOptions.reload()\n}\n\nconst addValue = (value) => {\n  error.value = null\n  info.value = null\n  if (value) {\n    const splitValues = value.split(',')\n    splitValues.forEach((value) => {\n      value = value.trim()\n      if (value) {\n        // check if value is not already in the values array\n        if (!values.value?.includes(value)) {\n          // check if value is valid\n          if (value && props.validate && !props.validate(value)) {\n            error.value = props.errorMessage(value)\n            query.value = value\n            return\n          }\n          // add value to values array\n          if (!values.value) {\n            values.value = [value]\n          } else {\n            values.value.push(value)\n          }\n          value = value.replace(value, '')\n        } else {\n          info.value = __('email already exists')\n        }\n      }\n    })\n    !error.value && (value = '')\n  }\n}\n\nconst removeValue = (value) => {\n  values.value = values.value.filter((v) => v !== value)\n}\n\nconst removeLastValue = () => {\n  if (query.value) return\n\n  let emailRef = emails.value[emails.value.length - 1]?.$el\n  if (document.activeElement === emailRef) {\n    values.value.pop()\n    nextTick(() => {\n      if (values.value.length) {\n        emailRef = emails.value[emails.value.length - 1].$el\n        emailRef?.focus()\n      } else {\n        setFocus()\n      }\n    })\n  } else {\n    emailRef?.focus()\n  }\n}\n\nfunction setFocus() {\n  search.value.$el.focus()\n}\n\ndefineExpose({ setFocus })\n</script>\n"],"names":["_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","props","__props","values","_useModel","emails","ref","search","error","info","query","text","showOptions","selectedValue","computed","val","addValue","watchDebounced","_a","options","reload","filterOptions","createResource","data","option","fullName","email","name","searchedContacts","value","removeValue","v","removeLastValue","emailRef","nextTick","setFocus","__expose"],"mappings":"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"}