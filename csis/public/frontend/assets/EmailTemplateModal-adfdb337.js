import{m as C,i as E,l as c,k as U,e as _,f as y,g as w,w as j,d as r,b as u,u as t,c as q,D as N,t as F,aa as S,ar as B,E as b,I as L,J as H}from"./index-85632e04.js";const J={class:"flex flex-col gap-4"},O={class:"flex sm:flex-row flex-col gap-4"},I={class:"flex-1"},P={class:"flex-1"},z={key:1},$={class:"mb-1.5 text-xs text-ink-gray-5"},K={__name:"EmailTemplateModal",props:C({emailTemplate:{type:Object,default:{}}},{modelValue:{},modelModifiers:{},reloadEmailTemplates:{},reloadEmailTemplatesModifiers:{}}),emits:C(["after"],["update:modelValue","update:reloadEmailTemplates"]),setup(f,{emit:A}){const v=f,m=E(f,"modelValue"),M=E(f,"reloadEmailTemplates"),d=c(""),h=c(null),T=c(null),p=c(!1);let e=c({content_type:"Rich Text"});async function k(){if(!V())return;const l={...v.emailTemplate},a={...e.value},o=l.name!==a.name;delete l.name,delete a.name;const s=JSON.stringify(l)!==JSON.stringify(a),i=a;if(!o&&!s){m.value=!1;return}o&&await R(),s&&await D(i),g()}async function R(){return await b("frappe.client.rename_doc",{doctype:"Email Template",old_name:v.emailTemplate.name,new_name:e.value.name})}async function D(l){return(await b("frappe.client.set_value",{doctype:"Email Template",name:e.value.name,fieldname:l})).name}async function x(){if(!V())return;const l=await b("frappe.client.insert",{doc:{doctype:"Email Template",...e.value}});l.name&&(L("email_template_created",{doctype:l.reference_doctype}),g())}function g(l){var a;(a=M.value)==null||a.reload(),m.value=!1}function V(){return e.value.use_html=e.value.content_type=="HTML",e.value.name?e.value.subject?!e.value.use_html&&(!e.value.response||e.value.response==="<p></p>")||e.value.use_html&&!e.value.response_html?(d.value="Content is required",!1):!0:(d.value="Subject is required",!1):(d.value="Name is required",!1)}return U(()=>m.value,l=>{l&&(p.value=!1,d.value="",H(()=>{var a,o,s,i;e.value.name?(o=(a=h.value)==null?void 0:a.el)==null||o.focus():(i=(s=T.value)==null?void 0:s.el)==null||i.focus(),e.value={...v.emailTemplate},e.value.content_type=e.value.use_html?"HTML":"Rich Text",e.value.name&&(p.value=!0)}))}),(l,a)=>{const o=_("FormControl"),s=_("ErrorMessage"),i=_("Dialog");return y(),w(i,{modelValue:m.value,"onUpdate:modelValue":a[7]||(a[7]=n=>m.value=n),options:{title:p.value?l.__(f.emailTemplate.name):l.__("Create Email Template"),size:"xl",actions:[{label:p.value?l.__("Update"):l.__("Create"),variant:"solid",onClick:()=>p.value?k():x()}]}},{"body-content":j(()=>[r("div",J,[r("div",O,[r("div",I,[u(o,{ref_key:"nameRef",ref:T,modelValue:t(e).name,"onUpdate:modelValue":a[0]||(a[0]=n=>t(e).name=n),placeholder:l.__("Payment Reminder"),label:l.__("Name"),required:!0},null,8,["modelValue","placeholder","label"])]),r("div",P,[u(o,{type:"select",modelValue:t(e).reference_doctype,"onUpdate:modelValue":a[1]||(a[1]=n=>t(e).reference_doctype=n),label:l.__("Doctype"),options:["CRM Deal","CRM Lead"],placeholder:l.__("CRM Deal")},null,8,["modelValue","label","placeholder"])])]),r("div",null,[u(o,{ref_key:"subjectRef",ref:h,modelValue:t(e).subject,"onUpdate:modelValue":a[2]||(a[2]=n=>t(e).subject=n),label:l.__("Subject"),placeholder:l.__("Payment Reminder from Frappé - (#{{ name }})"),required:!0},null,8,["modelValue","label","placeholder"])]),r("div",null,[u(o,{type:"select",modelValue:t(e).content_type,"onUpdate:modelValue":a[3]||(a[3]=n=>t(e).content_type=n),label:l.__("Content Type"),default:"Rich Text",options:["Rich Text","HTML"],placeholder:l.__("Rich Text")},null,8,["modelValue","label","placeholder"])]),r("div",null,[t(e).content_type==="HTML"?(y(),w(o,{key:0,type:"textarea",label:l.__("Content"),required:!0,ref:"content",rows:10,modelValue:t(e).response_html,"onUpdate:modelValue":a[4]||(a[4]=n=>t(e).response_html=n),placeholder:l.__(`<p>Dear {{ lead_name }},</p>

<p>This is a reminder for the payment of {{ grand_total }}.</p>

<p>Thanks,</p>
<p>Frappé</p>`)},null,8,["label","modelValue","placeholder"])):(y(),q("div",z,[r("div",$,[N(F(l.__("Content"))+" ",1),a[8]||(a[8]=r("span",{class:"text-ink-red-3"},"*",-1))]),u(t(S),{ref:"content","editor-class":"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors",bubbleMenu:!0,content:t(e).response,onChange:a[5]||(a[5]=n=>t(e).response=n),placeholder:l.__(`Dear {{ lead_name }}, 

This is a reminder for the payment of {{ grand_total }}. 

Thanks, 
Frappé`)},null,8,["content","placeholder"])]))]),r("div",null,[u(t(B),{modelValue:t(e).enabled,"onUpdate:modelValue":a[6]||(a[6]=n=>t(e).enabled=n),label:l.__("Enabled")},null,8,["modelValue","label"])]),u(s,{message:l.__(d.value)},null,8,["message"])])]),_:1},8,["modelValue","options"])}}};export{K as _};
//# sourceMappingURL=EmailTemplateModal-adfdb337.js.map
