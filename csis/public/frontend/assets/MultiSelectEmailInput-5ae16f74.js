import{K as H,f as n,c as v,d as r,m as U,i as J,l as i,j as I,bf as A,z as G,e as B,F as T,r as z,g as C,w as f,b as m,q as E,n as $,a1 as O,u as V,bg as Q,a4 as W,bh as X,p as k,D as Y,t as M,bi as R,a5 as ee,bj as te,J as ae}from"./index-85632e04.js";import{_ as le}from"./index-31644aa3.js";import{P as se}from"./Popover-4a1551e7.js";const oe={},ne={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ue(s,y){return n(),v("svg",ne,y[0]||(y[0]=[r("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.75 7.06416V12.1549C13.75 12.9834 13.0784 13.6549 12.25 13.6549H3.75C2.92157 13.6549 2.25 12.9834 2.25 12.1549V7.06416L6.81475 9.5221C7.55469 9.92053 8.44531 9.92053 9.18525 9.5221L13.75 7.06416ZM13.7469 5.93008C13.7137 5.41511 13.4172 4.95039 12.9583 4.70457L8.70833 2.42778C8.26586 2.19074 7.73414 2.19074 7.29167 2.42778L3.04167 4.70457C2.5828 4.95039 2.28629 5.41511 2.25311 5.93008L7.28885 8.64163C7.73282 8.88069 8.26719 8.88069 8.71115 8.64163L13.7469 5.93008ZM1.25 6.02679C1.25 5.10517 1.75706 4.25829 2.56945 3.82309L6.81945 1.5463C7.55691 1.15123 8.4431 1.15123 9.18055 1.5463L13.4306 3.82309C14.2429 4.25829 14.75 5.10517 14.75 6.02679V12.1549C14.75 13.5356 13.6307 14.6549 12.25 14.6549H3.75C2.36929 14.6549 1.25 13.5356 1.25 12.1549V6.02679Z",fill:"currentColor"},null,-1)]))}const be=H(oe,[["render",ue]]),re={class:"flex flex-wrap gap-1"},ce={class:"flex-1"},ie={class:"mt-1 rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none"},de={key:0,class:"flex gap-2 rounded px-2 py-1 text-base text-ink-gray-5"},fe={class:"flex flex-col gap-1 p-1 text-ink-gray-8"},me={class:"text-base font-medium"},ve={class:"text-sm text-ink-gray-5"},pe={key:1,class:"whitespace-pre-line text-sm text-ink-blue-3 mt-2 pl-2"},xe={__name:"MultiSelectEmailInput",props:U({validate:{type:Function,default:null},variant:{type:String,default:"subtle"},placeholder:{type:String,default:""},inputClass:{type:String,default:""},errorMessage:{type:Function,default:s=>`${s} is an Invalid value`},fetchContacts:{type:Boolean,default:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(s,{expose:y}){const p=s,u=J(s,"modelValue"),h=i([]),S=i(null),g=i(null),b=i(null),o=i(""),x=i(""),_=i(!1),D=I({get:()=>o.value||"",set:e=>{o.value="",e&&(_.value=!1),e!=null&&e.value&&Z(e.value)}});A(o,e=>{var a;e=e||"",!(x.value===e&&((a=F.value)!=null&&a.length))&&(x.value=e,P(e))},{debounce:300,immediate:!0});const L=G({url:"crm.api.contact.search_emails",method:"POST",cache:[x.value,"Contact"],params:{txt:x.value},transform:e=>e.map(t=>{let d=t[0],w=t[1],l=t[2];return{label:d||l||w,value:w}})}),F=I(()=>{let e=p.fetchContacts?L.data:[];return!(e!=null&&e.length)&&o.value&&e.push({label:o.value,value:o.value}),e||[]});function P(e){p.fetchContacts&&(L.update({params:{txt:e}}),L.reload())}const Z=e=>{g.value=null,b.value=null,e&&(e.split(",").forEach(t=>{var d;if(t=t.trim(),t)if((d=u.value)!=null&&d.includes(t))b.value=__("email already exists");else{if(t&&p.validate&&!p.validate(t)){g.value=p.errorMessage(t),o.value=t;return}u.value?u.value.push(t):u.value=[t],t=t.replace(t,"")}}),!g.value&&(e=""))},j=e=>{u.value=u.value.filter(a=>a!==e)},K=()=>{var a;if(o.value)return;let e=(a=h.value[h.value.length-1])==null?void 0:a.$el;document.activeElement===e?(u.value.pop(),ae(()=>{u.value.length?(e=h.value[h.value.length-1].$el,e==null||e.focus()):N()})):e==null||e.focus()};function N(){S.value.$el.focus()}return y({setFocus:N}),(e,a)=>{const t=B("FeatherIcon"),d=B("Button"),w=B("ErrorMessage");return n(),v("div",null,[r("div",re,[(n(!0),v(T,null,z(u.value,l=>(n(),C(d,{ref_for:!0,ref_key:"emails",ref:h,key:l,label:l,theme:"gray",variant:"subtle",class:$({"rounded bg-surface-white hover:!bg-surface-gray-1 focus-visible:ring-outline-gray-4":s.variant==="subtle"}),onKeydownCapture:O(E(K,["stop"]),["delete"])},{suffix:f(()=>[m(t,{class:"h-3.5",name:"x",onClick:E(c=>j(l),["stop"])},null,8,["onClick"])]),_:2},1032,["label","class","onKeydownCapture"]))),128)),r("div",ce,[m(V(te),{modelValue:D.value,"onUpdate:modelValue":a[2]||(a[2]=l=>D.value=l),nullable:""},{default:f(()=>[m(se,{class:"w-full",show:_.value,"onUpdate:show":a[1]||(a[1]=l=>_.value=l)},{target:f(({togglePopover:l})=>[m(V(Q),{ref_key:"search",ref:S,class:$(["search-input form-input w-full border-none focus:border-none focus:!shadow-none focus-visible:!ring-0",[s.variant=="ghost"?"bg-surface-white hover:bg-surface-white":"bg-surface-gray-2 hover:bg-surface-gray-3",s.inputClass]]),placeholder:s.placeholder,type:"text",value:o.value,onChange:a[0]||(a[0]=c=>{o.value=c.target.value,_.value=!0}),autocomplete:"off",onFocus:()=>l(),onKeydownCapture:O(E(K,["stop"]),["delete"])},null,8,["class","placeholder","value","onFocus","onKeydownCapture"])]),body:f(({isOpen:l})=>[W(r("div",null,[r("div",ie,[m(V(X),{class:"p-1.5 max-h-[12rem] overflow-y-auto",static:""},{default:f(()=>[F.value.length?k("",!0):(n(),v("div",de,[s.fetchContacts?(n(),C(t,{key:0,name:"search",class:"h-4"})):k("",!0),Y(" "+M(s.fetchContacts?e.__("No results found"):e.__("Type an email address to add")),1)])),(n(!0),v(T,null,z(F.value,c=>(n(),C(V(R),{key:c.value,value:c},{default:f(({active:q})=>[r("li",{class:$(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-3":q}])},[m(le,{class:"mr-2",user:c.value,size:"lg"},null,8,["user"]),r("div",fe,[r("div",me,M(c.label),1),r("div",ve,M(c.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[ee,l]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])]),g.value?(n(),C(w,{key:0,class:"mt-2 pl-2",message:g.value},null,8,["message"])):k("",!0),b.value?(n(),v("div",pe,M(b.value),1)):k("",!0)])}}};export{be as E,xe as _};
//# sourceMappingURL=MultiSelectEmailInput-5ae16f74.js.map
