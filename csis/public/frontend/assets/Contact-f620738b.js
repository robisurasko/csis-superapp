import{_ as fe,a as ge}from"./Resizer-d799806c.js";import{_ as ve}from"./FadedScrollableDiv-f3f408b5.js";import{S as ye,g as he}from"./view-de8292bb.js";import{_ as be}from"./LayoutHeader-448e93da.js";import{P as we}from"./PhoneIcon-cb5df69f.js";import{C as Ce}from"./CameraIcon-72212b8c.js";import{D as ke}from"./DealsIcon-acabc22f.js";import{_ as xe}from"./DealsListView-4c2e5303.js";import{_ as De}from"./AddressModal-fd287daa.js";import{g as ze,u as Ie,b as W,a as X,f as Se,t as $e}from"./index-31644aa3.js";import{g as Me}from"./settings-5fcce07e.js";import{o as Pe}from"./organizations-50691aa9.js";import{s as Ve}from"./statuses-1a7b8e83.js";import{c as Ne}from"./Link-4317fd36.js";import{l as C,z as F,j as k,A as Re,x as je,c as x,u as o,g as f,w as p,p as _,b as c,F as Be,h as Ee,B as Fe,e as N,f as r,d as m,C as T,y as Te,t as D,D as Y,n as Z,E as b,G as R}from"./index-85632e04.js";import{_ as qe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-41a5d25f.js";import{_ as Ae}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{F as Oe}from"./FileUploader-ffa5e39e.js";import{a as Ue}from"./QuickEntryModal-157d8856.js";import"./Section-7d029c27.js";import"./DragVerticalIcon-e7d3e46c.js";import"./ArrowUpRightIcon-fffd9b01.js";import"./ListRows-e4885bb7.js";import"./AssignmentModal-f44425e3.js";import"./MultipleAvatar-8c461416.js";import"./IndicatorIcon-99f76624.js";import"./ListFooter-fc834b42.js";import"./label-f9f1f609.js";const Ge={key:1,ref:"parentRef",class:"flex h-full"},Le={class:"border-b"},Je={class:"flex flex-col items-start justify-start gap-4 p-5"},He={class:"flex gap-4 items-center"},Ke={class:"group relative h-15.5 w-15.5"},Qe={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},We={class:"flex flex-col gap-2 truncate text-ink-gray-9"},Xe={class:"truncate text-2xl font-medium"},Ye={key:0},Ze={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},ea={class:""},aa={class:"flex gap-1.5"},ta={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},oa={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},na={class:"flex flex-col items-center justify-center space-y-3"},Na={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(ee){const{brand:ae}=Me(),{$dialog:te,makeCall:oe}=ze(),{getUser:q}=Ie(),{getOrganization:A}=Pe(),{getDealStatus:ne}=Ve(),{doctypeMeta:se}=W("Contact"),g=ee,w=Ee(),O=Fe(),S=C(!1),d=C({}),$=C({}),M=C(""),j=C(""),a=F({url:"crm.api.contact.get_contact",cache:["contact",g.contactId],params:{name:g.contactId},auto:!0,transform:e=>({...e,actual_mobile_no:e.mobile_no,mobile_no:e.mobile_no}),onSuccess:()=>{M.value="",j.value=""},onError:e=>{var t,i;(t=e.messages)!=null&&t[0]?(M.value=__("Not permitted"),j.value=__((i=e.messages)==null?void 0:i[0])):O.push({name:"Contacts"})}}),le=k(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(w.query.view||w.query.viewType){let t=he(w.query.view,w.query.viewType,"Contact");t&&e.push({label:__(t.label),icon:t.icon,route:{name:"Contacts",params:{viewType:w.query.viewType},query:{view:w.query.view}}})}return e.push({label:U.value,route:{name:"Contact",params:{contactId:g.contactId}}}),e}),U=k(()=>{var t,i;let e=((t=se.Contact)==null?void 0:t.title_field)||"name";return((i=a.data)==null?void 0:i[e])||g.contactId});Re(()=>({title:U.value,icon:ae.favicon}));function ie(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return __("Only PNG and JPG images are allowed")}async function G(e){await b("frappe.client.set_value",{doctype:"Contact",name:g.contactId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),a.reload()}async function re(){te({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await b("frappe.client.delete",{doctype:"Contact",name:g.contactId}),e(),O.push({name:"Contacts"})}}]})}const L=C(0),ce=[{label:"Deals",icon:je(ke,{class:"h-4 w-4"}),count:k(()=>{var e;return(e=P.data)==null?void 0:e.length})}],P=F({url:"crm.api.contact.get_linked_deals",cache:["deals",g.contactId],params:{contact:g.contactId},auto:!0}),B=k(()=>!P.data||P.data==[]?[]:P.data.map(e=>_e(e))),E=F({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0,transform:e=>k(()=>me(e))});function me(e){return e.map(t=>(t.columns=t.columns.map(i=>(i.fields=i.fields.map(u=>{var z,V,l,v;return u.fieldname==="email_id"?{...u,read_only:!1,fieldtype:"Dropdown",options:((V=(z=a.data)==null?void 0:z.email_ids)==null?void 0:V.map(s=>({name:s.name,value:s.email_id,selected:s.email_id===a.data.email_id,placeholder:"john@doe.com",onClick:()=>{d.value.email_id=s.email_id,J("email",s.email_id)},onSave:(n,y)=>{y?(H("email",n.value),a.data.email_ids.length===1&&(d.value.email_id=n.value)):K("Contact Email",n.name,"email_id",n.value)},onDelete:async(n,y)=>{var I;a.data.email_ids=a.data.email_ids.filter(h=>h.name!==n.name),!y&&await Q("Contact Email",n.name),d.value.email_id===n.value&&(a.data.email_ids.length===0?d.value.email_id="":d.value.email_id=(I=a.data.email_ids.find(h=>h.is_primary))==null?void 0:I.email_id)}})))||[],create:()=>{var s,n;(n=(s=a.data)==null?void 0:s.email_ids)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:u.fieldname==="mobile_no"?{...u,read_only:!1,fieldtype:"Dropdown",options:((v=(l=a.data)==null?void 0:l.phone_nos)==null?void 0:v.map(s=>({name:s.name,value:s.phone,selected:s.phone===a.data.actual_mobile_no,onClick:()=>{d.value.actual_mobile_no=s.phone,d.value.mobile_no=s.phone,J("mobile_no",s.phone)},onSave:(n,y)=>{y?(H("phone",n.value),a.data.phone_nos.length===1&&(d.value.actual_mobile_no=n.value)):K("Contact Phone",n.name,"phone",n.value)},onDelete:async(n,y)=>{var I;a.data.phone_nos=a.data.phone_nos.filter(h=>h.name!==n.name),!y&&await Q("Contact Phone",n.name),d.value.actual_mobile_no===n.value&&(a.data.phone_nos.length===0?d.value.actual_mobile_no="":d.value.actual_mobile_no=(I=a.data.phone_nos.find(h=>h.is_primary_mobile_no))==null?void 0:I.phone)}})))||[],create:()=>{var s,n;(n=(s=a.data)==null?void 0:s.phone_nos)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:u.fieldname==="address"?{...u,create:(s,n)=>{d.value.address=s,$.value={},S.value=!0,n()},edit:async s=>{$.value=await b("frappe.client.get",{doctype:"Address",name:s}),S.value=!0}}:u}),i)),t))}async function J(e,t){await b("crm.api.contact.set_as_primary",{contact:a.data.name,field:e,value:t})&&(a.reload(),R.success(__("Contact updated")))}async function H(e,t){if(!t)return;await b("crm.api.contact.create_new",{contact:a.data.name,field:e,value:t})&&(a.reload(),R.success(__("Contact updated")))}async function K(e,t,i,u){await b("frappe.client.set_value",{doctype:e,name:t,fieldname:i,value:u})&&(a.reload(),R.success(__("Contact updated")))}async function Q(e,t){await b("frappe.client.delete",{doctype:e,name:t}),await a.reload(),R.success(__("Contact updated"))}const{getFormattedCurrency:de}=W("CRM Deal"),ue=k(()=>pe);function _e(e){var t,i;return{name:e.name,organization:{label:e.organization,logo:(t=A(e.organization))==null?void 0:t.organization_logo},annual_revenue:de("annual_revenue",e),status:{label:e.status,color:(i=ne(e.status))==null?void 0:i.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&q(e.deal_owner).full_name,...e.deal_owner&&q(e.deal_owner)},modified:{label:Se(e.modified),timeAgo:__($e(e.modified))}}}const pe=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,t)=>{const i=N("ErrorMessage"),u=N("Button"),z=N("FeatherIcon"),V=N("Badge");return r(),x(Be,null,[o(a).data?(r(),f(be,{key:0},{"left-header":p(()=>[c(o(qe),{items:le.value},{prefix:p(({item:l})=>[l.icon?(r(),f(ve,{key:0,icon:l.icon,class:"mr-2 h-4"},null,8,["icon"])):_("",!0)]),_:1},8,["items"])]),_:1})):_("",!0),o(a).data?(r(),x("div",Ge,[o(a).data?(r(),f(fe,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:p(()=>[m("div",Le,[c(o(Oe),{onSuccess:G,validateFile:ie},{default:p(({openFileSelector:l,error:v})=>{var s;return[m("div",Je,[m("div",He,[m("div",Ke,[c(o(X),{size:"3xl",class:"h-15.5 w-15.5",label:o(a).data.full_name,image:o(a).data.image},null,8,["label","image"]),(r(),f(T(o(a).data.image?o(Ae):"div"),Te(o(a).data.image?{options:[{icon:"upload",label:o(a).data.image?e.__("Change image"):e.__("Upload image"),onClick:l},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>G("")}]}:{onClick:l},{class:"!absolute bottom-0 left-0 right-0"}),{default:p(()=>[m("div",Qe,[c(Ce,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),m("div",We,[m("div",Xe,[o(a).data.salutation?(r(),x("span",Ye,D(o(a).data.salutation+". "),1)):_("",!0),m("span",null,D(o(a).data.full_name),1)]),o(a).data.company_name?(r(),x("div",Ze,[c(o(X),{size:"xs",label:o(a).data.company_name,image:(s=o(A)(o(a).data.company_name))==null?void 0:s.organization_logo},null,8,["label","image"]),m("span",ea,D(o(a).data.company_name),1)])):_("",!0),c(i,{message:e.__(v)},null,8,["message"])])]),m("div",aa,[o(a).data.actual_mobile_no?(r(),f(u,{key:0,label:e.__("Make Call"),size:"sm",onClick:t[0]||(t[0]=n=>o(Ne)&&o(oe)(o(a).data.actual_mobile_no))},{prefix:p(()=>[c(we,{class:"h-4 w-4"})]),_:1},8,["label"])):_("",!0),c(u,{label:e.__("Delete"),theme:"red",size:"sm",onClick:re},{prefix:p(()=>[c(z,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])])])]}),_:1})]),o(E).data?(r(),x("div",ta,[c(ye,{sections:o(E).data,doctype:"Contact",docname:o(a).data.name,onReload:o(E).reload},null,8,["sections","docname","onReload"])])):_("",!0)]),_:1},8,["parent"])):_("",!0),c(o(Ue),{as:"div",modelValue:L.value,"onUpdate:modelValue":t[1]||(t[1]=l=>L.value=l),tabs:ce},{"tab-item":p(({tab:l,selected:v})=>[m("button",{class:Z(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":v}])},[l.icon?(r(),f(T(l.icon),{key:0,class:"h-5"})):_("",!0),Y(" "+D(e.__(l.label))+" ",1),c(V,{class:Z(["group-hover:bg-surface-gray-7",[v?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:p(()=>[Y(D(l.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":p(({tab:l})=>[l.label==="Deals"&&B.value.length?(r(),f(xe,{key:0,class:"mt-4",rows:B.value,columns:ue.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):_("",!0),B.value.length?_("",!0):(r(),x("div",oa,[m("div",na,[(r(),f(T(l.icon),{class:"!h-10 !w-10"})),m("div",null,D(e.__("No {0} Found",[e.__(l.label)])),1)])]))]),_:1},8,["modelValue"])],512)):M.value?(r(),f(ge,{key:2,errorTitle:M.value,errorMessage:j.value},null,8,["errorTitle","errorMessage"])):_("",!0),c(De,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=l=>S.value=l),address:$.value,"onUpdate:address":t[3]||(t[3]=l=>$.value=l)},null,8,["modelValue","address"])],64)}}};export{Na as default};
//# sourceMappingURL=Contact-f620738b.js.map
