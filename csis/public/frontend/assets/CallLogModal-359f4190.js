import{E as ne}from"./DragVerticalIcon-e7d3e46c.js";import{A as me}from"./ArrowUpRightIcon-fffd9b01.js";import{K as X,f as n,c,d as t,B as _e,i as H,l as h,j as ie,k as re,e as U,b as u,w as L,t as I,u as f,g as $,p as b,a3 as S,F as z,r as ue,C as ve,D as pe,_ as ge,n as q,x as ee,E as K,J as W,m as fe,z as G,I as Ce,aq as ye,y as he}from"./index-85632e04.js";import{C as ke}from"./ContactsIcon-830ef67e.js";import{L as Le}from"./LeadsIcon-68ebc4cc.js";import{D as be}from"./DealsIcon-acabc22f.js";import{C as Me}from"./CalendarIcon-b9320815.js";import{N as ae,_ as xe}from"./NoteModal-4abb9e0a.js";import{T as le}from"./TaskIcon-f5c3d969.js";import{T as we}from"./TaskModal-d0e5aa30.js";import{a as te}from"./FadedScrollableDiv-f3f408b5.js";import{b as Ve,f as oe,t as De,u as ce,a as se,n as Ie}from"./index-31644aa3.js";import{i as de}from"./Link-4317fd36.js";import{u as $e,F as Te,_ as Ee}from"./QuickEntryModal-157d8856.js";import{_ as Ne}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";const Be={},Re={width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Fe(i,o){return n(),c("svg",Re,o[0]||(o[0]=[t("g",{"clip-path":"url(#clip0_4750_5685)"},[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M10.4375 6C10.4375 8.45076 8.45076 10.4375 6 10.4375C3.54924 10.4375 1.5625 8.45076 1.5625 6C1.5625 3.54924 3.54924 1.5625 6 1.5625C8.45076 1.5625 10.4375 3.54924 10.4375 6ZM11.4375 6C11.4375 9.00305 9.00305 11.4375 6 11.4375C2.99695 11.4375 0.5625 9.00305 0.5625 6C0.5625 2.99695 2.99695 0.5625 6 0.5625C9.00305 0.5625 11.4375 2.99695 11.4375 6ZM9.00005 5.50004C9.27619 5.50004 9.50004 5.72391 9.50004 6.00005C9.50004 6.27619 9.27618 6.50004 9.00003 6.50004L6.25001 6.5C5.8358 6.49999 5.50003 6.16421 5.50002 5.75L5.5 3C5.5 2.72386 5.72385 2.5 6 2.5C6.27614 2.5 6.5 2.72385 6.5 3L6.50002 5.5L9.00005 5.50004Z",fill:"currentColor"})],-1),t("defs",null,[t("clipPath",{id:"clip0_4750_5685"},[t("rect",{width:"12",height:"12",fill:"white"})])],-1)]))}const Ae=X(Be,[["render",Fe]]),Pe={},Se={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function He(i,o){return n(),c("svg",Se,o[0]||(o[0]=[t("g",{"clip-path":"url(#clip0_3668_69185)"},[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),t("defs",null,[t("clipPath",{id:"clip0_3668_69185"},[t("rect",{width:"16",height:"16",fill:"white"})])],-1)]))}const Oe=X(Pe,[["render",He]]),{getFormattedPercent:Ue,getFormattedFloat:ze,getFormattedCurrency:Qe}=Ve("CRM Call Log");function Ze(i,o,M=[]){var C,d,g,v,x;let p=o.type==="Incoming";if(i==="duration")return{label:o._duration,icon:"clock"};if(i==="caller")return{label:(C=o._caller)==null?void 0:C.label,image:(d=o._caller)==null?void 0:d.image};if(i==="receiver")return{label:(g=o._receiver)==null?void 0:g.label,image:(v=o._receiver)==null?void 0:v.image};if(i==="type")return{label:o.type,icon:p?"phone-incoming":"phone-outgoing"};if(i==="status")return{label:je[o.status],color:Je[o.status]};if(["modified","creation"].includes(i))return{label:oe(o[i]),timeAgo:__(De(o[i]))};let _=(x=M==null?void 0:M.find(w=>(w.key||w.value)==i))==null?void 0:x.type;return _&&["Date","Datetime"].includes(_)?oe(o[i],"",!0,_=="Datetime"):_&&_=="Currency"?Qe(i,o):_&&_=="Float"?ze(i,o):_&&_=="Percent"?Ue(i,o):o[i]}const je={Completed:"Completed",Initiated:"Initiated",Busy:"Declined",Failed:"Failed",Queued:"Queued",Canceled:"Canceled",Ringing:"Ringing","No Answer":"Missed Call","In Progress":"In Progress"},Je={Completed:"green",Busy:"orange",Failed:"red",Initiated:"gray",Queued:"gray",Canceled:"gray",Ringing:"gray","No Answer":"red","In Progress":"blue"};const qe={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Ke={class:"mb-5 flex items-center justify-between"},Ge={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},We={class:"flex items-center gap-1"},Xe={class:"flex flex-col gap-3.5"},Ye={class:"grid size-7 place-content-center"},ea={class:"flex min-h-7 w-full items-center gap-2"},aa={key:0,class:"flex items-center gap-1"},la={class:"ml-1 flex flex-col gap-1"},ta={class:"ml-1 flex flex-col gap-1"},oa={key:2,class:"w-full"},sa=["src"],na=["innerHTML"],ia=["innerHTML"],ra=["innerHTML"],ua=["innerHTML"],ca={key:6},da={key:0,class:"px-4 pb-7 pt-4 sm:px-6"},ma={__name:"CallLogDetailModal",props:{modelValue:{},modelModifiers:{},callLog:{},callLogModifiers:{},callLogModal:{},callLogModalModifiers:{}},emits:["update:modelValue","update:callLog","update:callLogModal"],setup(i){const{isManager:o}=ce(),M=_e(),p=H(i,"modelValue"),_=h(!1),C=h(!1),d=H(i,"callLog"),g=h({title:"",content:""}),v=h({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low"}),x=ie(()=>{var m,r,y,T,E,N;if(!((m=d.value)!=null&&m.data))return[];let e=JSON.parse(JSON.stringify((r=d.value)==null?void 0:r.data));for(const k in e)e[k]=Ze(k,e);return g.value=((y=e._notes)==null?void 0:y[0])??null,v.value=((T=e._tasks)==null?void 0:T[0])??null,[{icon:ee(S,{name:e.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:e.type.label+" Call"},{icon:ke,name:"receiver",value:{receiver:e.receiver,caller:e.caller}},{icon:e._lead?Le:be,name:"reference_doc",value:e._lead?"Lead":"Deal",link:()=>{e._lead?M.push({name:"Lead",params:{leadId:e._lead}}):M.push({name:"Deal",params:{dealId:e._deal}})},condition:()=>e._lead||e._deal},{icon:Me,name:"creation",value:e.creation.label,tooltip:e.creation.label},{icon:Ae,name:"duration",value:e.duration.label},{icon:Oe,name:"status",value:e.status.label,color:e.status.color},{icon:ee(S,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:e.recording_url},{icon:ae,name:"note",value:((E=e._notes)==null?void 0:E[0])??null},{icon:le,name:"task",value:((N=e._tasks)==null?void 0:N[0])??null}].filter(k=>k.value).filter(k=>k.condition?k.condition():!0)}),w=h({}),V=h({});async function Q(){var e,a,m,r;await((m=(a=w.value).triggerOnCreateLead)==null?void 0:m.call(a,(e=d.value)==null?void 0:e.data,V.value,()=>p.value=!1)),K("crm.fcrm.doctype.crm_call_log.crm_call_log.create_lead_from_call_log",{call_log:(r=d.value)==null?void 0:r.data,lead_details:V.value}).then(y=>{y&&M.push({name:"Lead",params:{leadId:y}})})}const Z=H(i,"callLogModal");function j(){Z.value=!0,W(()=>{p.value=!1})}function O(){var e;(e=g.value)!=null&&e.name||(g.value={title:"",content:""}),_.value=!0}function D(){var e;(e=v.value)!=null&&e.name||(v.value={title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low"}),C.value=!0}async function J(e,a=!1){var m,r;g.value=e,a&&e.name&&await K("crm.integrations.api.add_note_to_call_log",{call_sid:(r=(m=d.value)==null?void 0:m.data)==null?void 0:r.id,note:e})}async function s(e,a=!1){var m,r;v.value=e,a&&e.name&&await K("crm.integrations.api.add_task_to_call_log",{call_sid:(r=(m=d.value)==null?void 0:m.data)==null?void 0:r.id,task:e})}return re(()=>{var e,a;return(a=(e=d.value)==null?void 0:e.data)==null?void 0:a.name},e=>{e&&(w.value=$e("CRM Call Log",e))}),(e,a)=>{const m=U("Button"),r=U("Dialog");return n(),c(z,null,[u(r,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=y=>p.value=y)},{body:L(()=>{var y,T,E,N,k,Y;return[t("div",qe,[t("div",Ke,[t("div",null,[t("h3",Ge,I(e.__("Call Details")),1)]),t("div",We,[u(f(Ne),{options:[{group:e.__("Options"),hideLabel:!0,items:[{label:(y=g.value)!=null&&y.name?e.__("Edit note"):e.__("Add note"),icon:ae,onClick:O},{label:(T=v.value)!=null&&T.name?e.__("Edit task"):e.__("Add task"),icon:le,onClick:D}]}]},{default:L(()=>[u(m,{variant:"ghost",icon:"more-horizontal"})]),_:1},8,["options"]),f(o)()&&!f(de)?(n(),$(m,{key:0,variant:"ghost",class:"w-7",onClick:j},{default:L(()=>[u(ne,{class:"h-4 w-4"})]),_:1})):b("",!0),u(m,{variant:"ghost",class:"w-7",onClick:a[0]||(a[0]=l=>p.value=!1)},{default:L(()=>[u(f(S),{name:"x",class:"h-4 w-4"})]),_:1})])]),t("div",Xe,[(n(!0),c(z,null,ue(x.value,l=>(n(),c("div",{key:l.name,class:"flex gap-2 text-base text-ink-gray-8"},[t("div",Ye,[(n(),$(ve(l.icon)))]),t("div",ea,[l.name=="receiver"?(n(),c("div",aa,[u(f(se),{image:l.value.caller.image,label:l.value.caller.label,size:"sm"},null,8,["image","label"]),t("div",la,I(l.value.caller.label),1),u(f(S),{name:"arrow-right",class:"mx-1 h-4 w-4 text-ink-gray-5"}),u(f(se),{image:l.value.receiver.image,label:l.value.receiver.label,size:"sm"},null,8,["image","label"]),t("div",ta,I(l.value.receiver.label),1)])):l.tooltip?(n(),$(f(ge),{key:1,text:l.tooltip},{default:L(()=>[pe(I(l.value),1)]),_:2},1032,["text"])):l.name=="recording_url"?(n(),c("div",oa,[t("audio",{class:"audio-control w-full",controls:"",src:l.value},null,8,sa)])):l.name=="note"?(n(),c("div",{key:3,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-ink-gray-7",onClick:a[1]||(a[1]=()=>_.value=!0)},[u(te,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:L(()=>{var B,R,F,A,P;return[(B=l.value)!=null&&B.title?(n(),c("div",{key:0,class:q([(R=l.value)!=null&&R.content?"mb-1 font-bold":""]),innerHTML:(F=l.value)==null?void 0:F.title},null,10,na)):b("",!0),(A=l.value)!=null&&A.content?(n(),c("div",{key:1,innerHTML:(P=l.value)==null?void 0:P.content},null,8,ia)):b("",!0)]}),_:2},1024)])):l.name=="task"?(n(),c("div",{key:4,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-ink-gray-7",onClick:a[2]||(a[2]=()=>C.value=!0)},[u(te,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:L(()=>{var B,R,F,A,P;return[(B=l.value)!=null&&B.title?(n(),c("div",{key:0,class:q([(R=l.value)!=null&&R.description?"mb-1 font-bold":""]),innerHTML:(F=l.value)==null?void 0:F.title},null,10,ra)):b("",!0),(A=l.value)!=null&&A.description?(n(),c("div",{key:1,innerHTML:(P=l.value)==null?void 0:P.description},null,8,ua)):b("",!0)]}),_:2},1024)])):(n(),c("div",{key:5,class:q(l.color?`text-${l.color}-600`:"")},I(l.value),3)),l.link?(n(),c("div",ca,[u(me,{class:"h-4 w-4 shrink-0 cursor-pointer text-ink-gray-5 hover:text-ink-gray-8",onClick:()=>l.link()},null,8,["onClick"])])):b("",!0)])]))),128))])]),!((N=(E=d.value)==null?void 0:E.data)!=null&&N._lead)&&!((Y=(k=d.value)==null?void 0:k.data)!=null&&Y._deal)?(n(),c("div",da,[u(m,{class:"w-full",variant:"solid",label:e.__("Create lead"),onClick:Q},null,8,["label"])])):b("",!0)]}),_:1},8,["modelValue"]),u(xe,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=y=>_.value=y),note:g.value,onAfter:J},null,8,["modelValue","note"]),u(we,{modelValue:C.value,"onUpdate:modelValue":a[5]||(a[5]=y=>C.value=y),task:v.value,onAfter:s},null,8,["modelValue","task"])],64)}}},Ra=X(ma,[["__scopeId","data-v-467f7b72"]]),_a={class:"px-4 pt-5 pb-6 bg-surface-modal sm:px-6"},va={class:"flex items-center justify-between mb-5"},pa={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},ga={class:"flex items-center gap-1"},fa={key:0},Ca={class:"px-4 pt-4 pb-7 sm:px-6"},ya={class:"space-y-2"},Fa={__name:"CallLogModal",props:fe({options:{type:Object,default:{afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{},callLog:{},callLogModifiers:{}}),emits:["update:modelValue","update:callLog"],setup(i){const o=i,{isManager:M}=ce(),p=H(i,"modelValue"),_=H(i,"callLog"),C=h(!1),d=h(null);h(null);const g=h(!1);let v=h({name:"",type:"",from:"",to:"",medium:"",duration:"",caller:"",receiver:"",status:"",recording_url:"",telephony_medium:"Manual"});const x=ie(()=>{let s=g.value?__("Edit Call Log"):__("New Call Log"),e="xl",a=[{label:g.value?__("Save"):__("Create"),variant:"solid",onClick:()=>g.value?Q():j.submit()}];return{title:s,size:e,actions:a}}),w=G({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Call Log"],params:{doctype:"CRM Call Log",type:"Quick Entry"},auto:!0});let V=h({});function Q(){d.value=null;const s={...V.value},e={...v.value};if(!(JSON.stringify(s)!==JSON.stringify(e))){p.value=!1;return}C.value=!0,Z.submit({doctype:"CRM Call Log",name:v.value.name,fieldname:e})}const Z=G({url:"frappe.client.set_value",onSuccess(s){C.value=!1,s.name&&O(s)},onError(s){C.value=!1,d.value=s}}),j=G({url:"frappe.client.insert",makeParams(){return{doc:{doctype:"CRM Call Log",id:Ie(6),telephony_medium:"Manual",...v.value}}},onSuccess(s){C.value=!1,s.name&&(Ce("call_log_created"),O(s))},onError(s){if(C.value=!1,s.exc_type=="MandatoryError"){const e=s.messages.map(a=>a.split("Log:")[1].trim()).join(", ");d.value=`These fields are required: ${e}`;return}d.value=s}});function O(s){p.value=!1,o.options.afterInsert&&o.options.afterInsert(s)}re(()=>p.value,s=>{s&&(g.value=!1,W(()=>{var e;V.value=((e=_.value)==null?void 0:e.data)||{},v.value={...V.value},v.value.name&&(g.value=!0)}))});const D=h(!1);function J(){D.value=!0,W(()=>{p.value=!1})}return(s,e)=>{const a=U("Button"),m=U("Dialog");return n(),c(z,null,[u(m,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=r=>p.value=r),options:x.value},{body:L(()=>[t("div",_a,[t("div",va,[t("div",null,[t("h3",pa,I(s.__(x.value.title)||s.__("Untitled")),1)]),t("div",ga,[f(M)()&&!f(de)?(n(),$(a,{key:0,variant:"ghost",class:"w-7",onClick:J},{default:L(()=>[u(ne,{class:"w-4 h-4"})]),_:1})):b("",!0),u(a,{variant:"ghost",class:"w-7",onClick:e[0]||(e[0]=r=>p.value=!1)},{default:L(()=>[u(f(S),{name:"x",class:"w-4 h-4"})]),_:1})])]),f(w).data?(n(),c("div",fa,[u(Te,{tabs:f(w).data,data:f(v),doctype:"CRM Call Log"},null,8,["tabs","data"]),u(f(ye),{class:"mt-8",message:d.value},null,8,["message"])])):b("",!0)]),t("div",Ca,[t("div",ya,[(n(!0),c(z,null,ue(x.value.actions,r=>(n(),$(a,he({class:"w-full",key:r.label,ref_for:!0},r,{label:s.__(r.label),loading:C.value}),null,16,["label","loading"]))),128))])])]),_:1},8,["modelValue","options"]),D.value?(n(),$(Ee,{key:0,modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=r=>D.value=r),doctype:"CRM Call Log"},null,8,["modelValue"])):b("",!0)],64)}}};export{Ra as C,Ae as D,Fa as _,Je as a,Ze as g,je as s};
//# sourceMappingURL=CallLogModal-359f4190.js.map
