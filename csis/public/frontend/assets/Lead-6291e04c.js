import{_ as ke,a as Ie}from"./Resizer-d799806c.js";import{_ as Me}from"./FadedScrollableDiv-f3f408b5.js";import{u as Le,_ as Ve,a as Re,b as Ee,A as Y,S as Se,c as $e}from"./useActiveTabManager-a0215a12.js";import{E as Te}from"./MultiSelectEmailInput-5ae16f74.js";import{E as Ae}from"./Email2Icon-d49a0a62.js";import{C as De}from"./CommentIcon-2d82e902.js";import{D as ze}from"./DetailsIcon-404b02bf.js";import{P as Z}from"./PhoneIcon-cb5df69f.js";import{T as Ne}from"./TaskIcon-f5c3d969.js";import{N as Fe}from"./NoteModal-4abb9e0a.js";import{W as Ue}from"./WhatsAppIcon-cd469fd1.js";import{I as qe}from"./IndicatorIcon-99f76624.js";import{C as Oe}from"./CameraIcon-72212b8c.js";import{L as je}from"./LinkIcon-c228db3f.js";import{O as Pe}from"./OrganizationsIcon-b5a4c50f.js";import{C as Be}from"./ContactsIcon-830ef67e.js";import{E as We}from"./DragVerticalIcon-e7d3e46c.js";import{_ as Ge}from"./LayoutHeader-448e93da.js";import{c as Qe,i as He,_ as ee,w as Je}from"./Link-4317fd36.js";import{S as Ke,g as Xe}from"./view-de8292bb.js";import{u as Ye,_ as Ze,a as ea,F as aa}from"./QuickEntryModal-157d8856.js";import{_ as ta}from"./CustomActions-4107b940.js";import{u as sa,g as oa,b as la,s as na,d as ia,e as ra,a as da,o as ua}from"./index-31644aa3.js";import{g as ma}from"./settings-5fcce07e.js";import{s as ca,l as _,z as U,G as f,E as J,a as pa,j as q,A as _a,k as fa,v as va,c as L,u as t,g as c,w as r,p,b as l,H as K,F as ga,h as ya,B as ba,I as ha,e as O,f as u,n as Ca,d as i,t as g,y as wa,C as xa,_ as S}from"./index-85632e04.js";import{s as ka}from"./statuses-1a7b8e83.js";import{_ as Ia}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-41a5d25f.js";import{_ as ae}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{F as Ma}from"./FileUploader-ffa5e39e.js";import{_ as te}from"./Switch.vue_vue_type_script_setup_true_lang-6e77b3e0.js";import{u as La}from"./helpCenter-64650aa2.js";import"./CalendarIcon-b9320815.js";import"./CallLogModal-359f4190.js";import"./ArrowUpRightIcon-fffd9b01.js";import"./LeadsIcon-68ebc4cc.js";import"./DealsIcon-acabc22f.js";import"./TaskModal-d0e5aa30.js";import"./MultipleAvatar-8c461416.js";import"./IconPicker-0c2832fa.js";import"./Popover-4a1551e7.js";import"./EmailTemplateModal-adfdb337.js";import"./AssignmentModal-f44425e3.js";import"./Section-7d029c27.js";import"./label-f9f1f609.js";const Va={key:1,class:"flex h-full overflow-hidden"},Ra={class:"flex items-center justify-start gap-5 border-b p-5"},Ea={class:"group relative size-12"},Sa={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},$a={class:"flex flex-col gap-2.5 truncate"},Ta={class:"truncate text-2xl font-medium text-ink-gray-9"},Aa={class:"flex gap-1.5"},Da={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},za={class:"mb-6 flex items-center justify-between"},Na={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},Fa={class:"flex items-center gap-1"},Ua={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},qa={class:"block text-base"},Oa={class:"ml-6 text-ink-gray-9"},ja={class:"flex items-center justify-between text-base"},Pa={key:1,class:"mt-2.5 text-base"},Ba={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},Wa={class:"block text-base"},Ga={class:"ml-6 text-ink-gray-9"},Qa={class:"flex items-center justify-between text-base"},Ha={key:1,class:"mt-2.5 text-base"},Ja={key:0,class:"h-px w-full border-t my-6"},qt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(se){const{brand:oe}=ma(),{user:le}=ca(),{isManager:ne}=sa(),{$dialog:ie,$socket:re,makeCall:de}=oa(),{statusOptions:X,getLeadStatus:ue,getDealStatus:me}=ka(),{doctypeMeta:ce}=la("CRM Lead"),{updateOnboardingStep:pe}=La("frappecrm"),y=ya(),$=ba(),V=se,T=_(""),j=_(""),s=U({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:V.leadId},cache:["lead",V.leadId],onSuccess:a=>{T.value="",j.value="",na(s),ia(s,{doc:a,$dialog:ie,$socket:re,router:$,toast:f,updateField:R,createToast:f.create,deleteDoc:be,resource:{lead:s,sections:z},call:J})},onError:a=>{var e,n;(e=a.messages)!=null&&e[0]?(T.value=__("Not permitted"),j.value=__((n=a.messages)==null?void 0:n[0])):$.push({name:"Leads"})}});pa(()=>{s.data||s.fetch()});const P=_(!1),B=_(!1);function _e(a,e,n){e=Array.isArray(a)?"":e,!(!Array.isArray(a)&&fe(a,e))&&U({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:V.leadId,fieldname:a,value:e},auto:!0,onSuccess:()=>{s.reload(),P.value=!0,f.success(__("Lead updated successfully")),n==null||n()},onError:m=>{var k;f.error(((k=m.messages)==null?void 0:k[0])||__("Error updating lead"))}})}function fe(a,e){var m;let n=s.data.fields_meta||{};return(m=n[a])!=null&&m.reqd&&!e?(f.error(__("{0} is a required field",[n[a].label])),!0):!1}const ve=q(()=>{let a=[{label:__("Leads"),route:{name:"Leads"}}];if(y.query.view||y.query.viewType){let e=Xe(y.query.view,y.query.viewType,"CRM Lead");e&&a.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:y.query.viewType},query:{view:y.query.view}}})}return a.push({label:A.value,route:{name:"Lead",params:{leadId:s.data.name}}}),a}),A=q(()=>{var e,n;let a=((e=ce["CRM Lead"])==null?void 0:e.title_field)||"name";return((n=s.data)==null?void 0:n[a])||V.leadId});_a(()=>({title:A.value,icon:oe.favicon}));const D=q(()=>[{name:"Activity",label:__("Activity"),icon:$e},{name:"Emails",label:__("Emails"),icon:Te},{name:"Comments",label:__("Comments"),icon:De},{name:"Data",label:__("Data"),icon:ze},{name:"Calls",label:__("Calls"),icon:Z},{name:"Tasks",label:__("Tasks"),icon:Ne},{name:"Notes",label:__("Notes"),icon:Fe},{name:"Attachments",label:__("Attachments"),icon:Y},{name:"WhatsApp",label:__("WhatsApp"),icon:Ue,condition:()=>Je.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:b,changeTabTo:ge}=Le(D,"lastLeadTab");fa(D,a=>{if(a&&y.params.tabName){let e=a.findIndex(n=>n.name.toLowerCase()===y.params.tabName.toLowerCase());e!==-1&&(b.value=e)}});function ye(a){let e=a.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const z=U({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});function R(a,e,n){_e(a,e,()=>{s.data[a]=e,n==null||n()})}async function be(a){await J("frappe.client.delete",{doctype:"CRM Lead",name:a}),$.push({name:"Leads"})}const h=_(!1),I=_(!1),M=_(!1),C=_(""),w=_(""),{triggerConvertToDeal:W}=Ye("CRM Lead",V.leadId);async function he(){if(I.value&&!C.value){f.error(__("Please select an existing contact"));return}if(M.value&&!w.value){f.error(__("Please select an existing organization"));return}!I.value&&C.value&&(C.value=""),!M.value&&w.value&&(w.value=""),await(W==null?void 0:W(s.data,x,()=>h.value=!1));let a=await J("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:s.data.name,deal:x,existing_contact:C.value,existing_organization:w.value}).catch(e=>{var n;f.error(__("Error converting to deal: {0}",[(n=e.messages)==null?void 0:n[0]]))});a&&(h.value=!1,I.value=!1,M.value=!1,C.value="",w.value="",pe("convert_lead_to_deal",!0,!1,()=>{localStorage.setItem("firstDeal"+le,a)}),ha("convert_lead_to_deal"),$.push({name:"Deal",params:{dealId:a}}))}const G=_(null);function Ce(){G.value.emailBox.show=!0}const x=va({}),we=q(()=>{let a=X("deal");return x.status||(x.status=a[0].value),a}),Q=U({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["RequiredFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Required Fields"},auto:!0,transform:a=>{let e=!1,n=a==null?void 0:a.forEach(m=>{var k;(k=m.sections)==null||k.forEach(H=>{var E;(E=H.columns)==null||E.forEach(F=>{var o;(o=F.fields)==null||o.forEach(d=>{e=!0,d.fieldname=="status"&&(d.fieldtype="Select",d.options=we.value,d.prefix=me(x.status).color),d.fieldtype==="Table"&&(x[d.fieldname]=[])})})})});return e?n:[]}}),N=_(!1);function xe(){N.value=!0,h.value=!1}return(a,e)=>{var E,F;const n=O("FeatherIcon"),m=O("Button"),k=O("ErrorMessage"),H=O("Dialog");return u(),L(ga,null,[t(s).data?(u(),c(Ge,{key:0},{"left-header":r(()=>[l(t(Ia),{items:ve.value},{prefix:r(({item:o})=>[o.icon?(u(),c(Me,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):p("",!0)]),_:1},8,["items"])]),"right-header":r(()=>{var o;return[(o=t(s).data._customActions)!=null&&o.length?(u(),c(ta,{key:0,actions:t(s).data._customActions},null,8,["actions"])):p("",!0),l(Re,{modelValue:t(s).data._assignedTo,"onUpdate:modelValue":e[0]||(e[0]=d=>t(s).data._assignedTo=d),data:t(s).data,doctype:"CRM Lead"},null,8,["modelValue","data"]),l(t(ae),{options:t(X)("lead",R,t(s).data._customStatuses)},{default:r(({open:d})=>[l(m,{label:t(s).data.status},{prefix:r(()=>[l(qe,{class:Ca(t(ue)(t(s).data.status).color)},null,8,["class"])]),suffix:r(()=>[l(n,{name:d?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options"]),l(m,{label:a.__("Convert to Deal"),variant:"solid",onClick:e[1]||(e[1]=d=>h.value=!0)},null,8,["label"])]}),_:1})):p("",!0),(E=t(s))!=null&&E.data?(u(),L("div",Va,[l(t(ea),{as:"div",modelValue:t(b),"onUpdate:modelValue":e[5]||(e[5]=o=>K(b)?b.value=o:null),tabs:D.value},{"tab-panel":r(()=>[l(Ee,{ref_key:"activities",ref:G,doctype:"CRM Lead",tabs:D.value,reload:P.value,"onUpdate:reload":e[2]||(e[2]=o=>P.value=o),tabIndex:t(b),"onUpdate:tabIndex":e[3]||(e[3]=o=>K(b)?b.value=o:null),modelValue:t(s),"onUpdate:modelValue":e[4]||(e[4]=o=>K(s)?s.value=o:null)},null,8,["tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),l(ke,{class:"flex flex-col justify-between border-l",side:"right"},{default:r(()=>[i("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium text-ink-gray-9",onClick:e[6]||(e[6]=o=>t(ra)(t(s).data.name))},g(a.__(t(s).data.name)),1),l(t(Ma),{onSuccess:e[8]||(e[8]=o=>R("image",o.file_url)),validateFile:ye},{default:r(({openFileSelector:o,error:d})=>[i("div",Ra,[i("div",Ea,[l(t(da),{size:"3xl",class:"size-12",label:A.value,image:t(s).data.image},null,8,["label","image"]),(u(),c(xa(t(s).data.image?t(ae):"div"),wa(t(s).data.image?{options:[{icon:"upload",label:t(s).data.image?a.__("Change image"):a.__("Upload image"),onClick:o},{icon:"trash-2",label:a.__("Remove image"),onClick:()=>R("image","")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:r(()=>[i("div",Sa,[l(Oe,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),i("div",$a,[l(t(S),{text:t(s).data.lead_name||a.__("Set first name")},{default:r(()=>[i("div",Ta,g(A.value),1)]),_:1},8,["text"]),i("div",Aa,[t(Qe)?(u(),c(t(S),{key:0,text:a.__("Make a call")},{default:r(()=>[i("div",null,[l(m,{class:"h-7 w-7",onClick:()=>t(s).data.mobile_no?t(de)(t(s).data.mobile_no):t(f).error(a.__("No phone number set"))},{default:r(()=>[l(Z,{class:"h-4 w-4"})]),_:2},1032,["onClick"])])]),_:2},1032,["text"])):p("",!0),l(t(S),{text:a.__("Send an email")},{default:r(()=>[i("div",null,[l(m,{class:"h-7 w-7"},{default:r(()=>[l(Ae,{class:"h-4 w-4",onClick:v=>t(s).data.email?Ce():t(f).error(a.__("No email set"))},null,8,["onClick"])]),_:2},1024)])]),_:2},1032,["text"]),l(t(S),{text:a.__("Go to website")},{default:r(()=>[i("div",null,[l(m,{class:"h-7 w-7"},{default:r(()=>[l(je,{class:"h-4 w-4",onClick:v=>t(s).data.website?t(ua)(t(s).data.website):t(f).error(a.__("No website set"))},null,8,["onClick"])]),_:2},1024)])]),_:2},1032,["text"]),l(t(S),{text:a.__("Attach a file")},{default:r(()=>[i("div",null,[l(m,{class:"h-7 w-7",onClick:e[7]||(e[7]=v=>B.value=!0)},{default:r(()=>[l(Y,{class:"h-4 w-4"})]),_:1})])]),_:1},8,["text"])]),l(k,{message:a.__(d)},null,8,["message"])])])]),_:1}),t(s).data.sla_status?(u(),c(Se,{key:0,modelValue:t(s).data,"onUpdate:modelValue":e[9]||(e[9]=o=>t(s).data=o),onUpdateField:R},null,8,["modelValue"])):p("",!0),t(z).data?(u(),L("div",Da,[l(Ke,{sections:t(z).data,doctype:"CRM Lead",docname:t(s).data.name,onReload:t(z).reload},null,8,["sections","docname","onReload"])])):p("",!0)]),_:1})])):T.value?(u(),c(Ie,{key:2,errorTitle:T.value,errorMessage:j.value},null,8,["errorTitle","errorMessage"])):p("",!0),l(H,{modelValue:h.value,"onUpdate:modelValue":e[15]||(e[15]=o=>h.value=o),options:{size:"xl",actions:[{label:a.__("Convert"),variant:"solid",onClick:he}]}},{"body-header":r(()=>[i("div",za,[i("div",null,[i("h3",Na,g(a.__("Convert to Deal")),1)]),i("div",Fa,[t(ne)()&&!t(He)?(u(),c(m,{key:0,variant:"ghost",class:"w-7",onClick:xe},{default:r(()=>[l(We,{class:"h-4 w-4"})]),_:1})):p("",!0),l(m,{variant:"ghost",class:"w-7",onClick:e[10]||(e[10]=o=>h.value=!1)},{default:r(()=>[l(n,{name:"x",class:"h-4 w-4"})]),_:1})])])]),"body-content":r(()=>{var o,d;return[i("div",Ua,[l(Pe,{class:"h-4 w-4"}),i("label",qa,g(a.__("Organization")),1)]),i("div",Oa,[i("div",ja,[i("div",null,g(a.__("Choose Existing")),1),l(t(te),{modelValue:M.value,"onUpdate:modelValue":e[11]||(e[11]=v=>M.value=v)},null,8,["modelValue"])]),M.value?(u(),c(ee,{key:0,class:"form-control mt-2.5",size:"md",value:w.value,doctype:"CRM Organization",onChange:e[12]||(e[12]=v=>w.value=v)},null,8,["value"])):(u(),L("div",Pa,g(a.__("New organization will be created based on the data in details section")),1))]),i("div",Ba,[l(Be,{class:"h-4 w-4"}),i("label",Wa,g(a.__("Contact")),1)]),i("div",Ga,[i("div",Qa,[i("div",null,g(a.__("Choose Existing")),1),l(t(te),{modelValue:I.value,"onUpdate:modelValue":e[13]||(e[13]=v=>I.value=v)},null,8,["modelValue"])]),I.value?(u(),c(ee,{key:0,class:"form-control mt-2.5",size:"md",value:C.value,doctype:"Contact",onChange:e[14]||(e[14]=v=>C.value=v)},null,8,["value"])):(u(),L("div",Ha,g(a.__("New contact will be created based on the person's details")),1))]),(o=t(Q).data)!=null&&o.length?(u(),L("div",Ja)):p("",!0),(d=t(Q).data)!=null&&d.length?(u(),c(aa,{key:1,tabs:t(Q).data,data:x,doctype:"CRM Deal"},null,8,["tabs","data"])):p("",!0)]}),_:1},8,["modelValue","options"]),N.value?(u(),c(Ze,{key:3,modelValue:N.value,"onUpdate:modelValue":e[16]||(e[16]=o=>N.value=o),doctype:"CRM Deal",onlyRequired:!0},null,8,["modelValue"])):p("",!0),(F=t(s).data)!=null&&F.name?(u(),c(Ve,{key:4,modelValue:B.value,"onUpdate:modelValue":e[17]||(e[17]=o=>B.value=o),doctype:"CRM Lead",docname:t(s).data.name,onAfter:e[18]||(e[18]=()=>{var o,d;(d=(o=G.value)==null?void 0:o.all_activities)==null||d.reload(),t(ge)("attachments")})},null,8,["modelValue","docname"])):p("",!0)],64)}}};export{qt as default};
//# sourceMappingURL=Lead-6291e04c.js.map
