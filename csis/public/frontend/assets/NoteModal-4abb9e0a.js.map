{"version":3,"file":"NoteModal-4abb9e0a.js","sources":["../../../../frontend/src/components/Icons/NoteIcon.vue","../../../../frontend/src/components/Modals/NoteModal.vue"],"sourcesContent":["<template>\n  <svg\n    width=\"16\"\n    height=\"16\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      fill-rule=\"evenodd\"\n      clip-rule=\"evenodd\"\n      d=\"M3.99707 14H11.9971C12.8255 14 13.4971 13.3284 13.4971 12.5V6.49988L11 6.4999C10.1716 6.49991 9.5 5.82833 9.5 4.9999V2H3.99707C3.16864 2 2.49707 2.67157 2.49707 3.5V12.5C2.49707 13.3284 3.16864 14 3.99707 14ZM13.8291 4.2806C14.1476 4.62366 14.3612 5.04668 14.4502 5.49987L14.4968 5.49987L14.4968 5.94777L14.4971 5.98173V12.5C14.4971 13.8807 13.3778 15 11.9971 15H3.99707C2.61636 15 1.49707 13.8807 1.49707 12.5V3.5C1.49707 2.11929 2.61636 1 3.99707 1H9.69261C10.3878 1 11.0516 1.28945 11.5246 1.79887L13.8291 4.2806ZM11 5.4999L13.4176 5.49988C13.3502 5.30132 13.2414 5.11735 13.0963 4.96105L10.7918 2.47932C10.7044 2.38525 10.6063 2.30368 10.5 2.23582V4.9999C10.5 5.27604 10.7239 5.4999 11 5.4999ZM5 11C4.72386 11 4.5 11.2239 4.5 11.5C4.5 11.7761 4.72386 12 5 12H11C11.2761 12 11.5 11.7761 11.5 11.5C11.5 11.2239 11.2761 11 11 11H5ZM4.5 9C4.5 8.72386 4.72386 8.5 5 8.5H10H11C11.2761 8.5 11.5 8.72386 11.5 9C11.5 9.27614 11.2761 9.5 11 9.5H10H5C4.72386 9.5 4.5 9.27614 4.5 9Z\"\n      fill=\"currentColor\"\n      fill-opacity=\"0.72\"\n    />\n  </svg>\n</template>\n","<template>\n  <Dialog v-model=\"show\" :options=\"{\n    size: 'xl',\n    actions: [\n      {\n        label: editMode ? __('Update') : __('Create'),\n        variant: 'solid',\n        onClick: () => updateNote(),\n      },\n    ],\n  }\">\n    <template #body-title>\n      <div class=\"flex items-center gap-3\">\n        <h3 class=\"text-2xl font-semibold leading-6 text-ink-gray-9\">\n          {{ editMode ? __('Edit Note') : __('Create Note') }}\n        </h3>\n        <Button v-if=\"_note?.reference_docname\" size=\"sm\" :label=\"_note.reference_doctype == 'CRM Deal'\n          ? __('Open Deal')\n          : __('Open Lead')\n          \" @click=\"redirect()\">\n          <template #suffix>\n            <ArrowUpRightIcon class=\"w-4 h-4\" />\n          </template>\n        </Button>\n      </div>\n    </template>\n    <template #body-content>\n      <div class=\"flex flex-col gap-4\">\n        <div>\n          <FormControl ref=\"title\" :label=\"__('Title')\" v-model=\"_note.title\" :placeholder=\"__('Call with John Doe')\"\n            required />\n        </div>\n        <div>\n          <div class=\"mb-1.5 text-xs text-ink-gray-5\">{{ __('Content') }}</div>\n          <TextEditor variant=\"outline\" ref=\"content\"\n            editor-class=\"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors\"\n            :bubbleMenu=\"true\" :content=\"_note.content\" @change=\"(val) => (_note.content = val)\" :placeholder=\"__('Took a call with John Doe and discussed the new project.')\n              \" />\n        </div>\n        <ErrorMessage class=\"mt-4\" v-if=\"error\" :message=\"__(error)\" />\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport ArrowUpRightIcon from '@/components/Icons/ArrowUpRightIcon.vue'\nimport { capture } from '@/telemetry'\nimport { TextEditor, call } from 'frappe-ui'\nimport { useOnboarding } from 'frappe-ui/frappe'\nimport { ref, nextTick, watch } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst props = defineProps({\n  note: {\n    type: Object,\n    default: {},\n  },\n  doctype: {\n    type: String,\n    default: 'CRM Lead',\n  },\n  doc: {\n    type: String,\n    default: '',\n  },\n})\n\nconst show = defineModel()\nconst notes = defineModel('reloadNotes')\n\nconst emit = defineEmits(['after'])\n\nconst router = useRouter()\n\nconst { updateOnboardingStep } = useOnboarding('frappecrm')\n\nconst error = ref(null)\nconst title = ref(null)\nconst editMode = ref(false)\nlet _note = ref({})\n\nasync function updateNote() {\n  if (_note.value.name) {\n    let d = await call('frappe.client.set_value', {\n      doctype: 'FCRM Note',\n      name: _note.value.name,\n      fieldname: _note.value,\n    })\n    if (d.name) {\n      notes.value?.reload()\n      emit('after', d)\n    }\n  } else {\n    let d = await call('frappe.client.insert', {\n      doc: {\n        doctype: 'FCRM Note',\n        title: _note.value.title,\n        content: _note.value.content,\n        reference_doctype: props.doctype,\n        reference_docname: props.doc || '',\n      },\n    }, {\n      onError: (err) => {\n        if (err.error.exc_type == 'MandatoryError') {\n          error.value = \"Title is mandatory\"\n        }\n      }\n    })\n    if (d.name) {\n      updateOnboardingStep('create_first_note')\n      capture('note_created')\n      notes.value?.reload()\n      emit('after', d, true)\n    }\n  }\n  show.value = false\n}\n\nfunction redirect() {\n  if (!props.note?.reference_docname) return\n  let name = props.note.reference_doctype == 'CRM Deal' ? 'Deal' : 'Lead'\n  let params = { leadId: props.note.reference_docname }\n  if (name == 'Deal') {\n    params = { dealId: props.note.reference_docname }\n  }\n  router.push({ name: name, params: params })\n}\n\nwatch(\n  () => show.value,\n  (value) => {\n    if (!value) return\n    editMode.value = false\n    nextTick(() => {\n      title.value?.el?.focus()\n      _note.value = { ...props.note }\n      if (_note.value.title || _note.value.content) {\n        editMode.value = true\n      }\n    })\n  },\n)\n</script>\n"],"names":["_hoisted_1","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","props","__props","show","_useModel","notes","emit","__emit","router","useRouter","updateOnboardingStep","useOnboarding","error","ref","title","editMode","_note","updateNote","d","call","_a","err","capture","_b","redirect","name","params","watch","value","nextTick"],"mappings":"oRAEIA,EAAU,CACV,WACA,YACA,QAAW,YACX,gDALF,SAAAC,EAAAC,EAAAC,EAAA,QAaIC,EAAA,EAAAC,EAAA,MAAAL,EAAAG,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,CALAG,EAAmB,OAAA,CACnB,YAAU,UACV,YAAk9B,UACl9B,EAAA,i9BACA,KAAA,0hBCwCN,MAAMC,EAAQC,EAeRC,EAAOC,EAAYF,EAAA,YAAA,EACnBG,EAAQD,EAAWF,EAAC,aAAa,EAEjCI,EAAOC,EAEPC,EAASC,EAAU,EAEnB,CAAE,qBAAAC,CAAoB,EAAKC,EAAc,WAAW,EAEpDC,EAAQC,EAAI,IAAI,EAChBC,EAAQD,EAAI,IAAI,EAChBE,EAAWF,EAAI,EAAK,EAC1B,IAAIG,EAAQH,EAAI,EAAE,EAElB,eAAeI,GAAa,SAC1B,GAAID,EAAM,MAAM,KAAM,CACpB,IAAIE,EAAI,MAAMC,EAAK,0BAA2B,CAC5C,QAAS,YACT,KAAMH,EAAM,MAAM,KAClB,UAAWA,EAAM,KACvB,CAAK,EACGE,EAAE,QACJE,EAAAf,EAAM,QAAN,MAAAe,EAAa,SACbd,EAAK,QAASY,CAAC,EAErB,KAAS,CACL,IAAIA,EAAI,MAAMC,EAAK,uBAAwB,CACzC,IAAK,CACH,QAAS,YACT,MAAOH,EAAM,MAAM,MACnB,QAASA,EAAM,MAAM,QACrB,kBAAmBf,EAAM,QACzB,kBAAmBA,EAAM,KAAO,EACjC,CACP,EAAO,CACD,QAAUoB,GAAQ,CACZA,EAAI,MAAM,UAAY,mBACxBT,EAAM,MAAQ,qBAElB,CACN,CAAK,EACGM,EAAE,OACJR,EAAqB,mBAAmB,EACxCY,EAAQ,cAAc,GACtBC,EAAAlB,EAAM,QAAN,MAAAkB,EAAa,SACbjB,EAAK,QAASY,EAAG,EAAI,EAEzB,CACAf,EAAK,MAAQ,EACf,CAEA,SAASqB,GAAW,OAClB,GAAI,GAACJ,EAAAnB,EAAM,OAAN,MAAAmB,EAAY,mBAAmB,OACpC,IAAIK,EAAOxB,EAAM,KAAK,mBAAqB,WAAa,OAAS,OAC7DyB,EAAS,CAAE,OAAQzB,EAAM,KAAK,iBAAkB,EAChDwB,GAAQ,SACVC,EAAS,CAAE,OAAQzB,EAAM,KAAK,iBAAkB,GAElDO,EAAO,KAAK,CAAE,KAAMiB,EAAM,OAAQC,EAAQ,CAC5C,CAEA,OAAAC,EACE,IAAMxB,EAAK,MACVyB,GAAU,CACJA,IACLb,EAAS,MAAQ,GACjBc,EAAS,IAAM,UACbN,GAAAH,EAAAN,EAAM,QAAN,YAAAM,EAAa,KAAb,MAAAG,EAAiB,QACjBP,EAAM,MAAQ,CAAE,GAAGf,EAAM,IAAK,GAC1Be,EAAM,MAAM,OAASA,EAAM,MAAM,WACnCD,EAAS,MAAQ,GAEzB,CAAK,EACF,CACH"}