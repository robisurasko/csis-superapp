import{m as ke,i as ue,B as xe,l as m,v as me,k as Ce,z as ie,j as pe,a as he,e as A,f as l,g as C,w as E,d as p,t as M,u as x,b as r,p as _,c as d,I as we,J as Ve,F as Ee,h as Me,n as re,_ as de,q as De,x as G}from"./index-85632e04.js";import{_ as ze,a as $e}from"./ViewControls-20f61d89.js";import{_ as Re}from"./MultipleAvatar-8c461416.js";import{_ as Ue}from"./CustomActions-4107b940.js";import{E as Ie}from"./EmailAtIcon-999061c4.js";import{P as Se}from"./PhoneIcon-cb5df69f.js";import{_ as Te,N as ce}from"./NoteModal-4abb9e0a.js";import{T as _e}from"./TaskIcon-f5c3d969.js";import{C as Ae}from"./CommentIcon-2d82e902.js";import{I as te}from"./IndicatorIcon-99f76624.js";import{D as Le}from"./DealsIcon-acabc22f.js";import{_ as qe}from"./LayoutHeader-448e93da.js";import{_ as Be}from"./DealsListView-4c2e5303.js";import{_ as Pe}from"./KanbanView-a348c3f4.js";import{E as je}from"./DragVerticalIcon-e7d3e46c.js";import{F as Oe,_ as Qe}from"./QuickEntryModal-157d8856.js";import{u as ve,b as Ke,g as Je,a as H,f as X,w as We,t as ae,c as Ge}from"./index-31644aa3.js";import{s as ge}from"./statuses-1a7b8e83.js";import{i as He,c as Xe}from"./Link-4317fd36.js";import{_ as fe}from"./Switch.vue_vue_type_script_setup_true_lang-6e77b3e0.js";import{T as Ye}from"./TaskModal-d0e5aa30.js";import{o as Ze}from"./organizations-50691aa9.js";import{_ as Fe}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import"./FadedScrollableDiv-f3f408b5.js";import"./IconPicker-0c2832fa.js";import"./Popover-4a1551e7.js";import"./PinIcon-6c6ca639.js";import"./DetailsIcon-404b02bf.js";import"./settings-5fcce07e.js";import"./ArrowUpRightIcon-fffd9b01.js";import"./helpCenter-64650aa2.js";import"./ListRows-e4885bb7.js";import"./AssignmentModal-f44425e3.js";import"./ListFooter-fc834b42.js";import"./label-f9f1f609.js";import"./Section-7d029c27.js";const Ne={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},et={class:"mb-5 flex items-center justify-between"},tt={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},at={class:"flex items-center gap-1"},st={key:0,class:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3"},lt={key:0,class:"flex items-center gap-3 text-sm text-ink-gray-5"},ot={key:1,class:"flex items-center gap-3 text-sm text-ink-gray-5"},nt={key:1,class:"h-px w-full border-t my-5"},ut={class:"px-4 pb-7 pt-4 sm:px-6"},it={class:"flex flex-row-reverse gap-2"},rt={__name:"DealModal",props:ke({defaults:Object},{modelValue:{},modelModifiers:{},quickEntry:{},quickEntryModifiers:{}}),emits:["update:modelValue","update:quickEntry"],setup(K){const Y=K,{getUser:Z,isManager:F}=ve(),{getDealStatus:N,statusOptions:L}=ge(),U=ue(K,"modelValue"),J=xe(),g=m(null),n=me({organization:"",organization_name:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",deal_owner:""}),D=m(!0),R=m(!0),I=m(!1),u=m(!1),S=m(!1),O=m(null);Ce([S,u],([f,b])=>{T.data.forEach($=>{$.sections.forEach(h=>{h.name==="organization_section"?h.hidden=!f:h.name==="organization_details_section"?h.hidden=f:h.name==="contact_section"?h.hidden=!b:h.name==="contact_details_section"&&(h.hidden=b)})})});const T=ie({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Deal"],params:{doctype:"CRM Deal",type:"Quick Entry"},auto:!0,transform:f=>(D.value=!1,f.forEach(b=>{b.sections.forEach($=>{$.columns.forEach(h=>{["organization_section","organization_details_section"].includes($.name)?D.value=!0:["contact_section","contact_details_section"].includes($.name)&&(R.value=!0),h.fields.forEach(V=>{V.fieldname=="status"&&(V.fieldtype="Select",V.options=w.value,V.prefix=N(n.status).color),V.fieldtype==="Table"&&(n[V.fieldname]=[])})})})}))}),w=pe(()=>{let f=L("deal");return n.status||(n.status=f[0].value),f});function s(){n.website&&!n.website.startsWith("http")&&(n.website="https://"+n.website),u.value?(n.first_name=null,n.last_name=null,n.email=null,n.mobile_no=null):n.contact=null,ie({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:n},auto:!0,validate(){if(g.value=null,n.annual_revenue){if(typeof n.annual_revenue=="string")n.annual_revenue=n.annual_revenue.replace(/,/g,"");else if(isNaN(n.annual_revenue))return g.value=__("Annual Revenue should be a number"),g.value}if(n.mobile_no&&isNaN(n.mobile_no.replace(/[-+() ]/g,"")))return g.value=__("Mobile No should be a number"),g.value;if(n.email&&!n.email.includes("@"))return g.value=__("Invalid Email"),g.value;if(!n.status)return g.value=__("Status is required"),g.value;I.value=!0},onSuccess(f){we("deal_created"),I.value=!1,U.value=!1,J.push({name:"Deal",params:{dealId:f}})},onError(f){if(I.value=!1,!f.messages){g.value=f.message;return}g.value=f.messages.join(`
`)}})}const Q=ue(K,"quickEntry");function ee(){Q.value=!0,Ve(()=>{U.value=!1})}return he(()=>{Object.assign(n,Y.defaults),n.deal_owner||(n.deal_owner=Z().name),!n.status&&w.value[0].value&&(n.status=w.value[0].value)}),(f,b)=>{const $=A("Button"),h=A("FeatherIcon"),V=A("ErrorMessage"),q=A("Dialog");return l(),C(q,{modelValue:U.value,"onUpdate:modelValue":b[3]||(b[3]=B=>U.value=B),options:{size:"3xl"}},{body:E(()=>{var B;return[p("div",Ne,[p("div",et,[p("div",null,[p("h3",tt,M(f.__("Create Deal")),1)]),p("div",at,[x(F)()&&!x(He)?(l(),C($,{key:0,variant:"ghost",class:"w-7",onClick:ee},{default:E(()=>[r(je,{class:"h-4 w-4"})]),_:1})):_("",!0),r($,{variant:"ghost",class:"w-7",onClick:b[0]||(b[0]=P=>U.value=!1)},{default:E(()=>[r(h,{name:"x",class:"h-4 w-4"})]),_:1})])]),p("div",null,[D.value||R.value?(l(),d("div",st,[D.value?(l(),d("div",lt,[p("div",null,M(f.__("Choose Existing Organization")),1),r(x(fe),{modelValue:S.value,"onUpdate:modelValue":b[1]||(b[1]=P=>S.value=P)},null,8,["modelValue"])])):_("",!0),R.value?(l(),d("div",ot,[p("div",null,M(f.__("Choose Existing Contact")),1),r(x(fe),{modelValue:u.value,"onUpdate:modelValue":b[2]||(b[2]=P=>u.value=P)},null,8,["modelValue"])])):_("",!0)])):_("",!0),D.value||R.value?(l(),d("div",nt)):_("",!0),(B=x(T).data)!=null&&B.length?(l(),C(Oe,{key:2,ref_key:"fieldLayoutRef",ref:O,tabs:x(T).data,data:n,doctype:"CRM Deal"},null,8,["tabs","data"])):_("",!0),g.value?(l(),C(V,{key:3,class:"mt-4",message:f.__(g.value)},null,8,["message"])):_("",!0)])]),p("div",ut,[p("div",it,[r($,{variant:"solid",label:f.__("Create"),loading:I.value,onClick:s},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}},dt={class:"flex gap-2 items-center"},ct={key:0},_t={key:1},ft={key:2},mt={key:3,class:"truncate text-base"},pt={key:4,class:"truncate text-base"},vt={key:5,class:"truncate text-base"},gt={key:6,class:"text-ink-gray-4"},bt={key:0,class:"truncate flex items-center gap-2"},yt={key:0},kt={key:1},xt={key:2},Ct={key:3,class:"truncate text-base"},ht={key:4,class:"truncate text-base"},wt={key:5,class:"flex items-center"},Vt={key:6,class:"truncate text-base"},Et={class:"flex gap-2 items-center justify-between"},Mt={class:"text-ink-gray-5 flex items-center gap-1.5"},Dt={key:0},zt={key:1},$t={key:2},Rt={key:3},Ut={key:2,class:"flex h-full items-center justify-center"},It={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},va={__name:"Deals",setup(K){const{getFormattedPercent:Y,getFormattedFloat:Z,getFormattedCurrency:F}=Ke("CRM Deal"),{makeCall:N}=Je(),{getUser:L}=ve(),{getOrganization:U}=Ze(),{getDealStatus:J}=ge(),g=Me(),n=m(null),D=m(!1),R=m(!1),I=me({}),u=m({}),S=m(1),O=m(1),T=m(20),w=m(null);function s(i,t){var v;function y(c){return c&&typeof c=="object"&&!Array.isArray(c)?c:{label:c}}return y((v=Q.value)==null?void 0:v.find(c=>c.name==i)[t])}const Q=pe(()=>{var i,t,y,v,c,e,a;return(t=(i=u.value)==null?void 0:i.data)!=null&&t.data?u.value.data.view_type==="group_by"?(v=(y=u.value)==null?void 0:y.data.group_by_field)!=null&&v.fieldname?ee((c=u.value)==null?void 0:c.data.data,(e=u.value)==null?void 0:e.data.group_by_field,u.value.data.columns):[]:u.value.data.view_type==="kanban"?f(u.value.data.data,u.value.data.fields):b((a=u.value)==null?void 0:a.data.data,u.value.data.columns):[]});function ee(i,t,y){var c;let v=[];return(c=t.options)==null||c.forEach(e=>{let a=[];e?a=i.filter(k=>k[t.fieldname]==e):a=i.filter(k=>!k[t.fieldname]);let o={label:t.label,group:e||__(" "),collapsed:!1,rows:b(a,y)};t.fieldname=="status"&&(o.icon=()=>{var k;return G(te,{class:(k=J(e))==null?void 0:k.color})}),v.push(o)}),v||i}function f(i,t){let y=[];return i.forEach(v=>{var c;(c=v.data)==null||c.forEach(e=>{y.push(e)})}),b(y,t)}function b(i,t=[]){let y=u.value.data.view_type,v=y==="kanban"?"fieldname":"key",c=y==="kanban"?"fieldtype":"type";return i.map(e=>{let a={};return u.value.data.rows.forEach(o=>{var se,le,oe;a[o]=e[o];let k=(se=t==null?void 0:t.find(z=>(z[v]||z.value)==o))==null?void 0:se[c];if(k&&["Date","Datetime"].includes(k)&&!["modified","creation"].includes(o)&&(a[o]=X(e[o],"",!0,k=="Datetime")),k&&k=="Currency"&&(a[o]=F(o,e)),k&&k=="Float"&&(a[o]=Z(o,e)),k&&k=="Percent"&&(a[o]=Y(o,e)),o=="organization")a[o]={label:e.organization,logo:(le=U(e.organization))==null?void 0:le.organization_logo};else if(o==="website")a[o]=We(e.website);else if(o=="status")a[o]={label:e.status,color:(oe=J(e.status))==null?void 0:oe.color};else if(o=="sla_status"){let z=e.sla_status,j=z,ne=e.sla_status=="Failed"?"red":e.sla_status=="Fulfilled"?"green":"orange";z=="First Response Due"&&(z=__(ae(e.response_by)),j=X(e.response_by),new Date(e.response_by)<new Date&&(ne="red")),a[o]={label:j,value:z,color:ne}}else if(o=="deal_owner")a[o]={label:e.deal_owner&&L(e.deal_owner).full_name,...e.deal_owner&&L(e.deal_owner)};else if(o=="_assign"){let z=JSON.parse(e._assign||"[]");a[o]=z.map(j=>({name:j,image:L(j).user_image,label:L(j).full_name}))}else if(["modified","creation"].includes(o))a[o]={label:X(e[o]),timeAgo:__(ae(e[o]))};else if(["first_response_time","first_responded_on","response_by"].includes(o)){let z=o=="response_by"?"response_by":"first_responded_on";a[o]={label:e[z]?X(e[z]):"",timeAgo:e[o]?o=="first_response_time"?Ge(e[o]):__(ae(e[o])):""}}}),a._email_count=e._email_count,a._note_count=e._note_count,a._task_count=e._task_count,a._comment_count=e._comment_count,a})}function $(i){let t=u.value.params.column_field;t&&(I[t]=i.column.name),D.value=!0}function h(i){var v;let t=((v=s(i,"mobile_no"))==null?void 0:v.label)||"";return[{icon:G(Se,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>N(t),condition:()=>t&&Xe.value},{icon:G(ce,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>P(i)},{icon:G(_e,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>ye(i)}].filter(c=>c.condition?c.condition():!0)}const V=m(""),q=m(!1),B=m({title:"",content:""});function P(i){V.value=i,q.value=!0}const W=m(!1),be=m({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function ye(i){V.value=i,W.value=!0}return(i,t)=>{const y=A("FeatherIcon"),v=A("Button"),c=A("Badge");return l(),d(Ee,null,[r(qe,null,{"left-header":E(()=>[r($e,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e),routeName:"Deals"},null,8,["modelValue"])]),"right-header":E(()=>{var e;return[(e=n.value)!=null&&e.customListActions?(l(),C(Ue,{key:0,actions:n.value.customListActions},null,8,["actions"])):_("",!0),r(v,{variant:"solid",label:i.__("Create"),onClick:t[1]||(t[1]=a=>D.value=!0)},{prefix:E(()=>[r(y,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),r(ze,{ref_key:"viewControls",ref:w,modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),loadMore:S.value,"onUpdate:loadMore":t[3]||(t[3]=e=>S.value=e),resizeColumn:O.value,"onUpdate:resizeColumn":t[4]||(t[4]=e=>O.value=e),updatedPageCount:T.value,"onUpdate:updatedPageCount":t[5]||(t[5]=e=>T.value=e),doctype:"CRM Deal",options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),x(g).params.viewType=="kanban"?(l(),C(Pe,{key:0,modelValue:u.value,"onUpdate:modelValue":t[7]||(t[7]=e=>u.value=e),options:{getRoute:e=>({name:"Deal",params:{dealId:e.name},query:{view:x(g).query.view,viewType:x(g).params.viewType}}),onNewClick:e=>$(e)},onUpdate:t[8]||(t[8]=e=>w.value.updateKanbanSettings(e)),onLoadMore:t[9]||(t[9]=e=>w.value.loadMoreKanban(e))},{title:E(({titleField:e,itemName:a})=>[p("div",dt,[e==="status"?(l(),d("div",ct,[r(te,{class:re(s(a,e).color)},null,8,["class"])])):e==="organization"&&s(a,e).label?(l(),d("div",_t,[r(x(H),{class:"flex items-center",image:s(a,e).logo,label:s(a,e).label,size:"sm"},null,8,["image","label"])])):e==="deal_owner"&&s(a,e).full_name?(l(),d("div",ft,[r(x(H),{class:"flex items-center",image:s(a,e).user_image,label:s(a,e).full_name,size:"sm"},null,8,["image","label"])])):_("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(l(),d("div",mt,[r(x(de),{text:s(a,e).label},{default:E(()=>[p("div",null,M(s(a,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(l(),d("div",pt,[s(a,e).value?(l(),C(c,{key:0,variant:"subtle",theme:s(a,e).color,size:"md",label:s(a,e).value},null,8,["theme","label"])):_("",!0)])):s(a,e).label?(l(),d("div",vt,M(s(a,e).label),1)):(l(),d("div",gt,M(i.__("No Title")),1))])]),fields:E(({fieldName:e,itemName:a})=>[s(a,e).label?(l(),d("div",bt,[e==="status"?(l(),d("div",yt,[r(te,{class:re(s(a,e).color)},null,8,["class"])])):e==="organization"?(l(),d("div",kt,[s(a,e).label?(l(),C(x(H),{key:0,class:"flex items-center",image:s(a,e).logo,label:s(a,e).label,size:"xs"},null,8,["image","label"])):_("",!0)])):e==="deal_owner"?(l(),d("div",xt,[s(a,e).full_name?(l(),C(x(H),{key:0,class:"flex items-center",image:s(a,e).user_image,label:s(a,e).full_name,size:"xs"},null,8,["image","label"])):_("",!0)])):_("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(l(),d("div",Ct,[r(x(de),{text:s(a,e).label},{default:E(()=>[p("div",null,M(s(a,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(l(),d("div",ht,[s(a,e).value?(l(),C(c,{key:0,variant:"subtle",theme:s(a,e).color,size:"md",label:s(a,e).value},null,8,["theme","label"])):_("",!0)])):e==="_assign"?(l(),d("div",wt,[r(Re,{avatars:s(a,e).label,size:"xs"},null,8,["avatars"])])):(l(),d("div",Vt,M(s(a,e).label),1))])):_("",!0)]),actions:E(({itemName:e})=>[p("div",Et,[p("div",Mt,[r(Ie,{class:"h-4 w-4"}),s(e,"_email_count").label?(l(),d("span",Dt,M(s(e,"_email_count").label),1)):_("",!0),t[25]||(t[25]=p("span",{class:"text-3xl leading-[0]"}," · ",-1)),r(ce,{class:"h-4 w-4"}),s(e,"_note_count").label?(l(),d("span",zt,M(s(e,"_note_count").label),1)):_("",!0),t[26]||(t[26]=p("span",{class:"text-3xl leading-[0]"}," · ",-1)),r(_e,{class:"h-4 w-4"}),s(e,"_task_count").label?(l(),d("span",$t,M(s(e,"_task_count").label),1)):_("",!0),t[27]||(t[27]=p("span",{class:"text-3xl leading-[0]"}," · ",-1)),r(Ae,{class:"h-4 w-4"}),s(e,"_comment_count").label?(l(),d("span",Rt,M(s(e,"_comment_count").label),1)):_("",!0)]),r(x(Fe),{class:"flex items-center gap-2",options:h(e),variant:"ghost",onClick:t[6]||(t[6]=De(()=>{},["stop","prevent"]))},{default:E(()=>[r(v,{icon:"plus",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):u.value.data&&Q.value.length?(l(),C(Be,{key:1,ref_key:"dealsListView",ref:n,modelValue:u.value.data.page_length_count,"onUpdate:modelValue":t[10]||(t[10]=e=>u.value.data.page_length_count=e),list:u.value,"onUpdate:list":t[11]||(t[11]=e=>u.value=e),rows:Q.value,columns:u.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:u.value.data.row_count,totalCount:u.value.data.total_count},onLoadMore:t[12]||(t[12]=()=>S.value++),onColumnWidthUpdated:t[13]||(t[13]=()=>O.value++),onUpdatePageCount:t[14]||(t[14]=e=>T.value=e),onApplyFilter:t[15]||(t[15]=e=>w.value.applyFilter(e)),onApplyLikeFilter:t[16]||(t[16]=e=>w.value.applyLikeFilter(e)),onLikeDoc:t[17]||(t[17]=e=>w.value.likeDoc(e)),onSelectionsChanged:t[18]||(t[18]=e=>w.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):u.value.data?(l(),d("div",Ut,[p("div",It,[r(Le,{class:"h-10 w-10"}),p("span",null,M(i.__("No {0} Found",[i.__("Deals")])),1),r(v,{label:i.__("Create"),onClick:t[19]||(t[19]=e=>D.value=!0)},{prefix:E(()=>[r(y,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):_("",!0),D.value?(l(),C(rt,{key:3,modelValue:D.value,"onUpdate:modelValue":t[20]||(t[20]=e=>D.value=e),quickEntry:R.value,"onUpdate:quickEntry":t[21]||(t[21]=e=>R.value=e),defaults:I},null,8,["modelValue","quickEntry","defaults"])):_("",!0),q.value?(l(),C(Te,{key:4,modelValue:q.value,"onUpdate:modelValue":t[22]||(t[22]=e=>q.value=e),note:B.value,doctype:"CRM Deal",doc:V.value},null,8,["modelValue","note","doc"])):_("",!0),W.value?(l(),C(Ye,{key:5,modelValue:W.value,"onUpdate:modelValue":t[23]||(t[23]=e=>W.value=e),task:be.value,doctype:"CRM Deal",doc:V.value},null,8,["modelValue","task","doc"])):_("",!0),R.value?(l(),C(Qe,{key:6,modelValue:R.value,"onUpdate:modelValue":t[24]||(t[24]=e=>R.value=e),doctype:"CRM Deal"},null,8,["modelValue"])):_("",!0)],64)}}};export{va as default};
//# sourceMappingURL=Deals-42615069.js.map
