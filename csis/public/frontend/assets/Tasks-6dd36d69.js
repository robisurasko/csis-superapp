import{m as X,i as Z,j as W,s as le,k as ne,l as M,e as F,f as a,c as u,b as o,w as p,u as v,F as j,r as ie,g as b,n as N,p as g,_ as E,d as w,t as $,q as H,B as re,aa as ue,E as de}from"./index-85632e04.js";import{_ as pe,a as ce}from"./ViewControls-20f61d89.js";import{_ as fe}from"./CustomActions-4107b940.js";import{A as me}from"./ArrowUpRightIcon-fffd9b01.js";import{f as P,i as Y,h as q,a as K,b as _e,u as ke,t as ve}from"./index-31644aa3.js";import{E as ye}from"./Email2Icon-d49a0a62.js";import{_ as ge}from"./LayoutHeader-448e93da.js";import{_ as Ce,H as ee,a as be,b as he,c as we,d as xe,e as Me,f as $e}from"./ListRows-e4885bb7.js";import{C as Ve}from"./CalendarIcon-b9320815.js";import{_ as te}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{_ as Te}from"./ListFooter-fc834b42.js";import{_ as Le}from"./KanbanView-a348c3f4.js";import{T as Ue}from"./TaskModal-d0e5aa30.js";import"./FadedScrollableDiv-f3f408b5.js";import"./IconPicker-0c2832fa.js";import"./Popover-4a1551e7.js";import"./Link-4317fd36.js";import"./DragVerticalIcon-e7d3e46c.js";import"./PinIcon-6c6ca639.js";import"./DetailsIcon-404b02bf.js";import"./settings-5fcce07e.js";import"./AssignmentModal-f44425e3.js";import"./label-f9f1f609.js";import"./IndicatorIcon-99f76624.js";import"./helpCenter-64650aa2.js";const Ae={key:0},Re={class:"flex items-center gap-2 truncate text-base"},De={key:0,class:"truncate"},ze={key:0},Be={key:1},Fe={key:2},Ee=["onClick"],Pe=["innerHTML"],Ie={key:2},Se={key:3},We=["onClick"],je={__name:"TasksListView",props:X({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:X(["loadMore","updatePageCount","showTask","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],["update:modelValue","update:list"]),setup(C,{expose:I,emit:S}){const h=S,U=Z(C,"modelValue"),z=Z(C,"list"),B=W(()=>{var y,l;return!!((l=(y=z.value.params)==null?void 0:y.filters)!=null&&l._liked_by)}),{user:r}=le();function A(y){if(y)return JSON.parse(y).includes(r)}ne(U,(y,l)=>{y!==l&&h("updatePageCount",y)});const T=M(null);return I({customListActions:W(()=>{var y;return(y=T.value)==null?void 0:y.customListActions})}),(y,l)=>{const n=F("Button"),L=F("FormControl");return a(),u(j,null,[o(v(Me),{columns:C.columns,rows:C.rows,options:{onRowClick:f=>h("showTask",f.name),selectable:C.options.selectable,showTooltip:C.options.showTooltip,resizeColumn:C.options.resizeColumn},"row-key":"name","onUpdate:selections":l[2]||(l[2]=f=>h("selectionsChanged",f))},{default:p(()=>[o(v(Ce),{class:"mx-3 sm:mx-5",onColumnWidthUpdated:l[1]||(l[1]=f=>h("columnWidthUpdated"))},{default:p(()=>[(a(!0),u(j,null,ie(C.columns,f=>(a(),b(v(be),{key:f.key,item:f,onColumnWidthUpdated:_=>h("columnWidthUpdated",f)},{default:p(()=>[f.key=="_liked_by"?(a(),b(n,{key:0,variant:"ghosted",class:N(["!h-4",B.value?"fill-red-500":"fill-white"]),onClick:l[0]||(l[0]=()=>h("applyLikeFilter"))},{default:p(()=>[o(ee,{class:"h-4 w-4"})]),_:1},8,["class"])):g("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),o(he,{class:"mx-3 sm:mx-5",rows:C.rows,doctype:"CRM Task"},{default:p(({idx:f,column:_,item:d})=>[_.key==="due_date"?(a(),u("div",Ae,[o(v(E),{text:d&&v(P)(d,"ddd, MMM D, YYYY | hh:mm a")},{default:p(()=>[w("div",Re,[w("div",null,[o(Ve)]),d?(a(),u("div",De,$(v(P)(d,"D MMM, hh:mm a")),1)):g("",!0)])]),_:2},1032,["text"])])):(a(),b(v(we),{key:1,item:d,align:_.align},{prefix:p(()=>[_.key==="status"?(a(),u("div",ze,[o(Y,{status:d},null,8,["status"])])):_.key==="priority"?(a(),u("div",Be,[o(q,{priority:d},null,8,["priority"])])):_.key==="assigned_to"?(a(),u("div",Fe,[d.full_name?(a(),b(v(K),{key:0,class:"flex items-center",image:d.user_image,label:d.full_name,size:"sm"},null,8,["image","label"])):g("",!0)])):g("",!0)]),default:p(({label:R})=>[["modified","creation"].includes(_.key)?(a(),u("div",{key:0,class:"truncate text-base",onClick:D=>h("applyFilter",{event:D,idx:f,column:_,item:d,firstColumn:C.columns[0]})},[o(v(E),{text:d.label},{default:p(()=>[w("div",null,$(d.timeAgo),1)]),_:2},1032,["text"])],8,Ee)):_.type==="Text Editor"?(a(),u("div",{key:1,innerHTML:d,class:"truncate text-base h-4 [&>p]:truncate"},null,8,Pe)):_.type==="Check"?(a(),u("div",Ie,[o(L,{type:"checkbox",modelValue:d,disabled:!0,class:"text-ink-gray-9"},null,8,["modelValue"])])):_.key==="_liked_by"?(a(),u("div",Se,[_.key=="_liked_by"?(a(),b(n,{key:0,variant:"ghosted",class:N(A(d)?"fill-red-500":"fill-white"),onClick:H(()=>h("likeDoc",{name:y.row.name,liked:A(d)}),["stop","prevent"])},{default:p(()=>[o(ee,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):g("",!0)])):(a(),u("div",{key:4,class:"truncate text-base",onClick:D=>h("applyFilter",{event:D,idx:f,column:_,item:d,firstColumn:C.columns[0]})},$(R),9,We))]),_:2},1032,["item","align"]))]),_:1},8,["rows"]),o(v(xe),null,{actions:p(({selections:f,unselectAll:_})=>[o(v(te),{options:T.value.bulkActions(f,_)},{default:p(()=>[o(n,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),o(v(Te),{class:"border-t px-3 py-2 sm:px-5",modelValue:U.value,"onUpdate:modelValue":l[3]||(l[3]=f=>U.value=f),options:{rowCount:C.options.rowCount,totalCount:C.options.totalCount},onLoadMore:l[4]||(l[4]=f=>h("loadMore"))},null,8,["modelValue","options"]),o($e,{ref_key:"listBulkActionsRef",ref:T,modelValue:z.value,"onUpdate:modelValue":l[5]||(l[5]=f=>z.value=f),doctype:"CRM Task",options:{hideAssign:!0}},null,8,["modelValue"])],64)}}},He={class:"flex items-center gap-2"},Ye={key:0},qe={key:1},Ke={key:2},Oe={key:3,class:"truncate text-base"},Je={key:4,class:"truncate text-base"},Ge={key:5,class:"text-ink-gray-4"},Qe={key:0,class:"truncate flex items-center gap-2"},Xe={key:0},Ze={key:1},Ne={key:2},et={key:3,class:"truncate text-base"},tt={key:4,class:"truncate text-base max-h-44"},at={key:5,class:"truncate text-base"},st={class:"flex gap-2 items-center justify-between"},ot={key:2,class:"flex h-full items-center justify-center"},lt={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},At={__name:"Tasks",setup(C){const{getFormattedPercent:I,getFormattedFloat:S,getFormattedCurrency:h}=_e("CRM Task"),{getUser:U}=ke(),z=re(),B=M(null),r=M({}),A=M(1),T=M(1),y=M(20),l=M(null);function n(i,t){var m;function c(e){return e&&typeof e=="object"?e:{label:e}}return c((m=L.value)==null?void 0:m.find(e=>e.name==i)[t])}const L=W(()=>{var i,t,c,m;return(t=(i=r.value)==null?void 0:i.data)!=null&&t.data?r.value.data.view_type==="kanban"?f(r.value.data.data,r.value.data.fields):_((c=r.value)==null?void 0:c.data.data,(m=r.value)==null?void 0:m.data.columns):[]});function f(i,t){let c=[];return i.forEach(m=>{var e;(e=m.data)==null||e.forEach(s=>{c.push(s)})}),_(c,t)}function _(i,t=[]){let c=r.value.data.view_type,m=c==="kanban"?"fieldname":"key",e=c==="kanban"?"fieldtype":"type";return i.map(s=>{var J;let V={};return(J=r.value)==null||J.data.rows.forEach(k=>{var G;V[k]=s[k];let x=(G=t==null?void 0:t.find(Q=>(Q[m]||Q.value)==k))==null?void 0:G[e];x&&["Date","Datetime"].includes(x)&&!["modified","creation","due_date"].includes(k)&&(V[k]=P(s[k],"",!0,x=="Datetime")),x&&x=="Currency"&&(V[k]=h(k,s)),x&&x=="Float"&&(V[k]=S(k,s)),x&&x=="Percent"&&(V[k]=I(k,s)),["modified","creation"].includes(k)?V[k]={label:P(s[k]),timeAgo:__(ve(s[k]))}:k=="assigned_to"&&(V[k]={label:s.assigned_to&&U(s.assigned_to).full_name,...s.assigned_to&&U(s.assigned_to)})}),V})}const d=M(!1),R=M({name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""});function D(i){var c,m;let t=(c=L.value)==null?void 0:c.find(e=>e.name===i);R.value={name:t.name,title:t.title,description:t.description,assigned_to:((m=t.assigned_to)==null?void 0:m.email)||"",due_date:t.due_date,status:t.status,priority:t.priority,reference_doctype:t.reference_doctype,reference_docname:t.reference_docname},d.value=!0}function O(i){var t;if(R.value={name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""},(t=i.column)!=null&&t.name){let c=r.value.params.column_field;c&&(R.value[c]=i.column.name)}d.value=!0}function ae(i){return[{label:__("Delete"),icon:"trash-2",onClick:()=>{se(i),r.value.reload()}}]}async function se(i){await de("frappe.client.delete",{doctype:"CRM Task",name:i})}function oe(i,t){if(!t)return;let c=i=="CRM Deal"?"Deal":"Lead",m={leadId:t};c=="Deal"&&(m={dealId:t}),z.push({name:c,params:m})}return(i,t)=>{const c=F("FeatherIcon"),m=F("Button");return a(),u(j,null,[o(ge,null,{"left-header":p(()=>[o(ce,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),routeName:"Tasks"},null,8,["modelValue"])]),"right-header":p(()=>{var e;return[(e=B.value)!=null&&e.customListActions?(a(),b(fe,{key:0,actions:B.value.customListActions},null,8,["actions"])):g("",!0),o(m,{variant:"solid",label:i.__("Create"),onClick:O},{prefix:p(()=>[o(c,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),o(pe,{ref_key:"viewControls",ref:l,modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),loadMore:A.value,"onUpdate:loadMore":t[2]||(t[2]=e=>A.value=e),resizeColumn:T.value,"onUpdate:resizeColumn":t[3]||(t[3]=e=>T.value=e),updatedPageCount:y.value,"onUpdate:updatedPageCount":t[4]||(t[4]=e=>y.value=e),doctype:"CRM Task",options:{allowedViews:["list","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),i.$route.params.viewType=="kanban"&&L.value.length?(a(),b(Le,{key:0,modelValue:r.value,"onUpdate:modelValue":t[6]||(t[6]=e=>r.value=e),options:{onClick:e=>D(e.name),onNewClick:e=>O(e)},onUpdate:t[7]||(t[7]=e=>l.value.updateKanbanSettings(e)),onLoadMore:t[8]||(t[8]=e=>l.value.loadMoreKanban(e))},{title:p(({titleField:e,itemName:s})=>[w("div",He,[e==="status"?(a(),u("div",Ye,[o(Y,{status:n(s,e).label},null,8,["status"])])):e==="priority"?(a(),u("div",qe,[o(q,{priority:n(s,e).label},null,8,["priority"])])):e==="assigned_to"?(a(),u("div",Ke,[n(s,e).full_name?(a(),b(v(K),{key:0,class:"flex items-center",image:n(s,e).user_image,label:n(s,e).full_name,size:"sm"},null,8,["image","label"])):g("",!0)])):g("",!0),["modified","creation"].includes(e)?(a(),u("div",Oe,[o(v(E),{text:n(s,e).label},{default:p(()=>[w("div",null,$(n(s,e).timeAgo),1)]),_:2},1032,["text"])])):n(s,e).label?(a(),u("div",Je,$(n(s,e).label),1)):(a(),u("div",Ge,$(i.__("No Title")),1))])]),fields:p(({fieldName:e,itemName:s})=>[n(s,e).label?(a(),u("div",Qe,[e==="status"?(a(),u("div",Xe,[o(Y,{class:"size-3",status:n(s,e).label},null,8,["status"])])):e==="priority"?(a(),u("div",Ze,[o(q,{priority:n(s,e).label},null,8,["priority"])])):e==="assigned_to"?(a(),u("div",Ne,[n(s,e).full_name?(a(),b(v(K),{key:0,class:"flex items-center",image:n(s,e).user_image,label:n(s,e).full_name,size:"sm"},null,8,["image","label"])):g("",!0)])):g("",!0),["modified","creation"].includes(e)?(a(),u("div",et,[o(v(E),{text:n(s,e).label},{default:p(()=>[w("div",null,$(n(s,e).timeAgo),1)]),_:2},1032,["text"])])):e=="description"?(a(),u("div",tt,[n(s,e).label?(a(),b(v(ue),{key:0,content:n(s,e).label,editable:!1,"editor-class":"!prose-sm max-w-none focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):g("",!0)])):(a(),u("div",at,$(n(s,e).label),1))])):g("",!0)]),actions:p(({itemName:e})=>[w("div",st,[w("div",null,[n(e,"reference_docname").label?(a(),b(m,{key:0,class:"-ml-2",variant:"ghost",size:"sm",label:n(e,"reference_doctype").label=="CRM Deal"?i.__("Deal"):i.__("Lead"),onClick:H(s=>oe(n(e,"reference_doctype").label,n(e,"reference_docname").label),["stop"])},{suffix:p(()=>[o(me,{class:"h-4 w-4"})]),_:2},1032,["label","onClick"])):g("",!0)]),o(v(te),{class:"flex items-center gap-2",options:ae(e),variant:"ghost",onClick:t[5]||(t[5]=H(()=>{},["stop","prevent"]))},{default:p(()=>[o(m,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):r.value.data&&L.value.length?(a(),b(je,{key:1,ref_key:"tasksListView",ref:B,modelValue:r.value.data.page_length_count,"onUpdate:modelValue":t[9]||(t[9]=e=>r.value.data.page_length_count=e),list:r.value,"onUpdate:list":t[10]||(t[10]=e=>r.value=e),rows:L.value,columns:r.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:r.value.data.row_count,totalCount:r.value.data.total_count},onLoadMore:t[11]||(t[11]=()=>A.value++),onColumnWidthUpdated:t[12]||(t[12]=()=>T.value++),onUpdatePageCount:t[13]||(t[13]=e=>y.value=e),onShowTask:D,onApplyFilter:t[14]||(t[14]=e=>l.value.applyFilter(e)),onApplyLikeFilter:t[15]||(t[15]=e=>l.value.applyLikeFilter(e)),onLikeDoc:t[16]||(t[16]=e=>l.value.likeDoc(e)),onSelectionsChanged:t[17]||(t[17]=e=>l.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):r.value.data?(a(),u("div",ot,[w("div",lt,[o(ye,{class:"h-10 w-10"}),w("span",null,$(i.__("No {0} Found",[i.__("Tasks")])),1),o(m,{label:i.__("Create"),onClick:t[18]||(t[18]=e=>d.value=!0)},{prefix:p(()=>[o(c,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):g("",!0),d.value?(a(),b(Ue,{key:3,modelValue:d.value,"onUpdate:modelValue":t[19]||(t[19]=e=>d.value=e),reloadTasks:r.value,"onUpdate:reloadTasks":t[20]||(t[20]=e=>r.value=e),task:R.value},null,8,["modelValue","reloadTasks","task"])):g("",!0)],64)}}};export{At as default};
//# sourceMappingURL=Tasks-6dd36d69.js.map
