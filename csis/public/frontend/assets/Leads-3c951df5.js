import{m as ie,h as ce,i as ue,j as ee,s as we,k as xe,l as C,e as D,f as a,c as u,b as i,w as m,u as p,F as te,r as he,g as v,n as I,p as c,_ as se,d as V,t as h,q as pe,v as Ve,x as G}from"./index-85632e04.js";import{_ as $e,a as Le}from"./ViewControls-20f61d89.js";import{_ as fe}from"./MultipleAvatar-8c461416.js";import{_ as Me}from"./CustomActions-4107b940.js";import{E as ze}from"./EmailAtIcon-999061c4.js";import{P as le}from"./PhoneIcon-cb5df69f.js";import{_ as Ue,N as re}from"./NoteModal-4abb9e0a.js";import{T as de}from"./TaskIcon-f5c3d969.js";import{C as Ae}from"./CommentIcon-2d82e902.js";import{I as F}from"./IndicatorIcon-99f76624.js";import{L as Te}from"./LeadsIcon-68ebc4cc.js";import{_ as Re}from"./LayoutHeader-448e93da.js";import{_ as Be,H as _e,a as Ie,b as De,c as Ee,d as Pe,e as Se,f as qe}from"./ListRows-e4885bb7.js";import{a as A,b as We,g as je,u as Ke,f as Q,w as Oe,t as N,c as He}from"./index-31644aa3.js";import{_ as me}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{_ as Je}from"./ListFooter-fc834b42.js";import{_ as Ge}from"./KanbanView-a348c3f4.js";import{_ as Qe}from"./LeadModal-6a610a17.js";import{T as Fe}from"./TaskModal-d0e5aa30.js";import{_ as Xe}from"./QuickEntryModal-157d8856.js";import{s as Ye}from"./statuses-1a7b8e83.js";import{c as Ze}from"./Link-4317fd36.js";import"./FadedScrollableDiv-f3f408b5.js";import"./IconPicker-0c2832fa.js";import"./Popover-4a1551e7.js";import"./DragVerticalIcon-e7d3e46c.js";import"./PinIcon-6c6ca639.js";import"./DetailsIcon-404b02bf.js";import"./settings-5fcce07e.js";import"./ArrowUpRightIcon-fffd9b01.js";import"./helpCenter-64650aa2.js";import"./AssignmentModal-f44425e3.js";import"./label-f9f1f609.js";import"./Section-7d029c27.js";const Ne={key:0,class:"flex items-center"},et={key:0},tt={key:1},st={key:2},lt={key:3},at={key:4},ot=["onClick"],nt={key:1},it={key:2,class:"truncate text-base"},ut={key:3},rt=["onClick"],dt={__name:"LeadsListView",props:ie({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:ie(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],["update:modelValue","update:list"]),setup(y,{expose:X,emit:Y}){const w=Y,K=ce(),$=ue(y,"modelValue"),R=ue(y,"list"),E=ee(()=>{var b,o;return!!((o=(b=R.value.params)==null?void 0:b.filters)!=null&&o._liked_by)}),{user:P}=we();function L(b){if(b)return JSON.parse(b).includes(P)}xe($,(b,o)=>{b!==o&&w("updatePageCount",b)});const M=C(null);return X({customListActions:ee(()=>{var b;return(b=M.value)==null?void 0:b.customListActions})}),(b,o)=>{const T=D("Button"),S=D("Badge"),q=D("FormControl");return a(),u(te,null,[i(p(Se),{class:I(b.$attrs.class),columns:y.columns,rows:y.rows,options:{getRowRoute:r=>({name:"Lead",params:{leadId:r.name},query:{view:p(K).query.view,viewType:p(K).params.viewType}}),selectable:y.options.selectable,showTooltip:y.options.showTooltip,resizeColumn:y.options.resizeColumn},"row-key":"name","onUpdate:selections":o[2]||(o[2]=r=>w("selectionsChanged",r))},{default:m(()=>[i(p(Be),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:o[1]||(o[1]=r=>w("columnWidthUpdated"))},{default:m(()=>[(a(!0),u(te,null,he(y.columns,r=>(a(),v(p(Ie),{key:r.key,item:r,onColumnWidthUpdated:s=>w("columnWidthUpdated",r)},{default:m(()=>[r.key=="_liked_by"?(a(),v(T,{key:0,variant:"ghosted",class:I(["!h-4",E.value?"fill-red-500":"fill-white"]),onClick:o[0]||(o[0]=()=>w("applyLikeFilter"))},{default:m(()=>[i(_e,{class:"h-4 w-4"})]),_:1},8,["class"])):c("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),i(De,{rows:y.rows,doctype:"CRM Lead"},{default:m(({idx:r,column:s,item:d,row:Z})=>[s.key==="_assign"?(a(),u("div",Ne,[i(fe,{avatars:d,size:"sm",onClick:W=>w("applyFilter",{event:W,idx:r,column:s,item:d,firstColumn:y.columns[0]})},null,8,["avatars","onClick"])])):(a(),v(p(Ee),{key:1,item:d,align:s.align},{prefix:m(()=>[s.key==="status"?(a(),u("div",et,[i(F,{class:I(d.color)},null,8,["class"])])):s.key==="lead_name"?(a(),u("div",tt,[d.label?(a(),v(p(A),{key:0,class:"flex items-center",image:d.image,label:d.image_label,size:"sm"},null,8,["image","label"])):c("",!0)])):s.key==="organization"?(a(),u("div",st,[d?(a(),v(p(A),{key:0,class:"flex items-center",image:d,label:d,size:"sm"},null,8,["image","label"])):c("",!0)])):s.key==="lead_owner"?(a(),u("div",lt,[d.full_name?(a(),v(p(A),{key:0,class:"flex items-center",image:d.user_image,label:d.full_name,size:"sm"},null,8,["image","label"])):c("",!0)])):s.key==="mobile_no"?(a(),u("div",at,[i(le,{class:"h-4 w-4"})])):c("",!0)]),default:m(({label:W})=>[["modified","creation","first_response_time","first_responded_on","response_by"].includes(s.key)?(a(),u("div",{key:0,class:"truncate text-base",onClick:z=>w("applyFilter",{event:z,idx:r,column:s,item:d,firstColumn:y.columns[0]})},[i(p(se),{text:d.label},{default:m(()=>[V("div",null,h(d.timeAgo),1)]),_:2},1032,["text"])],8,ot)):s.key==="_liked_by"?(a(),u("div",nt,[s.key=="_liked_by"?(a(),v(T,{key:0,variant:"ghosted",class:I(L(d)?"fill-red-500":"fill-white"),onClick:pe(()=>w("likeDoc",{name:Z.name,liked:L(d)}),["stop","prevent"])},{default:m(()=>[i(_e,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):c("",!0)])):s.key==="sla_status"?(a(),u("div",it,[d.value?(a(),v(S,{key:0,variant:"subtle",theme:d.color,size:"md",label:d.value,onClick:z=>w("applyFilter",{event:z,idx:r,column:s,item:d,firstColumn:y.columns[0]})},null,8,["theme","label","onClick"])):c("",!0)])):s.type==="Check"?(a(),u("div",ut,[i(q,{type:"checkbox",modelValue:d,disabled:!0,class:"text-ink-gray-9"},null,8,["modelValue"])])):(a(),u("div",{key:4,class:"truncate text-base",onClick:z=>w("applyFilter",{event:z,idx:r,column:s,item:d,firstColumn:y.columns[0]})},h(W),9,rt))]),_:2},1032,["item","align"]))]),_:1},8,["rows"]),i(p(Pe),null,{actions:m(({selections:r,unselectAll:s})=>[i(p(me),{options:M.value.bulkActions(r,s)},{default:m(()=>[i(T,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["class","columns","rows","options"]),$.value?(a(),v(p(Je),{key:0,class:"border-t sm:px-5 px-3 py-2",modelValue:$.value,"onUpdate:modelValue":o[3]||(o[3]=r=>$.value=r),options:{rowCount:y.options.rowCount,totalCount:y.options.totalCount},onLoadMore:o[4]||(o[4]=r=>w("loadMore"))},null,8,["modelValue","options"])):c("",!0),i(qe,{ref_key:"listBulkActionsRef",ref:M,modelValue:R.value,"onUpdate:modelValue":o[5]||(o[5]=r=>R.value=r),doctype:"CRM Lead"},null,8,["modelValue"])],64)}}},_t={class:"flex items-center gap-2"},ct={key:0},pt={key:1},ft={key:2},mt={key:3},vt={key:4},kt={key:5,class:"truncate text-base"},yt={key:6,class:"truncate text-base"},bt={key:7,class:"truncate text-base"},gt={key:8,class:"text-ink-gray-4"},Ct={key:0,class:"truncate flex items-center gap-2"},wt={key:0},xt={key:1},ht={key:2},Vt={key:3},$t={key:4,class:"truncate text-base"},Lt={key:5,class:"truncate text-base"},Mt={key:6,class:"flex items-center"},zt={key:7,class:"truncate text-base"},Ut={class:"flex gap-2 items-center justify-between"},At={class:"text-ink-gray-5 flex items-center gap-1.5"},Tt={key:0},Rt={key:1},Bt={key:2},It={key:3},Dt={key:2,class:"flex h-full items-center justify-center"},Et={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},ys={__name:"Leads",setup(y){const{getFormattedPercent:X,getFormattedFloat:Y,getFormattedCurrency:w}=We("CRM Lead"),{makeCall:K}=je(),{getUser:$}=Ke(),{getLeadStatus:R}=Ye(),E=ce(),P=C(null),L=C(!1),M=C(!1),b=Ve({}),o=C({}),T=C(1),S=C(1),q=C(20),r=C(null);function s(_,t){var k;function g(f){return f&&typeof f=="object"&&!Array.isArray(f)?f:{label:f}}return g((k=d.value)==null?void 0:k.find(f=>f.name==_)[t])}const d=ee(()=>{var _,t,g,k,f,e,l;return(t=(_=o.value)==null?void 0:_.data)!=null&&t.data?o.value.data.view_type==="group_by"?(k=(g=o.value)==null?void 0:g.data.group_by_field)!=null&&k.fieldname?Z((f=o.value)==null?void 0:f.data.data,(e=o.value)==null?void 0:e.data.group_by_field,o.value.data.columns):[]:o.value.data.view_type==="kanban"?W(o.value.data.data,o.value.data.fields):z((l=o.value)==null?void 0:l.data.data,o.value.data.columns):[]});function Z(_,t,g){var f;let k=[];return(f=t.options)==null||f.forEach(e=>{let l=[];e?l=_.filter(n=>n[t.fieldname]==e):l=_.filter(n=>!n[t.fieldname]);let j={label:t.label,group:e||__(" "),collapsed:!1,rows:z(l,g)};t.fieldname=="status"&&(j.icon=()=>{var n;return G(F,{class:(n=R(e))==null?void 0:n.color})}),k.push(j)}),k||_}function W(_,t){let g=[];return _.forEach(k=>{var f;(f=k.data)==null||f.forEach(e=>{g.push(e)})}),z(g,t)}function z(_,t=[]){let g=o.value.data.view_type,k=g==="kanban"?"fieldname":"key",f=g==="kanban"?"fieldtype":"type";return _.map(e=>{var j;let l={};return(j=o.value)==null||j.data.rows.forEach(n=>{var ae,oe;l[n]=e[n];let U=(ae=t==null?void 0:t.find(x=>(x[k]||x.value)==n))==null?void 0:ae[f];if(U&&["Date","Datetime"].includes(U)&&!["modified","creation"].includes(n)&&(l[n]=Q(e[n],"",!0,U=="Datetime")),U&&U=="Currency"&&(l[n]=w(n,e)),U&&U=="Float"&&(l[n]=Y(n,e)),U&&U=="Percent"&&(l[n]=X(n,e)),n=="lead_name")l[n]={label:e.lead_name,image:e.image,image_label:e.first_name};else if(n=="organization")l[n]=e.organization;else if(n==="website")l[n]=Oe(e.website);else if(n=="status")l[n]={label:e.status,color:(oe=R(e.status))==null?void 0:oe.color};else if(n=="sla_status"){let x=e.sla_status,B=x,ne=e.sla_status=="Failed"?"red":e.sla_status=="Fulfilled"?"green":"orange";x=="First Response Due"&&(x=__(N(e.response_by)),B=Q(e.response_by),new Date(e.response_by)<new Date&&(ne="red")),l[n]={label:B,value:x,color:ne}}else if(n=="lead_owner")l[n]={label:e.lead_owner&&$(e.lead_owner).full_name,...e.lead_owner&&$(e.lead_owner)};else if(n=="_assign"){let x=JSON.parse(e._assign||"[]");l[n]=x.map(B=>({name:B,image:$(B).user_image,label:$(B).full_name}))}else if(["modified","creation"].includes(n))l[n]={label:Q(e[n]),timeAgo:__(N(e[n]))};else if(["first_response_time","first_responded_on","response_by"].includes(n)){let x=n=="response_by"?"response_by":"first_responded_on";l[n]={label:e[x]?Q(e[x]):"",timeAgo:e[n]?n=="first_response_time"?He(e[n]):__(N(e[n])):""}}}),l._email_count=e._email_count,l._note_count=e._note_count,l._task_count=e._task_count,l._comment_count=e._comment_count,l})}function ve(_){let t=o.value.params.column_field;t&&(b[t]=_.column.name),L.value=!0}function ke(_){var k;let t=((k=s(_,"mobile_no"))==null?void 0:k.label)||"";return[{icon:G(le,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>K(t),condition:()=>t&&Ze.value},{icon:G(re,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>be(_)},{icon:G(de,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>Ce(_)}].filter(f=>f.condition?f.condition():!0)}const O=C(""),H=C(!1),ye=C({title:"",content:""});function be(_){O.value=_,H.value=!0}const J=C(!1),ge=C({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function Ce(_){O.value=_,J.value=!0}return(_,t)=>{const g=D("FeatherIcon"),k=D("Button"),f=D("Badge");return a(),u(te,null,[i(Re,null,{"left-header":m(()=>[i(Le,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),routeName:"Leads"},null,8,["modelValue"])]),"right-header":m(()=>{var e;return[(e=P.value)!=null&&e.customListActions?(a(),v(Me,{key:0,actions:P.value.customListActions},null,8,["actions"])):c("",!0),i(k,{variant:"solid",label:_.__("Create"),onClick:t[1]||(t[1]=l=>L.value=!0)},{prefix:m(()=>[i(g,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),i($e,{ref_key:"viewControls",ref:r,modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value=e),loadMore:T.value,"onUpdate:loadMore":t[3]||(t[3]=e=>T.value=e),resizeColumn:S.value,"onUpdate:resizeColumn":t[4]||(t[4]=e=>S.value=e),updatedPageCount:q.value,"onUpdate:updatedPageCount":t[5]||(t[5]=e=>q.value=e),doctype:"CRM Lead",filters:{converted:0},options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),p(E).params.viewType=="kanban"?(a(),v(Ge,{key:0,modelValue:o.value,"onUpdate:modelValue":t[7]||(t[7]=e=>o.value=e),options:{getRoute:e=>({name:"Lead",params:{leadId:e.name},query:{view:p(E).query.view,viewType:p(E).params.viewType}}),onNewClick:e=>ve(e)},onUpdate:t[8]||(t[8]=e=>r.value.updateKanbanSettings(e)),onLoadMore:t[9]||(t[9]=e=>r.value.loadMoreKanban(e))},{title:m(({titleField:e,itemName:l})=>[V("div",_t,[e==="status"?(a(),u("div",ct,[i(F,{class:I(s(l,e).color)},null,8,["class"])])):e==="organization"&&s(l,e).label?(a(),u("div",pt,[i(p(A),{class:"flex items-center",image:s(l,e).logo,label:s(l,e).label,size:"sm"},null,8,["image","label"])])):e==="lead_name"&&s(l,e).label?(a(),u("div",ft,[i(p(A),{class:"flex items-center",image:s(l,e).image,label:s(l,e).image_label,size:"sm"},null,8,["image","label"])])):e==="lead_owner"&&s(l,e).full_name?(a(),u("div",mt,[i(p(A),{class:"flex items-center",image:s(l,e).user_image,label:s(l,e).full_name,size:"sm"},null,8,["image","label"])])):e==="mobile_no"?(a(),u("div",vt,[i(le,{class:"h-4 w-4"})])):c("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(a(),u("div",kt,[i(p(se),{text:s(l,e).label},{default:m(()=>[V("div",null,h(s(l,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(a(),u("div",yt,[s(l,e).value?(a(),v(f,{key:0,variant:"subtle",theme:s(l,e).color,size:"md",label:s(l,e).value},null,8,["theme","label"])):c("",!0)])):s(l,e).label?(a(),u("div",bt,h(s(l,e).label),1)):(a(),u("div",gt,h(_.__("No Title")),1))])]),fields:m(({fieldName:e,itemName:l})=>[s(l,e).label?(a(),u("div",Ct,[e==="status"?(a(),u("div",wt,[i(F,{class:I(s(l,e).color)},null,8,["class"])])):e==="organization"&&s(l,e).label?(a(),u("div",xt,[i(p(A),{class:"flex items-center",image:s(l,e).logo,label:s(l,e).label,size:"xs"},null,8,["image","label"])])):e==="lead_name"?(a(),u("div",ht,[s(l,e).label?(a(),v(p(A),{key:0,class:"flex items-center",image:s(l,e).image,label:s(l,e).image_label,size:"xs"},null,8,["image","label"])):c("",!0)])):e==="lead_owner"?(a(),u("div",Vt,[s(l,e).full_name?(a(),v(p(A),{key:0,class:"flex items-center",image:s(l,e).user_image,label:s(l,e).full_name,size:"xs"},null,8,["image","label"])):c("",!0)])):c("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(a(),u("div",$t,[i(p(se),{text:s(l,e).label},{default:m(()=>[V("div",null,h(s(l,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(a(),u("div",Lt,[s(l,e).value?(a(),v(f,{key:0,variant:"subtle",theme:s(l,e).color,size:"md",label:s(l,e).value},null,8,["theme","label"])):c("",!0)])):e==="_assign"?(a(),u("div",Mt,[i(fe,{avatars:s(l,e).label,size:"xs"},null,8,["avatars"])])):(a(),u("div",zt,h(s(l,e).label),1))])):c("",!0)]),actions:m(({itemName:e})=>[V("div",Ut,[V("div",At,[i(ze,{class:"h-4 w-4"}),s(e,"_email_count").label?(a(),u("span",Tt,h(s(e,"_email_count").label),1)):c("",!0),t[25]||(t[25]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),i(re,{class:"h-4 w-4"}),s(e,"_note_count").label?(a(),u("span",Rt,h(s(e,"_note_count").label),1)):c("",!0),t[26]||(t[26]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),i(de,{class:"h-4 w-4"}),s(e,"_task_count").label?(a(),u("span",Bt,h(s(e,"_task_count").label),1)):c("",!0),t[27]||(t[27]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),i(Ae,{class:"h-4 w-4"}),s(e,"_comment_count").label?(a(),u("span",It,h(s(e,"_comment_count").label),1)):c("",!0)]),i(p(me),{class:"flex items-center gap-2",options:ke(e),variant:"ghost",onClick:t[6]||(t[6]=pe(()=>{},["stop","prevent"]))},{default:m(()=>[i(k,{icon:"plus",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):o.value.data&&d.value.length?(a(),v(dt,{key:1,ref_key:"leadsListView",ref:P,modelValue:o.value.data.page_length_count,"onUpdate:modelValue":t[10]||(t[10]=e=>o.value.data.page_length_count=e),list:o.value,"onUpdate:list":t[11]||(t[11]=e=>o.value=e),rows:d.value,columns:o.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:o.value.data.row_count,totalCount:o.value.data.total_count},onLoadMore:t[12]||(t[12]=()=>T.value++),onColumnWidthUpdated:t[13]||(t[13]=()=>S.value++),onUpdatePageCount:t[14]||(t[14]=e=>q.value=e),onApplyFilter:t[15]||(t[15]=e=>r.value.applyFilter(e)),onApplyLikeFilter:t[16]||(t[16]=e=>r.value.applyLikeFilter(e)),onLikeDoc:t[17]||(t[17]=e=>r.value.likeDoc(e)),onSelectionsChanged:t[18]||(t[18]=e=>r.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):o.value.data?(a(),u("div",Dt,[V("div",Et,[i(Te,{class:"h-10 w-10"}),V("span",null,h(_.__("No {0} Found",[_.__("Leads")])),1),i(k,{label:_.__("Create"),onClick:t[19]||(t[19]=e=>L.value=!0)},{prefix:m(()=>[i(g,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):c("",!0),L.value?(a(),v(Qe,{key:3,modelValue:L.value,"onUpdate:modelValue":t[20]||(t[20]=e=>L.value=e),quickEntry:M.value,"onUpdate:quickEntry":t[21]||(t[21]=e=>M.value=e),defaults:b},null,8,["modelValue","quickEntry","defaults"])):c("",!0),H.value?(a(),v(Ue,{key:4,modelValue:H.value,"onUpdate:modelValue":t[22]||(t[22]=e=>H.value=e),note:ye.value,doctype:"CRM Lead",doc:O.value},null,8,["modelValue","note","doc"])):c("",!0),J.value?(a(),v(Fe,{key:5,modelValue:J.value,"onUpdate:modelValue":t[23]||(t[23]=e=>J.value=e),task:ge.value,doctype:"CRM Lead",doc:O.value},null,8,["modelValue","task","doc"])):c("",!0),M.value?(a(),v(Xe,{key:6,modelValue:M.value,"onUpdate:modelValue":t[24]||(t[24]=e=>M.value=e)},null,8,["modelValue"])):c("",!0)],64)}}};export{ys as default};
//# sourceMappingURL=Leads-3c951df5.js.map
