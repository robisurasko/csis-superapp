import{_ as kt}from"./Section-7d029c27.js";import{N as ye,l as M,x as Ie,X as Ct,V as Xe,j as B,aL as be,P as Y,a as ie,k as we,aY as wt,U as G,Q as $e,Y as $t,F as H,R as Ze,al as et,S as j,b3 as Je,aT as Re,$ as K,aR as Fe,bk as St,aO as Vt,aP as pe,aQ as Q,J as ue,f as p,g as x,w as F,c as T,r as Z,u as d,a6 as me,y as Se,d as $,n as q,C as Dt,p as L,D as ke,t as N,m as ee,i as te,b as V,at as Ye,au as He,e as U,a4 as tt,a5 as lt,am as he,bl as Ft,av as Rt,q as X,a1 as Be,aq as It,ac as Ne,z as Me,ab as at,a7 as nt,E as Ee,I as st,K as Ue,v as ot,ar as Le,a9 as Ke,a3 as Ot,_ as rt,bm as fe,ae as Tt,G as Pe,bd as Mt,as as Lt,H as Bt,a8 as Pt}from"./index-85632e04.js";import{D as ve,a as it,E as Ae,_ as ut}from"./DragVerticalIcon-e7d3e46c.js";import{I as Nt}from"./IndicatorIcon-99f76624.js";import{b as ae,n as xe,u as Ge,_ as Oe,q as Te,r as re,z as Et,g as Ut,F as At,p as Qe}from"./index-31644aa3.js";import{_ as Ce,a as dt,D as ct}from"./Link-4317fd36.js";import{s as Gt,_ as We}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";let jt=ye({props:{onFocus:{type:Function,required:!0}},setup(a){let r=M(!0);return()=>r.value?Ie(Xe,{as:"button",type:"button",features:Ct.Focusable,onFocus(o){o.preventDefault();let g,C=50;function v(){var m;if(C--<=0){g&&cancelAnimationFrame(g);return}if((m=a.onFocus)!=null&&m.call(a)){r.value=!1,cancelAnimationFrame(g);return}g=requestAnimationFrame(v)}g=requestAnimationFrame(v)}}):null}});var qt=(a=>(a[a.Forwards=0]="Forwards",a[a.Backwards=1]="Backwards",a))(qt||{}),zt=(a=>(a[a.Less=-1]="Less",a[a.Equal=0]="Equal",a[a.Greater=1]="Greater",a))(zt||{});let pt=Symbol("TabsContext");function Ve(a){let r=j(pt,null);if(r===null){let o=new Error(`<${a} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,Ve),o}return r}let je=Symbol("TabsSSRContext"),Jt=ye({name:"TabGroup",emits:{change:a=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(a,{slots:r,attrs:o,emit:g}){var C;let v=M((C=a.selectedIndex)!=null?C:a.defaultIndex),m=M([]),b=M([]),h=B(()=>a.selectedIndex!==null),D=B(()=>h.value?a.selectedIndex:v.value);function y(n){var s;let t=be(i.tabs.value,G),l=be(i.panels.value,G),k=t.filter(R=>{var f;return!((f=G(R))!=null&&f.hasAttribute("disabled"))});if(n<0||n>t.length-1){let R=Re(v.value===null?0:Math.sign(n-v.value),{[-1]:()=>1,0:()=>Re(Math.sign(n),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0}),f=Re(R,{0:()=>t.indexOf(k[0]),1:()=>t.indexOf(k[k.length-1])});f!==-1&&(v.value=f),i.tabs.value=t,i.panels.value=l}else{let R=t.slice(0,n),f=[...t.slice(n),...R].find(J=>k.includes(J));if(!f)return;let E=(s=t.indexOf(f))!=null?s:i.selectedIndex.value;E===-1&&(E=i.selectedIndex.value),v.value=E,i.tabs.value=t,i.panels.value=l}}let i={selectedIndex:B(()=>{var n,s;return(s=(n=v.value)!=null?n:a.defaultIndex)!=null?s:null}),orientation:B(()=>a.vertical?"vertical":"horizontal"),activation:B(()=>a.manual?"manual":"auto"),tabs:m,panels:b,setSelectedIndex(n){D.value!==n&&g("change",n),h.value||y(n)},registerTab(n){var s;if(m.value.includes(n))return;let t=m.value[v.value];if(m.value.push(n),m.value=be(m.value,G),!h.value){let l=(s=m.value.indexOf(t))!=null?s:v.value;l!==-1&&(v.value=l)}},unregisterTab(n){let s=m.value.indexOf(n);s!==-1&&m.value.splice(s,1)},registerPanel(n){b.value.includes(n)||(b.value.push(n),b.value=be(b.value,G))},unregisterPanel(n){let s=b.value.indexOf(n);s!==-1&&b.value.splice(s,1)}};Y(pt,i);let e=M({tabs:[],panels:[]}),c=M(!1);ie(()=>{c.value=!0}),Y(je,B(()=>c.value?null:e.value));let u=B(()=>a.selectedIndex);return ie(()=>{we([u],()=>{var n;return y((n=a.selectedIndex)!=null?n:a.defaultIndex)},{immediate:!0})}),wt(()=>{if(!h.value||D.value==null||i.tabs.value.length<=0)return;let n=be(i.tabs.value,G);n.some((s,t)=>G(i.tabs.value[t])!==G(s))&&i.setSelectedIndex(n.findIndex(s=>G(s)===G(i.tabs.value[D.value])))}),()=>{let n={selectedIndex:v.value};return Ie(H,[m.value.length<=0&&Ie(jt,{onFocus:()=>{for(let s of m.value){let t=G(s);if((t==null?void 0:t.tabIndex)===0)return t.focus(),!0}return!1}}),$e({theirProps:{...o,...$t(a,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:n,slots:r,attrs:o,name:"TabGroup"})])}}}),Yt=ye({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:r,slots:o}){let g=Ve("TabList");return()=>{let C={selectedIndex:g.selectedIndex.value},v={role:"tablist","aria-orientation":g.orientation.value};return $e({ourProps:v,theirProps:a,slot:C,attrs:r,slots:o,name:"TabList"})}}}),Ht=ye({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(a,{attrs:r,slots:o,expose:g}){var C;let v=(C=a.id)!=null?C:`headlessui-tabs-tab-${Ze()}`,m=Ve("Tab"),b=M(null);g({el:b,$el:b}),ie(()=>m.registerTab(b)),et(()=>m.unregisterTab(b));let h=j(je),D=B(()=>{if(h.value){let l=h.value.tabs.indexOf(v);return l===-1?h.value.tabs.push(v)-1:l}return-1}),y=B(()=>{let l=m.tabs.value.indexOf(b);return l===-1?D.value:l}),i=B(()=>y.value===m.selectedIndex.value);function e(l){var k;let R=l();if(R===Fe.Success&&m.activation.value==="auto"){let f=(k=Vt(b))==null?void 0:k.activeElement,E=m.tabs.value.findIndex(J=>G(J)===f);E!==-1&&m.setSelectedIndex(E)}return R}function c(l){let k=m.tabs.value.map(R=>G(R)).filter(Boolean);if(l.key===K.Space||l.key===K.Enter){l.preventDefault(),l.stopPropagation(),m.setSelectedIndex(y.value);return}switch(l.key){case K.Home:case K.PageUp:return l.preventDefault(),l.stopPropagation(),e(()=>pe(k,Q.First));case K.End:case K.PageDown:return l.preventDefault(),l.stopPropagation(),e(()=>pe(k,Q.Last))}if(e(()=>Re(m.orientation.value,{vertical(){return l.key===K.ArrowUp?pe(k,Q.Previous|Q.WrapAround):l.key===K.ArrowDown?pe(k,Q.Next|Q.WrapAround):Fe.Error},horizontal(){return l.key===K.ArrowLeft?pe(k,Q.Previous|Q.WrapAround):l.key===K.ArrowRight?pe(k,Q.Next|Q.WrapAround):Fe.Error}}))===Fe.Success)return l.preventDefault()}let u=M(!1);function n(){var l;u.value||(u.value=!0,!a.disabled&&((l=G(b))==null||l.focus({preventScroll:!0}),m.setSelectedIndex(y.value),St(()=>{u.value=!1})))}function s(l){l.preventDefault()}let t=Gt(B(()=>({as:a.as,type:r.type})),b);return()=>{var l,k;let R={selected:i.value,disabled:(l=a.disabled)!=null?l:!1},{...f}=a,E={ref:b,onKeydown:c,onMousedown:s,onClick:n,id:v,role:"tab",type:t.value,"aria-controls":(k=G(m.panels.value[y.value]))==null?void 0:k.id,"aria-selected":i.value,tabIndex:i.value?0:-1,disabled:a.disabled?!0:void 0};return $e({ourProps:E,theirProps:f,slot:R,attrs:r,slots:o,name:"Tab"})}}}),Kt=ye({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:r,attrs:o}){let g=Ve("TabPanels");return()=>{let C={selectedIndex:g.selectedIndex.value};return $e({theirProps:a,ourProps:{},slot:C,attrs:o,slots:r,name:"TabPanels"})}}}),Qt=ye({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null},tabIndex:{type:Number,default:0}},setup(a,{attrs:r,slots:o,expose:g}){var C;let v=(C=a.id)!=null?C:`headlessui-tabs-panel-${Ze()}`,m=Ve("TabPanel"),b=M(null);g({el:b,$el:b}),ie(()=>m.registerPanel(b)),et(()=>m.unregisterPanel(b));let h=j(je),D=B(()=>{if(h.value){let e=h.value.panels.indexOf(v);return e===-1?h.value.panels.push(v)-1:e}return-1}),y=B(()=>{let e=m.panels.value.indexOf(b);return e===-1?D.value:e}),i=B(()=>y.value===m.selectedIndex.value);return()=>{var e;let c={selected:i.value},{tabIndex:u,...n}=a,s={ref:b,id:v,role:"tabpanel","aria-labelledby":(e=G(m.tabs.value[y.value]))==null?void 0:e.id,tabIndex:i.value?u:-1};return!i.value&&a.unmount&&!a.static?Ie(Xe,{as:"span","aria-hidden":!0,...s}):$e({ourProps:s,theirProps:n,slot:c,attrs:r,slots:o,features:Je.Static|Je.RenderStrategy,visible:i.value,name:"TabPanel"})}}});const ft={__name:"TabList",setup(a){const r=j("tab"),o=M([]),g=M(null),C=B(()=>{var b;return(b=r.value.tabs.value)==null?void 0:b.length}),v=M("");function m(b){b>=C.value&&(b=C.value-1);const h=o.value[b].el;r.value.vertical.value?(g.value.style.height=`${h.offsetHeight}px`,g.value.style.top=`${h.offsetTop}px`):(g.value.style.width=`${h.offsetWidth}px`,g.value.style.left=`${h.offsetLeft}px`)}return we(()=>r.value.tabIndex.value,b=>{b>=C.value&&(r.value.tabIndex.value=C.value-1),v.value="transition-all duration-300 ease-in-out",ue(()=>m(b))}),ie(()=>{ue(()=>m(r.value.tabIndex.value)),setTimeout(()=>m(r.value.tabIndex.value),100)}),(b,h)=>(p(),x(d(Yt),{class:q(["relative flex",d(r).vertical?"flex-col border-r overflow-y-auto":"gap-7.5 border-b overflow-x-auto items-center px-5"])},{default:F(()=>[(p(!0),T(H,null,Z(d(r).tabs,(D,y)=>(p(),x(d(Ht),{ref_for:!0,ref_key:"tabRef",ref:o,as:"template",key:y,class:"focus:outline-none focus:transition-none"},{default:F(({selected:i})=>[me(b.$slots,"default",Se({ref_for:!0},{tab:D,selected:i}),()=>[$("button",{class:q(["flex items-center gap-1.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9",[i?"text-ink-gray-9":"",d(r).vertical?"py-2.5 px-4 border-r border-transparent hover:border-outline-gray-3":"py-3 border-b border-transparent hover:border-outline-gray-3"]])},[D.icon?(p(),x(Dt(D.icon),{key:0,class:"size-4"})):L("",!0),ke(" "+N(D.label),1)],2)])]),_:2},1024))),128)),$("div",{ref_key:"indicator",ref:g,class:q(["tab-indicator absolute bg-surface-gray-7",[d(r).vertical?"right-0 w-px":"bottom-0 h-px",v.value]])},null,2)]),_:3},8,["class"]))}},vt={__name:"TabPanel",setup(a){const r=j("tab");return(o,g)=>(p(),x(d(Kt),{class:"flex flex-1 overflow-hidden"},{default:F(()=>[(p(!0),T(H,null,Z(d(r).tabs,(C,v)=>(p(),x(d(Qt),{class:"flex flex-1 flex-col overflow-y-auto focus:outline-none",key:v},{default:F(()=>[me(o.$slots,"default",Se({ref_for:!0},{tab:C}))]),_:2},1024))),128))]),_:3}))}},Wt={__name:"Tabs",props:ee({as:{type:String,default:"template"},tabs:{type:Array,required:!0},vertical:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const r=a,o=te(a,"modelValue");return Y("tab",B(()=>({tabIndex:o,tabs:r.tabs,vertical:r.vertical}))),(g,C)=>(p(),x(d(Jt),Se(a.as!=="template"?{as:a.as,class:["flex flex-1 overflow-hidden",a.vertical?"":"flex-col "]}:{},{defaultIndex:o.value,selectedIndex:o.value,onChange:C[0]||(C[0]=v=>o.value=v)}),{default:F(()=>[me(g.$slots,"default",{},()=>[V(ft,null,{default:F(({tab:v,selected:m})=>[me(g.$slots,"tab-item",Ye(He({tab:v,selected:m})))]),_:3}),V(vt,null,{default:F(({tab:v})=>[me(g.$slots,"tab-panel",Ye(He({tab:v})))]),_:3})])]),_:3},16,["defaultIndex","selectedIndex"]))}},mt={__name:"Password",props:{modelValue:{type:[String,Number],default:""},value:{type:[String,Number],default:""}},setup(a){const r=a,o=M(!1),g=B(()=>{let C=r.modelValue||r.value;return!(C!=null&&C.includes("*"))});return(C,v)=>{const m=U("FeatherIcon"),b=U("Button");return p(),x(d(he),Se({type:o.value?"text":"password",value:a.modelValue||a.value},C.$attrs),{suffix:F(()=>[tt(V(b,{class:"!h-4",onClick:v[0]||(v[0]=h=>o.value=!o.value)},{default:F(()=>[V(m,{name:o.value?"eye-off":"eye",class:"h-3"},null,8,["name"])]),_:1},512),[[lt,g.value]])]),_:1},16,["type","value"])}}},le={__name:"FormattedInput",props:{value:{type:[String,Number],default:""},formattedValue:{type:[String,Number],default:""}},setup(a){const r=a,o=Ft(),g=M(!1),C=M(null);function v(){g.value=!0,ue(()=>{var h;C.value&&((h=C.value.el)==null||h.select())})}const m=B(()=>g.value?r.value:r.formattedValue||r.value),b=B(()=>[{sm:"text-xs",md:"text-base"}[o.size||"sm"],"text-ink-gray-5"]);return(h,D)=>(p(),T(H,null,[V(d(Rt),Se({ref_key:"inputRef",ref:C,value:m.value,onFocus:v,onBlur:D[0]||(D[0]=y=>g.value=!1)},h.$attrs),null,16,["value"]),me(h.$slots,"description",{},()=>[d(o).description?(p(),T("p",{key:0,class:q(["mt-1.5",b.value])},N(d(o).description),3)):L("",!0)])],64))}},Xt={class:"group flex flex-wrap gap-1 min-h-20 p-1.5 rounded text-base bg-surface-gray-2 hover:bg-surface-gray-3 focus:border-outline-gray-4 focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full"},Zt={class:"w-full"},el=["onClick"],tl={__name:"TableMultiselectInput",props:ee({doctype:{type:String,required:!0},errorMessage:{type:Function,default:a=>`${a} is an Invalid value`}},{modelValue:{type:Array,default:()=>[]},modelModifiers:{}}),emits:ee(["change"],["update:modelValue"]),setup(a,{emit:r}){const o=a,g=r,{getFields:C}=ae(o.doctype),v=te(a,"modelValue"),m=M([]),b=M(null),h=M(""),D=M(""),y=B(()=>D.value?{name:["not in",i.value]}:[]),i=B(()=>(b.value="",e(),D.value?v.value.map(s=>s[D.value.fieldname]):[])),e=()=>{if(b.value="",!D.value){let s=C();D.value=s==null?void 0:s.find(t=>["Link","User"].includes(t.fieldtype)),D.value||(b.value="Table MultiSelect requires a Table with atleast one Link field")}return D.value},c=s=>{if(b.value=null,v.value.some(t=>t[D.value.fieldname]===s)){b.value="Value already exists";return}s&&(v.value.push({[D.value.fieldname]:s}),g("change",v.value),!b.value&&(h.value=""))},u=s=>{let t=v.value.filter(l=>l[D.value.fieldname]!==s);g("change",t)},n=()=>{var t;if(h.value)return;let s=(t=m.value[m.value.length-1])==null?void 0:t.$el;document.activeElement===s?(v.value.pop(),g("change",v.value),ue(()=>{v.value.length&&(s=m.value[m.value.length-1].$el,s==null||s.focus())})):s==null||s.focus()};return(s,t)=>{const l=U("FeatherIcon"),k=U("Button"),R=U("ErrorMessage");return p(),T("div",null,[$("div",Xt,[(p(!0),T(H,null,Z(i.value,f=>(p(),x(k,{ref_for:!0,ref_key:"valuesRef",ref:m,key:f,label:f,theme:"gray",variant:"subtle",class:"rounded bg-surface-white hover:!bg-surface-gray-1 focus-visible:ring-outline-gray-4",onKeydownCapture:Be(X(n,["stop"]),["delete"])},{suffix:F(()=>[V(l,{class:"h-3.5",name:"x",onClick:X(E=>u(f),["stop"])},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),$("div",Zt,[D.value?(p(),x(Ce,{key:0,class:"form-control flex-1 truncate cursor-text",value:h.value,filters:y.value,doctype:D.value.options,onChange:t[0]||(t[0]=f=>c(f)),hideMe:!0},{target:F(({togglePopover:f})=>[$("button",{class:"w-full h-7 cursor-text",onClick:X(f,["stop"])},null,8,el)]),_:1},8,["value","filters","doctype"])):L("",!0)])]),b.value?(p(),x(R,{key:0,class:"mt-2 pl-2",message:b.value},null,8,["message"])):L("",!0)])}}},ll={class:"flex items-center gap-2 text-2xl font-semibold leading-6 text-ink-gray-9"},al={class:"mt-4"},nl={class:"text-base text-ink-gray-8 mb-2"},sl={class:"px-1 py-0.5 bg-surface-gray-2 border border-outline-gray-modals rounded text-base text-ink-gray-8 flex items-center justify-between gap-2"},ol={class:"flex items-center gap-2"},rl={class:"flex items-center gap-2"},il={class:"flex flex-col gap-1 text-ink-gray-9"},ul={class:"text-ink-gray-4 text-sm"},dl={class:"flex flex-col gap-2"},cl={__name:"GridFieldsEditorModal",props:ee({doctype:String,parentDoctype:String},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const r=a,{getFields:o,getGridViewSettings:g,saveUserSettings:C}=ae(r.doctype),v=te(a,"modelValue"),m=M(!1),b=M(null),h=B(()=>JSON.stringify(y.value)!==JSON.stringify(D.value)),D=B(()=>{let t=o(),l=g(r.parentDoctype);return l.length?l.map(k=>{let R=t.find(f=>f.fieldname===k.fieldname);if(R)return R.columns=k.columns,s(R)}):t==null?void 0:t.filter(k=>k.in_list_view).map(k=>s(k))}),y=M(JSON.parse(JSON.stringify(D.value||[]))),i=B(()=>{var t;return(t=o())==null?void 0:t.filter(l=>!y.value.find(k=>k.fieldname===l.fieldname)&&!["Tab Break","Section Break","Column Break","Table"].includes(l.fieldtype))});function e(){y.value=JSON.parse(JSON.stringify(D.value||[]))}function c(t){y.value.push(s(t))}function u(t){const l=y.value.findIndex(k=>k.fieldname===t.fieldname);y.value.splice(l,1)}function n(){m.value=!0;let t=y.value.map(l=>({fieldname:l.fieldname,columns:l.columns}));if(t.length===0){b.value=__("At least one field is required");return}C(r.parentDoctype,"GridView",t,()=>{m.value=!1,v.value=!1})}function s(t){return{label:t.label,fieldname:t.fieldname,fieldtype:t.fieldtype,options:t.options,in_list_view:t.in_list_view,columns:t.columns||2}}return(t,l)=>{const k=U("Badge"),R=U("TextInput"),f=U("Button"),E=U("FeatherIcon");return p(),x(d(Ne),{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=J=>v.value=J)},{"body-title":F(()=>[$("h3",ll,[$("div",null,N(t.__("Edit Grid Fields Layout")),1),h.value?(p(),x(k,{key:0,label:t.__("Not Saved"),variant:"subtle",theme:"orange"},null,8,["label"])):L("",!0)])]),"body-content":F(()=>{var J,ne;return[$("div",al,[$("div",nl,N(t.__("Fields Order")),1),(J=D.value)!=null&&J.length?(p(),x(d(ve),{key:0,list:y.value,group:"fields","item-key":"fieldname",class:"flex flex-col gap-1"},{item:F(({element:A})=>[$("div",sl,[$("div",ol,[V(it,{class:"h-3.5 cursor-grab"}),$("div",null,N(A.label),1)]),$("div",rl,[V(R,{variant:"outline",type:"number",modelValue:A.columns,"onUpdate:modelValue":ge=>A.columns=ge,class:"w-20"},null,8,["modelValue","onUpdate:modelValue"]),V(f,{variant:"ghost",icon:"x",onClick:ge=>u(A)},null,8,["onClick"])])])]),_:1},8,["list"])):L("",!0),(ne=i.value)!=null&&ne.length?(p(),x(dt,{key:1,value:"",options:i.value,onChange:l[0]||(l[0]=A=>c(A))},{target:F(({togglePopover:A})=>[V(f,{class:"w-full mt-2",onClick:ge=>A(),label:t.__("Add Field")},{prefix:F(()=>[V(E,{name:"plus",class:"h-4"})]),_:2},1032,["onClick","label"])]),"item-label":F(({option:A})=>[$("div",il,[$("div",null,N(A.label),1),$("div",ul,N(`${A.fieldname} - ${A.fieldtype}`),1)])]),_:1},8,["options"])):L("",!0),b.value?(p(),x(d(It),{key:2,class:"mt-3",message:b.value},null,8,["message"])):L("",!0)])]}),actions:F(()=>[$("div",dl,[h.value?(p(),x(f,{key:0,class:"w-full",label:t.__("Reset"),onClick:e},null,8,["label"])):L("",!0),V(f,{class:"w-full",label:t.__("Save"),variant:"solid",onClick:n,loading:m.value,disabled:!h.value},null,8,["label","loading","disabled"])])]),_:1},8,["modelValue"])}}},pl={class:"flex flex-col gap-5.5"},fl={class:"flex items-center gap-2 text-base bg-surface-gray-2 rounded py-2 px-2.5"},vl=["onClick"],ml=["onDblclick"],yl={key:0,class:"flex items-center gap-2"},gl={key:1,class:"flex gap-1 items-center"},bl={class:"section flex flex-col gap-1.5 p-2.5 bg-surface-gray-2 rounded cursor-grab"},_l={class:"flex items-center justify-between"},hl=["onDblclick"],xl={key:1,class:"flex gap-2 items-center"},kl={class:"flex flex-col gap-1.5 flex-1 p-2 border border-dashed border-outline-gray-2 rounded bg-surface-modal cursor-grab"},Cl={class:"field px-2.5 py-2 border border-outline-gray-2 rounded text-base bg-surface-modal text-ink-gray-8 flex items-center leading-4 justify-between gap-2"},wl={class:"flex items-center gap-2 truncate"},$l={class:"truncate"},Sl={class:"gap-2 w-full"},Vl={class:"flex flex-col gap-1 text-ink-gray-9"},Dl={class:"text-ink-gray-4 text-sm"},Fl={class:"mt-5.5"},yt={__name:"FieldLayoutEditor",props:{tabs:Object,doctype:String,onlyRequired:{type:Boolean,default:!1}},setup(a){const r=a,o=M(0),g=B(()=>r.tabs.length==1&&!r.tabs[0].label?"prefix":"default"),C=["Geolocation","Attach","Attach Image","HTML","Signature"],v=B(()=>({doctype:r.doctype,restricted_fieldtypes:C,as_array:!0,only_required:r.onlyRequired})),m=Me({url:"crm.api.doc.get_fields_meta",params:v.value,cache:["fieldsMeta",r.doctype],auto:!0,transform:i=>{var u;let e=["name","owner","creation","modified","modified_by","docstatus","_comments","_user_tags","_assign","_liked_by"],c=[];return(u=r.tabs)==null||u.forEach(n=>{var s;(s=n.sections)==null||s.forEach(t=>{var l;(l=t.columns)==null||l.forEach(k=>{c=c.concat(k.fields)})})}),i.filter(n=>!c.find(s=>s.fieldname===n.fieldname)&&!e.includes(n.fieldname))}});function b(){if(r.tabs.length==1&&!r.tabs[0].label){r.tabs[0].label=__("New Tab");return}r.tabs.push({label:__("New Tab"),name:"tab_"+xe(),sections:[]}),o.value=r.tabs.length?r.tabs.length-1:0}function h(i,e){e&&i.fields.push(e)}function D(i){return[{label:__("Edit"),icon:"edit",onClick:()=>i.editingLabel=!0},{label:__("Remove tab"),icon:"trash-2",onClick:()=>{if(r.tabs.length==1){r.tabs[0].label="";return}r.tabs.splice(o.value,1),o.value=o.value?o.value-1:0}}]}function y(i,e,c){let u=e.columns[e.columns.length-1];return[{group:__("Section"),items:[{label:__("Edit"),icon:"edit",onClick:()=>e.editingLabel=!0},{label:e.collapsible?__("Uncollapsible"):__("Collapsible"),icon:e.collapsible?"chevron-up":"chevron-down",onClick:()=>e.collapsible=!e.collapsible},{label:e.hideLabel?__("Show label"):__("Hide label"),icon:e.hideLabel?"eye":"eye-off",onClick:()=>e.hideLabel=!e.hideLabel},{label:e.hideBorder?__("Show border"):__("Hide border"),icon:"minus",onClick:()=>e.hideBorder=!e.hideBorder},{label:__("Remove section"),icon:"trash-2",onClick:()=>{c.sections.splice(c.sections.indexOf(e),1)},condition:()=>e.editable!==!1},{label:__("Remove and move columns to {0} section",[i==0?__("next"):__("previous")]),icon:"trash-2",onClick:()=>{let n=c.sections[i==0?i+1:i-1];i==0?n.columns=e.columns.concat(n.columns):n.columns=n.columns.concat(e.columns),c.sections.splice(c.sections.indexOf(e),1)},condition:()=>e.editable!==!1&&e.columns.length},{label:__("Move to previous tab"),icon:"corner-up-left",onClick:()=>{r.tabs[o.value-1].sections.push(e),r.tabs[o.value].sections.splice(r.tabs[o.value].sections.indexOf(e),1),o.value-=1},condition:()=>r.tabs[o.value-1]},{label:__("Move to next tab"),icon:"corner-up-right",onClick:()=>{r.tabs[o.value+1].sections.push(e),r.tabs[o.value].sections.splice(r.tabs[o.value].sections.indexOf(e),1),o.value+=1},condition:()=>r.tabs[o.value+1]}]},{group:__("Column"),items:[{label:__("Add column"),icon:"columns",onClick:()=>{e.columns.push({label:"",name:"column_"+xe(),fields:[]})},condition:()=>e.columns.length<4},{label:__("Remove column"),icon:"trash-2",onClick:()=>e.columns.pop(),condition:()=>e.columns.length>1},{label:__("Remove and move fields to previous column"),icon:"trash-2",onClick:()=>{let n=e.columns[e.columns.length-2];n.fields=n.fields.concat(u.fields),e.columns.pop()},condition:()=>e.columns.length>1&&u.fields.length},{label:__("Move to next section"),icon:"corner-up-right",onClick:()=>{c.sections[i+1].columns.push(u),e.columns.pop()},condition:()=>c.sections[i+1]},{label:__("Move to previous section"),icon:"corner-up-left",onClick:()=>{c.sections[i-1].columns.push(u),e.columns.pop()},condition:()=>c.sections[i-1]}]}]}return we(()=>r.doctype,()=>m.fetch(v.value),{immediate:!0}),(i,e)=>{const c=U("Input"),u=U("Button"),n=U("FeatherIcon");return p(),T("div",pl,[$("div",fl,[a.tabs.length&&a.tabs[o.value].label?(p(),x(d(ve),{key:0,list:a.tabs,"item-key":"name",class:"flex items-center gap-2",onEnd:e[2]||(e[2]=s=>o.value=s.newIndex)},{item:F(({element:s,index:t})=>[$("div",{class:q(["flex items-center gap-2 cursor-pointer rounded",[o.value==t?"text-ink-gray-9 bg-surface-white shadow-sm":"text-ink-gray-5 hover:text-ink-gray-9 hover:bg-surface-white hover:shadow-sm",s.editingLabel?"p-1":"px-2 py-1"]]),onClick:l=>o.value=t},[$("div",{onDblclick:()=>s.editingLabel=!0},[s.editingLabel?(p(),T("div",gl,[V(c,{modelValue:s.label,"onUpdate:modelValue":l=>s.label=l,onKeydown:Be(l=>s.editingLabel=!1,["enter"]),onBlur:l=>s.editingLabel=!1,onClick:e[0]||(e[0]=X(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","onKeydown","onBlur"]),s.editingLabel?(p(),x(u,{key:0,icon:"check",variant:"ghost",onClick:l=>s.editingLabel=!1},null,8,["onClick"])):L("",!0)])):(p(),T("div",yl,N(i.__(s.label)||i.__("Untitled")),1))],40,ml),s.label&&o.value==t?(p(),x(d(We),{key:0,options:D(s),class:"!h-4",onClick:e[1]||(e[1]=X(()=>{},["stop"]))},{default:F(()=>[V(u,{variant:"ghost",class:"!p-1 !h-4"},{default:F(()=>[V(n,{name:"more-horizontal",class:"h-4"})]),_:1})]),_:2},1032,["options"])):L("",!0)],10,vl)]),_:1},8,["list"])):L("",!0),V(u,{variant:"ghost",class:"!h-6.5 !text-ink-gray-5 hover:!text-ink-gray-9",onClick:b,label:i.__("Add Tab")},{[g.value]:F(()=>[V(n,{name:"plus",class:"h-4"})]),_:2},1032,["label"])]),(p(!0),T(H,null,Z(a.tabs,(s,t)=>tt((p(),T("div",{key:s.name},[V(d(ve),{list:s.sections,"item-key":"name",class:"flex flex-col gap-5.5"},{item:F(({element:l,index:k})=>[$("div",bl,[$("div",_l,[$("div",{class:"flex h-7 max-w-fit cursor-pointer items-center gap-2 text-base font-medium leading-4 text-ink-gray-9",onDblclick:()=>l.editingLabel=!0},[l.editingLabel?(p(),T("div",xl,[V(c,{modelValue:l.label,"onUpdate:modelValue":R=>l.label=R,onKeydown:Be(R=>l.editingLabel=!1,["enter"]),onBlur:R=>l.editingLabel=!1,onClick:e[3]||(e[3]=X(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","onKeydown","onBlur"]),l.editingLabel?(p(),x(u,{key:0,icon:"check",variant:"ghost",onClick:R=>l.editingLabel=!1},null,8,["onClick"])):L("",!0)])):(p(),T("div",{key:0,class:q(["flex items-center gap-2",{"text-ink-gray-3":l.hideLabel||!l.label,italic:!l.label}])},[ke(N(i.__(l.label)||i.__("No label"))+" ",1),l.collapsible?(p(),x(n,{key:0,name:"chevron-down",class:"h-4 transition-all duration-300 ease-in-out"})):L("",!0)],2))],40,hl),V(d(We),{options:y(k,l,s)},{default:F(()=>[V(u,{variant:"ghost"},{default:F(()=>[V(n,{name:"more-horizontal",class:"h-4"})]),_:1})]),_:2},1032,["options"])]),V(d(ve),{class:"flex gap-2",list:l.columns,group:"columns","item-key":"name"},{item:F(({element:R})=>[$("div",kl,[V(d(ve),{list:R.fields,group:"fields","item-key":"fieldname",class:"flex flex-col gap-1.5",handle:".cursor-grab"},{item:F(({element:f})=>[$("div",Cl,[$("div",wl,[V(it,{class:"h-3.5 cursor-grab"}),$("div",$l,N(f.label),1)]),V(u,{variant:"ghost",class:"!size-4 rounded-sm",icon:"x",onClick:E=>R.fields.splice(R.fields.indexOf(f),1)},null,8,["onClick"])])]),_:2},1032,["list"]),d(m).data?(p(),x(dt,{key:0,value:"",options:d(m).data,onChange:f=>h(R,f)},{target:F(({togglePopover:f})=>[$("div",Sl,[V(u,{class:"w-full !h-8 !bg-surface-modal",variant:"outline",onClick:E=>f(),label:i.__("Add Field")},{prefix:F(()=>[V(n,{name:"plus",class:"h-4"})]),_:2},1032,["onClick","label"])])]),"item-label":F(({option:f})=>[$("div",Vl,[$("div",null,N(f.label),1),$("div",Dl,N(`${f.fieldname} - ${f.fieldtype}`),1)])]),_:2},1032,["options","onChange"])):L("",!0)])]),_:2},1032,["list"])])]),_:2},1032,["list"]),$("div",Fl,[V(u,{class:"w-full h-8",variant:"subtle",label:i.__("Add Section"),onClick:e[4]||(e[4]=l=>a.tabs[o.value].sections.push({label:i.__("New Section"),name:"section_"+d(xe)(),opened:!0,columns:[{name:"column_"+d(xe)(),fields:[]}]}))},{prefix:F(()=>[V(n,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])),[[lt,o.value==t]])),128))])}}},Rl={class:"flex items-center gap-2 text-2xl font-semibold leading-6 text-ink-gray-9"},Il={class:"flex flex-col gap-3"},Ol={class:"flex justify-between gap-2"},Tl={class:"flex flex-row-reverse gap-2"},Ml={key:0},Ll={__name:"GridRowFieldsModal",props:ee({doctype:{type:String,default:"CRM Lead"},parentDoctype:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:ee(["reload"],["update:modelValue"]),setup(a,{emit:r}){const o=a,g=r,C=te(a,"modelValue"),v=M(o.doctype),m=M(!1),b=M(!1),h=M(!1);function D(){return{doctype:v.value,type:"Grid Row",parent_doctype:o.parentDoctype}}const y=Me({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["GridRowFieldsModal",v.value,o.parentDoctype],params:D(),onSuccess(c){y.originalData=JSON.parse(JSON.stringify(c))}});we(()=>y==null?void 0:y.data,()=>{b.value=JSON.stringify(y==null?void 0:y.data)!==JSON.stringify(y==null?void 0:y.originalData)},{deep:!0}),ie(()=>at(i,100)());function i(){ue(()=>{y.params=D(),y.reload()})}function e(){let c=JSON.parse(JSON.stringify(y.data));c.forEach(u=>{u.sections&&u.sections.forEach(n=>{n.columns.forEach(s=>{s.fields&&(s.fields=s.fields.map(t=>t.fieldname))})})}),m.value=!0,Ee("crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.save_fields_layout",{doctype:v.value,type:"Grid Row",layout:JSON.stringify(c)}).then(()=>{m.value=!1,C.value=!1,st("data_fields_layout_builder",{doctype:v.value}),g("reload")})}return(c,u)=>{const n=U("Button");return p(),x(d(Ne),{modelValue:C.value,"onUpdate:modelValue":u[1]||(u[1]=s=>C.value=s),options:{size:"4xl"}},{"body-title":F(()=>[$("h3",Rl,[$("div",null,N(c.__("Edit Grid Row Fields Layout")),1),b.value?(p(),x(d(nt),{key:0,label:c.__("Not Saved"),variant:"subtle",theme:"orange"},null,8,["label"])):L("",!0)])]),"body-content":F(()=>{var s;return[$("div",Il,[$("div",Ol,[V(n,{label:h.value?c.__("Hide preview"):c.__("Show preview"),onClick:u[0]||(u[0]=t=>h.value=!h.value)},null,8,["label"]),$("div",Tl,[V(n,{loading:m.value,label:c.__("Save"),variant:"solid",onClick:e},null,8,["loading","label"]),V(n,{label:c.__("Reset"),onClick:i},null,8,["label"])])]),(s=d(y))!=null&&s.data?(p(),T("div",Ml,[h.value?(p(),x(qe,{key:1,tabs:d(y).data,data:{},preview:!0},null,8,["tabs"])):(p(),x(yt,{key:0,tabs:d(y).data,doctype:v.value},null,8,["tabs","doctype"]))])):L("",!0)])]}),_:1},8,["modelValue"])}}},Bl={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Pl={class:"mb-5 flex items-center justify-between"},Nl={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},El={class:"flex items-center gap-1"},Ul={__name:"GridRowModal",props:ee({index:Number,data:Object,doctype:String,parentDoctype:String},{modelValue:{},modelModifiers:{},showGridRowFieldsModal:{},showGridRowFieldsModalModifiers:{}}),emits:["update:modelValue","update:showGridRowFieldsModal"],setup(a){const r=a,{isManager:o}=Ge(),g=te(a,"modelValue"),C=te(a,"showGridRowFieldsModal"),v=Me({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["Grid Row",r.doctype,r.parentDoctype],params:{doctype:r.doctype,type:"Grid Row",parent_doctype:r.parentDoctype},auto:!0});function m(){C.value=!0,ue(()=>g.value=!1)}return(b,h)=>{const D=U("Button"),y=U("FeatherIcon"),i=U("Dialog");return p(),x(i,{modelValue:g.value,"onUpdate:modelValue":h[1]||(h[1]=e=>g.value=e),options:{size:"4xl"}},{body:F(()=>[$("div",Bl,[$("div",Pl,[$("div",null,[$("h3",Nl,N(b.__("Editing Row {0}",[a.index+1])),1)]),$("div",El,[d(o)()?(p(),x(D,{key:0,variant:"ghost",class:"w-7",onClick:m},{default:F(()=>[V(Ae,{class:"h-4 w-4"})]),_:1})):L("",!0),V(D,{variant:"ghost",class:"w-7",onClick:h[0]||(h[0]=e=>g.value=!1)},{default:F(()=>[V(y,{name:"x",class:"h-4 w-4"})]),_:1})])]),$("div",null,[d(v).data?(p(),x(qe,{key:0,tabs:d(v).data,data:a.data,doctype:a.doctype,isGridRow:!0},null,8,["tabs","data","doctype"])):L("",!0)])])]),_:1},8,["modelValue"])}}},Al=M(!1),Gl=M(""),jl=M({}),ql=M(null);function gt(a,r,o,g){a&&(o==null||o(),Gl.value=a,jl.value=r||{},ql.value=g||null,Al.value=!0)}const zl={class:"flex flex-col flex-1 text-base"},Jl={key:0,class:"mb-1.5 text-sm text-ink-gray-5"},Yl={key:1,class:"rounded border border-outline-gray-modals"},Hl={class:"grid-header flex items-center rounded-t-[7px] bg-surface-gray-2 text-ink-gray-5 truncate"},Kl={class:"inline-flex items-center justify-center border-r border-outline-gray-2 h-8 p-2 w-12"},Ql={class:"inline-flex items-center justify-center border-r border-outline-gray-2 py-2 px-1 w-12"},Wl=["title"],Xl={key:0,class:"text-ink-red-2"},Zl={class:"w-12"},ea=["onClick"],ta={class:"grid-row-checkbox inline-flex h-9.5 items-center bg-surface-white justify-center border-r border-outline-gray-modals p-2 w-12"},la={class:"flex h-9.5 items-center justify-center bg-surface-white border-r border-outline-gray-modals py-2 px-1 text-sm text-ink-gray-8 w-12"},aa={class:"cursor-pointer"},na={key:3,class:"flex h-full bg-surface-white justify-center items-center"},sa={class:"edit-row w-12"},oa={key:1,class:"flex flex-col items-center rounded p-5 text-sm text-ink-gray-5"},ra={key:2,class:"mt-2 flex flex-row gap-2"},ia={__name:"Grid",props:ee({label:{type:String,default:""},doctype:{type:String,required:!0},parentDoctype:{type:String,required:!0},parentFieldname:{type:String,required:!0}},{modelValue:{},modelModifiers:{},parent:{},parentModifiers:{}}),emits:["update:modelValue","update:parent"],setup(a){var ze;const r=a,o=j("triggerOnChange"),g=j("triggerOnRowAdd"),C=j("triggerOnRowRemove"),{getGridViewSettings:v,getFields:m,getFloatWithPrecision:b,getCurrencyWithPrecision:h,getFormattedCurrency:D,getGridSettings:y}=ae(r.doctype);ae(r.parentDoctype);const{getUser:i}=Ge(),e=te(a,"modelValue"),c=te(a,"parent");Y("parentDoc",c);const u=M(new Array(((ze=e.value)==null?void 0:ze.length)||[]).fill(!1)),n=ot(new Set),s=M(!1),t=M(!1),l=B(()=>y()),k=B(()=>{let w=v(r.parentDoctype),I=m();return w.length?w.map(de=>f(I.find(ce=>ce.fieldname===de.fieldname))):(I==null?void 0:I.filter(P=>P.in_list_view).map(P=>f(P)))||[]}),R=B(()=>{var w;return((w=m())==null?void 0:w.map(I=>f(I)))||[]});function f(w){return w.fieldtype==="Link"&&w.options!=="User"&&(w.create||(w.create=(I,P,de,ce)=>{const De=S=>{S&&z(S.name,P,de)};gt(P.options,I,ce,De)})),{...w,filters:w.link_filters&&JSON.parse(w.link_filters),placeholder:w.placeholder||w.label}}const E=B(()=>{var I;if(!((I=k.value)!=null&&I.length))return"1fr";let w=v(r.parentDoctype);return w.length?w.map(P=>`minmax(0, ${P.columns||2}fr)`).join(" "):k.value.map(()=>"minmax(0, 2fr)").join(" ")}),J=B(()=>{var w;return(w=e.value)!=null&&w.length?e.value.length===n.size:!1}),ne=B(()=>n.size>0),A=w=>{var I;w?(I=e.value)==null||I.forEach(P=>n.add(P.name)):n.clear()},ge=w=>{n.has(w.name)?n.delete(w.name):n.add(w.name)},bt=()=>{var I;const w={};(I=R.value)==null||I.forEach(P=>{P.fieldtype==="Check"?w[P.fieldname]=!1:w[P.fieldname]="",P.default&&(w[P.fieldname]=ht(P.default,P.fieldtype))}),w.name=xe(10),u.value.push(!1),w.__islocal=!0,w.idx=e.value.length+1,w.doctype=r.doctype,w.parentfield=r.parentFieldname,w.parenttype=r.parentDoctype,e.value.push(w),g(w)},_t=()=>{e.value=e.value.filter(w=>!n.has(w.name)),C(n,e.value),u.value.pop(),n.clear()};function z(w,I,P){P[I.fieldname]=w,o(I.fieldname,P)}function ht(w,I){if(["Float","Currency","Percent"].includes(I))return re(w);if(I==="Check"){if(["1","true","True"].includes(w))return!0;if(["0","false","False"].includes(w))return!1}else{if(I==="Int")return parseInt(w);if(w==="Today"&&I==="Date")return fe().format("YYYY-MM-DD");if(["Now","now"].includes(w)&&I==="Datetime")return fe().format("YYYY-MM-DD HH:mm:ss");if(["Now","now"].includes(w)&&I==="Time")return fe().format("HH:mm:ss");if(I==="Date")return fe(w).format("YYYY-MM-DD");if(I==="Datetime")return fe(w).format("YYYY-MM-DD HH:mm:ss");if(I==="Time")return fe(w).format("HH:mm:ss")}return w}return(w,I)=>{var de,ce,De;const P=U("Button");return p(),T("div",zl,[a.label?(p(),T("div",Jl,N(w.__(a.label)),1)):L("",!0),(de=k.value)!=null&&de.length?(p(),T("div",Yl,[$("div",Hl,[$("div",Kl,[V(d(Le),{class:"cursor-pointer duration-300",modelValue:J.value,onClick:I[0]||(I[0]=X(S=>A(S.target.checked),["stop"]))},null,8,["modelValue"])]),$("div",Ql,N(w.__("No")),1),$("div",{class:"grid w-full truncate",style:Ke({gridTemplateColumns:E.value})},[(p(!0),T(H,null,Z(k.value,S=>(p(),T("div",{class:q(["border-r border-outline-gray-2 p-2 truncate",["Int","Float","Currency","Percent"].includes(S.fieldtype)?"text-right":""]),key:S.fieldname,title:S.label},[ke(N(w.__(S.label))+" ",1),S.reqd||S.mandatory_depends_on&&S.mandatory_via_depends_on?(p(),T("span",Xl,"*")):L("",!0)],10,Wl))),128))],4),$("div",Zl,[V(P,{class:"flex w-full items-center justify-center rounded !bg-surface-gray-2 border-0",variant:"outline",onClick:I[1]||(I[1]=S=>s.value=!0)},{default:F(()=>[V(d(Ot),{name:"settings",class:"h-4 w-4 text-ink-gray-7"})]),_:1})])]),(ce=e.value)!=null&&ce.length?(p(),x(d(ve),{key:0,class:"w-full",modelValue:e.value,"onUpdate:modelValue":I[3]||(I[3]=S=>e.value=S),delay:d(Et)()?200:0,group:"rows","item-key":"name"},{item:F(({element:S,index:se})=>[$("div",{class:"grid-row flex cursor-pointer items-center border-b border-outline-gray-modals bg-surface-modals last:rounded-b last:border-b-0",onClick:X(()=>{l.value.editable_grid||(u.value[se]=!0)},["stop"])},[$("div",ta,[V(d(Le),{class:"cursor-pointer duration-300",modelValue:n.has(S.name),onClick:X(_=>ge(S),["stop"])},null,8,["modelValue","onClick"])]),$("div",la,N(se+1),1),$("div",{class:"grid w-full h-9.5",style:Ke({gridTemplateColumns:E.value})},[(p(!0),T(H,null,Z(k.value,_=>(p(),T("div",{class:"border-r border-outline-gray-modals h-full",key:_.fieldname},[_.read_only&&!["Int","Float","Currency","Percent","Check"].includes(_.fieldtype)?(p(),x(d(he),{key:0,type:"text",placeholder:_.placeholder,modelValue:S[_.fieldname],"onUpdate:modelValue":O=>S[_.fieldname]=O,disabled:!0},null,8,["placeholder","modelValue","onUpdate:modelValue"])):["Link","Dynamic Link"].includes(_.fieldtype)?(p(),x(Ce,{key:1,class:"text-sm text-ink-gray-8",value:S[_.fieldname],doctype:_.fieldtype=="Link"?_.options:S[_.options],filters:_.filters,onChange:O=>z(O,_,S),onCreate:(O,xt)=>_.create(w.v,_,S,xt)},null,8,["value","doctype","filters","onChange","onCreate"])):_.fieldtype==="User"?(p(),x(Ce,{key:2,class:"form-control",value:d(i)(S[_.fieldname]).full_name,doctype:_.options,filters:_.filters,onChange:O=>z(O,_,S),placeholder:_.placeholder,hideMe:!0},{prefix:F(()=>[V(Oe,{class:"mr-2",user:S[_.fieldname],size:"sm"},null,8,["user"])]),"item-prefix":F(({option:O})=>[V(Oe,{class:"mr-2",user:O.value,size:"sm"},null,8,["user"])]),"item-label":F(({option:O})=>[V(d(rt),{text:O.value},{default:F(()=>[$("div",aa,N(d(i)(O.value).full_name),1)]),_:2},1032,["text"])]),_:2},1032,["value","doctype","filters","onChange","placeholder"])):_.fieldtype==="Check"?(p(),T("div",na,[V(d(Le),{class:"cursor-pointer duration-300",modelValue:S[_.fieldname],"onUpdate:modelValue":O=>S[_.fieldname]=O,disabled:!l.value.editable_grid,onChange:O=>z(O.target.checked,_,S)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):_.fieldtype==="Date"?(p(),x(d(ut),{key:4,value:S[_.fieldname],"icon-left":"",variant:"outline",formatter:O=>d(Te)(O,"",!0),"input-class":"border-none text-sm text-ink-gray-8",onChange:O=>z(O,_,S)},null,8,["value","formatter","onChange"])):_.fieldtype==="Datetime"?(p(),x(d(ct),{key:5,value:S[_.fieldname],"icon-left":"",variant:"outline",formatter:O=>d(Te)(O,"",!0,!0),"input-class":"border-none text-sm text-ink-gray-8",onChange:O=>z(O,_,S)},null,8,["value","formatter","onChange"])):["Small Text","Text","Long Text","Code"].includes(_.fieldtype)?(p(),x(d(he),{key:6,rows:"1",type:"textarea",variant:"outline",value:S[_.fieldname],onChange:O=>z(O.target.value,_,S)},null,8,["value","onChange"])):_.fieldtype==="Select"?(p(),x(d(he),{key:7,class:"text-sm text-ink-gray-8",type:"select",variant:"outline",modelValue:S[_.fieldname],"onUpdate:modelValue":O=>S[_.fieldname]=O,options:_.options,onChange:O=>z(O.target.value,_,S)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])):_.fieldtype==="Password"?(p(),x(mt,{key:8,variant:"outline",value:S[_.fieldname],disabled:!!_.read_only,onChange:O=>z(O.target.value,_,S)},null,8,["value","disabled","onChange"])):_.fieldtype==="Int"?(p(),x(le,{key:9,class:"[&_input]:text-right",type:"text",variant:"outline",value:S[_.fieldname]||"0",disabled:!!_.read_only,onChange:O=>z(O.target.value,_,S)},null,8,["value","disabled","onChange"])):_.fieldtype==="Percent"?(p(),x(le,{key:10,class:"[&_input]:text-right",type:"text",variant:"outline",value:d(b)(_.fieldname,S),formattedValue:(S[_.fieldname]||"0")+"%",disabled:!!_.read_only,onChange:O=>z(d(re)(O.target.value),_,S)},null,8,["value","formattedValue","disabled","onChange"])):_.fieldtype==="Float"?(p(),x(le,{key:11,class:"[&_input]:text-right",type:"text",variant:"outline",value:d(b)(_.fieldname,S),formattedValue:S[_.fieldname],disabled:!!_.read_only,onChange:O=>z(d(re)(O.target.value),_,S)},null,8,["value","formattedValue","disabled","onChange"])):_.fieldtype==="Currency"?(p(),x(le,{key:12,class:"[&_input]:text-right",type:"text",variant:"outline",value:d(h)(_.fieldname,S),formattedValue:d(D)(_.fieldname,S,c.value),disabled:!!_.read_only,onChange:O=>z(d(re)(O.target.value),_,S)},null,8,["value","formattedValue","disabled","onChange"])):(p(),x(d(he),{key:13,class:"text-sm text-ink-gray-8",type:"text",variant:"outline",modelValue:S[_.fieldname],"onUpdate:modelValue":O=>S[_.fieldname]=O,options:_.options,onChange:O=>z(O.target.value,_,S)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]))]))),128))],4),$("div",sa,[V(P,{class:"flex w-full items-center justify-center rounded border-0",variant:"outline",onClick:_=>u.value[se]=!0},{default:F(()=>[V(Ae,{class:"h-4 w-4 text-ink-gray-7"})]),_:2},1032,["onClick"])]),u.value[se]?(p(),x(Ul,{key:0,modelValue:u.value[se],"onUpdate:modelValue":_=>u.value[se]=_,showGridRowFieldsModal:t.value,"onUpdate:showGridRowFieldsModal":I[2]||(I[2]=_=>t.value=_),index:se,data:S,doctype:a.doctype,parentDoctype:a.parentDoctype},null,8,["modelValue","onUpdate:modelValue","showGridRowFieldsModal","index","data","doctype","parentDoctype"])):L("",!0)],8,ea)]),_:1},8,["modelValue","delay"])):(p(),T("div",oa,N(w.__("No Data")),1))])):L("",!0),(De=k.value)!=null&&De.length?(p(),T("div",ra,[ne.value?(p(),x(P,{key:0,label:w.__("Delete"),variant:"solid",theme:"red",onClick:_t},null,8,["label"])):L("",!0),V(P,{label:w.__("Add Row"),onClick:bt},null,8,["label"])])):L("",!0),t.value?(p(),x(Ll,{key:3,modelValue:t.value,"onUpdate:modelValue":I[4]||(I[4]=S=>t.value=S),doctype:a.doctype,parentDoctype:a.parentDoctype},null,8,["modelValue","doctype","parentDoctype"])):L("",!0),s.value?(p(),x(cl,{key:4,modelValue:s.value,"onUpdate:modelValue":I[5]||(I[5]=S=>s.value=S),doctype:a.doctype,parentDoctype:a.parentDoctype},null,8,["modelValue","doctype","parentDoctype"])):L("",!0)])}}},ua=Ue(ia,[["__scopeId","data-v-a13cad29"]]),_e=ot({});function da(a,r="Form"){const o=Tt({doctype:"CRM Form Script",cache:["Form Scripts",a,r],fields:["name","dt","view","script"],filters:{view:r,dt:a,enabled:1},onSuccess:y=>{for(let i of y)_e[a]||(_e[a]={}),_e[a][i.name]=i||{}},onError:y=>{console.error(`Error loading CRM Form Scripts for ${a} (view: ${r}):`,y)}});!_e[a]&&!o.loading&&o.fetch();async function g(y,i={}){await o.promise;let e=_e[a];if(!e||Object.keys(e).length===0)return null;const{$dialog:c,$socket:u,makeCall:n}=Ut();return i.createDialog=c,i.toast=Pe,i.socket=u,i.router=Mt,i.call=Ee,i.crm={makePhoneCall:n},C(e,y,i)}function C(y,i,e){var n;const c=[];let u=null;for(let s in y){let t=(n=y[s])==null?void 0:n.script;if(t)try{const l=b(t);if(!l)continue;l.forEach(k=>{const R=h(t,k,e);if(!R)return;let f=null,E=a.replace(/\s+/g,""),{doctypeMeta:J}=ae(a),ne=k!==E;if(ne){if(!c.length){console.error(__("⚠️ No class found for doctype: {0}, it is mandatory to have a class for the parent doctype. it can be empty, but it should be present.",[a]));return}f=c[u]}else u=c.length||0;const A=v(R,J,i,f,ne);c.push(A)})}catch(l){console.error(__("Failed to load form controller: {0}",[l]))}}return c}function v(y,i,e,c=null,u=!1){let n=new y;n._isChildDoctype=u;for(const t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);n.getMeta=async t=>(i[t]||await ae(t),i[t]);const s=()=>e.doc;return u?(n.doc=D(s,c,n),c._childInstances||(c._childInstances=[]),c._childInstances.push(n)):n.doc=D(s,n),n}function m(y){typeof y.prototype.getRow!="function"&&(y.prototype.getRow=function(i,e){var n,s;e=e||this.currentRowIdx;let c=null;if(this instanceof Array){const{getFields:t}=ae(this.doc.doctype);let k=t().find(R=>R.fieldname===i);c=(n=k==null?void 0:k.options)==null?void 0:n.replace(/\s+/g,""),!e&&c&&(e=(s=this.find(R=>R.constructor.name===c))==null?void 0:s.currentRowIdx)}if(!this.doc[i])return console.warn(__("⚠️ No data found for parent field: {0}",[i])),null;const u=this.doc[i].find(t=>t.idx===e);return u?(u.parent=u.parent||this.doc.name,this instanceof Array&&c?D(u,this.find(t=>t.constructor.name===c)):D(u,this)):(console.warn(__("⚠️ No row found for idx: {0} in parent field: {1}",[e,i])),null)})}function b(y){return[...y.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").matchAll(/class\s+([A-Za-z0-9_]+)/g)].map(e=>e[1])||[]}function h(y,i,e={}){const c=Object.keys(e),u=Object.values(e),n=`
		${y}
		return ${i};
	`,s=new Function(...c,n)(...u);return m(s),s}function D(y,i,e=null){const c=typeof y=="function",u=()=>c?y():y;return new Proxy({},{get(n,s){const t=u();if(t)return s==="trigger"?(t&&"trigger"in t&&console.warn(__('⚠️ Avoid using "trigger" as a field name — it conflicts with the built-in trigger() method.')),(l,...k)=>{const R=i[l];if(typeof R=="function")return R.apply(i,k);console.warn(__('⚠️ Method "{0}" not found in class.',[l]))}):s==="getRow"?i.getRow.bind(e||i._childInstances||i):t[s]},set(n,s,t){const l=u();return l?(l[s]=t,!0):!1},has(n,s){const t=u();return t?s in t:!1},ownKeys(n){const s=u();return s?Reflect.ownKeys(s):[]},getOwnPropertyDescriptor(n,s){const t=u();if(t)return Reflect.getOwnPropertyDescriptor(t,s)}})}return{scripts:o,setupScript:g,setupFormController:v}}const W={},oe={};function ca(a,r){const{setupScript:o}=da(a);W[a]=W[a]||{},W[a][r]||(W[a][r]=Lt({doctype:a,name:r,onSuccess:async()=>await g(),setValue:{onSuccess:()=>{Pe.success(__("Document updated successfully"))},onError:c=>{Pe.error(__("Error updating document")),console.error(c)}}}));async function g(){if(oe[a]&&typeof oe[a][r]=="object")return;oe[a]||(oe[a]={}),oe[a][r]={};const c=await o(W[a][r]);if(!c||c.length===0)return;const u={};for(const n of c){const s=n.constructor.name;u[s]||(u[s]=[]),u[s].push(n)}oe[a][r]=u}function C(c=null){var t;const n=((c==null?void 0:c.doctype)||a).replace(/\s+/g,""),s=(t=oe[a])==null?void 0:t[r];return typeof s=="object"&&s!==null&&!Array.isArray(s)?s[n]||[]:[]}async function v(){await i(async function(){await this.refresh()})}async function m(c,u){await i(async function(){var s;u?(this.currentRowIdx=u.idx,this.value=u[c],this.oldValue=e(c,u)):(this.value=W[a][r].doc[c],this.oldValue=e(c)),await((s=this[c])==null?void 0:s.call(this))},u)}async function b(c){await i(async function(){var n;this.currentRowIdx=c.idx,this.value=c,await((n=this[c.parentfield+"_add"])==null?void 0:n.call(this))},c)}async function h(c,u){await i(async function(){var s;if(c.size===1){const t=Array.from(c)[0];this.currentRowIdx=u.find(l=>l.name===t).idx}else delete this.currentRowIdx;this.selectedRows=Array.from(c),this.rows=u,await((s=this[u[0].parentfield+"_remove"])==null?void 0:s.call(this))},u[0])}async function D(){const c=Array.from(arguments);await i(async function(){var n;await((n=this.on_create_lead)==null?void 0:n.call(this,...c))})}async function y(){const c=Array.from(arguments);await i(async function(){var n;await((n=this.convert_to_deal)==null?void 0:n.call(this,...c))})}async function i(c,u=null){const n=C(u);if(!n.length)return;const s=n.map(t=>async()=>await c.call(t));await At(s)}function e(c,u){var t,l;if(!W[a][r])return"";const n=W[a][r],s=n.originalDoc;return u!=null&&u.name?(l=(t=s==null?void 0:s[u.parentfield])==null?void 0:t.find(k=>k.name===u.name))==null?void 0:l[c]:(s==null?void 0:s[c])||n.doc[c]}return{document:W[a][r],triggerOnChange:m,triggerOnRowAdd:b,triggerOnRowRemove:h,triggerOnRefresh:v,setupFormScript:g,triggerOnCreateLead:D,triggerConvertToDeal:y}}const pa={key:0,class:"field"},fa={key:0,class:"mb-2 text-sm text-ink-gray-5"},va={key:0,class:"text-ink-red-2"},ma={key:4,class:"flex items-center gap-2"},ya={key:0,class:"text-ink-red-3"},ga={key:5,class:"flex gap-1"},ba={class:"cursor-pointer"},_a={__name:"Field",props:{field:Object},setup(a){const r=a,o=j("data"),g=j("doctype"),C=j("preview"),v=j("isGridRow"),{getFormattedPercent:m,getFormattedFloat:b,getFormattedCurrency:h}=ae(g),{getUser:D}=Ge();let y,i;if(v)y=j("triggerOnChange"),i=j("parentDoc");else{const{triggerOnChange:t,triggerOnRowAdd:l,triggerOnRowRemove:k}=ca(g,o.value.name);y=t,Y("triggerOnChange",y),Y("triggerOnRowAdd",l),Y("triggerOnRowRemove",k)}const e=B(()=>{let t=r.field;t.fieldtype=="Select"&&typeof t.options=="string"&&(t.options=t.options.split(`
`).map(k=>({label:k,value:k})),t.options[0].value!==""&&t.options.unshift({label:"",value:""})),t.fieldtype==="Link"&&t.options==="User"&&(t.fieldtype="User"),t.fieldtype==="Link"&&t.options!=="User"&&(t.create||(t.create=(k,R)=>{const f=E=>{E&&n(E.name,t)};gt(t.options,k,R,f)}));let l={...t,filters:t.link_filters&&JSON.parse(t.link_filters),placeholder:t.placeholder||t.label,display_via_depends_on:Qe(t.depends_on,o.value),mandatory_via_depends_on:Qe(t.mandatory_depends_on,o.value)};return l.visible=c(l),l});function c(t){return C.value?!0:(t.fieldtype=="Check"||t.read_only&&o.value[t.fieldname]||!t.read_only)&&(!t.depends_on||t.display_via_depends_on)&&!t.hidden}const u=t=>t.placeholder?__(t.placeholder):["Select","Link"].includes(t.fieldtype)?__("Select {0}",[__(t.label)]):__("Enter {0}",[__(t.label)]);function n(t,l){o.value[l.fieldname]=t,v?y(l.fieldname,o.value):y(l.fieldname)}function s(t,l){return l.fieldtype==="Duration"?t||0:t}return(t,l)=>{const k=U("FormControl"),R=U("Button");return e.value.visible?(p(),T("div",pa,[e.value.fieldtype!="Check"?(p(),T("div",fa,[ke(N(t.__(e.value.label))+" ",1),e.value.reqd||e.value.mandatory_depends_on&&e.value.mandatory_via_depends_on?(p(),T("span",va,"*")):L("",!0)])):L("",!0),e.value.read_only&&!["Int","Float","Currency","Percent","Check"].includes(e.value.fieldtype)?(p(),x(k,{key:1,type:"text",placeholder:u(e.value),modelValue:d(o)[e.value.fieldname],"onUpdate:modelValue":l[0]||(l[0]=f=>d(o)[e.value.fieldname]=f),disabled:!0,description:e.value.description},null,8,["placeholder","modelValue","description"])):e.value.fieldtype==="Table"?(p(),x(ua,{key:2,modelValue:d(o)[e.value.fieldname],"onUpdate:modelValue":l[1]||(l[1]=f=>d(o)[e.value.fieldname]=f),parent:d(o),"onUpdate:parent":l[2]||(l[2]=f=>Bt(o)?o.value=f:null),doctype:e.value.options,parentDoctype:d(g),parentFieldname:e.value.fieldname},null,8,["modelValue","parent","doctype","parentDoctype","parentFieldname"])):e.value.fieldtype==="Select"?(p(),x(k,{key:3,type:"select",class:q(["form-control",e.value.prefix?"prefix":""]),options:e.value.options,modelValue:d(o)[e.value.fieldname],"onUpdate:modelValue":l[3]||(l[3]=f=>d(o)[e.value.fieldname]=f),onChange:l[4]||(l[4]=f=>n(f.target.value,e.value)),placeholder:u(e.value),description:e.value.description},Pt({_:2},[e.value.prefix?{name:"prefix",fn:F(()=>[V(Nt,{class:q(e.value.prefix)},null,8,["class"])]),key:"0"}:void 0]),1032,["class","options","modelValue","placeholder","description"])):e.value.fieldtype=="Check"?(p(),T("div",ma,[V(k,{class:"form-control",type:"checkbox",modelValue:d(o)[e.value.fieldname],"onUpdate:modelValue":l[5]||(l[5]=f=>d(o)[e.value.fieldname]=f),onChange:l[6]||(l[6]=f=>n(f.target.checked,e.value)),disabled:!!e.value.read_only,description:e.value.description},null,8,["modelValue","disabled","description"]),$("label",{class:"text-sm text-ink-gray-5",onClick:l[7]||(l[7]=()=>{e.value.read_only||(d(o)[e.value.fieldname]=!d(o)[e.value.fieldname])})},[ke(N(t.__(e.value.label))+" ",1),e.value.mandatory?(p(),T("span",ya,"*")):L("",!0)])])):["Link","Dynamic Link"].includes(e.value.fieldtype)?(p(),T("div",ga,[V(Ce,{class:"form-control flex-1 truncate",value:d(o)[e.value.fieldname],doctype:e.value.fieldtype=="Link"?e.value.options:d(o)[e.value.options],filters:e.value.filters,onChange:l[8]||(l[8]=f=>n(f,e.value)),placeholder:u(e.value),onCreate:e.value.create},null,8,["value","doctype","filters","placeholder","onCreate"]),d(o)[e.value.fieldname]&&e.value.edit?(p(),x(R,{key:0,class:"shrink-0",label:t.__("Edit"),onClick:l[9]||(l[9]=f=>e.value.edit(d(o)[e.value.fieldname]))},{prefix:F(()=>[V(Ae,{class:"h-4 w-4"})]),_:1},8,["label"])):L("",!0)])):e.value.fieldtype==="Table MultiSelect"?(p(),x(tl,{key:6,modelValue:d(o)[e.value.fieldname],"onUpdate:modelValue":l[10]||(l[10]=f=>d(o)[e.value.fieldname]=f),doctype:e.value.options,onChange:l[11]||(l[11]=f=>n(f,e.value))},null,8,["modelValue","doctype"])):e.value.fieldtype==="User"?(p(),x(Ce,{key:7,class:"form-control",value:d(o)[e.value.fieldname]&&d(D)(d(o)[e.value.fieldname]).full_name,doctype:e.value.options,filters:e.value.filters,onChange:l[12]||(l[12]=f=>n(f,e.value)),placeholder:u(e.value),hideMe:!0},{prefix:F(()=>[d(o)[e.value.fieldname]?(p(),x(Oe,{key:0,class:"mr-2",user:d(o)[e.value.fieldname],size:"sm"},null,8,["user"])):L("",!0)]),"item-prefix":F(({option:f})=>[V(Oe,{class:"mr-2",user:f.value,size:"sm"},null,8,["user"])]),"item-label":F(({option:f})=>[V(d(rt),{text:f.value},{default:F(()=>[$("div",ba,N(d(D)(f.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value","doctype","filters","placeholder"])):e.value.fieldtype==="Datetime"?(p(),x(d(ct),{key:8,value:d(o)[e.value.fieldname],formatter:f=>d(Te)(f,"",!0,!0),placeholder:u(e.value),"input-class":"border-none",onChange:l[13]||(l[13]=f=>n(f,e.value))},null,8,["value","formatter","placeholder"])):e.value.fieldtype==="Date"?(p(),x(d(ut),{key:9,value:d(o)[e.value.fieldname],formatter:f=>d(Te)(f,"",!0),placeholder:u(e.value),"input-class":"border-none",onChange:l[14]||(l[14]=f=>n(f,e.value))},null,8,["value","formatter","placeholder"])):["Small Text","Text","Long Text","Code"].includes(e.value.fieldtype)?(p(),x(k,{key:10,type:"textarea",value:d(o)[e.value.fieldname],placeholder:u(e.value),description:e.value.description,onChange:l[15]||(l[15]=f=>n(f.target.value,e.value))},null,8,["value","placeholder","description"])):e.value.fieldtype==="Password"?(p(),x(mt,{key:11,value:d(o)[e.value.fieldname],placeholder:u(e.value),description:e.value.description,onChange:l[16]||(l[16]=f=>n(f.target.value,e.value))},null,8,["value","placeholder","description"])):e.value.fieldtype==="Int"?(p(),x(le,{key:12,type:"text",placeholder:u(e.value),value:d(o)[e.value.fieldname]||"0",disabled:!!e.value.read_only,description:e.value.description,onChange:l[17]||(l[17]=f=>n(f.target.value,e.value))},null,8,["placeholder","value","disabled","description"])):e.value.fieldtype==="Percent"?(p(),x(le,{key:13,type:"text",value:d(m)(e.value.fieldname,d(o)),placeholder:u(e.value),disabled:!!e.value.read_only,description:e.value.description,onChange:l[18]||(l[18]=f=>n(d(re)(f.target.value),e.value))},null,8,["value","placeholder","disabled","description"])):e.value.fieldtype==="Float"?(p(),x(le,{key:14,type:"text",value:d(b)(e.value.fieldname,d(o)),placeholder:u(e.value),disabled:!!e.value.read_only,description:e.value.description,onChange:l[19]||(l[19]=f=>n(d(re)(f.target.value),e.value))},null,8,["value","placeholder","disabled","description"])):e.value.fieldtype==="Currency"?(p(),x(le,{key:15,type:"text",value:d(h)(e.value.fieldname,d(o),d(i)),placeholder:u(e.value),disabled:!!e.value.read_only,description:e.value.description,onChange:l[20]||(l[20]=f=>n(d(re)(f.target.value),e.value))},null,8,["value","placeholder","disabled","description"])):(p(),x(k,{key:16,type:"text",placeholder:u(e.value),value:s(d(o)[e.value.fieldname],e.value),disabled:!!e.value.read_only,description:e.value.description,onChange:l[21]||(l[21]=f=>n(f.target.value,e.value))},null,8,["placeholder","value","disabled","description"]))])):L("",!0)}}},ha=Ue(_a,[["__scopeId","data-v-03e99443"]]),xa={class:"column flex flex-col gap-4 w-full"},ka={key:0,class:"text-ink-gray-9 max-w-fit text-base"},Ca={__name:"Column",props:{column:Object},setup(a){return(r,o)=>(p(),T("div",xa,[a.column.label&&!a.column.hideLabel?(p(),T("div",ka,N(a.column.label),1)):L("",!0),(p(!0),T(H,null,Z(a.column.fields,g=>(p(),x(ha,{key:g.fieldname,field:g,"data-name":g.fieldname},null,8,["field","data-name"]))),128))]))}},wa={__name:"Section",props:{section:Object},setup(a){const r=j("hasTabs");return(o,g)=>a.section.hidden?L("",!0):(p(),T("div",{key:0,class:q(["section",[a.section.hideBorder?"pt-4":"border-t border-outline-gray-modals mt-5 pt-5"]])},[V(kt,{class:q(["flex sm:flex-row flex-col gap-4 text-lg font-medium",{"px-3 sm:px-5":d(r)}]),labelClass:["text-lg font-medium",{"px-3 sm:px-5":d(r)}],label:a.section.label,hideLabel:a.section.hideLabel||!a.section.label,opened:a.section.opened,collapsible:a.section.collapsible,collapseIconPosition:"right"},{default:F(()=>[(p(!0),T(H,null,Z(a.section.columns,C=>(p(),x(Ca,{key:C.name,class:q({"mt-6":a.section.label&&!a.section.hideLabel}),column:C,"data-name":C.name},null,8,["class","column","data-name"]))),128))]),_:1},8,["class","labelClass","label","hideLabel","opened","collapsible"])],2))}};const $a={__name:"FieldLayout",props:{tabs:Array,data:Object,doctype:{type:String,default:"CRM Lead"},isGridRow:{type:Boolean,default:!1},preview:{type:Boolean,default:!1}},setup(a){const r=a,o=M(0),g=B(()=>r.tabs.length>1||r.tabs.length==1&&r.tabs[0].label);return Y("data",B(()=>r.data)),Y("hasTabs",g),Y("doctype",r.doctype),Y("preview",r.preview),Y("isGridRow",r.isGridRow),(C,v)=>(p(),T("div",{class:q(["flex flex-col",{"border border-outline-gray-1 rounded-lg":g.value,"border-outline-gray-modals":g.value}])},[V(d(Wt),{as:"div",modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=m=>o.value=m),tabs:a.tabs},{default:F(()=>[V(d(ft),{class:q(g.value?"border-outline-gray-modals":"hidden")},null,8,["class"]),V(d(vt),null,{default:F(({tab:m})=>[$("div",{class:q(["sections overflow-hidden",{"my-4 sm:my-5":g.value}])},[(p(!0),T(H,null,Z(m.sections,b=>(p(),x(wa,{key:b.name,section:b,"data-name":b.name},null,8,["section","data-name"]))),128))],2)]),_:1})]),_:1},8,["modelValue","tabs"])],2))}},qe=Ue($a,[["__scopeId","data-v-0a2ef829"]]),Sa={class:"flex items-center gap-2 text-2xl font-semibold leading-6 text-ink-gray-9"},Va={class:"flex flex-col gap-3"},Da={class:"flex justify-between gap-2"},Fa={class:"flex flex-row-reverse gap-2"},Ra={key:0},Na={__name:"QuickEntryModal",props:ee({doctype:{type:String,default:"CRM Lead"},onlyRequired:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const r=a,o=te(a,"modelValue"),g=M(r.doctype),C=M(!1),v=M(!1),m=M(!1);function b(){let i=r.onlyRequired?"Required Fields":"Quick Entry";return{doctype:g.value,type:i}}const h=Me({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntryModal",g.value,r.onlyRequired],params:b(),onSuccess(i){h.originalData=JSON.parse(JSON.stringify(i))}});we(()=>h==null?void 0:h.data,()=>{v.value=JSON.stringify(h==null?void 0:h.data)!==JSON.stringify(h==null?void 0:h.originalData)},{deep:!0}),ie(()=>at(D,100)());function D(){ue(()=>{h.params=b(),h.reload()})}function y(){let i=JSON.parse(JSON.stringify(h.data));i.forEach(c=>{c.sections&&c.sections.forEach(u=>{u.columns.forEach(n=>{n.fields&&(n.fields=n.fields.map(s=>s.fieldname))})})}),C.value=!0;let e=r.onlyRequired?"Required Fields":"Quick Entry";Ee("crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.save_fields_layout",{doctype:g.value,type:e,layout:JSON.stringify(i)}).then(()=>{C.value=!1,o.value=!1,st("quick_entry_layout_builder",{doctype:g.value})})}return(i,e)=>{const c=U("Button");return p(),x(d(Ne),{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=u=>o.value=u),options:{size:"4xl"}},{"body-title":F(()=>[$("h3",Sa,[$("div",null,N(i.__("Edit Quick Entry Layout")),1),v.value?(p(),x(d(nt),{key:0,label:i.__("Not Saved"),variant:"subtle",theme:"orange"},null,8,["label"])):L("",!0)])]),"body-content":F(()=>{var u;return[$("div",Va,[$("div",Da,[V(c,{label:m.value?i.__("Hide preview"):i.__("Show preview"),onClick:e[0]||(e[0]=n=>m.value=!m.value)},null,8,["label"]),$("div",Fa,[V(c,{loading:C.value,label:i.__("Save"),variant:"solid",onClick:y},null,8,["loading","label"]),V(c,{label:i.__("Reset"),onClick:D},null,8,["label"])])]),(u=d(h))!=null&&u.data?(p(),T("div",Ra,[m.value?(p(),x(qe,{key:1,tabs:d(h).data,data:{},preview:!0},null,8,["tabs"])):(p(),x(yt,{key:0,tabs:d(h).data,doctype:g.value,onlyRequired:a.onlyRequired},null,8,["tabs","doctype","onlyRequired"]))])):L("",!0)])]}),_:1},8,["modelValue"])}}};export{qe as F,ua as G,Na as _,Wt as a,ft as b,vt as c,yt as d,le as e,mt as f,Gl as g,jl as h,ql as i,Al as s,ca as u};
//# sourceMappingURL=QuickEntryModal-157d8856.js.map
