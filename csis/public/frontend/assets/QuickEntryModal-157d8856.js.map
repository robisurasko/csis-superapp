{"version":3,"file":"QuickEntryModal-157d8856.js","sources":["../../../../node_modules/@headlessui/vue/dist/internal/focus-sentinel.js","../../../../node_modules/@headlessui/vue/dist/components/tabs/tabs.js","../../../../node_modules/frappe-ui/src/components/Tabs/TabList.vue","../../../../node_modules/frappe-ui/src/components/Tabs/TabPanel.vue","../../../../node_modules/frappe-ui/src/components/Tabs/Tabs.vue","../../../../frontend/src/components/Controls/Password.vue","../../../../frontend/src/components/Controls/FormattedInput.vue","../../../../frontend/src/components/Controls/TableMultiselectInput.vue","../../../../frontend/src/components/Controls/GridFieldsEditorModal.vue","../../../../frontend/src/components/FieldLayoutEditor.vue","../../../../frontend/src/components/Controls/GridRowFieldsModal.vue","../../../../frontend/src/components/Controls/GridRowModal.vue","../../../../frontend/src/composables/document.js","../../../../frontend/src/components/Controls/Grid.vue","../../../../frontend/src/data/script.js","../../../../frontend/src/data/document.js","../../../../frontend/src/components/FieldLayout/Field.vue","../../../../frontend/src/components/FieldLayout/Section.vue","../../../../frontend/src/components/FieldLayout/FieldLayout.vue","../../../../frontend/src/components/Modals/QuickEntryModal.vue"],"sourcesContent":["import{defineComponent as i,h as m,ref as f}from\"vue\";import{Features as l,Hidden as F}from'./hidden.js';let d=i({props:{onFocus:{type:Function,required:!0}},setup(t){let n=f(!0);return()=>n.value?m(F,{as:\"button\",type:\"button\",features:l.Focusable,onFocus(o){o.preventDefault();let e,a=50;function r(){var u;if(a--<=0){e&&cancelAnimationFrame(e);return}if((u=t.onFocus)!=null&&u.call(t)){n.value=!1,cancelAnimationFrame(e);return}e=requestAnimationFrame(r)}e=requestAnimationFrame(r)}}):null}});export{d as FocusSentinel};\n","import{computed as v,defineComponent as L,Fragment as z,h as A,inject as j,onMounted as F,onUnmounted as K,provide as N,ref as P,watch as _,watchEffect as J}from\"vue\";import{useId as $}from'../../hooks/use-id.js';import{useResolveButtonType as Q}from'../../hooks/use-resolve-button-type.js';import{FocusSentinel as V}from'../../internal/focus-sentinel.js';import{Hidden as X}from'../../internal/hidden.js';import{Keys as S}from'../../keyboard.js';import{dom as f}from'../../utils/dom.js';import{Focus as g,focusIn as D,FocusResult as B,sortByDomNode as k}from'../../utils/focus-management.js';import{match as H}from'../../utils/match.js';import{microTask as Y}from'../../utils/micro-task.js';import{getOwnerDocument as Z}from'../../utils/owner.js';import{Features as q,omit as ee,render as M}from'../../utils/render.js';var te=(s=>(s[s.Forwards=0]=\"Forwards\",s[s.Backwards=1]=\"Backwards\",s))(te||{}),le=(d=>(d[d.Less=-1]=\"Less\",d[d.Equal=0]=\"Equal\",d[d.Greater=1]=\"Greater\",d))(le||{});let U=Symbol(\"TabsContext\");function C(a){let b=j(U,null);if(b===null){let s=new Error(`<${a} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,C),s}return b}let G=Symbol(\"TabsSSRContext\"),me=L({name:\"TabGroup\",emits:{change:a=>!0},props:{as:{type:[Object,String],default:\"template\"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(a,{slots:b,attrs:s,emit:d}){var E;let i=P((E=a.selectedIndex)!=null?E:a.defaultIndex),l=P([]),r=P([]),p=v(()=>a.selectedIndex!==null),R=v(()=>p.value?a.selectedIndex:i.value);function y(t){var c;let n=k(u.tabs.value,f),o=k(u.panels.value,f),e=n.filter(I=>{var m;return!((m=f(I))!=null&&m.hasAttribute(\"disabled\"))});if(t<0||t>n.length-1){let I=H(i.value===null?0:Math.sign(t-i.value),{[-1]:()=>1,[0]:()=>H(Math.sign(t),{[-1]:()=>0,[0]:()=>0,[1]:()=>1}),[1]:()=>0}),m=H(I,{[0]:()=>n.indexOf(e[0]),[1]:()=>n.indexOf(e[e.length-1])});m!==-1&&(i.value=m),u.tabs.value=n,u.panels.value=o}else{let I=n.slice(0,t),h=[...n.slice(t),...I].find(W=>e.includes(W));if(!h)return;let O=(c=n.indexOf(h))!=null?c:u.selectedIndex.value;O===-1&&(O=u.selectedIndex.value),i.value=O,u.tabs.value=n,u.panels.value=o}}let u={selectedIndex:v(()=>{var t,n;return(n=(t=i.value)!=null?t:a.defaultIndex)!=null?n:null}),orientation:v(()=>a.vertical?\"vertical\":\"horizontal\"),activation:v(()=>a.manual?\"manual\":\"auto\"),tabs:l,panels:r,setSelectedIndex(t){R.value!==t&&d(\"change\",t),p.value||y(t)},registerTab(t){var o;if(l.value.includes(t))return;let n=l.value[i.value];if(l.value.push(t),l.value=k(l.value,f),!p.value){let e=(o=l.value.indexOf(n))!=null?o:i.value;e!==-1&&(i.value=e)}},unregisterTab(t){let n=l.value.indexOf(t);n!==-1&&l.value.splice(n,1)},registerPanel(t){r.value.includes(t)||(r.value.push(t),r.value=k(r.value,f))},unregisterPanel(t){let n=r.value.indexOf(t);n!==-1&&r.value.splice(n,1)}};N(U,u);let T=P({tabs:[],panels:[]}),x=P(!1);F(()=>{x.value=!0}),N(G,v(()=>x.value?null:T.value));let w=v(()=>a.selectedIndex);return F(()=>{_([w],()=>{var t;return y((t=a.selectedIndex)!=null?t:a.defaultIndex)},{immediate:!0})}),J(()=>{if(!p.value||R.value==null||u.tabs.value.length<=0)return;let t=k(u.tabs.value,f);t.some((o,e)=>f(u.tabs.value[e])!==f(o))&&u.setSelectedIndex(t.findIndex(o=>f(o)===f(u.tabs.value[R.value])))}),()=>{let t={selectedIndex:i.value};return A(z,[l.value.length<=0&&A(V,{onFocus:()=>{for(let n of l.value){let o=f(n);if((o==null?void 0:o.tabIndex)===0)return o.focus(),!0}return!1}}),M({theirProps:{...s,...ee(a,[\"selectedIndex\",\"defaultIndex\",\"manual\",\"vertical\",\"onChange\"])},ourProps:{},slot:t,slots:b,attrs:s,name:\"TabGroup\"})])}}}),pe=L({name:\"TabList\",props:{as:{type:[Object,String],default:\"div\"}},setup(a,{attrs:b,slots:s}){let d=C(\"TabList\");return()=>{let i={selectedIndex:d.selectedIndex.value},l={role:\"tablist\",\"aria-orientation\":d.orientation.value};return M({ourProps:l,theirProps:a,slot:i,attrs:b,slots:s,name:\"TabList\"})}}}),xe=L({name:\"Tab\",props:{as:{type:[Object,String],default:\"button\"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(a,{attrs:b,slots:s,expose:d}){var o;let i=(o=a.id)!=null?o:`headlessui-tabs-tab-${$()}`,l=C(\"Tab\"),r=P(null);d({el:r,$el:r}),F(()=>l.registerTab(r)),K(()=>l.unregisterTab(r));let p=j(G),R=v(()=>{if(p.value){let e=p.value.tabs.indexOf(i);return e===-1?p.value.tabs.push(i)-1:e}return-1}),y=v(()=>{let e=l.tabs.value.indexOf(r);return e===-1?R.value:e}),u=v(()=>y.value===l.selectedIndex.value);function T(e){var I;let c=e();if(c===B.Success&&l.activation.value===\"auto\"){let m=(I=Z(r))==null?void 0:I.activeElement,h=l.tabs.value.findIndex(O=>f(O)===m);h!==-1&&l.setSelectedIndex(h)}return c}function x(e){let c=l.tabs.value.map(m=>f(m)).filter(Boolean);if(e.key===S.Space||e.key===S.Enter){e.preventDefault(),e.stopPropagation(),l.setSelectedIndex(y.value);return}switch(e.key){case S.Home:case S.PageUp:return e.preventDefault(),e.stopPropagation(),T(()=>D(c,g.First));case S.End:case S.PageDown:return e.preventDefault(),e.stopPropagation(),T(()=>D(c,g.Last))}if(T(()=>H(l.orientation.value,{vertical(){return e.key===S.ArrowUp?D(c,g.Previous|g.WrapAround):e.key===S.ArrowDown?D(c,g.Next|g.WrapAround):B.Error},horizontal(){return e.key===S.ArrowLeft?D(c,g.Previous|g.WrapAround):e.key===S.ArrowRight?D(c,g.Next|g.WrapAround):B.Error}}))===B.Success)return e.preventDefault()}let w=P(!1);function E(){var e;w.value||(w.value=!0,!a.disabled&&((e=f(r))==null||e.focus({preventScroll:!0}),l.setSelectedIndex(y.value),Y(()=>{w.value=!1})))}function t(e){e.preventDefault()}let n=Q(v(()=>({as:a.as,type:b.type})),r);return()=>{var m,h;let e={selected:u.value,disabled:(m=a.disabled)!=null?m:!1},{...c}=a,I={ref:r,onKeydown:x,onMousedown:t,onClick:E,id:i,role:\"tab\",type:n.value,\"aria-controls\":(h=f(l.panels.value[y.value]))==null?void 0:h.id,\"aria-selected\":u.value,tabIndex:u.value?0:-1,disabled:a.disabled?!0:void 0};return M({ourProps:I,theirProps:c,slot:e,attrs:b,slots:s,name:\"Tab\"})}}}),Ie=L({name:\"TabPanels\",props:{as:{type:[Object,String],default:\"div\"}},setup(a,{slots:b,attrs:s}){let d=C(\"TabPanels\");return()=>{let i={selectedIndex:d.selectedIndex.value};return M({theirProps:a,ourProps:{},slot:i,attrs:s,slots:b,name:\"TabPanels\"})}}}),ye=L({name:\"TabPanel\",props:{as:{type:[Object,String],default:\"div\"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null},tabIndex:{type:Number,default:0}},setup(a,{attrs:b,slots:s,expose:d}){var T;let i=(T=a.id)!=null?T:`headlessui-tabs-panel-${$()}`,l=C(\"TabPanel\"),r=P(null);d({el:r,$el:r}),F(()=>l.registerPanel(r)),K(()=>l.unregisterPanel(r));let p=j(G),R=v(()=>{if(p.value){let x=p.value.panels.indexOf(i);return x===-1?p.value.panels.push(i)-1:x}return-1}),y=v(()=>{let x=l.panels.value.indexOf(r);return x===-1?R.value:x}),u=v(()=>y.value===l.selectedIndex.value);return()=>{var n;let x={selected:u.value},{tabIndex:w,...E}=a,t={ref:r,id:i,role:\"tabpanel\",\"aria-labelledby\":(n=f(l.tabs.value[y.value]))==null?void 0:n.id,tabIndex:u.value?w:-1};return!u.value&&a.unmount&&!a.static?A(X,{as:\"span\",\"aria-hidden\":!0,...t}):M({ourProps:t,theirProps:E,slot:x,attrs:b,slots:s,features:q.Static|q.RenderStrategy,visible:u.value,name:\"TabPanel\"})}}});export{xe as Tab,me as TabGroup,pe as TabList,ye as TabPanel,Ie as TabPanels};\n","<template>\n  <TabList\n    class=\"relative flex\"\n    :class=\"\n      t.vertical\n        ? 'flex-col border-r overflow-y-auto'\n        : 'gap-7.5 border-b overflow-x-auto items-center px-5'\n    \"\n  >\n    <Tab\n      ref=\"tabRef\"\n      as=\"template\"\n      v-for=\"(tab, i) in t.tabs\"\n      :key=\"i\"\n      v-slot=\"{ selected }\"\n      class=\"focus:outline-none focus:transition-none\"\n    >\n      <slot v-bind=\"{ tab, selected }\">\n        <button\n          class=\"flex items-center gap-1.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9\"\n          :class=\"[\n            selected ? 'text-ink-gray-9' : '',\n            t.vertical\n              ? 'py-2.5 px-4 border-r border-transparent hover:border-outline-gray-3'\n              : 'py-3 border-b border-transparent hover:border-outline-gray-3',\n          ]\"\n        >\n          <component v-if=\"tab.icon\" :is=\"tab.icon\" class=\"size-4\" />\n          {{ tab.label }}\n        </button>\n      </slot>\n    </Tab>\n    <div\n      ref=\"indicator\"\n      class=\"tab-indicator absolute bg-surface-gray-7\"\n      :class=\"[t.vertical ? 'right-0 w-px' : 'bottom-0 h-px', transitionClass]\"\n    />\n  </TabList>\n</template>\n<script setup>\nimport { TabList, Tab } from '@headlessui/vue'\nimport { ref, watch, computed, onMounted, nextTick, inject } from 'vue'\n\nconst t = inject('tab')\n\nconst tabRef = ref([])\nconst indicator = ref(null)\nconst tabsLength = computed(() => t.value.tabs.value?.length)\n\nconst transitionClass = ref('')\n\nfunction moveIndicator(index) {\n  if (index >= tabsLength.value) {\n    index = tabsLength.value - 1\n  }\n  const selectedTab = tabRef.value[index].el\n  if (t.value.vertical.value) {\n    indicator.value.style.height = `${selectedTab.offsetHeight}px`\n    indicator.value.style.top = `${selectedTab.offsetTop}px`\n  } else {\n    indicator.value.style.width = `${selectedTab.offsetWidth}px`\n    indicator.value.style.left = `${selectedTab.offsetLeft}px`\n  }\n}\n\nwatch(\n  () => t.value.tabIndex.value,\n  (index) => {\n    if (index >= tabsLength.value) {\n      t.value.tabIndex.value = tabsLength.value - 1\n    }\n    transitionClass.value = 'transition-all duration-300 ease-in-out'\n    nextTick(() => moveIndicator(index))\n  },\n)\n\nonMounted(() => {\n  nextTick(() => moveIndicator(t.value.tabIndex.value))\n  // Fix for indicator not moving on initial load\n  setTimeout(() => moveIndicator(t.value.tabIndex.value), 100)\n})\n</script>\n","<template>\n  <TabPanels class=\"flex flex-1 overflow-hidden\">\n    <TabPanel\n      class=\"flex flex-1 flex-col overflow-y-auto focus:outline-none\"\n      v-for=\"(tab, i) in t.tabs\"\n      :key=\"i\"\n    >\n      <slot v-bind=\"{ tab }\" />\n    </TabPanel>\n  </TabPanels>\n</template>\n<script setup>\nimport { TabPanels, TabPanel } from '@headlessui/vue'\nimport { inject } from 'vue'\n\nconst t = inject('tab')\n</script>\n","<template>\n  <TabGroup\n    v-bind=\"\n      as !== 'template'\n        ? {\n            as,\n            class: ['flex flex-1 overflow-hidden', vertical ? '' : 'flex-col '],\n          }\n        : {}\n    \"\n    :defaultIndex=\"tabIndex\"\n    :selectedIndex=\"tabIndex\"\n    @change=\"(idx) => (tabIndex = idx)\"\n  >\n    <slot>\n      <TabList v-slot=\"{ tab, selected }\">\n        <slot name=\"tab-item\" v-bind=\"{ tab, selected }\" />\n      </TabList>\n      <TabPanel v-slot=\"{ tab }\">\n        <slot name=\"tab-panel\" v-bind=\"{ tab }\" />\n      </TabPanel>\n    </slot>\n  </TabGroup>\n</template>\n\n<script setup>\nimport TabList from './TabList.vue'\nimport TabPanel from './TabPanel.vue'\nimport { TabGroup } from '@headlessui/vue'\nimport { computed, provide } from 'vue'\n\nconst props = defineProps({\n  as: {\n    type: String,\n    default: 'template',\n  },\n  tabs: {\n    type: Array,\n    required: true,\n  },\n  vertical: {\n    type: Boolean,\n    default: false,\n  },\n})\n\nconst tabIndex = defineModel()\n\nprovide(\n  'tab',\n  computed(() => ({\n    tabIndex,\n    tabs: props.tabs,\n    vertical: props.vertical,\n  })),\n)\n</script>\n","<template>\n  <FormControl\n    :type=\"show ? 'text' : 'password'\"\n    :value=\"modelValue || value\"\n    v-bind=\"$attrs\"\n  >\n    <template #suffix>\n      <Button v-show=\"showEye\" class=\"!h-4\" @click=\"show = !show\">\n        <FeatherIcon :name=\"show ? 'eye-off' : 'eye'\" class=\"h-3\" />\n      </Button>\n    </template>\n  </FormControl>\n</template>\n<script setup>\nimport { FormControl } from 'frappe-ui'\nimport { ref, computed } from 'vue'\nconst props = defineProps({\n  modelValue: {\n    type: [String, Number],\n    default: '',\n  },\n  value: {\n    type: [String, Number],\n    default: '',\n  },\n})\nconst show = ref(false)\nconst showEye = computed(() => {\n  let v = props.modelValue || props.value\n  return !v?.includes('*')\n})\n</script>\n","<template>\n  <TextInput\n    ref=\"inputRef\"\n    :value=\"displayValue\"\n    @focus=\"handleFocus\"\n    @blur=\"isFocused = false\"\n    v-bind=\"$attrs\"\n  />\n  <slot name=\"description\">\n    <p v-if=\"attrs.description\" class=\"mt-1.5\" :class=\"descriptionClasses\">\n      {{ attrs.description }}\n    </p>\n  </slot>\n</template>\n<script setup>\nimport { TextInput } from 'frappe-ui'\nimport { ref, computed, nextTick, useAttrs } from 'vue'\n\nconst props = defineProps({\n  value: {\n    type: [String, Number],\n    default: '',\n  },\n  formattedValue: {\n    type: [String, Number],\n    default: '',\n  },\n})\n\nconst attrs = useAttrs()\n\nconst isFocused = ref(false)\nconst inputRef = ref(null)\n\nfunction handleFocus() {\n  isFocused.value = true\n\n  nextTick(() => {\n    if (inputRef.value) {\n      inputRef.value.el?.select()\n    }\n  })\n}\n\nconst displayValue = computed(() => {\n  return isFocused.value ? props.value : props.formattedValue || props.value\n})\n\nconst descriptionClasses = computed(() => {\n  return [\n    {\n      sm: 'text-xs',\n      md: 'text-base',\n    }[attrs.size || 'sm'],\n    'text-ink-gray-5',\n  ]\n})\n</script>\n","<template>\n  <div>\n    <div\n      class=\"group flex flex-wrap gap-1 min-h-20 p-1.5 rounded text-base bg-surface-gray-2 hover:bg-surface-gray-3 focus:border-outline-gray-4 focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full\"\n    >\n      <Button\n        ref=\"valuesRef\"\n        v-for=\"value in parsedValues\"\n        :key=\"value\"\n        :label=\"value\"\n        theme=\"gray\"\n        variant=\"subtle\"\n        class=\"rounded bg-surface-white hover:!bg-surface-gray-1 focus-visible:ring-outline-gray-4\"\n        @keydown.delete.capture.stop=\"removeLastValue\"\n      >\n        <template #suffix>\n          <FeatherIcon\n            class=\"h-3.5\"\n            name=\"x\"\n            @click.stop=\"removeValue(value)\"\n          />\n        </template>\n      </Button>\n      <div class=\"w-full\">\n        <Link\n          v-if=\"linkField\"\n          class=\"form-control flex-1 truncate cursor-text\"\n          :value=\"query\"\n          :filters=\"filters\"\n          :doctype=\"linkField.options\"\n          @change=\"(v) => addValue(v)\"\n          :hideMe=\"true\"\n        >\n          <template #target=\"{ togglePopover }\">\n            <button\n              class=\"w-full h-7 cursor-text\"\n              @click.stop=\"togglePopover\"\n            />\n          </template>\n        </Link>\n      </div>\n    </div>\n    <ErrorMessage class=\"mt-2 pl-2\" v-if=\"error\" :message=\"error\" />\n  </div>\n</template>\n\n<script setup>\nimport Link from '@/components/Controls/Link.vue'\nimport { getMeta } from '@/stores/meta'\nimport { ref, computed, nextTick } from 'vue'\n\nconst props = defineProps({\n  doctype: {\n    type: String,\n    required: true,\n  },\n  errorMessage: {\n    type: Function,\n    default: (value) => `${value} is an Invalid value`,\n  },\n})\n\nconst emit = defineEmits(['change'])\n\nconst { getFields } = getMeta(props.doctype)\n\nconst values = defineModel({\n  type: Array,\n  default: () => [],\n})\n\nconst valuesRef = ref([])\nconst error = ref(null)\nconst query = ref('')\n\nconst linkField = ref('')\n\nconst filters = computed(() => {\n  if (!linkField.value) return []\n  return {\n    name: ['not in', parsedValues.value],\n  }\n})\n\nconst parsedValues = computed(() => {\n  error.value = ''\n  getLinkField()\n  if (!linkField.value) return []\n  return values.value.map((row) => row[linkField.value.fieldname])\n})\n\nconst getLinkField = () => {\n  error.value = ''\n  if (!linkField.value) {\n    let fields = getFields()\n    linkField.value = fields?.find((df) =>\n      ['Link', 'User'].includes(df.fieldtype),\n    )\n    if (!linkField.value) {\n      error.value =\n        'Table MultiSelect requires a Table with atleast one Link field'\n    }\n  }\n  return linkField.value\n}\n\nconst addValue = (value) => {\n  error.value = null\n\n  if (values.value.some((row) => row[linkField.value.fieldname] === value)) {\n    error.value = 'Value already exists'\n    return\n  }\n\n  if (value) {\n    values.value.push({ [linkField.value.fieldname]: value })\n    emit('change', values.value)\n    !error.value && (query.value = '')\n  }\n}\n\nconst removeValue = (value) => {\n  let _value = values.value.filter(\n    (row) => row[linkField.value.fieldname] !== value,\n  )\n  emit('change', _value)\n}\n\nconst removeLastValue = () => {\n  if (query.value) return\n\n  let valueRef = valuesRef.value[valuesRef.value.length - 1]?.$el\n  if (document.activeElement === valueRef) {\n    values.value.pop()\n    emit('change', values.value)\n    nextTick(() => {\n      if (values.value.length) {\n        valueRef = valuesRef.value[valuesRef.value.length - 1].$el\n        valueRef?.focus()\n      }\n    })\n  } else {\n    valueRef?.focus()\n  }\n}\n</script>\n","<template>\n  <Dialog v-model=\"show\">\n    <template #body-title>\n      <h3\n        class=\"flex items-center gap-2 text-2xl font-semibold leading-6 text-ink-gray-9\"\n      >\n        <div>{{ __('Edit Grid Fields Layout') }}</div>\n        <Badge\n          v-if=\"dirty\"\n          :label=\"__('Not Saved')\"\n          variant=\"subtle\"\n          theme=\"orange\"\n        />\n      </h3>\n    </template>\n    <template #body-content>\n      <div class=\"mt-4\">\n        <div class=\"text-base text-ink-gray-8 mb-2\">\n          {{ __('Fields Order') }}\n        </div>\n        <Draggable\n          v-if=\"oldFields?.length\"\n          :list=\"fields\"\n          group=\"fields\"\n          item-key=\"fieldname\"\n          class=\"flex flex-col gap-1\"\n        >\n          <template #item=\"{ element: field }\">\n            <div\n              class=\"px-1 py-0.5 bg-surface-gray-2 border border-outline-gray-modals rounded text-base text-ink-gray-8 flex items-center justify-between gap-2\"\n            >\n              <div class=\"flex items-center gap-2\">\n                <DragVerticalIcon class=\"h-3.5 cursor-grab\" />\n                <div>{{ field.label }}</div>\n              </div>\n              <div class=\"flex items-center gap-2\">\n                <TextInput\n                  variant=\"outline\"\n                  type=\"number\"\n                  v-model=\"field.columns\"\n                  class=\"w-20\"\n                />\n                <Button variant=\"ghost\" icon=\"x\" @click=\"removeField(field)\" />\n              </div>\n            </div>\n          </template>\n        </Draggable>\n        <Autocomplete\n          v-if=\"dropdownFields?.length\"\n          value=\"\"\n          :options=\"dropdownFields\"\n          @change=\"(e) => addField(e)\"\n        >\n          <template #target=\"{ togglePopover }\">\n            <Button\n              class=\"w-full mt-2\"\n              @click=\"togglePopover()\"\n              :label=\"__('Add Field')\"\n            >\n              <template #prefix>\n                <FeatherIcon name=\"plus\" class=\"h-4\" />\n              </template>\n            </Button>\n          </template>\n          <template #item-label=\"{ option }\">\n            <div class=\"flex flex-col gap-1 text-ink-gray-9\">\n              <div>{{ option.label }}</div>\n              <div class=\"text-ink-gray-4 text-sm\">\n                {{ `${option.fieldname} - ${option.fieldtype}` }}\n              </div>\n            </div>\n          </template>\n        </Autocomplete>\n        <ErrorMessage class=\"mt-3\" v-if=\"error\" :message=\"error\" />\n      </div>\n    </template>\n    <template #actions>\n      <div class=\"flex flex-col gap-2\">\n        <Button\n          v-if=\"dirty\"\n          class=\"w-full\"\n          :label=\"__('Reset')\"\n          @click=\"reset\"\n        />\n        <Button\n          class=\"w-full\"\n          :label=\"__('Save')\"\n          variant=\"solid\"\n          @click=\"update\"\n          :loading=\"loading\"\n          :disabled=\"!dirty\"\n        />\n      </div>\n    </template>\n  </Dialog>\n</template>\n<script setup>\nimport DragVerticalIcon from '@/components/Icons/DragVerticalIcon.vue'\nimport Autocomplete from '@/components/frappe-ui/Autocomplete.vue'\nimport { getMeta } from '@/stores/meta'\nimport Draggable from 'vuedraggable'\nimport { Dialog, ErrorMessage } from 'frappe-ui'\nimport { ref, computed } from 'vue'\n\nconst props = defineProps({\n  doctype: String,\n  parentDoctype: String,\n})\n\nconst { getFields, getGridViewSettings, saveUserSettings } = getMeta(\n  props.doctype,\n)\n\nconst show = defineModel()\n\nconst loading = ref(false)\nconst error = ref(null)\n\nconst dirty = computed(() => {\n  return JSON.stringify(fields.value) !== JSON.stringify(oldFields.value)\n})\n\nconst oldFields = computed(() => {\n  let _fields = getFields()\n  let gridViewSettings = getGridViewSettings(props.parentDoctype)\n\n  if (gridViewSettings.length) {\n    return gridViewSettings.map((field) => {\n      let f = _fields.find((f) => f.fieldname === field.fieldname)\n      if (f) {\n        f.columns = field.columns\n        return fieldObj(f)\n      }\n    })\n  }\n  return _fields?.filter((field) => field.in_list_view).map((f) => fieldObj(f))\n})\n\nconst fields = ref(JSON.parse(JSON.stringify(oldFields.value || [])))\n\nconst dropdownFields = computed(() => {\n  return getFields()?.filter((field) => {\n    return (\n      !fields.value.find((f) => f.fieldname === field.fieldname) &&\n      !['Tab Break', 'Section Break', 'Column Break', 'Table'].includes(\n        field.fieldtype,\n      )\n    )\n  })\n})\n\nfunction reset() {\n  fields.value = JSON.parse(JSON.stringify(oldFields.value || []))\n}\n\nfunction addField(field) {\n  fields.value.push(fieldObj(field))\n}\n\nfunction removeField(field) {\n  const index = fields.value.findIndex((f) => f.fieldname === field.fieldname)\n  fields.value.splice(index, 1)\n}\n\nfunction update() {\n  loading.value = true\n\n  let updateFields = fields.value.map((field) => {\n    return {\n      fieldname: field.fieldname,\n      columns: field.columns,\n    }\n  })\n\n  if (updateFields.length === 0) {\n    error.value = __('At least one field is required')\n    return\n  }\n\n  saveUserSettings(props.parentDoctype, 'GridView', updateFields, () => {\n    loading.value = false\n    show.value = false\n  })\n}\n\nfunction fieldObj(field) {\n  return {\n    label: field.label,\n    fieldname: field.fieldname,\n    fieldtype: field.fieldtype,\n    options: field.options,\n    in_list_view: field.in_list_view,\n    columns: field.columns || 2,\n  }\n}\n</script>\n","<template>\n  <div class=\"flex flex-col gap-5.5\">\n    <div\n      class=\"flex items-center gap-2 text-base bg-surface-gray-2 rounded py-2 px-2.5\"\n    >\n      <Draggable\n        v-if=\"tabs.length && tabs[tabIndex].label\"\n        :list=\"tabs\"\n        item-key=\"name\"\n        class=\"flex items-center gap-2\"\n        @end=\"(e) => (tabIndex = e.newIndex)\"\n      >\n        <template #item=\"{ element: tab, index: i }\">\n          <div\n            class=\"flex items-center gap-2 cursor-pointer rounded\"\n            :class=\"[\n              tabIndex == i\n                ? 'text-ink-gray-9 bg-surface-white shadow-sm'\n                : 'text-ink-gray-5 hover:text-ink-gray-9 hover:bg-surface-white hover:shadow-sm',\n              tab.editingLabel ? 'p-1' : 'px-2 py-1',\n            ]\"\n            @click=\"tabIndex = i\"\n          >\n            <div @dblclick=\"() => (tab.editingLabel = true)\">\n              <div v-if=\"!tab.editingLabel\" class=\"flex items-center gap-2\">\n                {{ __(tab.label) || __('Untitled') }}\n              </div>\n              <div v-else class=\"flex gap-1 items-center\">\n                <Input\n                  v-model=\"tab.label\"\n                  @keydown.enter=\"tab.editingLabel = false\"\n                  @blur=\"tab.editingLabel = false\"\n                  @click.stop\n                />\n                <Button\n                  v-if=\"tab.editingLabel\"\n                  icon=\"check\"\n                  variant=\"ghost\"\n                  @click=\"tab.editingLabel = false\"\n                />\n              </div>\n            </div>\n            <Dropdown\n              v-if=\"tab.label && tabIndex == i\"\n              :options=\"getTabOptions(tab)\"\n              class=\"!h-4\"\n              @click.stop\n            >\n              <template #default>\n                <Button variant=\"ghost\" class=\"!p-1 !h-4\">\n                  <FeatherIcon name=\"more-horizontal\" class=\"h-4\" />\n                </Button>\n              </template>\n            </Dropdown>\n          </div>\n        </template>\n      </Draggable>\n      <Button\n        variant=\"ghost\"\n        class=\"!h-6.5 !text-ink-gray-5 hover:!text-ink-gray-9\"\n        @click=\"addTab\"\n        :label=\"__('Add Tab')\"\n      >\n        <template v-slot:[slotName]>\n          <FeatherIcon name=\"plus\" class=\"h-4\" />\n        </template>\n      </Button>\n    </div>\n    <div v-show=\"tabIndex == i\" v-for=\"(tab, i) in tabs\" :key=\"tab.name\">\n      <Draggable\n        :list=\"tab.sections\"\n        item-key=\"name\"\n        class=\"flex flex-col gap-5.5\"\n      >\n        <template #item=\"{ element: section, index: i }\">\n          <div\n            class=\"section flex flex-col gap-1.5 p-2.5 bg-surface-gray-2 rounded cursor-grab\"\n          >\n            <div class=\"flex items-center justify-between\">\n              <div\n                class=\"flex h-7 max-w-fit cursor-pointer items-center gap-2 text-base font-medium leading-4 text-ink-gray-9\"\n                @dblclick=\"() => (section.editingLabel = true)\"\n              >\n                <div\n                  v-if=\"!section.editingLabel\"\n                  class=\"flex items-center gap-2\"\n                  :class=\"{\n                    'text-ink-gray-3': section.hideLabel || !section.label,\n                    italic: !section.label,\n                  }\"\n                >\n                  {{ __(section.label) || __('No label') }}\n                  <FeatherIcon\n                    v-if=\"section.collapsible\"\n                    name=\"chevron-down\"\n                    class=\"h-4 transition-all duration-300 ease-in-out\"\n                  />\n                </div>\n                <div v-else class=\"flex gap-2 items-center\">\n                  <Input\n                    v-model=\"section.label\"\n                    @keydown.enter=\"section.editingLabel = false\"\n                    @blur=\"section.editingLabel = false\"\n                    @click.stop\n                  />\n                  <Button\n                    v-if=\"section.editingLabel\"\n                    icon=\"check\"\n                    variant=\"ghost\"\n                    @click=\"section.editingLabel = false\"\n                  />\n                </div>\n              </div>\n              <Dropdown :options=\"getSectionOptions(i, section, tab)\">\n                <template #default>\n                  <Button variant=\"ghost\">\n                    <FeatherIcon name=\"more-horizontal\" class=\"h-4\" />\n                  </Button>\n                </template>\n              </Dropdown>\n            </div>\n            <Draggable\n              class=\"flex gap-2\"\n              :list=\"section.columns\"\n              group=\"columns\"\n              item-key=\"name\"\n            >\n              <template #item=\"{ element: column }\">\n                <div\n                  class=\"flex flex-col gap-1.5 flex-1 p-2 border border-dashed border-outline-gray-2 rounded bg-surface-modal cursor-grab\"\n                >\n                  <Draggable\n                    :list=\"column.fields\"\n                    group=\"fields\"\n                    item-key=\"fieldname\"\n                    class=\"flex flex-col gap-1.5\"\n                    handle=\".cursor-grab\"\n                  >\n                    <template #item=\"{ element: field }\">\n                      <div\n                        class=\"field px-2.5 py-2 border border-outline-gray-2 rounded text-base bg-surface-modal text-ink-gray-8 flex items-center leading-4 justify-between gap-2\"\n                      >\n                        <div class=\"flex items-center gap-2 truncate\">\n                          <DragVerticalIcon class=\"h-3.5 cursor-grab\" />\n                          <div class=\"truncate\">{{ field.label }}</div>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          class=\"!size-4 rounded-sm\"\n                          icon=\"x\"\n                          @click=\"\n                            column.fields.splice(\n                              column.fields.indexOf(field),\n                              1,\n                            )\n                          \"\n                        />\n                      </div>\n                    </template>\n                  </Draggable>\n                  <Autocomplete\n                    v-if=\"fields.data\"\n                    value=\"\"\n                    :options=\"fields.data\"\n                    @change=\"(e) => addField(column, e)\"\n                  >\n                    <template #target=\"{ togglePopover }\">\n                      <div class=\"gap-2 w-full\">\n                        <Button\n                          class=\"w-full !h-8 !bg-surface-modal\"\n                          variant=\"outline\"\n                          @click=\"togglePopover()\"\n                          :label=\"__('Add Field')\"\n                        >\n                          <template #prefix>\n                            <FeatherIcon name=\"plus\" class=\"h-4\" />\n                          </template>\n                        </Button>\n                      </div>\n                    </template>\n                    <template #item-label=\"{ option }\">\n                      <div class=\"flex flex-col gap-1 text-ink-gray-9\">\n                        <div>{{ option.label }}</div>\n                        <div class=\"text-ink-gray-4 text-sm\">\n                          {{ `${option.fieldname} - ${option.fieldtype}` }}\n                        </div>\n                      </div>\n                    </template>\n                  </Autocomplete>\n                </div>\n              </template>\n            </Draggable>\n          </div>\n        </template>\n      </Draggable>\n      <div class=\"mt-5.5\">\n        <Button\n          class=\"w-full h-8\"\n          variant=\"subtle\"\n          :label=\"__('Add Section')\"\n          @click=\"\n            tabs[tabIndex].sections.push({\n              label: __('New Section'),\n              name: 'section_' + getRandom(),\n              opened: true,\n              columns: [{ name: 'column_' + getRandom(), fields: [] }],\n            })\n          \"\n        >\n          <template #prefix>\n            <FeatherIcon name=\"plus\" class=\"h-4\" />\n          </template>\n        </Button>\n      </div>\n    </div>\n  </div>\n</template>\n<script setup>\nimport Autocomplete from '@/components/frappe-ui/Autocomplete.vue'\nimport DragVerticalIcon from '@/components/Icons/DragVerticalIcon.vue'\nimport Draggable from 'vuedraggable'\nimport { getRandom } from '@/utils'\nimport { Dropdown, createResource } from 'frappe-ui'\nimport { ref, computed, watch } from 'vue'\n\nconst props = defineProps({\n  tabs: Object,\n  doctype: String,\n  onlyRequired: {\n    type: Boolean,\n    default: false,\n  },\n})\n\nconst tabIndex = ref(0)\nconst slotName = computed(() => {\n  if (props.tabs.length == 1 && !props.tabs[0].label) {\n    return 'prefix'\n  }\n  return 'default'\n})\n\nconst restrictedFieldTypes = [\n  'Geolocation',\n  'Attach',\n  'Attach Image',\n  'HTML',\n  'Signature',\n]\n\nconst params = computed(() => {\n  return {\n    doctype: props.doctype,\n    restricted_fieldtypes: restrictedFieldTypes,\n    as_array: true,\n    only_required: props.onlyRequired,\n  }\n})\n\nconst fields = createResource({\n  url: 'crm.api.doc.get_fields_meta',\n  params: params.value,\n  cache: ['fieldsMeta', props.doctype],\n  auto: true,\n  transform: (data) => {\n    let restrictedFields = [\n      'name',\n      'owner',\n      'creation',\n      'modified',\n      'modified_by',\n      'docstatus',\n      '_comments',\n      '_user_tags',\n      '_assign',\n      '_liked_by',\n    ]\n    let existingFields = []\n\n    props.tabs?.forEach((tab) => {\n      tab.sections?.forEach((section) => {\n        section.columns?.forEach((column) => {\n          existingFields = existingFields.concat(column.fields)\n        })\n      })\n    })\n\n    return data.filter((field) => {\n      return (\n        !existingFields.find((f) => f.fieldname === field.fieldname) &&\n        !restrictedFields.includes(field.fieldname)\n      )\n    })\n  },\n})\n\nfunction addTab() {\n  if (props.tabs.length == 1 && !props.tabs[0].label) {\n    props.tabs[0].label = __('New Tab')\n    return\n  }\n\n  props.tabs.push({\n    label: __('New Tab'),\n    name: 'tab_' + getRandom(),\n    sections: [],\n  })\n  tabIndex.value = props.tabs.length ? props.tabs.length - 1 : 0\n}\n\nfunction addField(column, field) {\n  if (!field) return\n  column.fields.push(field)\n}\n\nfunction getTabOptions(tab) {\n  return [\n    {\n      label: __('Edit'),\n      icon: 'edit',\n      onClick: () => (tab.editingLabel = true),\n    },\n    {\n      label: __('Remove tab'),\n      icon: 'trash-2',\n      onClick: () => {\n        if (props.tabs.length == 1) {\n          props.tabs[0].label = ''\n          return\n        }\n        props.tabs.splice(tabIndex.value, 1)\n        tabIndex.value = tabIndex.value ? tabIndex.value - 1 : 0\n      },\n    },\n  ]\n}\n\nfunction getSectionOptions(i, section, tab) {\n  let column = section.columns[section.columns.length - 1]\n  return [\n    {\n      group: __('Section'),\n      items: [\n        {\n          label: __('Edit'),\n          icon: 'edit',\n          onClick: () => (section.editingLabel = true),\n        },\n        {\n          label: section.collapsible ? __('Uncollapsible') : __('Collapsible'),\n          icon: section.collapsible ? 'chevron-up' : 'chevron-down',\n          onClick: () => (section.collapsible = !section.collapsible),\n        },\n        {\n          label: section.hideLabel ? __('Show label') : __('Hide label'),\n          icon: section.hideLabel ? 'eye' : 'eye-off',\n          onClick: () => (section.hideLabel = !section.hideLabel),\n        },\n        {\n          label: section.hideBorder ? __('Show border') : __('Hide border'),\n          icon: 'minus',\n          onClick: () => (section.hideBorder = !section.hideBorder),\n        },\n        {\n          label: __('Remove section'),\n          icon: 'trash-2',\n          onClick: () => {\n            tab.sections.splice(tab.sections.indexOf(section), 1)\n          },\n          condition: () => section.editable !== false,\n        },\n        {\n          label: __('Remove and move columns to {0} section', [\n            i == 0 ? __('next') : __('previous'),\n          ]),\n          icon: 'trash-2',\n          onClick: () => {\n            let targetSection = tab.sections[i == 0 ? i + 1 : i - 1]\n            if (i == 0) {\n              targetSection.columns = section.columns.concat(\n                targetSection.columns,\n              )\n            } else {\n              targetSection.columns = targetSection.columns.concat(\n                section.columns,\n              )\n            }\n            tab.sections.splice(tab.sections.indexOf(section), 1)\n          },\n          condition: () => section.editable !== false && section.columns.length,\n        },\n        {\n          label: __('Move to previous tab'),\n          icon: 'corner-up-left',\n          onClick: () => {\n            let previousTab = props.tabs[tabIndex.value - 1]\n            previousTab.sections.push(section)\n            props.tabs[tabIndex.value].sections.splice(\n              props.tabs[tabIndex.value].sections.indexOf(section),\n              1,\n            )\n            tabIndex.value -= 1\n          },\n          condition: () => props.tabs[tabIndex.value - 1],\n        },\n        {\n          label: __('Move to next tab'),\n          icon: 'corner-up-right',\n          onClick: () => {\n            let nextTab = props.tabs[tabIndex.value + 1]\n            nextTab.sections.push(section)\n            props.tabs[tabIndex.value].sections.splice(\n              props.tabs[tabIndex.value].sections.indexOf(section),\n              1,\n            )\n            tabIndex.value += 1\n          },\n          condition: () => props.tabs[tabIndex.value + 1],\n        },\n      ],\n    },\n    {\n      group: __('Column'),\n      items: [\n        {\n          label: __('Add column'),\n          icon: 'columns',\n          onClick: () => {\n            section.columns.push({\n              label: '',\n              name: 'column_' + getRandom(),\n              fields: [],\n            })\n          },\n          condition: () => section.columns.length < 4,\n        },\n        {\n          label: __('Remove column'),\n          icon: 'trash-2',\n          onClick: () => section.columns.pop(),\n          condition: () => section.columns.length > 1,\n        },\n        {\n          label: __('Remove and move fields to previous column'),\n          icon: 'trash-2',\n          onClick: () => {\n            let previousColumn = section.columns[section.columns.length - 2]\n            previousColumn.fields = previousColumn.fields.concat(column.fields)\n            section.columns.pop()\n          },\n          condition: () => section.columns.length > 1 && column.fields.length,\n        },\n        {\n          label: __('Move to next section'),\n          icon: 'corner-up-right',\n          onClick: () => {\n            let nextSection = tab.sections[i + 1]\n            nextSection.columns.push(column)\n            section.columns.pop()\n          },\n          condition: () => tab.sections[i + 1],\n        },\n        {\n          label: __('Move to previous section'),\n          icon: 'corner-up-left',\n          onClick: () => {\n            let previousSection = tab.sections[i - 1]\n            previousSection.columns.push(column)\n            section.columns.pop()\n          },\n          condition: () => tab.sections[i - 1],\n        },\n      ],\n    },\n  ]\n}\n\nwatch(\n  () => props.doctype,\n  () => fields.fetch(params.value),\n  { immediate: true },\n)\n</script>\n","<template>\n  <Dialog v-model=\"show\" :options=\"{ size: '4xl' }\">\n    <template #body-title>\n      <h3\n        class=\"flex items-center gap-2 text-2xl font-semibold leading-6 text-ink-gray-9\"\n      >\n        <div>{{ __('Edit Grid Row Fields Layout') }}</div>\n        <Badge\n          v-if=\"dirty\"\n          :label=\"__('Not Saved')\"\n          variant=\"subtle\"\n          theme=\"orange\"\n        />\n      </h3>\n    </template>\n    <template #body-content>\n      <div class=\"flex flex-col gap-3\">\n        <div class=\"flex justify-between gap-2\">\n          <Button\n            :label=\"preview ? __('Hide preview') : __('Show preview')\"\n            @click=\"preview = !preview\"\n          />\n          <div class=\"flex flex-row-reverse gap-2\">\n            <Button\n              :loading=\"loading\"\n              :label=\"__('Save')\"\n              variant=\"solid\"\n              @click=\"saveChanges\"\n            />\n            <Button :label=\"__('Reset')\" @click=\"reload\" />\n          </div>\n        </div>\n        <div v-if=\"tabs?.data\">\n          <FieldLayoutEditor\n            v-if=\"!preview\"\n            :tabs=\"tabs.data\"\n            :doctype=\"_doctype\"\n          />\n          <FieldLayout\n            v-else\n            :tabs=\"tabs.data\"\n            :data=\"{}\"\n            :preview=\"true\"\n          />\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n<script setup>\nimport FieldLayout from '@/components/FieldLayout/FieldLayout.vue'\nimport FieldLayoutEditor from '@/components/FieldLayoutEditor.vue'\nimport { useDebounceFn } from '@vueuse/core'\nimport { capture } from '@/telemetry'\nimport { Dialog, Badge, call, createResource } from 'frappe-ui'\nimport { ref, watch, onMounted, nextTick } from 'vue'\n\nconst props = defineProps({\n  doctype: {\n    type: String,\n    default: 'CRM Lead',\n  },\n  parentDoctype: {\n    type: String,\n    default: '',\n  },\n})\n\nconst emit = defineEmits(['reload'])\n\nconst show = defineModel()\nconst _doctype = ref(props.doctype)\nconst loading = ref(false)\nconst dirty = ref(false)\nconst preview = ref(false)\n\nfunction getParams() {\n  return {\n    doctype: _doctype.value,\n    type: 'Grid Row',\n    parent_doctype: props.parentDoctype,\n  }\n}\n\nconst tabs = createResource({\n  url: 'crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout',\n  cache: ['GridRowFieldsModal', _doctype.value, props.parentDoctype],\n  params: getParams(),\n  onSuccess(data) {\n    tabs.originalData = JSON.parse(JSON.stringify(data))\n  },\n})\n\nwatch(\n  () => tabs?.data,\n  () => {\n    dirty.value =\n      JSON.stringify(tabs?.data) !== JSON.stringify(tabs?.originalData)\n  },\n  { deep: true },\n)\n\nonMounted(() => useDebounceFn(reload, 100)())\n\nfunction reload() {\n  nextTick(() => {\n    tabs.params = getParams()\n    tabs.reload()\n  })\n}\n\nfunction saveChanges() {\n  let _tabs = JSON.parse(JSON.stringify(tabs.data))\n  _tabs.forEach((tab) => {\n    if (!tab.sections) return\n    tab.sections.forEach((section) => {\n      section.columns.forEach((column) => {\n        if (!column.fields) return\n        column.fields = column.fields.map((field) => field.fieldname)\n      })\n    })\n  })\n  loading.value = true\n  call(\n    'crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.save_fields_layout',\n    {\n      doctype: _doctype.value,\n      type: 'Grid Row',\n      layout: JSON.stringify(_tabs),\n    },\n  ).then(() => {\n    loading.value = false\n    show.value = false\n    capture('data_fields_layout_builder', { doctype: _doctype.value })\n    emit('reload')\n  })\n}\n</script>\n","<template>\n  <Dialog v-model=\"show\" :options=\"{ size: '4xl' }\">\n    <template #body>\n      <div class=\"bg-surface-modal px-4 pb-6 pt-5 sm:px-6\">\n        <div class=\"mb-5 flex items-center justify-between\">\n          <div>\n            <h3 class=\"text-2xl font-semibold leading-6 text-ink-gray-9\">\n              {{ __('Editing Row {0}', [index + 1]) }}\n            </h3>\n          </div>\n          <div class=\"flex items-center gap-1\">\n            <Button\n              v-if=\"isManager()\"\n              variant=\"ghost\"\n              class=\"w-7\"\n              @click=\"openGridRowFieldsModal\"\n            >\n              <EditIcon class=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" class=\"w-7\" @click=\"show = false\">\n              <FeatherIcon name=\"x\" class=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n        <div>\n          <FieldLayout\n            v-if=\"tabs.data\"\n            :tabs=\"tabs.data\"\n            :data=\"data\"\n            :doctype=\"doctype\"\n            :isGridRow=\"true\"\n          />\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport EditIcon from '@/components/Icons/EditIcon.vue'\nimport FieldLayout from '@/components/FieldLayout/FieldLayout.vue'\nimport { usersStore } from '@/stores/users'\nimport { createResource } from 'frappe-ui'\nimport { nextTick } from 'vue'\n\nconst props = defineProps({\n  index: Number,\n  data: Object,\n  doctype: String,\n  parentDoctype: String,\n})\n\nconst { isManager } = usersStore()\n\nconst show = defineModel()\nconst showGridRowFieldsModal = defineModel('showGridRowFieldsModal')\n\nconst tabs = createResource({\n  url: 'crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout',\n  cache: ['Grid Row', props.doctype, props.parentDoctype],\n  params: {\n    doctype: props.doctype,\n    type: 'Grid Row',\n    parent_doctype: props.parentDoctype,\n  },\n  auto: true,\n})\n\nfunction openGridRowFieldsModal() {\n  showGridRowFieldsModal.value = true\n  nextTick(() => (show.value = false))\n}\n</script>\n","import { ref } from 'vue'\n\nexport const showCreateDocumentModal = ref(false)\nexport const createDocumentDoctype = ref('')\nexport const createDocumentData = ref({})\nexport const createDocumentCallback = ref(null)\n\nexport function createDocument(doctype, obj, close, callback) {\n  if (doctype) {\n    close?.()\n    createDocumentDoctype.value = doctype\n    createDocumentData.value = obj || {}\n    createDocumentCallback.value = callback || null\n    showCreateDocumentModal.value = true\n  }\n}\n","<template>\n  <div class=\"flex flex-col flex-1 text-base\">\n    <div v-if=\"label\" class=\"mb-1.5 text-sm text-ink-gray-5\">\n      {{ __(label) }}\n    </div>\n\n    <div\n      v-if=\"fields?.length\"\n      class=\"rounded border border-outline-gray-modals\"\n    >\n      <!-- Header -->\n      <div\n        class=\"grid-header flex items-center rounded-t-[7px] bg-surface-gray-2 text-ink-gray-5 truncate\"\n      >\n        <div\n          class=\"inline-flex items-center justify-center border-r border-outline-gray-2 h-8 p-2 w-12\"\n        >\n          <Checkbox\n            class=\"cursor-pointer duration-300\"\n            :modelValue=\"allRowsSelected\"\n            @click.stop=\"toggleSelectAllRows($event.target.checked)\"\n          />\n        </div>\n        <div\n          class=\"inline-flex items-center justify-center border-r border-outline-gray-2 py-2 px-1 w-12\"\n        >\n          {{ __('No') }}\n        </div>\n        <div\n          class=\"grid w-full truncate\"\n          :style=\"{ gridTemplateColumns: gridTemplateColumns }\"\n        >\n          <div\n            v-for=\"field in fields\"\n            class=\"border-r border-outline-gray-2 p-2 truncate\"\n            :class=\"\n              ['Int', 'Float', 'Currency', 'Percent'].includes(field.fieldtype)\n                ? 'text-right'\n                : ''\n            \"\n            :key=\"field.fieldname\"\n            :title=\"field.label\"\n          >\n            {{ __(field.label) }}\n            <span\n              v-if=\"\n                field.reqd ||\n                (field.mandatory_depends_on && field.mandatory_via_depends_on)\n              \"\n              class=\"text-ink-red-2\"\n              >*</span\n            >\n          </div>\n        </div>\n        <div class=\"w-12\">\n          <Button\n            class=\"flex w-full items-center justify-center rounded !bg-surface-gray-2 border-0\"\n            variant=\"outline\"\n            @click=\"showGridFieldsEditorModal = true\"\n          >\n            <FeatherIcon name=\"settings\" class=\"h-4 w-4 text-ink-gray-7\" />\n          </Button>\n        </div>\n      </div>\n      <!-- Rows -->\n      <template v-if=\"rows?.length\">\n        <Draggable\n          class=\"w-full\"\n          v-model=\"rows\"\n          :delay=\"isTouchScreenDevice() ? 200 : 0\"\n          group=\"rows\"\n          item-key=\"name\"\n        >\n          <template #item=\"{ element: row, index }\">\n            <div\n              class=\"grid-row flex cursor-pointer items-center border-b border-outline-gray-modals bg-surface-modals last:rounded-b last:border-b-0\"\n              @click.stop=\"\n                () => {\n                  if (!gridSettings.editable_grid) {\n                    showRowList[index] = true\n                  }\n                }\n              \"\n            >\n              <div\n                class=\"grid-row-checkbox inline-flex h-9.5 items-center bg-surface-white justify-center border-r border-outline-gray-modals p-2 w-12\"\n              >\n                <Checkbox\n                  class=\"cursor-pointer duration-300\"\n                  :modelValue=\"selectedRows.has(row.name)\"\n                  @click.stop=\"toggleSelectRow(row)\"\n                />\n              </div>\n              <div\n                class=\"flex h-9.5 items-center justify-center bg-surface-white border-r border-outline-gray-modals py-2 px-1 text-sm text-ink-gray-8 w-12\"\n              >\n                {{ index + 1 }}\n              </div>\n              <div\n                class=\"grid w-full h-9.5\"\n                :style=\"{ gridTemplateColumns: gridTemplateColumns }\"\n              >\n                <div\n                  class=\"border-r border-outline-gray-modals h-full\"\n                  v-for=\"field in fields\"\n                  :key=\"field.fieldname\"\n                >\n                  <FormControl\n                    v-if=\"\n                      field.read_only &&\n                      ![\n                        'Int',\n                        'Float',\n                        'Currency',\n                        'Percent',\n                        'Check',\n                      ].includes(field.fieldtype)\n                    \"\n                    type=\"text\"\n                    :placeholder=\"field.placeholder\"\n                    v-model=\"row[field.fieldname]\"\n                    :disabled=\"true\"\n                  />\n                  <Link\n                    v-else-if=\"\n                      ['Link', 'Dynamic Link'].includes(field.fieldtype)\n                    \"\n                    class=\"text-sm text-ink-gray-8\"\n                    :value=\"row[field.fieldname]\"\n                    :doctype=\"\n                      field.fieldtype == 'Link'\n                        ? field.options\n                        : row[field.options]\n                    \"\n                    :filters=\"field.filters\"\n                    @change=\"(v) => fieldChange(v, field, row)\"\n                    :onCreate=\"\n                      (value, close) => field.create(v, field, row, close)\n                    \"\n                  />\n                  <Link\n                    v-else-if=\"field.fieldtype === 'User'\"\n                    class=\"form-control\"\n                    :value=\"getUser(row[field.fieldname]).full_name\"\n                    :doctype=\"field.options\"\n                    :filters=\"field.filters\"\n                    @change=\"(v) => fieldChange(v, field, row)\"\n                    :placeholder=\"field.placeholder\"\n                    :hideMe=\"true\"\n                  >\n                    <template #prefix>\n                      <UserAvatar\n                        class=\"mr-2\"\n                        :user=\"row[field.fieldname]\"\n                        size=\"sm\"\n                      />\n                    </template>\n                    <template #item-prefix=\"{ option }\">\n                      <UserAvatar class=\"mr-2\" :user=\"option.value\" size=\"sm\" />\n                    </template>\n                    <template #item-label=\"{ option }\">\n                      <Tooltip :text=\"option.value\">\n                        <div class=\"cursor-pointer\">\n                          {{ getUser(option.value).full_name }}\n                        </div>\n                      </Tooltip>\n                    </template>\n                  </Link>\n                  <div\n                    v-else-if=\"field.fieldtype === 'Check'\"\n                    class=\"flex h-full bg-surface-white justify-center items-center\"\n                  >\n                    <Checkbox\n                      class=\"cursor-pointer duration-300\"\n                      v-model=\"row[field.fieldname]\"\n                      :disabled=\"!gridSettings.editable_grid\"\n                      @change=\"(e) => fieldChange(e.target.checked, field, row)\"\n                    />\n                  </div>\n                  <DatePicker\n                    v-else-if=\"field.fieldtype === 'Date'\"\n                    :value=\"row[field.fieldname]\"\n                    icon-left=\"\"\n                    variant=\"outline\"\n                    :formatter=\"(date) => getFormat(date, '', true)\"\n                    input-class=\"border-none text-sm text-ink-gray-8\"\n                    @change=\"(v) => fieldChange(v, field, row)\"\n                  />\n                  <DateTimePicker\n                    v-else-if=\"field.fieldtype === 'Datetime'\"\n                    :value=\"row[field.fieldname]\"\n                    icon-left=\"\"\n                    variant=\"outline\"\n                    :formatter=\"(date) => getFormat(date, '', true, true)\"\n                    input-class=\"border-none text-sm text-ink-gray-8\"\n                    @change=\"(v) => fieldChange(v, field, row)\"\n                  />\n                  <FormControl\n                    v-else-if=\"\n                      ['Small Text', 'Text', 'Long Text', 'Code'].includes(\n                        field.fieldtype,\n                      )\n                    \"\n                    rows=\"1\"\n                    type=\"textarea\"\n                    variant=\"outline\"\n                    :value=\"row[field.fieldname]\"\n                    @change=\"fieldChange($event.target.value, field, row)\"\n                  />\n                  <FormControl\n                    v-else-if=\"field.fieldtype === 'Select'\"\n                    class=\"text-sm text-ink-gray-8\"\n                    type=\"select\"\n                    variant=\"outline\"\n                    v-model=\"row[field.fieldname]\"\n                    :options=\"field.options\"\n                    @change=\"(e) => fieldChange(e.target.value, field, row)\"\n                  />\n                  <Password\n                    v-else-if=\"field.fieldtype === 'Password'\"\n                    variant=\"outline\"\n                    :value=\"row[field.fieldname]\"\n                    :disabled=\"Boolean(field.read_only)\"\n                    @change=\"fieldChange($event.target.value, field, row)\"\n                  />\n                  <FormattedInput\n                    v-else-if=\"field.fieldtype === 'Int'\"\n                    class=\"[&_input]:text-right\"\n                    type=\"text\"\n                    variant=\"outline\"\n                    :value=\"row[field.fieldname] || '0'\"\n                    :disabled=\"Boolean(field.read_only)\"\n                    @change=\"fieldChange($event.target.value, field, row)\"\n                  />\n                  <FormattedInput\n                    v-else-if=\"field.fieldtype === 'Percent'\"\n                    class=\"[&_input]:text-right\"\n                    type=\"text\"\n                    variant=\"outline\"\n                    :value=\"getFloatWithPrecision(field.fieldname, row)\"\n                    :formattedValue=\"(row[field.fieldname] || '0') + '%'\"\n                    :disabled=\"Boolean(field.read_only)\"\n                    @change=\"fieldChange(flt($event.target.value), field, row)\"\n                  />\n                  <FormattedInput\n                    v-else-if=\"field.fieldtype === 'Float'\"\n                    class=\"[&_input]:text-right\"\n                    type=\"text\"\n                    variant=\"outline\"\n                    :value=\"getFloatWithPrecision(field.fieldname, row)\"\n                    :formattedValue=\"row[field.fieldname]\"\n                    :disabled=\"Boolean(field.read_only)\"\n                    @change=\"fieldChange(flt($event.target.value), field, row)\"\n                  />\n                  <FormattedInput\n                    v-else-if=\"field.fieldtype === 'Currency'\"\n                    class=\"[&_input]:text-right\"\n                    type=\"text\"\n                    variant=\"outline\"\n                    :value=\"getCurrencyWithPrecision(field.fieldname, row)\"\n                    :formattedValue=\"\n                      getFormattedCurrency(field.fieldname, row, parentDoc)\n                    \"\n                    :disabled=\"Boolean(field.read_only)\"\n                    @change=\"fieldChange(flt($event.target.value), field, row)\"\n                  />\n                  <FormControl\n                    v-else\n                    class=\"text-sm text-ink-gray-8\"\n                    type=\"text\"\n                    variant=\"outline\"\n                    v-model=\"row[field.fieldname]\"\n                    :options=\"field.options\"\n                    @change=\"fieldChange($event.target.value, field, row)\"\n                  />\n                </div>\n              </div>\n              <div class=\"edit-row w-12\">\n                <Button\n                  class=\"flex w-full items-center justify-center rounded border-0\"\n                  variant=\"outline\"\n                  @click=\"showRowList[index] = true\"\n                >\n                  <EditIcon class=\"h-4 w-4 text-ink-gray-7\" />\n                </Button>\n              </div>\n              <GridRowModal\n                v-if=\"showRowList[index]\"\n                v-model=\"showRowList[index]\"\n                v-model:showGridRowFieldsModal=\"showGridRowFieldsModal\"\n                :index=\"index\"\n                :data=\"row\"\n                :doctype=\"doctype\"\n                :parentDoctype=\"parentDoctype\"\n              />\n            </div>\n          </template>\n        </Draggable>\n      </template>\n\n      <div\n        v-else\n        class=\"flex flex-col items-center rounded p-5 text-sm text-ink-gray-5\"\n      >\n        {{ __('No Data') }}\n      </div>\n    </div>\n\n    <div v-if=\"fields?.length\" class=\"mt-2 flex flex-row gap-2\">\n      <Button\n        v-if=\"showDeleteBtn\"\n        :label=\"__('Delete')\"\n        variant=\"solid\"\n        theme=\"red\"\n        @click=\"deleteRows\"\n      />\n      <Button :label=\"__('Add Row')\" @click=\"addRow\" />\n    </div>\n    <GridRowFieldsModal\n      v-if=\"showGridRowFieldsModal\"\n      v-model=\"showGridRowFieldsModal\"\n      :doctype=\"doctype\"\n      :parentDoctype=\"parentDoctype\"\n    />\n    <GridFieldsEditorModal\n      v-if=\"showGridFieldsEditorModal\"\n      v-model=\"showGridFieldsEditorModal\"\n      :doctype=\"doctype\"\n      :parentDoctype=\"parentDoctype\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport Password from '@/components/Controls/Password.vue'\nimport FormattedInput from '@/components/Controls/FormattedInput.vue'\nimport GridFieldsEditorModal from '@/components/Controls/GridFieldsEditorModal.vue'\nimport GridRowFieldsModal from '@/components/Controls/GridRowFieldsModal.vue'\nimport GridRowModal from '@/components/Controls/GridRowModal.vue'\nimport EditIcon from '@/components/Icons/EditIcon.vue'\nimport Link from '@/components/Controls/Link.vue'\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport { getRandom, getFormat, isTouchScreenDevice } from '@/utils'\nimport { flt } from '@/utils/numberFormat.js'\nimport { usersStore } from '@/stores/users'\nimport { getMeta } from '@/stores/meta'\nimport { createDocument } from '@/composables/document'\nimport {\n  FeatherIcon,\n  FormControl,\n  Checkbox,\n  DateTimePicker,\n  DatePicker,\n  Tooltip,\n  dayjs,\n} from 'frappe-ui'\nimport Draggable from 'vuedraggable'\nimport { ref, reactive, computed, inject, provide } from 'vue'\n\nconst props = defineProps({\n  label: {\n    type: String,\n    default: '',\n  },\n  doctype: {\n    type: String,\n    required: true,\n  },\n  parentDoctype: {\n    type: String,\n    required: true,\n  },\n  parentFieldname: {\n    type: String,\n    required: true,\n  },\n})\n\nconst triggerOnChange = inject('triggerOnChange')\nconst triggerOnRowAdd = inject('triggerOnRowAdd')\nconst triggerOnRowRemove = inject('triggerOnRowRemove')\n\nconst {\n  getGridViewSettings,\n  getFields,\n  getFloatWithPrecision,\n  getCurrencyWithPrecision,\n  getFormattedCurrency,\n  getGridSettings,\n} = getMeta(props.doctype)\ngetMeta(props.parentDoctype)\nconst { getUser } = usersStore()\n\nconst rows = defineModel()\nconst parentDoc = defineModel('parent')\n\nprovide('parentDoc', parentDoc)\n\nconst showRowList = ref(new Array(rows.value?.length || []).fill(false))\nconst selectedRows = reactive(new Set())\n\nconst showGridFieldsEditorModal = ref(false)\nconst showGridRowFieldsModal = ref(false)\n\nconst gridSettings = computed(() => getGridSettings())\n\nconst fields = computed(() => {\n  let gridViewSettings = getGridViewSettings(props.parentDoctype)\n  let gridFields = getFields()\n  if (gridViewSettings.length) {\n    let d = gridViewSettings.map((gs) =>\n      getFieldObj(gridFields.find((f) => f.fieldname === gs.fieldname)),\n    )\n    return d\n  }\n  return (\n    gridFields?.filter((f) => f.in_list_view).map((f) => getFieldObj(f)) || []\n  )\n})\n\nconst allFields = computed(() => {\n  return getFields()?.map((f) => getFieldObj(f)) || []\n})\n\nfunction getFieldObj(field) {\n  if (field.fieldtype === 'Link' && field.options !== 'User') {\n    if (!field.create) {\n      field.create = (value, field, row, close) => {\n        const callback = (d) => {\n          if (d) fieldChange(d.name, field, row)\n        }\n        createDocument(field.options, value, close, callback)\n      }\n    }\n  }\n\n  return {\n    ...field,\n    filters: field.link_filters && JSON.parse(field.link_filters),\n    placeholder: field.placeholder || field.label,\n  }\n}\n\nconst gridTemplateColumns = computed(() => {\n  if (!fields.value?.length) return '1fr'\n  // for the checkbox & sr no. columns\n  let gridViewSettings = getGridViewSettings(props.parentDoctype)\n  if (gridViewSettings.length) {\n    return gridViewSettings\n      .map((gs) => `minmax(0, ${gs.columns || 2}fr)`)\n      .join(' ')\n  }\n  return fields.value.map(() => `minmax(0, 2fr)`).join(' ')\n})\n\nconst allRowsSelected = computed(() => {\n  if (!rows.value?.length) return false\n  return rows.value.length === selectedRows.size\n})\n\nconst showDeleteBtn = computed(() => selectedRows.size > 0)\n\nconst toggleSelectAllRows = (iSelected) => {\n  if (iSelected) {\n    rows.value?.forEach((row) => selectedRows.add(row.name))\n  } else {\n    selectedRows.clear()\n  }\n}\n\nconst toggleSelectRow = (row) => {\n  if (selectedRows.has(row.name)) {\n    selectedRows.delete(row.name)\n  } else {\n    selectedRows.add(row.name)\n  }\n}\n\nconst addRow = () => {\n  const newRow = {}\n  allFields.value?.forEach((field) => {\n    if (field.fieldtype === 'Check') {\n      newRow[field.fieldname] = false\n    } else {\n      newRow[field.fieldname] = ''\n    }\n\n    if (field.default) {\n      newRow[field.fieldname] = getDefaultValue(field.default, field.fieldtype)\n    }\n  })\n  newRow.name = getRandom(10)\n  showRowList.value.push(false)\n  newRow['__islocal'] = true\n  newRow['idx'] = rows.value.length + 1\n  newRow['doctype'] = props.doctype\n  newRow['parentfield'] = props.parentFieldname\n  newRow['parenttype'] = props.parentDoctype\n  rows.value.push(newRow)\n  triggerOnRowAdd(newRow)\n}\n\nconst deleteRows = () => {\n  rows.value = rows.value.filter((row) => !selectedRows.has(row.name))\n  triggerOnRowRemove(selectedRows, rows.value)\n\n  showRowList.value.pop()\n  selectedRows.clear()\n}\n\nfunction fieldChange(value, field, row) {\n  row[field.fieldname] = value\n  triggerOnChange(field.fieldname, row)\n}\n\nfunction getDefaultValue(defaultValue, fieldtype) {\n  if (['Float', 'Currency', 'Percent'].includes(fieldtype)) {\n    return flt(defaultValue)\n  } else if (fieldtype === 'Check') {\n    if (['1', 'true', 'True'].includes(defaultValue)) {\n      return true\n    } else if (['0', 'false', 'False'].includes(defaultValue)) {\n      return false\n    }\n  } else if (fieldtype === 'Int') {\n    return parseInt(defaultValue)\n  } else if (defaultValue === 'Today' && fieldtype === 'Date') {\n    return dayjs().format('YYYY-MM-DD')\n  } else if (\n    ['Now', 'now'].includes(defaultValue) &&\n    fieldtype === 'Datetime'\n  ) {\n    return dayjs().format('YYYY-MM-DD HH:mm:ss')\n  } else if (['Now', 'now'].includes(defaultValue) && fieldtype === 'Time') {\n    return dayjs().format('HH:mm:ss')\n  } else if (fieldtype === 'Date') {\n    return dayjs(defaultValue).format('YYYY-MM-DD')\n  } else if (fieldtype === 'Datetime') {\n    return dayjs(defaultValue).format('YYYY-MM-DD HH:mm:ss')\n  } else if (fieldtype === 'Time') {\n    return dayjs(defaultValue).format('HH:mm:ss')\n  }\n\n  return defaultValue\n}\n</script>\n\n<style scoped>\n/* For Input fields */\n:deep(.grid-row input:not([type='checkbox'])),\n:deep(.grid-row textarea) {\n  border: none;\n  border-radius: 0;\n  height: 38px;\n}\n\n:deep(.grid-row input:focus),\n:deep(.grid-row input:hover),\n:deep(.grid-row textarea:focus),\n:deep(.grid-row textarea:hover) {\n  box-shadow: none;\n}\n\n:deep(.grid-row input:focus-within) :deep(.grid-row textarea:focus-within) {\n  border: 1px solid var(--outline-gray-2);\n}\n\n/* For select field */\n:deep(.grid-row select) {\n  border: none;\n  border-radius: 0;\n  height: 38px;\n}\n\n/* For Autocomplete */\n:deep(.grid-row button) {\n  border: none;\n  border-radius: 0;\n  background-color: var(--surface-white);\n  height: 38px;\n}\n\n:deep(.grid-row:last-child .grid-row-checkbox) {\n  border-bottom-left-radius: 7px;\n}\n\n:deep(.grid-row .edit-row button) {\n  border-bottom-right-radius: 7px;\n}\n\n:deep(.grid-row button:focus) :deep(.grid-row button:hover) {\n  box-shadow: none;\n  background-color: var(--surface-white);\n}\n\n:deep(.grid-row button:focus-within) {\n  border: 1px solid var(--outline-gray-2);\n}\n</style>\n","import { globalStore } from '@/stores/global'\nimport { getMeta } from '@/stores/meta'\nimport { call, createListResource, toast } from 'frappe-ui'\nimport { reactive } from 'vue'\nimport router from '@/router'\n\nconst doctypeScripts = reactive({})\n\nexport function getScript(doctype, view = 'Form') {\n  const scripts = createListResource({\n    doctype: 'CRM Form Script',\n    cache: ['Form Scripts', doctype, view],\n    fields: ['name', 'dt', 'view', 'script'],\n    filters: { view, dt: doctype, enabled: 1 },\n    onSuccess: (_scripts) => {\n      for (let script of _scripts) {\n        if (!doctypeScripts[doctype]) {\n          doctypeScripts[doctype] = {}\n        }\n        doctypeScripts[doctype][script.name] = script || {}\n      }\n    },\n    onError: (err) => {\n      console.error(\n        `Error loading CRM Form Scripts for ${doctype} (view: ${view}):`,\n        err,\n      )\n    },\n  })\n\n  if (!doctypeScripts[doctype] && !scripts.loading) {\n    scripts.fetch()\n  }\n\n  async function setupScript(document, helpers = {}) {\n    await scripts.promise\n\n    let scriptDefs = doctypeScripts[doctype]\n    if (!scriptDefs || Object.keys(scriptDefs).length === 0) return null\n\n    const { $dialog, $socket, makeCall } = globalStore()\n\n    helpers.createDialog = $dialog\n    helpers.toast = toast\n    helpers.socket = $socket\n    helpers.router = router\n    helpers.call = call\n\n    helpers.crm = {\n      makePhoneCall: makeCall,\n    }\n\n    return setupMultipleFormControllers(scriptDefs, document, helpers)\n  }\n\n  function setupMultipleFormControllers(scriptStrings, document, helpers) {\n    const controllers = []\n    let parentInstanceIdx = null\n\n    for (let scriptName in scriptStrings) {\n      let script = scriptStrings[scriptName]?.script\n      if (!script) continue\n      try {\n        const classNames = getClassNames(script)\n        if (!classNames) continue\n\n        classNames.forEach((className) => {\n          const FormClass = evaluateFormClass(script, className, helpers)\n          if (!FormClass) return\n\n          let parentInstance = null\n          let doctypeName = doctype.replace(/\\s+/g, '')\n\n          let { doctypeMeta } = getMeta(doctype)\n\n          // if className is not doctype name, then it is a child doctype\n          let isChildDoctype = className !== doctypeName\n\n          if (isChildDoctype) {\n            if (!controllers.length) {\n              console.error(\n                __(\n                  ' No class found for doctype: {0}, it is mandatory to have a class for the parent doctype. it can be empty, but it should be present.',\n                  [doctype],\n                ),\n              )\n              return\n            }\n            parentInstance = controllers[parentInstanceIdx]\n          } else {\n            parentInstanceIdx = controllers.length || 0\n          }\n\n          const instance = setupFormController(\n            FormClass,\n            doctypeMeta,\n            document,\n            parentInstance,\n            isChildDoctype,\n          )\n\n          controllers.push(instance)\n        })\n      } catch (err) {\n        console.error(__('Failed to load form controller: {0}', [err]))\n      }\n    }\n\n    return controllers\n  }\n\n  function setupFormController(\n    FormClass,\n    meta,\n    document,\n    parentInstance = null,\n    isChildDoctype = false,\n  ) {\n    let instance = new FormClass()\n\n    instance._isChildDoctype = isChildDoctype\n\n    for (const key in document) {\n      if (document.hasOwnProperty(key)) {\n        instance[key] = document[key]\n      }\n    }\n\n    instance.getMeta = async (doctype) => {\n      if (!meta[doctype]) {\n        await getMeta(doctype)\n        return meta[doctype]\n      }\n      return meta[doctype]\n    }\n\n    const getDoc = () => document.doc\n\n    if (isChildDoctype) {\n      instance.doc = createDocProxy(getDoc, parentInstance, instance)\n\n      if (!parentInstance._childInstances) {\n        parentInstance._childInstances = []\n      }\n\n      parentInstance._childInstances.push(instance)\n    } else {\n      instance.doc = createDocProxy(getDoc, instance)\n    }\n\n    return instance\n  }\n\n  function setupHelperMethods(FormClass) {\n    if (typeof FormClass.prototype.getRow !== 'function') {\n      FormClass.prototype.getRow = function (parentField, idx) {\n        idx = idx || this.currentRowIdx\n\n        let dt = null\n\n        if (this instanceof Array) {\n          const { getFields } = getMeta(this.doc.doctype)\n          let fields = getFields()\n          let field = fields.find((f) => f.fieldname === parentField)\n          dt = field?.options?.replace(/\\s+/g, '')\n\n          if (!idx && dt) {\n            idx = this.find((r) => r.constructor.name === dt)?.currentRowIdx\n          }\n        }\n\n        if (!this.doc[parentField]) {\n          console.warn(\n            __(' No data found for parent field: {0}', [parentField]),\n          )\n          return null\n        }\n        const row = this.doc[parentField].find((r) => r.idx === idx)\n\n        if (!row) {\n          console.warn(\n            __(' No row found for idx: {0} in parent field: {1}', [\n              idx,\n              parentField,\n            ]),\n          )\n          return null\n        }\n\n        row.parent = row.parent || this.doc.name\n\n        if (this instanceof Array && dt) {\n          return createDocProxy(\n            row,\n            this.find((r) => r.constructor.name === dt),\n          )\n        }\n\n        return createDocProxy(row, this)\n      }\n    }\n  }\n\n  // utility function to setup a form controller\n  function getClassNames(script) {\n    const withoutComments = script\n      .replace(/\\/\\/.*$/gm, '') // Remove single-line comments\n      .replace(/\\/\\*[\\s\\S]*?\\*\\//g, '') // Remove multi-line comments\n\n    // Match class declarations\n    return (\n      [...withoutComments.matchAll(/class\\s+([A-Za-z0-9_]+)/g)].map(\n        (match) => match[1],\n      ) || []\n    )\n  }\n\n  function evaluateFormClass(script, className, helpers = {}) {\n    const helperKeys = Object.keys(helpers)\n    const helperValues = Object.values(helpers)\n\n    const wrappedScript = `\n\t\t${script}\n\t\treturn ${className};\n\t`\n\n    const FormClass = new Function(...helperKeys, wrappedScript)(\n      ...helperValues,\n    )\n\n    setupHelperMethods(FormClass)\n\n    return FormClass\n  }\n\n  function createDocProxy(source, instance, childInstance = null) {\n    const isFunction = typeof source === 'function'\n    const getCurrentData = () => (isFunction ? source() : source)\n\n    return new Proxy(\n      {},\n      {\n        get(target, prop) {\n          const currentDocData = getCurrentData()\n          if (!currentDocData) return undefined\n\n          if (prop === 'trigger') {\n            if (currentDocData && 'trigger' in currentDocData) {\n              console.warn(\n                __(\n                  ' Avoid using \"trigger\" as a field name  it conflicts with the built-in trigger() method.',\n                ),\n              )\n            }\n\n            return (methodName, ...args) => {\n              const method = instance[methodName]\n              if (typeof method === 'function') {\n                return method.apply(instance, args)\n              } else {\n                console.warn(\n                  __(' Method \"{0}\" not found in class.', [methodName]),\n                )\n              }\n            }\n          }\n\n          if (prop === 'getRow') {\n            return instance.getRow.bind(\n              childInstance || instance._childInstances || instance,\n            )\n          }\n\n          return currentDocData[prop]\n        },\n        set(target, prop, value) {\n          const currentDocData = getCurrentData()\n          if (!currentDocData) return false\n\n          currentDocData[prop] = value\n          return true\n        },\n        has(target, prop) {\n          const currentDocData = getCurrentData()\n          if (!currentDocData) return false\n          return prop in currentDocData\n        },\n        ownKeys(target) {\n          const currentDocData = getCurrentData()\n          if (!currentDocData) return []\n          return Reflect.ownKeys(currentDocData)\n        },\n        getOwnPropertyDescriptor(target, prop) {\n          const currentDocData = getCurrentData()\n          if (!currentDocData) return undefined\n          return Reflect.getOwnPropertyDescriptor(currentDocData, prop)\n        },\n      },\n    )\n  }\n\n  return {\n    scripts,\n    setupScript,\n    setupFormController,\n  }\n}\n","import { getScript } from '@/data/script'\nimport { runSequentially } from '@/utils'\nimport { createDocumentResource, toast } from 'frappe-ui'\n\nconst documentsCache = {}\nconst controllersCache = {}\n\nexport function useDocument(doctype, docname) {\n  const { setupScript } = getScript(doctype)\n\n  documentsCache[doctype] = documentsCache[doctype] || {}\n\n  if (!documentsCache[doctype][docname]) {\n    documentsCache[doctype][docname] = createDocumentResource({\n      doctype: doctype,\n      name: docname,\n      onSuccess: async () => await setupFormScript(),\n      setValue: {\n        onSuccess: () => {\n          toast.success(__('Document updated successfully'))\n        },\n        onError: (err) => {\n          toast.error(__('Error updating document'))\n          console.error(err)\n        },\n      },\n    })\n  }\n\n  async function setupFormScript() {\n    if (\n      controllersCache[doctype] &&\n      typeof controllersCache[doctype][docname] === 'object'\n    ) {\n      return\n    }\n\n    if (!controllersCache[doctype]) {\n      controllersCache[doctype] = {}\n    }\n\n    controllersCache[doctype][docname] = {}\n\n    const controllersArray = await setupScript(documentsCache[doctype][docname])\n\n    if (!controllersArray || controllersArray.length === 0) return\n\n    const organizedControllers = {}\n    for (const controller of controllersArray) {\n      const controllerKey = controller.constructor.name // e.g., \"CRMLead\", \"CRMProducts\"\n      if (!organizedControllers[controllerKey]) {\n        organizedControllers[controllerKey] = []\n      }\n      organizedControllers[controllerKey].push(controller)\n    }\n    controllersCache[doctype][docname] = organizedControllers\n  }\n\n  function getControllers(row = null) {\n    const _doctype = row?.doctype || doctype\n    const controllerKey = _doctype.replace(/\\s+/g, '')\n\n    const docControllers = controllersCache[doctype]?.[docname]\n\n    if (\n      typeof docControllers === 'object' &&\n      docControllers !== null &&\n      !Array.isArray(docControllers)\n    ) {\n      return docControllers[controllerKey] || []\n    }\n    return []\n  }\n\n  async function triggerOnRefresh() {\n    const handler = async function () {\n      await this.refresh()\n    }\n    await trigger(handler)\n  }\n\n  async function triggerOnChange(fieldname, row) {\n    const handler = async function () {\n      if (row) {\n        this.currentRowIdx = row.idx\n        this.value = row[fieldname]\n        this.oldValue = getOldValue(fieldname, row)\n      } else {\n        this.value = documentsCache[doctype][docname].doc[fieldname]\n        this.oldValue = getOldValue(fieldname)\n      }\n      await this[fieldname]?.()\n    }\n\n    await trigger(handler, row)\n  }\n\n  async function triggerOnRowAdd(row) {\n    const handler = async function () {\n      this.currentRowIdx = row.idx\n      this.value = row\n      await this[row.parentfield + '_add']?.()\n    }\n\n    await trigger(handler, row)\n  }\n\n  async function triggerOnRowRemove(selectedRows, rows) {\n    const handler = async function () {\n      if (selectedRows.size === 1) {\n        const selectedRow = Array.from(selectedRows)[0]\n        this.currentRowIdx = rows.find((r) => r.name === selectedRow).idx\n      } else {\n        delete this.currentRowIdx\n      }\n\n      this.selectedRows = Array.from(selectedRows)\n      this.rows = rows\n\n      await this[rows[0].parentfield + '_remove']?.()\n    }\n\n    await trigger(handler, rows[0])\n  }\n\n  async function triggerOnCreateLead() {\n    const args = Array.from(arguments)\n    const handler = async function () {\n      await this.on_create_lead?.(...args)\n    }\n    await trigger(handler)\n  }\n\n  async function triggerConvertToDeal() {\n    const args = Array.from(arguments)\n    const handler = async function () {\n      await this.convert_to_deal?.(...args)\n    }\n    await trigger(handler)\n  }\n\n  async function trigger(taskFn, row = null) {\n    const controllers = getControllers(row)\n    if (!controllers.length) return\n\n    const tasks = controllers.map(\n      (controller) => async () => await taskFn.call(controller),\n    )\n\n    await runSequentially(tasks)\n  }\n\n  function getOldValue(fieldname, row) {\n    if (!documentsCache[doctype][docname]) return ''\n\n    const document = documentsCache[doctype][docname]\n    const oldDoc = document.originalDoc\n\n    if (row?.name) {\n      return oldDoc?.[row.parentfield]?.find((r) => r.name === row.name)?.[\n        fieldname\n      ]\n    }\n\n    return oldDoc?.[fieldname] || document.doc[fieldname]\n  }\n\n  return {\n    document: documentsCache[doctype][docname],\n    triggerOnChange,\n    triggerOnRowAdd,\n    triggerOnRowRemove,\n    triggerOnRefresh,\n    setupFormScript,\n    triggerOnCreateLead,\n    triggerConvertToDeal,\n  }\n}\n","<template>\n  <div v-if=\"field.visible\" class=\"field\">\n    <div v-if=\"field.fieldtype != 'Check'\" class=\"mb-2 text-sm text-ink-gray-5\">\n      {{ __(field.label) }}\n      <span\n        v-if=\"\n          field.reqd ||\n          (field.mandatory_depends_on && field.mandatory_via_depends_on)\n        \"\n        class=\"text-ink-red-2\"\n        >*</span\n      >\n    </div>\n    <FormControl\n      v-if=\"\n        field.read_only &&\n        !['Int', 'Float', 'Currency', 'Percent', 'Check'].includes(\n          field.fieldtype,\n        )\n      \"\n      type=\"text\"\n      :placeholder=\"getPlaceholder(field)\"\n      v-model=\"data[field.fieldname]\"\n      :disabled=\"true\"\n      :description=\"field.description\"\n    />\n    <Grid\n      v-else-if=\"field.fieldtype === 'Table'\"\n      v-model=\"data[field.fieldname]\"\n      v-model:parent=\"data\"\n      :doctype=\"field.options\"\n      :parentDoctype=\"doctype\"\n      :parentFieldname=\"field.fieldname\"\n    />\n    <FormControl\n      v-else-if=\"field.fieldtype === 'Select'\"\n      type=\"select\"\n      class=\"form-control\"\n      :class=\"field.prefix ? 'prefix' : ''\"\n      :options=\"field.options\"\n      v-model=\"data[field.fieldname]\"\n      @change=\"(e) => fieldChange(e.target.value, field)\"\n      :placeholder=\"getPlaceholder(field)\"\n      :description=\"field.description\"\n    >\n      <template v-if=\"field.prefix\" #prefix>\n        <IndicatorIcon :class=\"field.prefix\" />\n      </template>\n    </FormControl>\n    <div v-else-if=\"field.fieldtype == 'Check'\" class=\"flex items-center gap-2\">\n      <FormControl\n        class=\"form-control\"\n        type=\"checkbox\"\n        v-model=\"data[field.fieldname]\"\n        @change=\"(e) => fieldChange(e.target.checked, field)\"\n        :disabled=\"Boolean(field.read_only)\"\n        :description=\"field.description\"\n      />\n      <label\n        class=\"text-sm text-ink-gray-5\"\n        @click=\"\n          () => {\n            if (!Boolean(field.read_only)) {\n              data[field.fieldname] = !data[field.fieldname]\n            }\n          }\n        \"\n      >\n        {{ __(field.label) }}\n        <span class=\"text-ink-red-3\" v-if=\"field.mandatory\">*</span>\n      </label>\n    </div>\n    <div\n      class=\"flex gap-1\"\n      v-else-if=\"['Link', 'Dynamic Link'].includes(field.fieldtype)\"\n    >\n      <Link\n        class=\"form-control flex-1 truncate\"\n        :value=\"data[field.fieldname]\"\n        :doctype=\"\n          field.fieldtype == 'Link' ? field.options : data[field.options]\n        \"\n        :filters=\"field.filters\"\n        @change=\"(v) => fieldChange(v, field)\"\n        :placeholder=\"getPlaceholder(field)\"\n        :onCreate=\"field.create\"\n      />\n      <Button\n        v-if=\"data[field.fieldname] && field.edit\"\n        class=\"shrink-0\"\n        :label=\"__('Edit')\"\n        @click=\"field.edit(data[field.fieldname])\"\n      >\n        <template #prefix>\n          <EditIcon class=\"h-4 w-4\" />\n        </template>\n      </Button>\n    </div>\n\n    <TableMultiselectInput\n      v-else-if=\"field.fieldtype === 'Table MultiSelect'\"\n      v-model=\"data[field.fieldname]\"\n      :doctype=\"field.options\"\n      @change=\"(v) => fieldChange(v, field)\"\n    />\n\n    <Link\n      v-else-if=\"field.fieldtype === 'User'\"\n      class=\"form-control\"\n      :value=\"data[field.fieldname] && getUser(data[field.fieldname]).full_name\"\n      :doctype=\"field.options\"\n      :filters=\"field.filters\"\n      @change=\"(v) => fieldChange(v, field)\"\n      :placeholder=\"getPlaceholder(field)\"\n      :hideMe=\"true\"\n    >\n      <template #prefix>\n        <UserAvatar\n          v-if=\"data[field.fieldname]\"\n          class=\"mr-2\"\n          :user=\"data[field.fieldname]\"\n          size=\"sm\"\n        />\n      </template>\n      <template #item-prefix=\"{ option }\">\n        <UserAvatar class=\"mr-2\" :user=\"option.value\" size=\"sm\" />\n      </template>\n      <template #item-label=\"{ option }\">\n        <Tooltip :text=\"option.value\">\n          <div class=\"cursor-pointer\">\n            {{ getUser(option.value).full_name }}\n          </div>\n        </Tooltip>\n      </template>\n    </Link>\n    <DateTimePicker\n      v-else-if=\"field.fieldtype === 'Datetime'\"\n      :value=\"data[field.fieldname]\"\n      :formatter=\"(date) => getFormat(date, '', true, true)\"\n      :placeholder=\"getPlaceholder(field)\"\n      input-class=\"border-none\"\n      @change=\"(v) => fieldChange(v, field)\"\n    />\n    <DatePicker\n      v-else-if=\"field.fieldtype === 'Date'\"\n      :value=\"data[field.fieldname]\"\n      :formatter=\"(date) => getFormat(date, '', true)\"\n      :placeholder=\"getPlaceholder(field)\"\n      input-class=\"border-none\"\n      @change=\"(v) => fieldChange(v, field)\"\n    />\n    <FormControl\n      v-else-if=\"\n        ['Small Text', 'Text', 'Long Text', 'Code'].includes(field.fieldtype)\n      \"\n      type=\"textarea\"\n      :value=\"data[field.fieldname]\"\n      :placeholder=\"getPlaceholder(field)\"\n      :description=\"field.description\"\n      @change=\"fieldChange($event.target.value, field)\"\n    />\n    <Password\n      v-else-if=\"field.fieldtype === 'Password'\"\n      :value=\"data[field.fieldname]\"\n      :placeholder=\"getPlaceholder(field)\"\n      :description=\"field.description\"\n      @change=\"fieldChange($event.target.value, field)\"\n    />\n    <FormattedInput\n      v-else-if=\"field.fieldtype === 'Int'\"\n      type=\"text\"\n      :placeholder=\"getPlaceholder(field)\"\n      :value=\"data[field.fieldname] || '0'\"\n      :disabled=\"Boolean(field.read_only)\"\n      :description=\"field.description\"\n      @change=\"fieldChange($event.target.value, field)\"\n    />\n    <FormattedInput\n      v-else-if=\"field.fieldtype === 'Percent'\"\n      type=\"text\"\n      :value=\"getFormattedPercent(field.fieldname, data)\"\n      :placeholder=\"getPlaceholder(field)\"\n      :disabled=\"Boolean(field.read_only)\"\n      :description=\"field.description\"\n      @change=\"fieldChange(flt($event.target.value), field)\"\n    />\n    <FormattedInput\n      v-else-if=\"field.fieldtype === 'Float'\"\n      type=\"text\"\n      :value=\"getFormattedFloat(field.fieldname, data)\"\n      :placeholder=\"getPlaceholder(field)\"\n      :disabled=\"Boolean(field.read_only)\"\n      :description=\"field.description\"\n      @change=\"fieldChange(flt($event.target.value), field)\"\n    />\n    <FormattedInput\n      v-else-if=\"field.fieldtype === 'Currency'\"\n      type=\"text\"\n      :value=\"getFormattedCurrency(field.fieldname, data, parentDoc)\"\n      :placeholder=\"getPlaceholder(field)\"\n      :disabled=\"Boolean(field.read_only)\"\n      :description=\"field.description\"\n      @change=\"fieldChange(flt($event.target.value), field)\"\n    />\n    <FormControl\n      v-else\n      type=\"text\"\n      :placeholder=\"getPlaceholder(field)\"\n      :value=\"getDataValue(data[field.fieldname], field)\"\n      :disabled=\"Boolean(field.read_only)\"\n      :description=\"field.description\"\n      @change=\"fieldChange($event.target.value, field)\"\n    />\n  </div>\n</template>\n<script setup>\nimport Password from '@/components/Controls/Password.vue'\nimport FormattedInput from '@/components/Controls/FormattedInput.vue'\nimport EditIcon from '@/components/Icons/EditIcon.vue'\nimport IndicatorIcon from '@/components/Icons/IndicatorIcon.vue'\nimport UserAvatar from '@/components/UserAvatar.vue'\nimport TableMultiselectInput from '@/components/Controls/TableMultiselectInput.vue'\nimport Link from '@/components/Controls/Link.vue'\nimport Grid from '@/components/Controls/Grid.vue'\nimport { createDocument } from '@/composables/document'\nimport { getFormat, evaluateDependsOnValue } from '@/utils'\nimport { flt } from '@/utils/numberFormat.js'\nimport { getMeta } from '@/stores/meta'\nimport { usersStore } from '@/stores/users'\nimport { useDocument } from '@/data/document'\nimport { Tooltip, DatePicker, DateTimePicker } from 'frappe-ui'\nimport { computed, provide, inject } from 'vue'\n\nconst props = defineProps({\n  field: Object,\n})\n\nconst data = inject('data')\nconst doctype = inject('doctype')\nconst preview = inject('preview')\nconst isGridRow = inject('isGridRow')\n\nconst { getFormattedPercent, getFormattedFloat, getFormattedCurrency } =\n  getMeta(doctype)\n\nconst { getUser } = usersStore()\n\nlet triggerOnChange\nlet parentDoc\n\nif (!isGridRow) {\n  const {\n    triggerOnChange: trigger,\n    triggerOnRowAdd,\n    triggerOnRowRemove,\n  } = useDocument(doctype, data.value.name)\n  triggerOnChange = trigger\n\n  provide('triggerOnChange', triggerOnChange)\n  provide('triggerOnRowAdd', triggerOnRowAdd)\n  provide('triggerOnRowRemove', triggerOnRowRemove)\n} else {\n  triggerOnChange = inject('triggerOnChange')\n  parentDoc = inject('parentDoc')\n}\n\nconst field = computed(() => {\n  let field = props.field\n  if (field.fieldtype == 'Select' && typeof field.options === 'string') {\n    field.options = field.options.split('\\n').map((option) => {\n      return { label: option, value: option }\n    })\n\n    if (field.options[0].value !== '') {\n      field.options.unshift({ label: '', value: '' })\n    }\n  }\n\n  if (field.fieldtype === 'Link' && field.options === 'User') {\n    field.fieldtype = 'User'\n  }\n\n  if (field.fieldtype === 'Link' && field.options !== 'User') {\n    if (!field.create) {\n      field.create = (value, close) => {\n        const callback = (d) => {\n          if (d) fieldChange(d.name, field)\n        }\n        createDocument(field.options, value, close, callback)\n      }\n    }\n  }\n\n  let _field = {\n    ...field,\n    filters: field.link_filters && JSON.parse(field.link_filters),\n    placeholder: field.placeholder || field.label,\n    display_via_depends_on: evaluateDependsOnValue(\n      field.depends_on,\n      data.value,\n    ),\n    mandatory_via_depends_on: evaluateDependsOnValue(\n      field.mandatory_depends_on,\n      data.value,\n    ),\n  }\n\n  _field.visible = isFieldVisible(_field)\n  return _field\n})\n\nfunction isFieldVisible(field) {\n  if (preview.value) return true\n  return (\n    (field.fieldtype == 'Check' ||\n      (field.read_only && data.value[field.fieldname]) ||\n      !field.read_only) &&\n    (!field.depends_on || field.display_via_depends_on) &&\n    !field.hidden\n  )\n}\n\nconst getPlaceholder = (field) => {\n  if (field.placeholder) {\n    return __(field.placeholder)\n  }\n  if (['Select', 'Link'].includes(field.fieldtype)) {\n    return __('Select {0}', [__(field.label)])\n  } else {\n    return __('Enter {0}', [__(field.label)])\n  }\n}\n\nfunction fieldChange(value, df) {\n  data.value[df.fieldname] = value\n\n  if (isGridRow) {\n    triggerOnChange(df.fieldname, data.value)\n  } else {\n    triggerOnChange(df.fieldname)\n  }\n}\n\nfunction getDataValue(value, field) {\n  if (field.fieldtype === 'Duration') {\n    return value || 0\n  }\n  return value\n}\n</script>\n<style scoped>\n:deep(.form-control.prefix select) {\n  padding-left: 2rem;\n}\n</style>\n","<template>\n  <div\n    v-if=\"!section.hidden\"\n    class=\"section\"\n    :class=\"[\n      section.hideBorder\n        ? 'pt-4'\n        : 'border-t border-outline-gray-modals mt-5 pt-5',\n    ]\"\n  >\n    <Section\n      class=\"flex sm:flex-row flex-col gap-4 text-lg font-medium\"\n      :class=\"{ 'px-3 sm:px-5': hasTabs }\"\n      :labelClass=\"['text-lg font-medium', { 'px-3 sm:px-5': hasTabs }]\"\n      :label=\"section.label\"\n      :hideLabel=\"section.hideLabel || !section.label\"\n      :opened=\"section.opened\"\n      :collapsible=\"section.collapsible\"\n      collapseIconPosition=\"right\"\n    >\n      <template v-for=\"column in section.columns\" :key=\"column.name\">\n        <Column\n          :class=\"{ 'mt-6': section.label && !section.hideLabel }\"\n          :column=\"column\"\n          :data-name=\"column.name\"\n        />\n      </template>\n    </Section>\n  </div>\n</template>\n<script setup>\nimport Section from '@/components/Section.vue'\nimport Column from '@/components/FieldLayout/Column.vue'\nimport { inject } from 'vue'\n\nconst props = defineProps({\n  section: Object,\n})\n\nconst hasTabs = inject('hasTabs')\n</script>\n","<template>\n  <div\n    class=\"flex flex-col\"\n    :class=\"{\n      'border border-outline-gray-1 rounded-lg': hasTabs,\n      'border-outline-gray-modals': hasTabs,\n    }\"\n  >\n    <Tabs as=\"div\" v-model=\"tabIndex\" :tabs=\"tabs\">\n      <TabList :class=\"!hasTabs ? 'hidden' : 'border-outline-gray-modals'\" />\n      <TabPanel v-slot=\"{ tab }\">\n        <div\n          class=\"sections overflow-hidden\"\n          :class=\"{ 'my-4 sm:my-5': hasTabs }\"\n        >\n          <template v-for=\"section in tab.sections\" :key=\"section.name\">\n            <Section :section=\"section\" :data-name=\"section.name\" />\n          </template>\n        </div>\n      </TabPanel>\n    </Tabs>\n  </div>\n</template>\n\n<script setup>\nimport Section from '@/components/FieldLayout/Section.vue'\nimport { Tabs, TabList, TabPanel } from 'frappe-ui'\nimport { ref, computed, provide } from 'vue'\n\nconst props = defineProps({\n  tabs: Array,\n  data: Object,\n  doctype: {\n    type: String,\n    default: 'CRM Lead',\n  },\n  isGridRow: {\n    type: Boolean,\n    default: false,\n  },\n  preview: {\n    type: Boolean,\n    default: false,\n  },\n})\n\nconst tabIndex = ref(0)\n\nconst hasTabs = computed(() => {\n  return (\n    props.tabs.length > 1 || (props.tabs.length == 1 && props.tabs[0].label)\n  )\n})\n\nprovide(\n  'data',\n  computed(() => props.data),\n)\nprovide('hasTabs', hasTabs)\nprovide('doctype', props.doctype)\nprovide('preview', props.preview)\nprovide('isGridRow', props.isGridRow)\n</script>\n<style scoped>\n.section:not(:has(.field)) {\n  display: none;\n}\n\n.section:has(.field):nth-child(1 of .section:has(.field)) {\n  border-top: none;\n  margin-top: 0;\n  padding-top: 0;\n}\n</style>\n","<template>\n  <Dialog v-model=\"show\" :options=\"{ size: '4xl' }\">\n    <template #body-title>\n      <h3\n        class=\"flex items-center gap-2 text-2xl font-semibold leading-6 text-ink-gray-9\"\n      >\n        <div>{{ __('Edit Quick Entry Layout') }}</div>\n        <Badge\n          v-if=\"dirty\"\n          :label=\"__('Not Saved')\"\n          variant=\"subtle\"\n          theme=\"orange\"\n        />\n      </h3>\n    </template>\n    <template #body-content>\n      <div class=\"flex flex-col gap-3\">\n        <div class=\"flex justify-between gap-2\">\n          <Button\n            :label=\"preview ? __('Hide preview') : __('Show preview')\"\n            @click=\"preview = !preview\"\n          />\n          <div class=\"flex flex-row-reverse gap-2\">\n            <Button\n              :loading=\"loading\"\n              :label=\"__('Save')\"\n              variant=\"solid\"\n              @click=\"saveChanges\"\n            />\n            <Button :label=\"__('Reset')\" @click=\"reload\" />\n          </div>\n        </div>\n        <div v-if=\"tabs?.data\">\n          <FieldLayoutEditor\n            v-if=\"!preview\"\n            :tabs=\"tabs.data\"\n            :doctype=\"_doctype\"\n            :onlyRequired=\"onlyRequired\"\n          />\n          <FieldLayout v-else :tabs=\"tabs.data\" :data=\"{}\" :preview=\"true\" />\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n<script setup>\nimport FieldLayout from '@/components/FieldLayout/FieldLayout.vue'\nimport FieldLayoutEditor from '@/components/FieldLayoutEditor.vue'\nimport { useDebounceFn } from '@vueuse/core'\nimport { capture } from '@/telemetry'\nimport { Dialog, Badge, Switch, call, createResource } from 'frappe-ui'\nimport { ref, watch, onMounted, nextTick } from 'vue'\n\nconst props = defineProps({\n  doctype: {\n    type: String,\n    default: 'CRM Lead',\n  },\n  onlyRequired: {\n    type: Boolean,\n    default: false,\n  },\n})\n\nconst show = defineModel()\nconst _doctype = ref(props.doctype)\nconst loading = ref(false)\nconst dirty = ref(false)\nconst preview = ref(false)\n\nfunction getParams() {\n  let type = props.onlyRequired ? 'Required Fields' : 'Quick Entry'\n  return { doctype: _doctype.value, type }\n}\n\nconst tabs = createResource({\n  url: 'crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout',\n  cache: ['QuickEntryModal', _doctype.value, props.onlyRequired],\n  params: getParams(),\n  onSuccess(data) {\n    tabs.originalData = JSON.parse(JSON.stringify(data))\n  },\n})\n\nwatch(\n  () => tabs?.data,\n  () => {\n    dirty.value =\n      JSON.stringify(tabs?.data) !== JSON.stringify(tabs?.originalData)\n  },\n  { deep: true },\n)\n\nonMounted(() => useDebounceFn(reload, 100)())\n\nfunction reload() {\n  nextTick(() => {\n    tabs.params = getParams()\n    tabs.reload()\n  })\n}\n\nfunction saveChanges() {\n  let _tabs = JSON.parse(JSON.stringify(tabs.data))\n  _tabs.forEach((tab) => {\n    if (!tab.sections) return\n    tab.sections.forEach((section) => {\n      section.columns.forEach((column) => {\n        if (!column.fields) return\n        column.fields = column.fields.map((field) => field.fieldname)\n      })\n    })\n  })\n  loading.value = true\n  let type = props.onlyRequired ? 'Required Fields' : 'Quick Entry'\n  call(\n    'crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.save_fields_layout',\n    {\n      doctype: _doctype.value,\n      type: type,\n      layout: JSON.stringify(_tabs),\n    },\n  ).then(() => {\n    loading.value = false\n    show.value = false\n    capture('quick_entry_layout_builder', { doctype: _doctype.value })\n  })\n}\n</script>\n"],"names":["d","i","t","n","f","m","F","l","e","a","r","u","te","s","le","U","C","b","j","G","me","L","E","P","p","v","R","c","k","o","I","H","h","W","O","N","T","x","w","_","J","A","z","V","M","ee","pe","xe","$","K","B","Z","S","D","g","Y","Q","Ie","ye","X","q","inject","tabRef","ref","indicator","tabsLength","computed","_a","transitionClass","moveIndicator","index","selectedTab","watch","nextTick","onMounted","props","__props","tabIndex","_useModel","provide","show","showEye","attrs","useAttrs","isFocused","inputRef","handleFocus","displayValue","descriptionClasses","emit","__emit","getFields","getMeta","values","valuesRef","error","query","linkField","filters","parsedValues","getLinkField","row","fields","df","addValue","value","removeValue","_value","removeLastValue","valueRef","getGridViewSettings","saveUserSettings","loading","dirty","oldFields","_fields","gridViewSettings","field","fieldObj","dropdownFields","reset","addField","removeField","update","updateFields","slotName","restrictedFieldTypes","params","createResource","data","restrictedFields","existingFields","tab","section","column","addTab","getRandom","getTabOptions","getSectionOptions","targetSection","previousColumn","_doctype","preview","getParams","tabs","useDebounceFn","reload","saveChanges","_tabs","call","capture","isManager","usersStore","showGridRowFieldsModal","openGridRowFieldsModal","showCreateDocumentModal","createDocumentDoctype","createDocumentData","createDocumentCallback","createDocument","doctype","obj","close","callback","triggerOnChange","triggerOnRowAdd","triggerOnRowRemove","getFloatWithPrecision","getCurrencyWithPrecision","getFormattedCurrency","getGridSettings","getUser","rows","parentDoc","showRowList","selectedRows","reactive","showGridFieldsEditorModal","gridSettings","gridFields","gs","getFieldObj","allFields","fieldChange","gridTemplateColumns","allRowsSelected","showDeleteBtn","toggleSelectAllRows","iSelected","toggleSelectRow","addRow","newRow","getDefaultValue","deleteRows","defaultValue","fieldtype","flt","dayjs","doctypeScripts","getScript","view","scripts","createListResource","_scripts","script","err","setupScript","document","helpers","scriptDefs","$dialog","$socket","makeCall","globalStore","toast","router","setupMultipleFormControllers","scriptStrings","controllers","parentInstanceIdx","scriptName","classNames","getClassNames","className","FormClass","evaluateFormClass","parentInstance","doctypeName","doctypeMeta","isChildDoctype","instance","setupFormController","meta","key","getDoc","createDocProxy","setupHelperMethods","parentField","idx","dt","_b","match","helperKeys","helperValues","wrappedScript","source","childInstance","isFunction","getCurrentData","target","prop","currentDocData","methodName","args","method","documentsCache","controllersCache","useDocument","docname","createDocumentResource","setupFormScript","controllersArray","organizedControllers","controller","controllerKey","getControllers","docControllers","triggerOnRefresh","trigger","fieldname","getOldValue","selectedRow","triggerOnCreateLead","triggerConvertToDeal","taskFn","tasks","runSequentially","oldDoc","isGridRow","getFormattedPercent","getFormattedFloat","option","_field","evaluateDependsOnValue","isFieldVisible","getPlaceholder","getDataValue","hasTabs","type"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4]}