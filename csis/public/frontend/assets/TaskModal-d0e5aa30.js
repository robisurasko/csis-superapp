import{u as P,i as z,j as A,_ as x,q as F,h as N,A as q}from"./index-31644aa3.js";import{A as K}from"./ArrowUpRightIcon-fffd9b01.js";import{_ as G,D as H}from"./Link-4317fd36.js";import{K as Q,m as C,i as V,B as W,l as p,a as X,k as Y,e as m,f as k,g as y,w as r,d as u,t as b,b as l,p as D,u as n,aa as Z,_ as ee,E as B,I as ae,J as te}from"./index-85632e04.js";import{_ as E}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{u as se}from"./helpCenter-64650aa2.js";const oe={class:"flex items-center gap-3"},le={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},re={class:"flex flex-col gap-4"},ne={class:"mb-1.5 text-xs text-ink-gray-5"},ie={class:"flex flex-wrap items-center gap-2"},ue={class:"cursor-pointer text-ink-gray-9"},de={__name:"TaskModal",props:C({task:{type:Object,default:{}},doctype:{type:String,default:"CRM Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:C(["updateTask","after"],["update:modelValue","update:reloadTasks"]),setup(d,{emit:O}){const i=d,c=V(d,"modelValue"),h=V(d,"reloadTasks"),w=O,R=W(),{getUser:_}=P(),{updateOnboardingStep:S}=se("frappecrm"),v=p(null),T=p(null),f=p(!1),a=p({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:i.doctype,reference_docname:null});function U(e){a.value.status=e}function $(e){a.value.priority=e}function j(){var o;if(!((o=i.task)!=null&&o.reference_docname))return;let e=i.task.reference_doctype=="CRM Deal"?"Deal":"Lead",t={leadId:i.task.reference_docname};e=="Deal"&&(t={dealId:i.task.reference_docname}),R.push({name:e,params:t})}async function I(){var e,t;if(a.value.assigned_to||(a.value.assigned_to=_().name),a.value.name){let o=await B("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value});o.name&&((e=h.value)==null||e.reload(),w("after",o))}else{let o=await B("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:i.doctype,reference_docname:i.doc||null,...a.value}},{onError:g=>{g.error.exc_type=="MandatoryError"&&(v.value="Title is mandatory")}});o.name&&(S("create_first_task"),ae("task_created"),(t=h.value)==null||t.reload(),w("after",o,!0))}c.value=!1}function M(){f.value=!1,te(()=>{var e,t,o;(o=(t=(e=T.value)==null?void 0:e.el)==null?void 0:t.focus)==null||o.call(t),a.value={...i.task},a.value.title&&(f.value=!0)})}return X(()=>c.value&&M()),Y(c,e=>{e&&M()}),(e,t)=>{const o=m("Button"),g=m("FormControl"),J=m("ErrorMessage"),L=m("Dialog");return k(),y(L,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=s=>c.value=s),options:{size:"xl",actions:[{label:f.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>I()}]}},{"body-title":r(()=>{var s;return[u("div",oe,[u("h3",le,b(f.value?e.__("Edit Task"):e.__("Create Task")),1),(s=d.task)!=null&&s.reference_docname?(k(),y(o,{key:0,size:"sm",label:d.task.reference_doctype=="CRM Deal"?e.__("Open Deal"):e.__("Open Lead"),onClick:t[0]||(t[0]=ce=>j())},{suffix:r(()=>[l(K,{class:"w-4 h-4"})]),_:1},8,["label"])):D("",!0)])]}),"body-content":r(()=>[u("div",re,[u("div",null,[l(g,{ref_key:"title",ref:T,label:e.__("Title"),modelValue:a.value.title,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.title=s),placeholder:e.__("Call with John Doe"),required:""},null,8,["label","modelValue","placeholder"])]),u("div",null,[u("div",ne,b(e.__("Description")),1),l(n(Z),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:t[2]||(t[2]=s=>a.value.description=s),placeholder:e.__("Took a call with John Doe and discussed the new project.")},null,8,["content","placeholder"])]),u("div",ie,[l(n(E),{options:n(A)(U)},{default:r(()=>[l(o,{label:a.value.status,class:"justify-between w-full"},{prefix:r(()=>[l(z,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"]),l(G,{class:"form-control",value:n(_)(a.value.assigned_to).full_name,doctype:"User",onChange:t[3]||(t[3]=s=>a.value.assigned_to=s),placeholder:e.__("John Doe"),hideMe:!0},{prefix:r(()=>[l(x,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":r(({option:s})=>[l(x,{class:"mr-2",user:s.value,size:"sm"},null,8,["user"])]),"item-label":r(({option:s})=>[l(n(ee),{text:s.value},{default:r(()=>[u("div",ue,b(n(_)(s.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value","placeholder"]),l(n(H),{class:"datepicker w-36",modelValue:a.value.due_date,"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.due_date=s),placeholder:e.__("01/04/2024 11:30 PM"),formatter:s=>n(F)(s,"",!0,!0),"input-class":"border-none"},null,8,["modelValue","placeholder","formatter"]),l(n(E),{options:n(q)($)},{default:r(()=>[l(o,{label:a.value.priority,class:"justify-between w-full"},{prefix:r(()=>[l(N,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])]),v.value?(k(),y(J,{key:0,class:"mt-4",message:e.__(v.value)},null,8,["message"])):D("",!0)])]),_:1},8,["modelValue","options"])}}},ke=Q(de,[["__scopeId","data-v-36f6cba0"]]);export{ke as T};
//# sourceMappingURL=TaskModal-d0e5aa30.js.map
