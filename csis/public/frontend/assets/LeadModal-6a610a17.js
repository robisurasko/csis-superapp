import{E as O}from"./DragVerticalIcon-e7d3e46c.js";import{F as Q}from"./QuickEntryModal-157d8856.js";import{u as z}from"./index-31644aa3.js";import{s as D}from"./statuses-1a7b8e83.js";import{m as T,s as U,i as w,B as A,l as k,z as E,v as J,j as P,a as W,e as i,f as c,g as d,w as g,d as n,t as $,u as m,b as f,p as b,I as G,J as H}from"./index-85632e04.js";import{i as K}from"./Link-4317fd36.js";import{u as X}from"./helpCenter-64650aa2.js";const Y={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Z={class:"mb-5 flex items-center justify-between"},ee={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},ae={class:"flex items-center gap-1"},te={class:"px-4 pb-7 pt-4 sm:px-6"},se={class:"flex flex-row-reverse gap-2"},de={__name:"LeadModal",props:T({defaults:Object},{modelValue:{},modelModifiers:{},quickEntry:{},quickEntryModifiers:{}}),emits:["update:modelValue","update:quickEntry"],setup(_){const M=_,{user:x}=U(),{getUser:C,isManager:L}=z(),{getLeadStatus:S,statusOptions:N}=D(),{updateOnboardingStep:V}=X("frappecrm"),l=w(_,"modelValue"),I=A(),t=k(null),u=k(!1),y=E({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Lead"],params:{doctype:"CRM Lead",type:"Quick Entry"},auto:!0,transform:a=>a.forEach(s=>{s.sections.forEach(r=>{r.columns.forEach(v=>{v.fields.forEach(o=>{o.fieldname=="status"&&(o.fieldtype="Select",o.options=p.value,o.prefix=S(e.status).color),o.fieldtype==="Table"&&(e[o.fieldname]=[])})})})})}),e=J({salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",organization:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",status:"",lead_owner:""}),B=E({url:"frappe.client.insert",makeParams(a){return{doc:{doctype:"CRM Lead",...a}}}}),p=P(()=>{var s;let a=N("lead");return e.status||(e.status=(s=a==null?void 0:a[0])==null?void 0:s.value),a});function R(){e.website&&!e.website.startsWith("http")&&(e.website="https://"+e.website),B.submit(e,{validate(){if(t.value=null,!e.first_name)return t.value=__("First Name is mandatory"),t.value;if(e.annual_revenue){if(typeof e.annual_revenue=="string")e.annual_revenue=e.annual_revenue.replace(/,/g,"");else if(isNaN(e.annual_revenue))return t.value=__("Annual Revenue should be a number"),t.value}if(e.mobile_no&&isNaN(e.mobile_no.replace(/[-+() ]/g,"")))return t.value=__("Mobile No should be a number"),t.value;if(e.email&&!e.email.includes("@"))return t.value=__("Invalid Email"),t.value;if(!e.status)return t.value=__("Status is required"),t.value;u.value=!0},onSuccess(a){G("lead_created"),u.value=!1,l.value=!1,I.push({name:"Lead",params:{leadId:a.name}}),V("create_first_lead",!0,!1,()=>{localStorage.setItem("firstLead"+x,a.name)})},onError(a){if(u.value=!1,!a.messages){t.value=a.message;return}t.value=a.messages.join(`
`)}})}const j=w(_,"quickEntry");function q(){j.value=!0,H(()=>{l.value=!1})}return W(()=>{var a;Object.assign(e,M.defaults),e.lead_owner||(e.lead_owner=C().name),!e.status&&((a=p.value[0])!=null&&a.value)&&(e.status=p.value[0].value)}),(a,s)=>{const r=i("Button"),v=i("FeatherIcon"),o=i("ErrorMessage"),F=i("Dialog");return c(),d(F,{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=h=>l.value=h),options:{size:"3xl"}},{body:g(()=>[n("div",Y,[n("div",Z,[n("div",null,[n("h3",ee,$(a.__("Create Lead")),1)]),n("div",ae,[m(L)()&&!m(K)?(c(),d(r,{key:0,variant:"ghost",class:"w-7",onClick:q},{default:g(()=>[f(O,{class:"h-4 w-4"})]),_:1})):b("",!0),f(r,{variant:"ghost",class:"w-7",onClick:s[0]||(s[0]=h=>l.value=!1)},{default:g(()=>[f(v,{name:"x",class:"h-4 w-4"})]),_:1})])]),n("div",null,[m(y).data?(c(),d(Q,{key:0,tabs:m(y).data,data:e},null,8,["tabs","data"])):b("",!0),t.value?(c(),d(o,{key:1,class:"mt-4",message:a.__(t.value)},null,8,["message"])):b("",!0)])]),n("div",te,[n("div",se,[f(r,{variant:"solid",label:a.__("Create"),loading:u.value,onClick:R},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}};export{de as _};
//# sourceMappingURL=LeadModal-6a610a17.js.map
