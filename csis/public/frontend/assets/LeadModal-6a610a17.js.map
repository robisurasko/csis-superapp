{"version":3,"file":"LeadModal-6a610a17.js","sources":["../../../../frontend/src/components/Modals/LeadModal.vue"],"sourcesContent":["<template>\n  <Dialog v-model=\"show\" :options=\"{ size: '3xl' }\">\n    <template #body>\n      <div class=\"bg-surface-modal px-4 pb-6 pt-5 sm:px-6\">\n        <div class=\"mb-5 flex items-center justify-between\">\n          <div>\n            <h3 class=\"text-2xl font-semibold leading-6 text-ink-gray-9\">\n              {{ __('Create Lead') }}\n            </h3>\n          </div>\n          <div class=\"flex items-center gap-1\">\n            <Button\n              v-if=\"isManager() && !isMobileView\"\n              variant=\"ghost\"\n              class=\"w-7\"\n              @click=\"openQuickEntryModal\"\n            >\n              <EditIcon class=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" class=\"w-7\" @click=\"show = false\">\n              <FeatherIcon name=\"x\" class=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n        <div>\n          <FieldLayout v-if=\"tabs.data\" :tabs=\"tabs.data\" :data=\"lead\" />\n          <ErrorMessage class=\"mt-4\" v-if=\"error\" :message=\"__(error)\" />\n        </div>\n      </div>\n      <div class=\"px-4 pb-7 pt-4 sm:px-6\">\n        <div class=\"flex flex-row-reverse gap-2\">\n          <Button\n            variant=\"solid\"\n            :label=\"__('Create')\"\n            :loading=\"isLeadCreating\"\n            @click=\"createNewLead\"\n          />\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport EditIcon from '@/components/Icons/EditIcon.vue'\nimport FieldLayout from '@/components/FieldLayout/FieldLayout.vue'\nimport { usersStore } from '@/stores/users'\nimport { statusesStore } from '@/stores/statuses'\nimport { sessionStore } from '@/stores/session'\nimport { isMobileView } from '@/composables/settings'\nimport { capture } from '@/telemetry'\nimport { createResource } from 'frappe-ui'\nimport { useOnboarding } from 'frappe-ui/frappe'\nimport { computed, onMounted, ref, reactive, nextTick } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst props = defineProps({\n  defaults: Object,\n})\n\nconst { user } = sessionStore()\nconst { getUser, isManager } = usersStore()\nconst { getLeadStatus, statusOptions } = statusesStore()\nconst { updateOnboardingStep } = useOnboarding('frappecrm')\n\nconst show = defineModel()\nconst router = useRouter()\nconst error = ref(null)\nconst isLeadCreating = ref(false)\n\nconst tabs = createResource({\n  url: 'crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout',\n  cache: ['QuickEntry', 'CRM Lead'],\n  params: { doctype: 'CRM Lead', type: 'Quick Entry' },\n  auto: true,\n  transform: (_tabs) => {\n    return _tabs.forEach((tab) => {\n      tab.sections.forEach((section) => {\n        section.columns.forEach((column) => {\n          column.fields.forEach((field) => {\n            if (field.fieldname == 'status') {\n              field.fieldtype = 'Select'\n              field.options = leadStatuses.value\n              field.prefix = getLeadStatus(lead.status).color\n            }\n\n            if (field.fieldtype === 'Table') {\n              lead[field.fieldname] = []\n            }\n          })\n        })\n      })\n    })\n  },\n})\n\nconst lead = reactive({\n  salutation: '',\n  first_name: '',\n  last_name: '',\n  email: '',\n  mobile_no: '',\n  gender: '',\n  organization: '',\n  website: '',\n  no_of_employees: '',\n  territory: '',\n  annual_revenue: '',\n  industry: '',\n  status: '',\n  lead_owner: '',\n})\n\nconst createLead = createResource({\n  url: 'frappe.client.insert',\n  makeParams(values) {\n    return {\n      doc: {\n        doctype: 'CRM Lead',\n        ...values,\n      },\n    }\n  },\n})\n\nconst leadStatuses = computed(() => {\n  let statuses = statusOptions('lead')\n  if (!lead.status) {\n    lead.status = statuses?.[0]?.value\n  }\n  return statuses\n})\n\nfunction createNewLead() {\n  if (lead.website && !lead.website.startsWith('http')) {\n    lead.website = 'https://' + lead.website\n  }\n\n  createLead.submit(lead, {\n    validate() {\n      error.value = null\n      if (!lead.first_name) {\n        error.value = __('First Name is mandatory')\n        return error.value\n      }\n      if (lead.annual_revenue) {\n        if (typeof lead.annual_revenue === 'string') {\n          lead.annual_revenue = lead.annual_revenue.replace(/,/g, '')\n        } else if (isNaN(lead.annual_revenue)) {\n          error.value = __('Annual Revenue should be a number')\n          return error.value\n        }\n      }\n      if (lead.mobile_no && isNaN(lead.mobile_no.replace(/[-+() ]/g, ''))) {\n        error.value = __('Mobile No should be a number')\n        return error.value\n      }\n      if (lead.email && !lead.email.includes('@')) {\n        error.value = __('Invalid Email')\n        return error.value\n      }\n      if (!lead.status) {\n        error.value = __('Status is required')\n        return error.value\n      }\n      isLeadCreating.value = true\n    },\n    onSuccess(data) {\n      capture('lead_created')\n      isLeadCreating.value = false\n      show.value = false\n      router.push({ name: 'Lead', params: { leadId: data.name } })\n      updateOnboardingStep('create_first_lead', true, false, () => {\n        localStorage.setItem('firstLead' + user, data.name)\n      })\n    },\n    onError(err) {\n      isLeadCreating.value = false\n      if (!err.messages) {\n        error.value = err.message\n        return\n      }\n      error.value = err.messages.join('\\n')\n    },\n  })\n}\n\nconst showQuickEntryModal = defineModel('quickEntry')\n\nfunction openQuickEntryModal() {\n  showQuickEntryModal.value = true\n  nextTick(() => {\n    show.value = false\n  })\n}\n\nonMounted(() => {\n  Object.assign(lead, props.defaults)\n  if (!lead.lead_owner) {\n    lead.lead_owner = getUser().name\n  }\n  if (!lead.status && leadStatuses.value[0]?.value) {\n    lead.status = leadStatuses.value[0].value\n  }\n})\n</script>\n"],"names":["props","__props","user","sessionStore","getUser","isManager","usersStore","getLeadStatus","statusOptions","statusesStore","updateOnboardingStep","useOnboarding","show","_useModel","router","useRouter","error","ref","isLeadCreating","tabs","createResource","_tabs","tab","section","column","field","leadStatuses","lead","reactive","createLead","values","computed","statuses","_a","createNewLead","data","capture","err","showQuickEntryModal","openQuickEntryModal","nextTick","onMounted"],"mappings":"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"}