import{_ as ye}from"./FadedScrollableDiv-f3f408b5.js";import{D as K}from"./DetailsIcon-404b02bf.js";import{u as ge,a as ve,S as he,L as be,b as Ce,c as xe,A as Ie}from"./useActiveTabManager-a0215a12.js";import{E as we}from"./MultiSelectEmailInput-5ae16f74.js";import{E as ke}from"./Email2Icon-d49a0a62.js";import{C as De}from"./CommentIcon-2d82e902.js";import{P as Q}from"./PhoneIcon-cb5df69f.js";import{T as Ve}from"./TaskIcon-f5c3d969.js";import{N as ze}from"./NoteModal-4abb9e0a.js";import{W as Me}from"./WhatsAppIcon-cd469fd1.js";import{I as Ae}from"./IndicatorIcon-99f76624.js";import{A as Se}from"./ArrowUpRightIcon-fffd9b01.js";import{S as $e,g as Re,a as Ee}from"./view-de8292bb.js";import{_ as Te}from"./LayoutHeader-448e93da.js";import{_ as qe}from"./OrganizationModal-b2c5c5b4.js";import{C as Ue}from"./ContactModal-e2b879e7.js";import{_ as Pe}from"./Section-7d029c27.js";import{_ as Be,i as Ne,c as je,w as Oe}from"./Link-4317fd36.js";import{_ as Fe}from"./CustomActions-4107b940.js";import{g as Le,b as We,s as Ge,d as He,a as Je}from"./index-31644aa3.js";import{g as Ke}from"./settings-5fcce07e.js";import{s as Qe}from"./statuses-1a7b8e83.js";import{z as k,G as y,E as D,a as Xe,l as V,j as q,A as Ye,c as m,u as t,g as x,w as d,p,b as l,d as u,H as U,F as X,h as Ze,B as ea,e as P,f as r,n as B,t as z,r as aa,D as Y,x as ta}from"./index-85632e04.js";import{_ as oa}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-41a5d25f.js";import{_ as Z}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{b as sa,c as na,a as la}from"./QuickEntryModal-157d8856.js";import"./CalendarIcon-b9320815.js";import"./CallLogModal-359f4190.js";import"./DragVerticalIcon-e7d3e46c.js";import"./ContactsIcon-830ef67e.js";import"./LeadsIcon-68ebc4cc.js";import"./DealsIcon-acabc22f.js";import"./TaskModal-d0e5aa30.js";import"./helpCenter-64650aa2.js";import"./MultipleAvatar-8c461416.js";import"./IconPicker-0c2832fa.js";import"./Popover-4a1551e7.js";import"./FileUploader-ffa5e39e.js";import"./EmailTemplateModal-adfdb337.js";import"./AssignmentModal-f44425e3.js";const ia={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},ra={class:"absolute right-0"},da={key:1,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},ca={class:"flex items-center gap-2"},ma={key:2,class:"flex h-full overflow-hidden"},ua={key:0},pa={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},_a={key:0,class:"pr-2"},fa={key:0,class:"contacts-area"},ya={key:0,class:"flex min-h-20 flex-1 items-center justify-center gap-3 text-base text-ink-gray-4"},ga={class:"flex cursor-pointer items-center justify-between gap-2 pr-1 text-base leading-5 text-ink-gray-7"},va=["onClick"],ha={class:"truncate"},ba={class:"flex items-center"},Ca={class:"flex flex-col gap-1.5 text-base text-ink-gray-8"},xa={class:"flex items-center gap-3 pb-1.5 pl-1 pt-4"},Ia={class:"flex items-center gap-3 p-1 py-1.5"},wa={key:0,class:"mx-2 h-px border-t border-outline-gray-modals"},ka={key:2,class:"flex h-20 items-center justify-center text-base text-ink-gray-5"},ut={__name:"MobileDeal",props:{dealId:{type:String,required:!0}},setup(ee){const{brand:ae}=Ke(),{$dialog:te,$socket:oe}=Le(),{statusOptions:se,getDealStatus:ne}=Qe(),{doctypeMeta:le}=We("CRM Deal"),h=Ze(),M=ea(),f=ee,o=k({url:"crm.fcrm.doctype.crm_deal.api.get_deal",params:{name:f.dealId},cache:["deal",f.dealId],onSuccess:a=>{a.organization&&(N.update({params:{doctype:"CRM Organization",name:a.organization}}),N.fetch()),Ge(o),He(o,{doc:a,$dialog:te,$socket:oe,router:M,toast:y,updateField:A,createToast:y.create,deleteDoc:_e,resource:{deal:o,dealContacts:v,sections:I},call:D})}}),N=k({url:"frappe.client.get",onSuccess:a=>o.data._organizationObj=a});Xe(()=>{o.data||o.fetch()});const S=V(!1),$=V(!1),R=V({});function ie(a,e,s){e=Array.isArray(a)?"":e,!re(a,e)&&k({url:"frappe.client.set_value",params:{doctype:"CRM Deal",name:f.dealId,fieldname:a,value:e},auto:!0,onSuccess:()=>{o.reload(),S.value=!0,y.success(__("Deal updated")),s==null||s()},onError:n=>{var C;y.error(((C=n.messages)==null?void 0:C[0])||__("Error updating deal"))}})}function re(a,e){var n;let s=o.data.fields_meta||{};return(n=s[a])!=null&&n.reqd&&!e?(y.error(__("{0} is a required field",[s[a].label])),!0):!1}const de=q(()=>{let a=[{label:__("Deals"),route:{name:"Deals"}}];if(h.query.view||h.query.viewType){let e=Re(h.query.view,h.query.viewType,"CRM Deal");e&&a.push({label:__(e.label),icon:e.icon,route:{name:"Deals",params:{viewType:h.query.viewType},query:{view:h.query.view}}})}return a.push({label:j.value,route:{name:"Deal",params:{dealId:o.data.name}}}),a}),j=q(()=>{var e,s;let a=((e=le["CRM Deal"])==null?void 0:e.title_field)||"name";return((s=o.data)==null?void 0:s[a])||f.dealId});Ye(()=>({title:j.value,icon:ae.favicon}));const E=q(()=>[{name:"Details",label:__("Details"),icon:K,condition:()=>Ne.value},{name:"Activity",label:__("Activity"),icon:xe},{name:"Emails",label:__("Emails"),icon:we},{name:"Comments",label:__("Comments"),icon:De},{name:"Data",label:__("Data"),icon:K},{name:"Calls",label:__("Calls"),icon:Q,condition:()=>je.value},{name:"Tasks",label:__("Tasks"),icon:Ve},{name:"Notes",label:__("Notes"),icon:ze},{name:"Attachments",label:__("Attachments"),icon:Ie},{name:"WhatsApp",label:__("WhatsApp"),icon:Me,condition:()=>Oe.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:b}=ge(E,"lastDealTab"),I=k({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Deal"],params:{doctype:"CRM Deal"},auto:!0,transform:a=>ce(a)});function ce(a){return a.forEach(e=>{e.name!="contacts_section"&&e.columns[0].fields.forEach(s=>{s.name=="organization"&&(s.create=(n,C)=>{R.value.organization_name=n,$.value=!0,C()},s.link=n=>M.push({name:"Organization",params:{organizationId:n}}))})}),a}const T=V(!1),O=V({});function me(a){let e=[{label:__("Delete"),icon:"trash-2",onClick:()=>ue(a)}];return a.is_primary||e.push({label:__("Set as Primary Contact"),icon:ta(Ee,{class:"h-4 w-4"}),onClick:()=>pe(a.name)}),e}async function F(a){var s;if((s=v.data)!=null&&s.find(n=>n.name===a)){y.error(__("Contact already added"));return}await D("crm.fcrm.doctype.crm_deal.crm_deal.add_contact",{deal:f.dealId,contact:a})&&(v.reload(),y.success(__("Contact added")))}async function ue(a){await D("crm.fcrm.doctype.crm_deal.crm_deal.remove_contact",{deal:f.dealId,contact:a})&&(v.reload(),y.success(__("Contact removed")))}async function pe(a){await D("crm.fcrm.doctype.crm_deal.crm_deal.set_primary_contact",{deal:f.dealId,contact:a})&&(v.reload(),y.success(__("Primary contact set")))}const v=k({url:"crm.fcrm.doctype.crm_deal.api.get_deal_contacts",params:{name:f.dealId},cache:["deal_contacts",f.dealId],auto:!0,onSuccess:a=>{var s;let e=(s=I.data)==null?void 0:s.find(n=>n.name=="contacts_section");e&&(e.contacts=a.map(n=>({name:n.name,full_name:n.full_name,email:n.email,mobile_no:n.mobile_no,image:n.image,is_primary:n.is_primary,opened:!1})))}});function A(a,e,s){ie(a,e,()=>{o.data[a]=e,s==null||s()})}async function _e(a){await D("frappe.client.delete",{doctype:"CRM Deal",name:a}),M.push({name:"Deals"})}return(a,e)=>{var L;const s=P("FeatherIcon"),n=P("Button"),C=P("Badge");return r(),m(X,null,[t(o).data?(r(),x(Te,{key:0},{default:d(()=>[u("header",ia,[l(t(oa),{items:de.value},{prefix:d(({item:i})=>[i.icon?(r(),x(ye,{key:0,icon:i.icon,class:"mr-2 h-4"},null,8,["icon"])):p("",!0)]),_:1},8,["items"]),u("div",ra,[l(t(Z),{options:t(se)("deal",A,t(o).data._customStatuses)},{default:d(({open:i})=>[l(n,{label:t(o).data.status},{prefix:d(()=>[l(Ae,{class:B(t(ne)(t(o).data.status).color)},null,8,["class"])]),suffix:d(()=>[l(s,{name:i?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options"])])])]),_:1})):p("",!0),t(o).data?(r(),m("div",da,[l(ve,{modelValue:t(o).data._assignedTo,"onUpdate:modelValue":e[0]||(e[0]=i=>t(o).data._assignedTo=i),data:t(o).data,doctype:"CRM Deal"},null,8,["modelValue","data"]),u("div",ca,[(L=t(o).data._customActions)!=null&&L.length?(r(),x(Fe,{key:0,actions:t(o).data._customActions},null,8,["actions"])):p("",!0)])])):p("",!0),t(o).data?(r(),m("div",ma,[l(t(la),{as:"div",modelValue:t(b),"onUpdate:modelValue":e[6]||(e[6]=i=>U(b)?b.value=i:null),tabs:E.value,class:"overflow-auto"},{default:d(()=>[l(t(sa),{class:"!px-3"}),l(t(na),null,{default:d(({tab:i})=>[i.name=="Details"?(r(),m("div",ua,[t(o).data.sla_status?(r(),x(he,{key:0,modelValue:t(o).data,"onUpdate:modelValue":e[1]||(e[1]=c=>t(o).data=c),onUpdateField:A},null,8,["modelValue"])):p("",!0),t(I).data?(r(),m("div",pa,[l($e,{sections:t(I).data,doctype:"CRM Deal",docname:t(o).data.name,onReload:t(I).reload},{actions:d(({section:c})=>[c.name=="contacts_section"?(r(),m("div",_a,[l(Be,{value:"",doctype:"Contact",onChange:e[2]||(e[2]=g=>F(g)),onCreate:(g,w)=>{O.value={first_name:g,company_name:t(o).data.organization},T.value=!0,w()}},{target:d(({togglePopover:g})=>[l(n,{class:"h-7 px-3",variant:"ghost",icon:"plus",onClick:w=>g()},null,8,["onClick"])]),_:1},8,["onCreate"])])):p("",!0)]),default:d(({section:c})=>{var g,w,W;return[c.name=="contacts_section"?(r(),m("div",fa,[(g=t(v))!=null&&g.loading&&((W=(w=t(v))==null?void 0:w.data)==null?void 0:W.length)==0?(r(),m("div",ya,[l(be,{class:"h-4 w-4"}),u("span",null,z(a.__("Loading...")),1)])):c.contacts.length?(r(!0),m(X,{key:1},aa(c.contacts,(_,G)=>(r(),m("div",{key:_.name},[u("div",{class:B(["px-2 pb-2.5",[G==0?"pt-5":"pt-2.5"]])},[l(Pe,{opened:_.opened},{header:d(({opened:fe,toggle:H})=>[u("div",ga,[u("div",{class:"flex h-7 items-center gap-2 truncate",onClick:J=>H()},[l(t(Je),{label:_.full_name,image:_.image,size:"md"},null,8,["label","image"]),u("div",ha,z(_.full_name),1),_.is_primary?(r(),x(C,{key:0,class:"ml-2",variant:"outline",label:a.__("Primary"),theme:"green"},null,8,["label"])):p("",!0)],8,va),u("div",ba,[l(t(Z),{options:me(_.name)},{default:d(()=>[l(n,{icon:"more-horizontal",class:"text-ink-gray-5",variant:"ghost"})]),_:2},1032,["options"]),l(n,{variant:"ghost",onClick:J=>t(M).push({name:"Contact",params:{contactId:_.name}})},{default:d(()=>[l(Se,{class:"h-4 w-4"})]),_:2},1032,["onClick"]),l(n,{variant:"ghost",onClick:J=>H()},{default:d(()=>[l(s,{name:"chevron-right",class:B(["h-4 w-4 text-ink-gray-9 transition-all duration-300 ease-in-out",{"rotate-90":fe}])},null,8,["class"])]),_:2},1032,["onClick"])])])]),default:d(()=>[u("div",Ca,[u("div",xa,[l(ke,{class:"h-4 w-4"}),Y(" "+z(_.email),1)]),u("div",Ia,[l(Q,{class:"h-4 w-4"}),Y(" "+z(_.mobile_no),1)])])]),_:2},1032,["opened"])],2),G!=c.contacts.length-1?(r(),m("div",wa)):p("",!0)]))),128)):(r(),m("div",ka,z(a.__("No contacts added")),1))])):p("",!0)]}),_:1},8,["sections","docname","onReload"])])):p("",!0)])):(r(),x(Ce,{key:1,doctype:"CRM Deal",tabs:E.value,reload:S.value,"onUpdate:reload":e[3]||(e[3]=c=>S.value=c),tabIndex:t(b),"onUpdate:tabIndex":e[4]||(e[4]=c=>U(b)?b.value=c:null),modelValue:t(o),"onUpdate:modelValue":e[5]||(e[5]=c=>U(o)?o.value=c:null)},null,8,["tabs","reload","tabIndex","modelValue"]))]),_:1})]),_:1},8,["modelValue","tabs"])])):p("",!0),l(qe,{modelValue:$.value,"onUpdate:modelValue":e[7]||(e[7]=i=>$.value=i),organization:R.value,"onUpdate:organization":e[8]||(e[8]=i=>R.value=i),options:{redirect:!1,afterInsert:i=>A("organization",i.name)}},null,8,["modelValue","organization","options"]),l(Ue,{modelValue:T.value,"onUpdate:modelValue":e[9]||(e[9]=i=>T.value=i),contact:O.value,options:{redirect:!1,afterInsert:i=>F(i.name)}},null,8,["modelValue","contact","options"])],64)}}};export{ut as default};
//# sourceMappingURL=MobileDeal-bd10bed1.js.map
