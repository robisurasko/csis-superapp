import{m as b,i as h,l as C,j as N,a as U,e as p,f as u,g as f,w as l,b as d,u as _,_ as M,d as y,t as j,c as I,F as J,r as L,q as O,p as V,E as k,I as w}from"./index-85632e04.js";import{u as q,_ as x}from"./index-31644aa3.js";import{_ as R}from"./Link-4317fd36.js";const T={class:"cursor-pointer text-ink-gray-9"},G={class:"mt-3 flex flex-wrap items-center gap-2"},W={__name:"AssignmentModal",props:b({doc:{type:Object,default:null},docs:{type:Set,default:new Set},doctype:{type:String,default:""}},{modelValue:{},modelModifiers:{},assignees:{},assigneesModifiers:{}}),emits:b(["reload"],["update:modelValue","update:assignees"]),setup(g,{emit:A}){const t=g,B=A,m=h(g,"modelValue"),n=h(g,"assignees"),r=C([]),v=C(""),{getUser:c}=q(),S=e=>{n.value=n.value.filter(s=>s.name!==e)},$=N(()=>t.doc?t.doctype=="CRM Lead"?t.doc.lead_owner:t.doc.deal_owner:""),z=e=>{v.value="";let s={name:e,image:c(e).user_image,label:c(e).full_name};n.value.find(o=>o.name===e)||n.value.push(s)};function D(){const e=r.value.filter(o=>!n.value.find(i=>i.name===o.name)).map(o=>o.name),s=n.value.filter(o=>!r.value.find(i=>i.name===o.name)).map(o=>o.name);if(e.length)for(let o of e)k("frappe.desk.form.assign_to.remove",{doctype:t.doctype,name:t.doc.name,assign_to:o});s.length&&(t.docs.size?(w("bulk_assign_to",{doctype:t.doctype}),k("frappe.desk.form.assign_to.add_multiple",{doctype:t.doctype,name:JSON.stringify(Array.from(t.docs)),assign_to:s,bulk_assign:!0,re_assign:!0}).then(()=>{B("reload")})):(w("assign_to",{doctype:t.doctype}),k("frappe.desk.form.assign_to.add",{doctype:t.doctype,name:t.doc.name,assign_to:s}))),m.value=!1}return U(()=>{r.value=[...n.value]}),(e,s)=>{const o=p("FeatherIcon"),i=p("Button"),E=p("ErrorMessage"),F=p("Dialog");return u(),f(F,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=a=>m.value=a),options:{title:e.__("Assign To"),size:"xl",actions:[{label:e.__("Cancel"),variant:"subtle",onClick:()=>{n.value=[...r.value],m.value=!1}},{label:e.__("Update"),variant:"solid",onClick:()=>D()}]},onClose:s[2]||(s[2]=()=>{n.value=[...r.value]})},{"body-content":l(()=>[d(R,{class:"form-control",value:"",doctype:"User",onChange:s[0]||(s[0]=a=>z(a)&&(e.$refs.input.value="")),placeholder:e.__("John Doe"),hideMe:!0},{"item-prefix":l(({option:a})=>[d(x,{class:"mr-2",user:a.value,size:"sm"},null,8,["user"])]),"item-label":l(({option:a})=>[d(_(M),{text:a.value},{default:l(()=>[y("div",T,j(_(c)(a.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["placeholder"]),y("div",G,[(u(!0),I(J,null,L(n.value,a=>(u(),f(_(M),{text:a.name,key:a.name},{default:l(()=>[y("div",null,[d(i,{label:_(c)(a.name).full_name,theme:"gray"},{prefix:l(()=>[d(x,{user:a.name,size:"sm"},null,8,["user"])]),suffix:l(()=>[a.name!==$.value?(u(),f(o,{key:0,class:"h-3.5",name:"x",onClick:O(H=>S(a.name),["stop"])},null,8,["onClick"])):V("",!0)]),_:2},1032,["label"])])]),_:2},1032,["text"]))),128))]),v.value?(u(),f(E,{key:0,class:"mt-2",message:e.__(v.value)},null,8,["message"])):V("",!0)]),_:1},8,["modelValue","options"])}}};export{W as _};
//# sourceMappingURL=AssignmentModal-f44425e3.js.map
