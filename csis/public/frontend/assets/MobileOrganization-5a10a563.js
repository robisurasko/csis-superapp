import{S as le,g as re}from"./view-de8292bb.js";import{_ as me}from"./FadedScrollableDiv-f3f408b5.js";import{_ as ce}from"./LayoutHeader-448e93da.js";import{_ as de}from"./AddressModal-fd287daa.js";import{_ as ue}from"./DealsListView-4c2e5303.js";import{_ as _e}from"./ContactsListView-b9f45afc.js";import{D as ge}from"./DetailsIcon-404b02bf.js";import{C as pe}from"./CameraIcon-72212b8c.js";import{D as fe}from"./DealsIcon-acabc22f.js";import{C as ye}from"./ContactsIcon-830ef67e.js";import{g as be}from"./settings-5fcce07e.js";import{u as he,g as ve,b as F,a as we,f as q,t as A}from"./index-31644aa3.js";import{s as ze}from"./statuses-1a7b8e83.js";import{as as ke,j as p,A as Ce,l as k,z as xe,E as R,x as N,ae as P,c as f,u as t,g as u,w as m,p as c,b as i,F as De,h as Oe,B as Re,e as C,f as s,d,y as Ie,C as I,t as x,n as L,D as T,G as Me}from"./index-85632e04.js";import{_ as Se}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-41a5d25f.js";import{_ as $e}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{F as Be}from"./FileUploader-ffa5e39e.js";import{b as Ve,c as je,a as Fe}from"./QuickEntryModal-157d8856.js";import"./Section-7d029c27.js";import"./DragVerticalIcon-e7d3e46c.js";import"./Link-4317fd36.js";import"./ArrowUpRightIcon-fffd9b01.js";import"./ListRows-e4885bb7.js";import"./AssignmentModal-f44425e3.js";import"./MultipleAvatar-8c461416.js";import"./IndicatorIcon-99f76624.js";import"./PhoneIcon-cb5df69f.js";import"./ListFooter-fc834b42.js";import"./label-f9f1f609.js";const qe={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Ae={key:1,class:"flex flex-col h-full overflow-hidden"},Ne={class:"flex flex-col items-start justify-start gap-4 p-4"},Pe={class:"flex gap-4 items-center"},Le={class:"group relative h-14.5 w-14.5"},Te={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Ee={class:"flex flex-col gap-2 truncate"},Ue={class:"truncate text-lg font-medium text-ink-gray-9"},Ge={class:"flex items-center gap-1.5"},Je={key:0},We={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},He={key:3,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},Ke={class:"flex flex-col items-center justify-center space-y-3"},xa={__name:"MobileOrganization",props:{organizationId:{type:String,required:!0}},setup(E){const r=E,{brand:U}=be(),{getUser:M}=he(),{$dialog:G}=ve(),{getDealStatus:J}=ze(),{doctypeMeta:W}=F("CRM Organization"),_=Oe(),H=Re(),n=ke({doctype:"CRM Organization",name:r.organizationId,cache:["organization",r.organizationId],fields:["*"],auto:!0}),K=p(()=>{let e=[{label:__("Organizations"),route:{name:"Organizations"}}];if(_.query.view||_.query.viewType){let a=re(_.query.view,_.query.viewType,"CRM Organization");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Organizations",params:{viewType:_.query.viewType},query:{view:_.query.view}}})}return e.push({label:S.value,route:{name:"Organization",params:{organizationId:r.organizationId}}}),e}),S=p(()=>{var a,l;let e=((a=W["CRM Organization"])==null?void 0:a.title_field)||"name";return((l=n.doc)==null?void 0:l[e])||r.organizationId});Ce(()=>({title:S.value,icon:U.favicon}));function Q(e){let a=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(a))return __("Only PNG and JPG images are allowed")}async function $(e){await R("frappe.client.set_value",{doctype:"CRM Organization",name:r.organizationId,fieldname:"organization_logo",value:(e==null?void 0:e.file_url)||""}),n.reload()}async function X(){G({title:__("Delete organization"),message:__("Are you sure you want to delete this organization?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await R("frappe.client.delete",{doctype:"CRM Organization",name:r.organizationId}),e(),H.push({name:"Organizations"})}}]})}function Y(){n.doc.website?window.open(n.doc.website,"_blank"):Me.error(__("No website found"))}const v=k(!1),Z=k({}),w=k({}),D=xe({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Organization"],params:{doctype:"CRM Organization"},auto:!0,transform:e=>ee(e)});function ee(e){return e.map(a=>(a.columns=a.columns.map(l=>(l.fields=l.fields.map(g=>g.fieldname==="address"?{...g,create:(h,O)=>{Z.value.address=h,w.value={},v.value=!0,O()},edit:async h=>{w.value=await R("frappe.client.get",{doctype:"Address",name:h}),v.value=!0}}:g),l)),a))}const y=k(0),ae=[{name:"Details",label:__("Details"),icon:ge},{name:"Deals",label:__("Deals"),icon:N(fe,{class:"h-4 w-4"}),count:p(()=>{var e;return(e=B.data)==null?void 0:e.length})},{name:"Contacts",label:__("Contacts"),icon:N(ye,{class:"h-4 w-4"}),count:p(()=>{var e;return(e=V.data)==null?void 0:e.length})}],B=P({type:"list",doctype:"CRM Deal",cache:["deals",r.organizationId],fields:["name","organization","currency","annual_revenue","status","email","mobile_no","deal_owner","modified"],filters:{organization:r.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),V=P({type:"list",doctype:"Contact",cache:["contacts",r.organizationId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:r.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),b=p(()=>{let e=[];return e=y.value?V:B,e.data?e.data.map(a=>y.value?ne(a):te(a)):[]}),{getFormattedCurrency:oe}=F("CRM Deal"),j=p(()=>y.value===0?ie:se);function te(e){var a,l;return{name:e.name,organization:{label:e.organization,logo:(a=n.doc)==null?void 0:a.organization_logo},annual_revenue:oe("annual_revenue",e),status:{label:e.status,color:(l=J(e.status))==null?void 0:l.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&M(e.deal_owner).full_name,...e.deal_owner&&M(e.deal_owner)},modified:{label:q(e.modified),timeAgo:__(A(e.modified))}}}function ne(e){var a;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(a=n.doc)==null?void 0:a.organization_logo},modified:{label:q(e.modified),timeAgo:__(A(e.modified))}}}const ie=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],se=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Organization"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,a)=>{const l=C("FeatherIcon"),g=C("Button"),h=C("ErrorMessage"),O=C("Badge");return s(),f(De,null,[t(n).doc?(s(),u(ce,{key:0},{default:m(()=>[d("header",qe,[i(t(Se),{items:K.value},{prefix:m(({item:o})=>[o.icon?(s(),u(me,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):c("",!0)]),_:1},8,["items"])])]),_:1})):c("",!0),t(n).doc?(s(),f("div",Ae,[i(t(Be),{onSuccess:$,validateFile:Q},{default:m(({openFileSelector:o,error:z})=>[d("div",Ne,[d("div",Pe,[d("div",Le,[i(t(we),{size:"3xl",class:"h-14.5 w-14.5",label:t(n).doc.organization_name,image:t(n).doc.organization_logo},null,8,["label","image"]),(s(),u(I(t(n).doc.organization_logo?t($e):"div"),Ie(t(n).doc.organization_logo?{options:[{icon:"upload",label:t(n).doc.organization_logo?e.__("Change image"):e.__("Upload image"),onClick:o},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>$("")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:m(()=>[d("div",Te,[i(pe,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),d("div",Ee,[d("div",Ue,x(t(n).doc.name),1),d("div",Ge,[i(g,{onClick:Y},{default:m(()=>[i(l,{name:"link",class:"h-4 w-4"})]),_:1}),i(g,{label:e.__("Delete"),theme:"red",size:"sm",onClick:X},{prefix:m(()=>[i(l,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])]),i(h,{message:e.__(z)},null,8,["message"])])])])]),_:1}),i(t(Fe),{as:"div",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=o=>y.value=o),tabs:ae,class:"overflow-auto"},{default:m(()=>[i(t(Ve),{class:"!px-4"},{default:m(({tab:o,selected:z})=>[o.name!=="Details"?(s(),f("button",{key:0,class:L(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":z}])},[o.icon?(s(),u(I(o.icon),{key:0,class:"h-5"})):c("",!0),T(" "+x(e.__(o.label))+" ",1),i(O,{class:L(["group-hover:bg-surface-gray-7",[z?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:m(()=>[T(x(o.count),1)]),_:2},1032,["class"])],2)):c("",!0)]),_:1}),i(t(je),null,{default:m(({tab:o})=>[o.name=="Details"?(s(),f("div",Je,[t(D).data?(s(),f("div",We,[i(le,{sections:t(D).data,doctype:"CRM Organization",docname:t(n).doc.name,onReload:t(D).reload},null,8,["sections","docname","onReload"])])):c("",!0)])):c("",!0),o.label==="Deals"&&b.value.length?(s(),u(ue,{key:1,class:"mt-4",rows:b.value,columns:j.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):c("",!0),o.label==="Contacts"&&b.value.length?(s(),u(_e,{key:2,class:"mt-4",rows:b.value,columns:j.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):c("",!0),!b.value.length&&o.name!=="Details"?(s(),f("div",He,[d("div",Ke,[(s(),u(I(o.icon),{class:"!h-10 !w-10"})),d("div",null,x(e.__("No {0} Found",[e.__(o.label)])),1)])])):c("",!0)]),_:1})]),_:1},8,["modelValue"])])):c("",!0),i(de,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=o=>v.value=o),address:w.value,"onUpdate:address":a[2]||(a[2]=o=>w.value=o)},null,8,["modelValue","address"])],64)}}};export{xa as default};
//# sourceMappingURL=MobileOrganization-5a10a563.js.map
