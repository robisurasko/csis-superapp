import{_ as ae}from"./FadedScrollableDiv-f3f408b5.js";import{D as O}from"./DetailsIcon-404b02bf.js";import{u as te,a as oe,S as se,b as le,c as ne,A as ie}from"./useActiveTabManager-a0215a12.js";import{E as re}from"./MultiSelectEmailInput-5ae16f74.js";import{C as de}from"./CommentIcon-2d82e902.js";import{P as ue}from"./PhoneIcon-cb5df69f.js";import{T as me}from"./TaskIcon-f5c3d969.js";import{N as ce}from"./NoteModal-4abb9e0a.js";import{W as pe}from"./WhatsAppIcon-cd469fd1.js";import{I as _e}from"./IndicatorIcon-99f76624.js";import{O as fe}from"./OrganizationsIcon-b5a4c50f.js";import{C as ve}from"./ContactsIcon-830ef67e.js";import{_ as be}from"./LayoutHeader-448e93da.js";import{_ as B,i as ye,c as ge,w as Ce}from"./Link-4317fd36.js";import{S as he,g as we}from"./view-de8292bb.js";import{_ as xe}from"./CustomActions-4107b940.js";import{g as Ie,b as Ve,s as Le,d as ke}from"./index-31644aa3.js";import{g as Ae}from"./settings-5fcce07e.js";import{s as Me}from"./statuses-1a7b8e83.js";import{z as S,G as v,E as T,a as Re,l as w,j as $,A as De,k as Se,c as b,u as t,g as y,w as u,p as g,b as n,d as r,H as z,F as Te,h as $e,B as ze,I as Ee,e as E,f as i,n as qe,t as x}from"./index-85632e04.js";import{_ as Ne}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-41a5d25f.js";import{_ as Ue}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{_ as P}from"./Switch.vue_vue_type_script_setup_true_lang-6e77b3e0.js";import{b as Oe,c as Be,a as Pe}from"./QuickEntryModal-157d8856.js";import"./Email2Icon-d49a0a62.js";import"./CalendarIcon-b9320815.js";import"./CallLogModal-359f4190.js";import"./DragVerticalIcon-e7d3e46c.js";import"./ArrowUpRightIcon-fffd9b01.js";import"./LeadsIcon-68ebc4cc.js";import"./DealsIcon-acabc22f.js";import"./TaskModal-d0e5aa30.js";import"./helpCenter-64650aa2.js";import"./MultipleAvatar-8c461416.js";import"./IconPicker-0c2832fa.js";import"./Popover-4a1551e7.js";import"./FileUploader-ffa5e39e.js";import"./EmailTemplateModal-adfdb337.js";import"./AssignmentModal-f44425e3.js";import"./Section-7d029c27.js";import"./label-f9f1f609.js";const je={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Fe={class:"absolute right-0"},We={key:1,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},Ge={class:"flex items-center gap-2"},He={key:2,class:"flex h-full overflow-hidden"},Je={key:0},Ke={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},Qe={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},Xe={class:"block text-base"},Ye={class:"ml-6"},Ze={class:"flex items-center justify-between text-base"},ea={key:1,class:"mt-2.5 text-base"},aa={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},ta={class:"block text-base"},oa={class:"ml-6"},sa={class:"flex items-center justify-between text-base"},la={key:1,class:"mt-2.5 text-base"},Ha={__name:"MobileLead",props:{leadId:{type:String,required:!0}},setup(j){const{brand:F}=Ae(),{$dialog:W,$socket:G}=Ie(),{statusOptions:H,getLeadStatus:J}=Me(),{doctypeMeta:K}=Ve("CRM Lead"),d=$e(),M=ze(),I=j,o=S({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:I.leadId},cache:["lead",I.leadId],onSuccess:a=>{Le(o),ke(o,{doc:a,$dialog:W,$socket:G,router:M,toast:v,updateField:D,createToast:v.create,deleteDoc:Z,resource:{lead:o,sections:L},call:T})}});Re(()=>{o.data||o.fetch()});const R=w(!1);function Q(a,e,l){e=Array.isArray(a)?"":e,!(!Array.isArray(a)&&X(a,e))&&S({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:I.leadId,fieldname:a,value:e},auto:!0,onSuccess:()=>{o.reload(),R.value=!0,v.success(__("Lead updated successfully")),l==null||l()},onError:_=>{var A;v.error(__(((A=_.messages)==null?void 0:A[0])||"Error updating lead"))}})}function X(a,e){var _;let l=o.data.fields_meta||{};return(_=l[a])!=null&&_.reqd&&!e?(v.error(__("{0} is a required field",[l[a].label])),!0):!1}const Y=$(()=>{let a=[{label:__("Leads"),route:{name:"Leads"}}];if(d.query.view||d.query.viewType){let e=we(d.query.view,d.query.viewType,"CRM Lead");e&&a.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:d.query.viewType},query:{view:d.query.view}}})}return a.push({label:q.value,route:{name:"Lead",params:{leadId:o.data.name}}}),a}),q=$(()=>{var e,l;let a=((e=K["CRM Lead"])==null?void 0:e.title_field)||"name";return((l=o.data)==null?void 0:l[a])||I.leadId});De(()=>({title:q.value,icon:F.favicon}));const V=$(()=>[{name:"Details",label:__("Details"),icon:O,condition:()=>ye.value},{name:"Activity",label:__("Activity"),icon:ne},{name:"Emails",label:__("Emails"),icon:re},{name:"Comments",label:__("Comments"),icon:de},{name:"Data",label:__("Data"),icon:O},{name:"Calls",label:__("Calls"),icon:ue,condition:()=>ge.value},{name:"Tasks",label:__("Tasks"),icon:me},{name:"Notes",label:__("Notes"),icon:ce},{name:"Attachments",label:__("Attachments"),icon:ie},{name:"WhatsApp",label:__("WhatsApp"),icon:pe,condition:()=>Ce.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:m}=te(V,"lastLeadTab");Se(V,a=>{if(a&&d.params.tabName){let e=a.findIndex(l=>l.name.toLowerCase()===d.params.tabName.toLowerCase());e!==-1&&(m.value=e)}});const L=S({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});function D(a,e,l){Q(a,e,()=>{o.data[a]=e,l==null||l()})}async function Z(a){await T("frappe.client.delete",{doctype:"CRM Lead",name:a}),M.push({name:"Leads"})}const k=w(!1),C=w(!1),h=w(!1),c=w(""),p=w("");async function ee(){if(C.value&&!c.value){v.error(__("Please select an existing contact"));return}if(h.value&&!p.value){v.error(__("Please select an existing organization"));return}!C.value&&c.value&&(c.value=""),!h.value&&p.value&&(p.value="");let a=await T("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:o.data.name,deal:{},existing_contact:c.value,existing_organization:p.value});a&&(k.value=!1,C.value=!1,h.value=!1,c.value="",p.value="",Ee("convert_lead_to_deal"),M.push({name:"Deal",params:{dealId:a}}))}return(a,e)=>{var N,U;const l=E("FeatherIcon"),_=E("Button"),A=E("Dialog");return i(),b(Te,null,[t(o).data?(i(),y(be,{key:0},{default:u(()=>[r("header",je,[n(t(Ne),{items:Y.value},{prefix:u(({item:s})=>[s.icon?(i(),y(ae,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):g("",!0)]),_:1},8,["items"]),r("div",Fe,[n(t(Ue),{options:t(H)("lead",D,t(o).data._customStatuses)},{default:u(({open:s})=>[n(_,{label:t(o).data.status},{prefix:u(()=>[n(_e,{class:qe(t(J)(t(o).data.status).color)},null,8,["class"])]),suffix:u(()=>[n(l,{name:s?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options"])])])]),_:1})):g("",!0),t(o).data?(i(),b("div",We,[n(oe,{modelValue:t(o).data._assignedTo,"onUpdate:modelValue":e[0]||(e[0]=s=>t(o).data._assignedTo=s),data:t(o).data,doctype:"CRM Lead"},null,8,["modelValue","data"]),r("div",Ge,[(N=t(o).data._customActions)!=null&&N.length?(i(),y(xe,{key:0,actions:t(o).data._customActions},null,8,["actions"])):g("",!0),n(_,{label:a.__("Convert"),variant:"solid",onClick:e[1]||(e[1]=s=>k.value=!0)},null,8,["label"])])])):g("",!0),(U=t(o))!=null&&U.data?(i(),b("div",He,[n(t(Pe),{as:"div",modelValue:t(m),"onUpdate:modelValue":e[6]||(e[6]=s=>z(m)?m.value=s:null),tabs:V.value,class:"overflow-auto"},{default:u(()=>[n(t(Oe),{class:"!px-3"}),n(t(Be),null,{default:u(({tab:s})=>[s.name=="Details"?(i(),b("div",Je,[t(o).data.sla_status?(i(),y(se,{key:0,modelValue:t(o).data,"onUpdate:modelValue":e[2]||(e[2]=f=>t(o).data=f),onUpdateField:D},null,8,["modelValue"])):g("",!0),t(L).data?(i(),b("div",Ke,[n(he,{sections:t(L).data,doctype:"CRM Lead",docname:t(o).data.name,onReload:t(L).reload},null,8,["sections","docname","onReload"])])):g("",!0)])):(i(),y(le,{key:1,doctype:"CRM Lead",tabs:V.value,reload:R.value,"onUpdate:reload":e[3]||(e[3]=f=>R.value=f),tabIndex:t(m),"onUpdate:tabIndex":e[4]||(e[4]=f=>z(m)?m.value=f:null),modelValue:t(o),"onUpdate:modelValue":e[5]||(e[5]=f=>z(o)?o.value=f:null)},null,8,["tabs","reload","tabIndex","modelValue"]))]),_:1})]),_:1},8,["modelValue","tabs"])])):g("",!0),n(A,{modelValue:k.value,"onUpdate:modelValue":e[11]||(e[11]=s=>k.value=s),options:{title:a.__("Convert to Deal"),size:"xl",actions:[{label:a.__("Convert"),variant:"solid",onClick:ee}]}},{"body-content":u(()=>[r("div",Qe,[n(fe,{class:"h-4 w-4"}),r("label",Xe,x(a.__("Organization")),1)]),r("div",Ye,[r("div",Ze,[r("div",null,x(a.__("Choose Existing")),1),n(t(P),{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=s=>h.value=s)},null,8,["modelValue"])]),h.value?(i(),y(B,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:p.value,doctype:"CRM Organization",onChange:e[8]||(e[8]=s=>p.value=s)},null,8,["value"])):(i(),b("div",ea,x(a.__("New organization will be created based on the data in details section")),1))]),r("div",aa,[n(ve,{class:"h-4 w-4"}),r("label",ta,x(a.__("Contact")),1)]),r("div",oa,[r("div",sa,[r("div",null,x(a.__("Choose Existing")),1),n(t(P),{modelValue:C.value,"onUpdate:modelValue":e[9]||(e[9]=s=>C.value=s)},null,8,["modelValue"])]),C.value?(i(),y(B,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:c.value,doctype:"Contact",onChange:e[10]||(e[10]=s=>c.value=s)},null,8,["value"])):(i(),b("div",la,x(a.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"])],64)}}};export{Ha as default};
//# sourceMappingURL=MobileLead-7093248f.js.map
