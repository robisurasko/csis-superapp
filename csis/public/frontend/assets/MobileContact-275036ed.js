import{_ as _e}from"./FadedScrollableDiv-f3f408b5.js";import{S as pe,g as fe}from"./view-de8292bb.js";import{_ as ge}from"./LayoutHeader-448e93da.js";import{D as ve}from"./DetailsIcon-404b02bf.js";import{P as ye}from"./PhoneIcon-cb5df69f.js";import{C as he}from"./CameraIcon-72212b8c.js";import{D as be}from"./DealsIcon-acabc22f.js";import{_ as we}from"./DealsListView-4c2e5303.js";import{_ as Ce}from"./AddressModal-fd287daa.js";import{g as ke,u as xe,b as H,a as K,f as De,t as Ie}from"./index-31644aa3.js";import{g as ze}from"./settings-5fcce07e.js";import{o as Se}from"./organizations-50691aa9.js";import{s as Pe}from"./statuses-1a7b8e83.js";import{c as $e}from"./Link-4317fd36.js";import{l as V,z as N,j as k,A as Ve,x as je,c as b,u as o,g,w as p,p as u,b as c,F as Me,h as Be,B as Fe,E as w,e as j,f as r,d as _,y as Ne,C as q,t as I,n as Q,D as W,G as M}from"./index-85632e04.js";import{_ as qe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-41a5d25f.js";import{_ as Ae}from"./Dropdown.vue_vue_type_script_setup_true_lang-4f930b23.js";import{F as Ee}from"./FileUploader-ffa5e39e.js";import{b as Re,c as Oe,a as Te}from"./QuickEntryModal-157d8856.js";import"./Section-7d029c27.js";import"./DragVerticalIcon-e7d3e46c.js";import"./ArrowUpRightIcon-fffd9b01.js";import"./ListRows-e4885bb7.js";import"./AssignmentModal-f44425e3.js";import"./MultipleAvatar-8c461416.js";import"./IndicatorIcon-99f76624.js";import"./ListFooter-fc834b42.js";import"./label-f9f1f609.js";const Ue={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Ge={key:1,class:"flex flex-col h-full overflow-hidden"},Le={class:"flex flex-col items-start justify-start gap-4 p-4"},Je={class:"flex gap-4 items-center"},He={class:"group relative h-14.5 w-14.5"},Ke={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Qe={class:"flex flex-col gap-2 truncate"},We={class:"truncate text-lg font-medium text-ink-gray-9"},Xe={key:0},Ye={class:"flex items-center gap-1.5"},Ze={key:0},ea={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},aa={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},ta={class:"flex flex-col items-center justify-center space-y-3"},Va={__name:"MobileContact",props:{contactId:{type:String,required:!0}},setup(X){const{brand:Y}=ze(),{$dialog:Z,makeCall:ee}=ke(),{getUser:A}=xe(),{getOrganization:E}=Se(),{getDealStatus:ae}=Pe(),{doctypeMeta:te}=H("Contact"),f=X,C=Be(),oe=Fe(),z=V(!1),m=V({}),S=V({}),a=N({url:"crm.api.contact.get_contact",cache:["contact",f.contactId],params:{name:f.contactId},auto:!0,transform:e=>({...e,actual_mobile_no:e.mobile_no,mobile_no:e.mobile_no})}),ne=k(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(C.query.view||C.query.viewType){let t=fe(C.query.view,C.query.viewType,"Contact");t&&e.push({label:__(t.label),icon:t.icon,route:{name:"Contacts",params:{viewType:C.query.viewType},query:{view:C.query.view}}})}return e.push({label:R.value,route:{name:"Contact",params:{contactId:f.contactId}}}),e}),R=k(()=>{var t,i;let e=((t=te.Contact)==null?void 0:t.title_field)||"name";return((i=a.data)==null?void 0:i[e])||f.contactId});Ve(()=>({title:R.value,icon:Y.favicon}));function le(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return __("Only PNG and JPG images are allowed")}async function O(e){await w("frappe.client.set_value",{doctype:"Contact",name:f.contactId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),a.reload()}async function se(){Z({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await w("frappe.client.delete",{doctype:"Contact",name:f.contactId}),e(),oe.push({name:"Contacts"})}}]})}const T=V(0),ie=[{name:"Details",label:__("Details"),icon:ve},{name:"Deals",label:__("Deals"),icon:je(be,{class:"h-4 w-4"}),count:k(()=>{var e;return(e=P.data)==null?void 0:e.length})}],P=N({url:"crm.api.contact.get_linked_deals",cache:["deals",f.contactId],params:{contact:f.contactId},auto:!0}),B=k(()=>!P.data||P.data==[]?[]:P.data.map(e=>de(e))),F=N({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0,transform:e=>k(()=>re(e))});function re(e){return e.map(t=>(t.columns=t.columns.map(i=>(i.fields=i.fields.map(d=>{var x,$,n,v;return d.fieldname==="email_id"?{...d,type:"dropdown",options:(($=(x=a.data)==null?void 0:x.email_ids)==null?void 0:$.map(s=>({name:s.name,value:s.email_id,selected:s.email_id===a.data.email_id,placeholder:"john@doe.com",onClick:()=>{m.value.email_id=s.email_id,U("email",s.email_id)},onSave:(l,y)=>{y?(G("email",l.value),a.data.email_ids.length===1&&(m.value.email_id=l.value)):L("Contact Email",l.name,"email_id",l.value)},onDelete:async(l,y)=>{var D;a.data.email_ids=a.data.email_ids.filter(h=>h.name!==l.name),!y&&await J("Contact Email",l.name),m.value.email_id===l.value&&(a.data.email_ids.length===0?m.value.email_id="":m.value.email_id=(D=a.data.email_ids.find(h=>h.is_primary))==null?void 0:D.email_id)}})))||[],create:()=>{var s,l;(l=(s=a.data)==null?void 0:s.email_ids)==null||l.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:d.name==="mobile_no"?{...d,read_only:!1,fieldtype:"dropdown",options:((v=(n=a.data)==null?void 0:n.phone_nos)==null?void 0:v.map(s=>({name:s.name,value:s.phone,selected:s.phone===a.data.actual_mobile_no,onClick:()=>{m.value.actual_mobile_no=s.phone,m.value.mobile_no=s.phone,U("mobile_no",s.phone)},onSave:(l,y)=>{y?(G("phone",l.value),a.data.phone_nos.length===1&&(m.value.actual_mobile_no=l.value)):L("Contact Phone",l.name,"phone",l.value)},onDelete:async(l,y)=>{var D;a.data.phone_nos=a.data.phone_nos.filter(h=>h.name!==l.name),!y&&await J("Contact Phone",l.name),m.value.actual_mobile_no===l.value&&(a.data.phone_nos.length===0?m.value.actual_mobile_no="":m.value.actual_mobile_no=(D=a.data.phone_nos.find(h=>h.is_primary_mobile_no))==null?void 0:D.phone)}})))||[],create:()=>{var s,l;(l=(s=a.data)==null?void 0:s.phone_nos)==null||l.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:d.name==="address"?{...d,create:(s,l)=>{m.value.address=s,S.value={},z.value=!0,l()},edit:async s=>{S.value=await w("frappe.client.get",{doctype:"Address",name:s}),z.value=!0}}:d}),i)),t))}async function U(e,t){await w("crm.api.contact.set_as_primary",{contact:a.data.name,field:e,value:t})&&(a.reload(),M.success(___("Contact updated")))}async function G(e,t){if(!t)return;await w("crm.api.contact.create_new",{contact:a.data.name,field:e,value:t})&&(a.reload(),M.success(__("Contact updated")))}async function L(e,t,i,d){await w("frappe.client.set_value",{doctype:e,name:t,fieldname:i,value:d})&&(a.reload(),M.success(__("Contact updated")))}async function J(e,t){await w("frappe.client.delete",{doctype:e,name:t}),await a.reload(),M.success(__("Contact updated"))}const{getFormattedCurrency:ce}=H("CRM Deal"),me=k(()=>ue);function de(e){var t,i;return{name:e.name,organization:{label:e.organization,logo:(t=E(e.organization))==null?void 0:t.organization_logo},annual_revenue:ce("annual_revenue",e),status:{label:e.status,color:(i=ae(e.status))==null?void 0:i.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&A(e.deal_owner).full_name,...e.deal_owner&&A(e.deal_owner)},modified:{label:De(e.modified),timeAgo:__(Ie(e.modified))}}}const ue=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,t)=>{const i=j("Button"),d=j("FeatherIcon"),x=j("ErrorMessage"),$=j("Badge");return r(),b(Me,null,[o(a).data?(r(),g(ge,{key:0},{default:p(()=>[_("header",Ue,[c(o(qe),{items:ne.value},{prefix:p(({item:n})=>[n.icon?(r(),g(_e,{key:0,icon:n.icon,class:"mr-2 h-4"},null,8,["icon"])):u("",!0)]),_:1},8,["items"])])]),_:1})):u("",!0),o(a).data?(r(),b("div",Ge,[c(o(Ee),{onSuccess:O,validateFile:le},{default:p(({openFileSelector:n,error:v})=>{var s;return[_("div",Le,[_("div",Je,[_("div",He,[c(o(K),{size:"3xl",class:"h-14.5 w-14.5",label:o(a).data.full_name,image:o(a).data.image},null,8,["label","image"]),(r(),g(q(o(a).data.image?o(Ae):"div"),Ne(o(a).data.image?{options:[{icon:"upload",label:o(a).data.image?e.__("Change image"):e.__("Upload image"),onClick:n},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>O("")}]}:{onClick:n},{class:"!absolute bottom-0 left-0 right-0"}),{default:p(()=>[_("div",Ke,[c(he,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),_("div",Qe,[_("div",We,[o(a).data.salutation?(r(),b("span",Xe,I(o(a).data.salutation+". "),1)):u("",!0),_("span",null,I(o(a).data.full_name),1)]),_("div",Ye,[o(a).data.actual_mobile_no?(r(),g(i,{key:0,label:e.__("Make Call"),size:"sm",onClick:t[0]||(t[0]=l=>o($e)&&o(ee)(o(a).data.actual_mobile_no))},{prefix:p(()=>[c(ye,{class:"h-4 w-4"})]),_:1},8,["label"])):u("",!0),c(i,{label:e.__("Delete"),theme:"red",size:"sm",onClick:se},{prefix:p(()=>[c(d,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"]),o(a).data.company_name?(r(),g(o(K),{key:1,size:"md",label:o(a).data.company_name,image:(s=o(E)(o(a).data.company_name))==null?void 0:s.organization_logo},null,8,["label","image"])):u("",!0)]),c(x,{message:e.__(v)},null,8,["message"])])])])]}),_:1}),c(o(Te),{as:"div",modelValue:T.value,"onUpdate:modelValue":t[1]||(t[1]=n=>T.value=n),tabs:ie,class:"overflow-auto"},{default:p(()=>[c(o(Re),{class:"!px-4"},{default:p(({tab:n,selected:v})=>[n.name=="Deals"?(r(),b("button",{key:0,class:Q(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:border-outline-gray-3 hover:text-ink-gray-9",{"text-ink-gray-9":v}])},[n.icon?(r(),g(q(n.icon),{key:0,class:"h-5"})):u("",!0),W(" "+I(e.__(n.label))+" ",1),c($,{class:Q(["group-hover:bg-surface-gray-7",[v?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:p(()=>[W(I(n.count),1)]),_:2},1032,["class"])],2)):u("",!0)]),_:1}),c(o(Oe),null,{default:p(({tab:n})=>[n.name=="Details"?(r(),b("div",Ze,[o(F).data?(r(),b("div",ea,[c(pe,{sections:o(F).data,doctype:"Contact",docname:o(a).data.name,onReload:o(F).reload},null,8,["sections","docname","onReload"])])):u("",!0)])):n.label==="Deals"&&B.value.length?(r(),g(we,{key:1,class:"mt-4",rows:B.value,columns:me.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):u("",!0),n.label==="Deals"&&!B.value.length?(r(),b("div",aa,[_("div",ta,[(r(),g(q(n.icon),{class:"!h-10 !w-10"})),_("div",null,I(e.__("No {0} Found",[e.__(n.label)])),1)])])):u("",!0)]),_:1})]),_:1},8,["modelValue"])])):u("",!0),c(Ce,{modelValue:z.value,"onUpdate:modelValue":t[2]||(t[2]=n=>z.value=n),address:S.value,"onUpdate:address":t[3]||(t[3]=n=>S.value=n)},null,8,["modelValue","address"])],64)}}};export{Va as default};
//# sourceMappingURL=MobileContact-275036ed.js.map
