{"version":3,"file":"helpCenter-64650aa2.js","sources":["../../../../node_modules/frappe-ui/frappe/Help/help.js","../../../../node_modules/frappe-ui/frappe/session.js","../../../../node_modules/frappe-ui/frappe/Onboarding/onboarding.js","../../../../node_modules/frappe-ui/frappe/HelpCenter/helpCenter.js"],"sourcesContent":["import { ref } from 'vue'\n\nexport const showHelpModal = ref(false)\nexport const minimize = ref(false)\n","export function sessionUser() {\n  let cookies = new URLSearchParams(document.cookie.split('; ').join('&'))\n  let _sessionUser = cookies.get('user_id')\n  if (_sessionUser === 'Guest') {\n    _sessionUser = null\n  }\n  return _sessionUser\n}\n","import call from '../../src/utils/call'\nimport { createResource } from '../../src/resources'\nimport { minimize, showHelpModal } from '../Help/help'\nimport { sessionUser } from '../session'\nimport { useStorage } from '@vueuse/core'\nimport { computed, reactive } from 'vue'\n\nconst onboardings = reactive({})\nconst onboardingStatus = useStorage('onboardingStatus', {})\n\nexport function useOnboarding(appName) {\n  const user = sessionUser()\n\n  if (!user || user === 'Guest') return\n\n  const isOnboardingStepsCompleted = useStorage(\n    'isOnboardingStepsCompleted' + appName + user,\n    false,\n  )\n\n  const onboardingSteps = computed(\n    () =>\n      onboardingStatus.value?.[user]?.[appName + '_onboarding_status'] || [],\n  )\n\n  if (!onboardingSteps.value.length && !isOnboardingStepsCompleted.value) {\n    createResource({\n      url: 'frappe.onboarding.get_onboarding_status',\n      cache: 'onboarding_status',\n      auto: true,\n      onSuccess: (data) => {\n        onboardingStatus.value[user] = data\n        syncStatus()\n      },\n    })\n  }\n\n  const stepsCompleted = computed(\n    () => onboardings[appName]?.filter((step) => step.completed).length || 0,\n  )\n  const totalSteps = computed(() => onboardings[appName]?.length || 0)\n\n  const completedPercentage = computed(() =>\n    Math.floor((stepsCompleted.value / totalSteps.value) * 100),\n  )\n\n  function skip(step, callback = null) {\n    updateOnboardingStep(step, true, true, callback)\n  }\n\n  function skipAll(callback = null) {\n    updateAll(true, callback)\n  }\n\n  function reset(step, callback = null) {\n    updateOnboardingStep(step, false, false, callback)\n  }\n\n  function resetAll(callback = null) {\n    updateAll(false, callback)\n  }\n\n  function updateOnboardingStep(\n    step,\n    value = true,\n    skipped = false,\n    callback = null,\n  ) {\n    if (isOnboardingStepsCompleted.value) return\n\n    if (!onboardingSteps.value.length) {\n      if (!onboardingStatus.value[user]) {\n        onboardingStatus.value[user] = {}\n      }\n      onboardingStatus.value[user][appName + '_onboarding_status'] =\n        onboardings[appName].map((s) => {\n          return { name: s.name, completed: false }\n        })\n    }\n\n    let index = onboardingSteps.value.findIndex((s) => s.name === step)\n    if (index !== -1) {\n      onboardingSteps.value[index].completed = value\n      onboardings[appName][index].completed = value\n    }\n\n    updateUserOnboardingStatus(onboardingSteps.value)\n\n    callback?.(step, skipped)\n\n    minimize.value = false\n  }\n\n  function updateAll(value, callback = null) {\n    if (isOnboardingStepsCompleted.value && value) return\n\n    if (!onboardingSteps.value.length) {\n      if (!onboardingStatus.value[user]) {\n        onboardingStatus.value[user] = {}\n      }\n\n      onboardingStatus.value[user][appName + '_onboarding_status'] =\n        onboardings[appName].map((s) => {\n          return { name: s.name, completed: value }\n        })\n    } else {\n      onboardingSteps.value.forEach((step) => {\n        step.completed = value\n      })\n    }\n\n    onboardings[appName].forEach((step) => {\n      step.completed = value\n    })\n\n    updateUserOnboardingStatus(onboardingSteps.value)\n\n    callback?.(value)\n  }\n\n  function updateUserOnboardingStatus(steps) {\n    call('frappe.onboarding.update_user_onboarding_status', {\n      steps: JSON.stringify(steps),\n      appName,\n    })\n  }\n\n  function syncStatus() {\n    if (isOnboardingStepsCompleted.value) return\n\n    if (onboardingSteps.value.length) {\n      let _steps = onboardingSteps.value\n      _steps.forEach((step, index) => {\n        onboardings[appName][index].completed = step.completed\n      })\n      isOnboardingStepsCompleted.value = _steps.every((step) => step.completed)\n    } else {\n      isOnboardingStepsCompleted.value = false\n    }\n  }\n\n  function setUp(steps) {\n    showHelpModal.value = !isOnboardingStepsCompleted.value\n\n    if (onboardings[appName]) return\n\n    onboardings[appName] = steps\n    syncStatus()\n  }\n\n  return {\n    steps: onboardings[appName],\n    stepsCompleted,\n    totalSteps,\n    completedPercentage,\n    isOnboardingStepsCompleted,\n    updateOnboardingStep,\n    skip,\n    skipAll,\n    reset,\n    resetAll,\n    setUp,\n    syncStatus,\n  }\n}\n","import { ref } from 'vue'\n\nexport const showHelpCenter = ref(false)\n"],"names":["showHelpModal","ref","minimize","sessionUser","_sessionUser","onboardings","reactive","onboardingStatus","useStorage","useOnboarding","appName","user","isOnboardingStepsCompleted","onboardingSteps","computed","_b","_a","createResource","data","syncStatus","stepsCompleted","step","totalSteps","completedPercentage","skip","callback","updateOnboardingStep","skipAll","updateAll","reset","resetAll","value","skipped","s","index","updateUserOnboardingStatus","steps","call","_steps","setUp","showHelpCenter"],"mappings":"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","x_google_ignoreList":[0,1,2,3]}